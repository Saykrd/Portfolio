"use strict";var DEBUG=!1,LOGGING=!1,Avota;!function(t){t.NAME="AvotaJS",t.MAJOR=1,t.MINOR=17,t.BUILD=6736,t.DATE="Thu Sep 17 14:30:23 PDT 2015",t.VERSION=t.MAJOR+"."+t.MINOR+"."+t.BUILD}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e,i){this.level=t,this.category=e,this.message=i}return t}();t.LogMessage=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t){this._category=this.getName(t)}return e.prototype.clear=function(){t.Log.clear()},e.prototype.trace=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.TRACE,this._category,e))},e.prototype.debug=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.DEBUG,this._category,e))},e.prototype.log=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.LOG,this._category,e))},e.prototype.print=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.PRINT,this._category,e))},e.prototype.info=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.INFO,this._category,e))},e.prototype.notice=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.NOTICE,this._category,e))},e.prototype.warn=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.WARN,this._category,e))},e.prototype.error=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.ERROR,this._category,e))},e.prototype.critical=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.CRITICAL,this._category,e))},e.prototype.fatal=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.FATAL,this._category,e))},e.prototype.mark=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.MARK,this._category,e))},e.prototype.command=function(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.Log.log(new t.LogMessage(t.Log.COMMAND,this._category,e))},e.prototype.assert=function(e){for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];e||t.Log.log(new t.LogMessage(t.Log.WARN,this._category,i))},e.prototype.getName=function(t){if(!t.constructor||!t.constructor.toString)return t=t.toString(),-1!=t.indexOf("[object ")?"["+t.substring(8):t;var e=t.constructor.toString().match(/function\s*(\w+)/);return e&&2==e.length?"["+e[1]+"]":void 0},e}();t.Logger=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.MARK=-1,e.ALL=0,e.TRACE=1,e.DEBUG=2,e.LOG=3,e.INFO=4,e.PRINT=5,e.NOTICE=6,e.WARN=7,e.CRITICAL=8,e.ERROR=9,e.FATAL=10,e.COMMAND=100,e.COLOR_TRACE="#CCCCCC",e.COLOR_DEBUG="#999999",e.COLOR_LOG="#666666",e.COLOR_INFO="#333333",e.COLOR_PRINT="#000000",e.COLOR_NOTICE="#0066FF",e.COLOR_WARN="#FF6600",e.COLOR_CRITICAL="#FF0000",e.COLOR_ERROR="#FF0000",e.COLOR_FATAL="#FF0000",e.COLOR_COMMAND="#6666FF",e._targets=[],e.getLogger=function(e){return new t.Logger(e)},e.log=function(t){for(var i=0;i<e._targets.length;i++)e._targets[i].output(t)},e.clear=function(){for(var t=0;t<e._targets.length;t++)e._targets[t].clear()},e.addTarget=function(t){-1==e._targets.indexOf(t)&&e._targets.push(t)},e.removeTarget=function(t){for(var t,i=0;i<e._targets.length;i++)t=e._targets.splice(e._targets.indexOf(t),1)[0],t.destroy()},e.removeAllTargets=function(){for(var t,i=0;i<e._targets.length;i++)t=e._targets[i],t.destroy();e._targets=[]},e.getTargetByType=function(t){var i,n;for(var o in e._targets)n=e._targets[o],n instanceof t&&(i=n);return i},e.setLevel=function(t){for(var i=0;i<e._targets.length;i++)e._targets[i].level=t},e.setFilters=function(t){for(var i=0;i<e._targets.length;i++)e._targets[i].filters=t},e.formatCategory=function(t){return t?"["+t+"]: ":""},e.resolveLevelName=function(t){switch(t){case e.ALL:return"|   ALL| ";case e.TRACE:return"| TRACE| ";case e.DEBUG:return"| DEBUG| ";case e.LOG:return"|   LOG| ";case e.PRINT:return"| PRINT| ";case e.INFO:return"|  INFO| ";case e.NOTICE:return"|NOTICE| ";case e.WARN:return"|  WARN| ";case e.ERROR:return"| ERROR| ";case e.CRITICAL:return"|CRITICAL| ";case e.FATAL:return"| FATAL| ";case e.COMMAND:return"|   CMD| "}},e.getColor=function(t){switch(t){case e.TRACE:return e.COLOR_TRACE;case e.DEBUG:return e.COLOR_DEBUG;case e.LOG:return e.COLOR_LOG;case e.PRINT:return e.COLOR_PRINT;case e.INFO:return e.COLOR_INFO;case e.NOTICE:return e.COLOR_NOTICE;case e.WARN:return e.COLOR_WARN;case e.ERROR:return e.COLOR_ERROR;case e.CRITICAL:return e.COLOR_CRITICAL;case e.FATAL:return e.COLOR_FATAL;case e.COMMAND:return e.COLOR_COMMAND;default:return e.COLOR_LOG}},e.destroy=function(){for(var t=0;t<e._targets.length;t++)e._targets[t].destroy(),e._targets[t]=null;e._targets=null},e}();t.Log=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){this.destroyed=!1,LOGGING&&(this._log=t.Log.getLogger(this),this._log.debug("Constructed"))}return e.prototype.destroy=function(){if(DEBUG&&this.destroyed)throw new Error("Already destroyed");this.destroyed=!0,LOGGING&&(this._log.debug("Destroyed"),this._log=null)},e}();t.AbstractBase=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.getClassName=function(t){if(!t.constructor||!t.constructor.toString)return t=t.toString(),-1!=t.indexOf("[object ")?"["+t.substring(8):t;var e=t.constructor.toString().match(/function\s*(\w+)/);return e&&2==e.length?e[1]:void 0},t}();t.ClassUtil=e}(Avota||(Avota={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i},Avota;!function(t){var e=function(e){function i(n){i.COUNT++,e.call(this),this.name=n||t.ClassUtil.getClassName(this),this.id=i.COUNT,this.tag=Number.MIN_VALUE}return __extends(i,e),i.COUNT=0,Object.defineProperty(i.prototype,"context",{get:function(){return this._context},set:function(t){this._context&&this._context._remove(this),this._context=t,this._context&&!this._context.has(this)&&this._context._add(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group",{get:function(){return this._group},set:function(t){this._group&&this._group._remove(this),this._group=t,this._group&&!this._group.has(this)&&this._group._add(this)},enumerable:!0,configurable:!0}),i.prototype._onCreate=function(){},i.prototype.destroy=function(){this._context&&this._context.has(this)&&this._context._remove(this),this._group&&this._group.has(this)&&this._group._remove(this),e.prototype.destroy.call(this),this._context=null,this._group=null,this.alias=null,this.tag=Number.MIN_VALUE},i}(t.AbstractBase);t.Element=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this,e),this._elements={}}return __extends(e,t),e.prototype._add=function(t){return t==this?void(LOGGING&&this._log.warn("Cannot add self.")):this.has(t)?void(LOGGING&&this._log.warn("Already contains item.")):(this._elements[t.id]=t,void(LOGGING&&this._log.debug("Added: "+t.name)))},e.prototype._remove=function(t){return t==this?void(LOGGING&&this._log.warn("Cannot remove self.")):this.has(t)?(this._elements[t.id]=null,delete this._elements[t.id],void(LOGGING&&this._log.debug("Removed: "+t.name))):void(LOGGING&&this._log.warn("Does not contain item."))},e.prototype.has=function(t){return null!=this._elements[t.id]},e.prototype.get=function(t){var e,i;for(var n in this._elements)if(e=this._elements[n],e.name==t||e.alias==t){i=e;break}return i},e.prototype.getByPrefix=function(t){var e,i=[];for(var n in this._elements)e=this._elements[n],(e.name&&-1!=e.name.indexOf(t)||e.alias&&-1!=e.alias.indexOf(t))&&i.push(e);return i},e.prototype.getByTag=function(t){var e,i=[];for(var n in this._elements)e=this._elements[n],e.tag==t&&i.push(e);return i},e.prototype.getByType=function(t){var e,i=[];for(var n in this._elements)e=this._elements[n],e instanceof t&&i.push(e);return i},e.prototype.getAll=function(){var t,e=[];for(var i in this._elements)t=this._elements[i],e.push(t);return e},e.prototype.empty=function(){for(var t,e=this.getAll(),i=0;i<e.length;i++)t=e[i],t.destroyed||t.destroy();for(var n in this._elements)this._elements[n]=null,delete this._elements[n]},e.prototype.create=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];var n;if(e&&e.length>0)switch(e.length){case 1:n=new t(e[0]);break;case 2:n=new t(e[0],e[1]);break;case 3:n=new t(e[0],e[1],e[2]);break;case 4:n=new t(e[0],e[1],e[2],e[3]);break;case 5:n=new t(e[0],e[1],e[2],e[3],e[4]);break;case 6:n=new t(e[0],e[1],e[2],e[3],e[4],e[5]);break;case 7:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);break;case 8:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);break;case 9:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);break;case 10:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}else n=new t;return LOGGING&&this._log.debug("Created: "+n.name),this._context&&(n.context=this._context),n.group=this,n._onCreate(),n},e.prototype.destroy=function(){this.empty(),t.prototype.destroy.call(this),this._elements=null},e}(t.Element);t.Group=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.isDesktop=!1,t.isMobile=!1,t.isiOS=!1,t.isAndroid=!1,t.isChromeOS=!1,t.isMacOS=!1,t.isLinux=!1,t.isWindows=!1,t.isiPhone=!1,t.isiPad=!1,t.isiPod=!1,t.isRetina=!1,t.isAndroidPhone=!1,t.isAndroidTablet=!1,t.isCocoonJS=!1,t.pixelRatio=1,t.colorDepth=-1,t.screenWidth=-1,t.screenHeight=-1,t.isSafari=!1,t.isWebApp=!1,t.isChrome=!1,t.isFirefox=!1,t.isIE=!1,t.hasCookies=!1,t.hasCanvas=!1,t.hasFile=!1,t.hasFileSystem=!1,t.hasLocalStorage=!1,t.hasApplicationCache=!1,t.hasWebGL=!1,t.hasWorker=!1,t.hasWebSQL=!1,t.hasTouch=!1,t.hasCSS3D=!1,t.hasRequestAnimationFrame=!1,t.hasUserMedia=!1,t.hasDeviceMotion=!1,t.hasWebAudio=!1,t.hasAudioTag=!1,t.hasOGG=!1,t.hasMP3=!1,t.hasWAV=!1,t.hasM4A=!1,t.hasVideoTag=!1,t.hasOGGVid=!1,t.hasH264=!1,t.hasWEBM=!1,Object.defineProperty(t,"orientation",{get:function(){return window.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isLandscape",{get:function(){return 90==t.orientation||-90==t.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isPortrait",{get:function(){return 0==t.orientation||180==t.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"windowWidth",{get:function(){return document.documentElement.clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"windowHeight",{get:function(){return document.documentElement.clientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t,"hash",{get:function(){return window.location.hash},enumerable:!0,configurable:!0}),t.getURLParameterByName=function(e,i){"undefined"==typeof i&&(i=!0);var n=new RegExp("[?&]"+e+"=([^&]*)").exec(t.querystring);return i?n&&decodeURIComponent(n[1].replace(/\/+/g,"")):n&&decodeURIComponent(n[1])},t.getHashParameterByName=function(e,i){"undefined"==typeof i&&(i=!0);var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)"),o=t.url.match(n);return o?o[1]:""},t._init=!1,t.init=function(){t._init||(t._checkAudio(),t._checkVideo(),t._checkBrowser(),t._checkFeatures(),t._checkPlatform(),t._checkDevice(),t._init=!0)},t._checkDevice=function(){t.pixelRatio=window.devicePixelRatio||1,t.screenWidth=window.screen.width*t.pixelRatio,t.screenHeight=window.screen.height*t.pixelRatio,t.colorDepth=window.screen.colorDepth,t.isMobile&&(t.screenWidth=window.screen.height*t.pixelRatio,t.screenHeight=window.screen.width*t.pixelRatio),2==t.pixelRatio&&(t.isRetina=!0)},t._checkBrowser=function(){var e=navigator.userAgent;t.browserVersion=navigator.appVersion.toString(),/Safari/.test(e)&&(t.browserName="Safari",t.isSafari=!0,t.browserVersion=e.substring(-1!=e.indexOf("Version")?e.indexOf("Version")+8:e.indexOf("Safari")+7)),/Mobile(.*)Safari/.test(e)&&(t.browserName="MobileSafari",t.isSafari=!0,t.browserVersion=e.substring(-1!=e.indexOf("Version")?e.indexOf("Version")+8:e.indexOf("Safari")+7)),/Chrome/.test(e)&&(t.browserName="Chrome",t.isChrome=!0,t.isSafari=!1,t.browserVersion=e.substring(e.indexOf("Chrome")+7)),/Firefox/.test(e)&&(t.browserName="Firefox",t.isFirefox=!0,t.browserVersion=e.substring(e.indexOf("Firefox")+8)),/MSIE (\d+\.\d+);/.test(e)&&(t.browserName="MSIE",t.isIE=!0,t.browserVersion=e.substring(e.indexOf("MSIE")+5)),navigator.standalone&&(t.browserName="WebApp",t.isWebApp=!0),navigator.isCocoonJS&&(t.browserName="CocoonJS",t.isCocoonJS=!0);var i;(-1!=(i=t.browserVersion.indexOf(";"))||-1!=(i=t.browserVersion.indexOf(" ")))&&(t.browserVersion=t.browserVersion.substring(0,i)),t.browserDetails={name:t.browserName,version:t.browserVersion};var n=t.browserVersion.split(".");switch(n.length){case 1:t.browserDetails.major=parseInt(n[0]);break;case 2:t.browserDetails.major=parseInt(n[0]),t.browserDetails.minor=parseInt(n[1]);break;case 3:t.browserDetails.major=parseInt(n[0]),t.browserDetails.minor=parseInt(n[1]),t.browserDetails.build=parseInt(n[2]);break;case 4:t.browserDetails.major=parseInt(n[0]),t.browserDetails.minor=parseInt(n[1]),t.browserDetails.build=parseInt(n[2]),t.browserDetails.revision=parseInt(n[3])}t.url=window.location.href,t.querystring=window.location.search,t.host=window.location.hostname,t.path=window.location.pathname,t.port=window.location.port},t._checkFeatures=function(){this.hasCookies="cookie"in document&&(document.cookie.length>0||(document.cookie="__test").indexOf.call(document.cookie,"__test")>-1),this.hasCanvas=!!window.CanvasRenderingContext2D||t.isCocoonJS,this.hasLocalStorage=!!window.Storage,this.hasFile=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.hasFileSystem=!!window.requestFileSystem,this.hasWebGL=!!window.WebGLRenderingContext,this.hasWorker=!!window.Worker,this.hasGeoLocation="geolocation"in navigator,this.hasWebSQL=!!window.openDatabase,this.hasApplicationCache=!!window.applicationCache,this.hasRequestAnimationFrame=!!window.requestAnimationFrame,this.hasUserMedia=!!navigator.getUserMedia,this.hasDeviceMotion=!!window.DeviceMotionEvent,("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled)&&(this.hasTouch=!0)},t._checkPlatform=function(){var e=navigator.userAgent;/Android/.test(e)&&(t.platformName="Android",t.isAndroid=!0),/CrOS/.test(e)&&(t.platformName="ChromeOS",t.isChromeOS=!0),/iP[ao]d|iPhone/i.test(e)&&(t.platformName="iOS",t.isiOS=!0),/Linux/.test(e)&&!t.isAndroid&&(t.platformName="Linux",t.isLinux=!0),/Mac OS/.test(e)&&!t.isiOS&&(t.platformName="Mac",t.isMacOS=!0),/Windows/.test(e)&&(t.platformName="Windows",t.isWindows=!0),/iPad/.test(e)&&(t.platformName="iPad",t.isiPad=!0),/iPhone/.test(e)&&(t.platformName="iPhone",t.isiPhone=!0),/iPod/.test(e)&&(t.platformName="iPod",t.isiPod=!0),t.isAndroid&&/[.0-9]* Mobile/.test(e)&&(t.platformName="AndroidPhone",t.isAndroidPhone=!0),t.isAndroid&&/[.0-9]* (?!Mobile)/.test(e)&&(t.platformName="AndroidTablet",t.isAndroidTablet=!0),(t.isWindows||t.isMacOS||t.isLinux)&&(t.isDesktop=!0),(t.isAndroid||t.isiOS||t.isWebApp)&&(t.isMobile=!0)},t._checkVideo=function(){var e=document.createElement("video");try{(t.hasVideoTag=!!e.canPlayType)&&(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(this.hasOGGVid=!0),e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(this.hasH264=!0),e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(this.hasWEBM=!0))}catch(i){}},t._checkAudio=function(){var e=document.createElement("audio");try{(t.hasAudioTag=!!e.canPlayType)&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.hasOGG=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.hasMP3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.hasWAV=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.hasM4A=!0))}catch(i){}window.AudioContext?this.hasWebAudio=!0:window.webkitAudioContext&&(this.hasWebAudio=!0)},t._checkCSS3D=function(){var t,e=document.createElement("p"),i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var n in i)void 0!==e.style[n]&&(e.style[n]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(i[n]));document.body.removeChild(e),this.hasCSS3D=void 0!==t&&t.length>0&&"none"!==t},t}();t.EnvUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.isString=function(t){return null!==t&&("string"==typeof t||"object"==typeof t&&t.constructor===String)},t.isNumber=function(t){return null!==t&&("number"==typeof t||"object"==typeof t&&t.constructor===Number)},t.isArray=function(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)},t.isBoolean=function(t){return null!==t&&("boolean"==typeof t||"object"==typeof t&&t.constructor===Boolean)},t.isType=function(t,e){return null!==t&&t instanceof e},t.create=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];var n;if(e&&e.length>0)switch(e.length){case 1:n=new t(e[0]);break;case 2:n=new t(e[0],e[1]);break;case 3:n=new t(e[0],e[1],e[2]);break;case 4:n=new t(e[0],e[1],e[2],e[3]);break;case 5:n=new t(e[0],e[1],e[2],e[3],e[4]);break;case 6:n=new t(e[0],e[1],e[2],e[3],e[4],e[5]);break;case 7:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);break;case 8:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);break;case 9:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);break;case 10:n=new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}else n=new t;return n},t}();t.ObjectUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e){this._timeStampOffset=0,this.level=t||0,this.filters=e||[],this._startTime=(new Date).getTime(),"undefined"==typeof console&&(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}})}return e.prototype.output=function(e){if(e.level>=this.level){if(this.filters.length>0){for(var i=!1,n=0;n<this.filters.length;n++)this.filters[n]==e.category&&(i=!0);if(!i)return}var o,r="%c";switch(r+="("+this.getTimeStamp()+")",r+=t.Log.resolveLevelName(e.level)+" ",r+=e.category+": ",t.ObjectUtil.isString(e.message[0])||t.ObjectUtil.isNumber(e.message[0])||t.ObjectUtil.isBoolean(e.message[0])?(r+=e.message,o=[r,"color: "+t.Log.getColor(e.level)]):o=[e.message[0]],e.level){default:case t.Log.TRACE:case t.Log.DEBUG:case t.Log.LOG:case t.Log.PRINT:1==o.length&&console.log.apply(console,[r,"color: "+t.Log.getColor(e.level)]),console.log.apply(console,o);break;case t.Log.INFO:1==o.length&&console.info.apply(console,[r,"color: "+t.Log.getColor(e.level)]),console.info.apply(console,o);break;case t.Log.WARN:1==o.length&&console.warn.apply(console,[r,"color: "+t.Log.getColor(e.level)]),console.warn.apply(console,o);break;case t.Log.ERROR:case t.Log.CRITICAL:case t.Log.FATAL:1==o.length&&console.error.apply(console,[r,"color: "+t.Log.getColor(e.level)]),console.error.apply(console,o)}}},e.prototype.clear=function(){this._timeStampOffset=this.getTimer()},e.prototype.getTimeStamp=function(){return this.getTimer()-this._timeStampOffset},e.prototype.getTimer=function(){return(new Date).getTime()-this._startTime},e.prototype.destroy=function(){this.filters=null},e}();t.ConsoleTarget=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e,i,n,o){"undefined"==typeof o&&(o=0),this.active=!0,this.params=null,this._listener=e,this._isOnce=i,this.context=n,this._signal=t,this.priority=o||0}return t.prototype.execute=function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},t.prototype.detach=function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},t.prototype.isBound=function(){return!!this._signal&&!!this._listener},t.prototype.isOnce=function(){return this._isOnce},t.prototype.getListener=function(){return this._listener},t.prototype.getSignal=function(){return this._signal},t.prototype._destroy=function(){delete this._signal,delete this._listener,delete this.context},t.prototype.toString=function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"},t}();t.SignalBinding=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0}return e.VERSION="1.0.0",e.prototype.validateListener=function(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},e.prototype._registerListener=function(e,i,n,o){var r,s=this._indexOfListener(e,n);if(-1!==s){if(r=this._bindings[s],r.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else r=new t.SignalBinding(this,e,i,n,o),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},e.prototype._addBinding=function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t.priority<=this._bindings[e].priority);this._bindings.splice(e+1,0,t)},e.prototype._indexOfListener=function(t,e){for(var i,n=this._bindings.length;n--;)if(i=this._bindings[n],i.getListener()===t&&i.context===e)return n;return-1},e.prototype.has=function(t,e){return"undefined"==typeof e&&(e=null),-1!==this._indexOfListener(t,e)},e.prototype.add=function(t,e,i){return"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},e.prototype.addOnce=function(t,e,i){return"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},e.prototype.remove=function(t,e){"undefined"==typeof e&&(e=null),this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},e.prototype.removeAll=function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},e.prototype.getNumListeners=function(){return this._bindings.length},e.prototype.halt=function(){this._shouldPropagate=!1},e.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];if(this.active){var i,n=this._bindings.length;if(this.memorize&&(this._prevParams=t),n){i=this._bindings.slice(0),this._shouldPropagate=!0;do n--;while(i[n]&&this._shouldPropagate&&i[n].execute(t)!==!1)}}},e.prototype.forget=function(){this._prevParams=null},e.prototype.dispose=function(){this.removeAll(),delete this._bindings,delete this._prevParams},e.prototype.toString=function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"},e}();t.Signal=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){var o=this;i.COUNT++,e.call(this,n),t.Log.getTargetByType(t.ConsoleTarget)||t.Log.addTarget(new t.ConsoleTarget),this.name=n||t.ClassUtil.getClassName(this)+"_"+i.COUNT,this.DOMContentLoadedSignal=new t.Signal,this.loadedSignal=new t.Signal,this.hashChangedSignal=new t.Signal,this.resizeSignal=new t.Signal,this.scrollSignal=new t.Signal,this.activatedSignal=new t.Signal,this.deactivatedSignal=new t.Signal,this.beforeUnloadSignal=new t.Signal,this.unloadSignal=new t.Signal,this.orientationChangeSignal=new t.Signal,this.visibilityChangeSignal=new t.Signal,this.deviceMotionSignal=new t.Signal,this.deviceOrientationSignal=new t.Signal,this.enterLandscapeSignal=new t.Signal,this.enterPortraitSignal=new t.Signal,i.registerContext(this,this.name),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(function(t){return o._onDOMContentLoaded(t)}):(this._onDOMLoadedListener=this._onDOMContentLoaded.bind(this),document.addEventListener("DOMContentLoaded",this._onDOMLoadedListener,!1)),this._onLoadListener=this._onLoaded.bind(this),this._onHashChangeListener=this._onHashChange.bind(this),this._onResizeListener=this._onResize.bind(this),this._onOrientationChangeListener=this._onOrientationChange.bind(this),this._onScrollListener=this._onScroll.bind(this),this._onFocusListener=this._onActivated.bind(this),this._onBlurListener=this._onDeactivated.bind(this),this._onPageShowListener=this._onActivated.bind(this),this._onPageHideListener=this._onDeactivated.bind(this),this._onBeforeUnloadListener=this._onBeforeUnload.bind(this),this._onUnloadListener=this._onUnload.bind(this),this._onVisibilityChangeListener=this._onVisibilityChange.bind(this),this._onDeviceMotionListener=this._onDeviceMotion.bind(this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),window.addEventListener("load",this._onLoadListener,!1),window.addEventListener("hashchange",this._onHashChangeListener,!1),window.addEventListener("resize",this._onResizeListener,!1),window.addEventListener("orientationchange",this._onOrientationChangeListener,!1),window.addEventListener("scroll",this._onScrollListener,!1),window.addEventListener("focus",this._onFocusListener,!1),window.addEventListener("blur",this._onBlurListener,!1),window.addEventListener("pageshow",this._onPageShowListener,!1),window.addEventListener("pagehide",this._onPageHideListener,!1),window.addEventListener("beforeunload",this._onBeforeUnloadListener,!1),window.addEventListener("unload",this._onUnloadListener,!1),window.addEventListener("devicemotion",this._onDeviceMotionListener,!1),window.addEventListener("deviceorientation",this._onDeviceOrientationListener,!1);for(var r=["","ms","moz","webkit","o"],s=0;s<r.length;s++)if(r[s]+"Hidden"in document){document.addEventListener(r[s]+"visibilitychange",this._onVisibilityChangeListener,!1);break}}return __extends(i,e),i.COUNT=0,i.NAME="Context",i.registerContext=function(e,n){if(void 0==i._contexts&&(i._contexts={}),i._contexts[n])throw new Error("Unable to register context, Context:"+n+" already exists.");i._contexts[n]=e,LOGGING&&t.Log.log(new t.LogMessage(t.Log.DEBUG,"[Context]","Context Registered: "+n))},i.unregisterContext=function(e){i._contexts[e]=null,delete i._contexts[e],LOGGING&&t.Log.log(new t.LogMessage(t.Log.DEBUG,"[Context]","Context Unregistered: "+e))},i.getContext=function(t){return i._contexts[t]},i.getAllContexts=function(){var t=[];for(var e in i._contexts)t.push(i._contexts[e]);return t},i.destroy=function(){for(var t in i._contexts){var e=i._contexts[t];e.destroyed||e.destroy(),i._contexts[t]=null,delete i._contexts[t]}i._contexts=null,i.COUNT=0},i.prototype.create=function(t){for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];var o=e.prototype.create.apply(this,[t].concat(i));return o.context!=this&&(o.context=this),o},i.prototype._onDOMContentLoaded=function(t){document.removeEventListener("DOMContentLoaded",this._onDOMLoadedListener),LOGGING&&this._log.log("DOM Ready"),this.DOMContentLoadedSignal.dispatch(t)},i.prototype._onLoaded=function(t){LOGGING&&this._log.log("Loaded"),self.focus(),this.loadedSignal.dispatch(t)},i.prototype._onHashChange=function(t){LOGGING&&this._log.log("Hash Changed"),this.hashChangedSignal.dispatch(t)},i.prototype._onResize=function(t){this.resizeSignal.dispatch(t)},i.prototype._onOrientationChange=function(){LOGGING&&this._log.log("Orientation Changed: "+t.EnvUtil.orientation),this.orientationChangeSignal.dispatch(t.EnvUtil.orientation),t.EnvUtil.isLandscape&&this.enterLandscapeSignal.dispatch(),t.EnvUtil.isPortrait&&this.enterPortraitSignal.dispatch()},i.prototype._onScroll=function(t){this.scrollSignal.dispatch(t)},i.prototype._onActivated=function(t){LOGGING&&this._log.log("Activated"),this.activatedSignal.dispatch(t)},i.prototype._onDeactivated=function(t){LOGGING&&this._log.log("Deactivated"),this.deactivatedSignal.dispatch(t)},i.prototype._onVisibilityChange=function(){for(var t=document.hidden,e=["ms","moz","webkit","o"],i=0;i<e.length;i++)"undefined"!=typeof document[e[i]+"Hidden"]&&(t=document[e[i]+"Hidden"]);LOGGING&&this._log.log("VisiblityChange: "+(t?"Hidden":"Visible")),this.visibilityChangeSignal.dispatch(t)},i.prototype._onDeviceMotion=function(t){this.deviceMotionSignal.dispatch(t)},i.prototype._onDeviceOrientation=function(t){this.deviceOrientationSignal.dispatch(t)},i.prototype._onBeforeUnload=function(t){LOGGING&&this._log.log("Before Unload"),this.beforeUnloadSignal.dispatch(t)},i.prototype._onUnload=function(t){LOGGING&&this._log.log("Unload"),this.unloadSignal.dispatch(t)},i.prototype.destroy=function(){window.removeEventListener("load",this._onLoadListener),window.removeEventListener("hashchange",this._onHashChangeListener),window.removeEventListener("resize",this._onResizeListener),window.removeEventListener("orientationchange",this._onOrientationChangeListener,!1),window.removeEventListener("scroll",this._onScrollListener),window.removeEventListener("focus",this._onFocusListener),window.removeEventListener("blur",this._onBlurListener),window.removeEventListener("beforeunload",this._onBeforeUnloadListener),window.removeEventListener("unload",this._onUnloadListener),window.removeEventListener("devicemotion",this._onDeviceMotionListener),window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),document.removeEventListener("DOMContentLoaded",this._onDOMLoadedListener);for(var t=["ms","moz","webkit","o"],n=0;n<t.length;n++)document.removeEventListener(t[n]+"visibilitychange",this._onVisibilityChangeListener,!1);i.unregisterContext(this.name),this.DOMContentLoadedSignal.removeAll(),this.loadedSignal.removeAll(),this.hashChangedSignal.removeAll(),this.resizeSignal.removeAll(),this.scrollSignal.removeAll(),this.activatedSignal.removeAll(),this.deactivatedSignal.removeAll(),this.beforeUnloadSignal.removeAll(),this.unloadSignal.removeAll(),this.orientationChangeSignal.removeAll(),this.visibilityChangeSignal.removeAll(),this.deviceMotionSignal.removeAll(),this.deviceOrientationSignal.removeAll(),this.enterLandscapeSignal.removeAll(),this.enterPortraitSignal.removeAll(),e.prototype.destroy.call(this),this.DOMContentLoadedSignal=null,this.loadedSignal=null,this.hashChangedSignal=null,this.resizeSignal=null,this.scrollSignal=null,this.activatedSignal=null,this.deactivatedSignal=null,this.beforeUnloadSignal=null,this.unloadSignal=null,this.orientationChangeSignal=null,this.visibilityChangeSignal=null,this.enterLandscapeSignal=null,this.enterPortraitSignal=null,this.deviceMotionSignal=null,this.deviceOrientationSignal=null,this._onDOMLoadedListener=null,this._onLoadListener=null,this._onHashChangeListener=null,this._onResizeListener=null,this._onOrientationChangeListener=null,this._onScrollListener=null,this._onFocusListener=null,this._onBlurListener=null,this._onPageShowListener=null,this._onPageHideListener=null,this._onBeforeUnloadListener=null,this._onUnloadListener=null,this._onVisibilityChangeListener=null,this._onDeviceMotionListener=null,this._onDeviceOrientationListener=null;var o=0;for(var r in i._contexts)o++;0==o&&i.destroy()},i}(t.Group);t.Context=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRegistered",{get:function(){return void 0!=this._owner},enumerable:!0,configurable:!0}),e.prototype.register=function(t,e){return this.isRegistered?void(LOGGING&&this._log.error(e+" is already registered with "+this._owner.name)):(this._owner=t,this.name=e,void this._onRegister())},e.prototype.unregister=function(){return this.isRegistered?(this._onUnregister(),void(this._owner=null)):void(LOGGING&&this._log.error(this.name+" is not registered"))},e.prototype.reset=function(){this._onReset()
},e.prototype._onRegister=function(){LOGGING&&this._log.debug("Registered to "+this._owner.name+", as "+this.name)},e.prototype._onUnregister=function(){LOGGING&&this._log.debug("Unregistered from "+this._owner.name)},e.prototype._onReset=function(){LOGGING&&this._log.trace("Reset")},e.prototype.destroy=function(){this.isRegistered&&this.unregister(),this._owner=null,t.prototype.destroy.call(this)},e}(t.Group);t.Component=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this,e),this._components={}}return __extends(e,t),e.prototype.addComponent=function(t,e){return t.owner||this._components[e]?void(LOGGING&&this._log.warn(e+" is already registered with "+t.owner.name)):(this._components[e]=t,t.register(this,e),void this._resetComponents())},e.prototype.removeComponent=function(t){return t&&t.owner==this&&this._components[t.name]?(this._components[t.name]=null,delete this._components[t.name],t.unregister(),void this._resetComponents()):void(LOGGING&&this._log.warn(t.name+" is not registered with this entity"))},e.prototype.removeComponentByName=function(t){var e=this.getComponent(t);return e&&e.owner==this&&this._components[e.name]?(this._components[e.name]=null,delete this._components[e.name],e.unregister(),void this._resetComponents()):void(LOGGING&&this._log.warn(e.name+" is not registered with this entity"))},e.prototype.getComponent=function(t){return this._components[t]},e.prototype.getComponentByType=function(t){var e;for(var i in this._components)if(e=this._components[i],e instanceof t)return e;return null},e.prototype.getComponentsByType=function(t){var e,i=[];for(var n in this._components)e=this._components[n],e instanceof t&&i.push(e);return i},e.prototype.getComponents=function(){var t=[];for(var e in this._components)t.push(this._components[e]);return t},e.prototype._registerComponents=function(){var t;for(var e in this._components)t=this._components[e],t.isRegistered||t.register(this,t.name);this._resetComponents()},e.prototype._resetComponents=function(){var t;for(var e in this._components)t=this._components[e],t.reset()},e.prototype.destroy=function(){var e;for(var i in this._components)e=this._components[i],e&&!e.destroyed&&e.destroy(),this._components[i]=null,delete this._components[i];this._components=null,t.prototype.destroy.call(this)},e}(t.Group);t.Entity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t){"undefined"==typeof t&&(t=i.NAME),e.call(this,t),this._typeCount=0,this._typeList={},this._bitList=[],this._bitMasks={}}return __extends(i,e),i.NAME="BitMaskManager",i.NUM_TYPES=64,Object.defineProperty(i.prototype,"typeCount",{get:function(){return this._typeCount},enumerable:!0,configurable:!0}),i.prototype.getBitMask=function(e){var i,n=e?e.toString():"default";return this._bitMasks[n]?i=this._bitMasks[n]:(i=this.create(t.BitMask,this,e),i.name="BitMask_"+n,this._bitMasks[n]=i),i},i.prototype.getType=function(t){return null==this._typeList[t]&&(this.typeCount<i.NUM_TYPES?(this._typeList[t]=this._typeCount,this._bitList[1<<this._typeCount]=t,this._typeCount++):LOGGING&&this._log.error("Only "+i.NUM_TYPES+" types can be created")),1<<this._typeList[t]},i.prototype.getTypeName=function(t){return this._bitList[t]},i.prototype.doesTypeMatch=function(t,e){return t.bits==1<<this._typeList[e]},i.prototype.doesTypeOverlap=function(t,e){return 0!=(t.bits&1<<this._typeList[e])},i.prototype.doTypesMatch=function(t,e){return t.bits==e.bits},i.prototype.doTypesOverlap=function(t,e){return 0!=(t.bits&e.bits)},i.prototype.destroy=function(){var t;for(t in this._typeList)this._typeList[t]=null,delete this._typeList[t];for(t in this._bitMasks)this._bitMasks[t]=null,delete this._bitMasks[t];this._typeList=null,this._bitList=null,this._bitMasks=null,e.prototype.destroy.call(this)},i}(t.Group);t.BitMaskManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){t.call(this),this._typeManager=e,"[object String]"===Object.prototype.toString.call(i)&&(this.typeName=i),"[object Array]"===Object.prototype.toString.call(i)&&(this.typeNames=i)}return __extends(e,t),Object.defineProperty(e.prototype,"typeManager",{get:function(){return this._typeManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bits",{get:function(){return this._bits},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){for(var t,e=0;e<this._typeManager.typeCount;e++)this._bits&1<<e&&(t=this._typeManager.getTypeName(1<<e));return t},set:function(t){this._bits=this._typeManager.getType(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeNames",{get:function(){for(var t=[],e=0;e<this._typeManager.typeCount;e++)this._bits&1<<e&&t.push(this._typeManager.getTypeName(1<<e));return t},set:function(t){this._bits=0;for(var e=0;e<t.length;e++)this._bits|=this._typeManager.getType(t[e])},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._typeManager=null,t.prototype.destroy.call(this)},e}(t.Element);t.BitMask=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i){"undefined"==typeof i&&(i=e.NAME),t.call(this,i),this._data={}}return __extends(e,t),e.NAME="SharedData",e.prototype.write=function(t,e){this._data[t]=e},e.prototype.read=function(t){return this._data[t]},e.prototype.destroy=function(){for(var e in this._data)this._data[e]=null,delete this._data[e];this._data=null,t.prototype.destroy.call(this)},e}(t.Element);t.SharedData=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,s),this.canvas=document.createElement(t.EnvUtil.isCocoonJS?"screencanvas":"canvas"),this.canvas.width=o,this.canvas.height=r,this.canvas.style["-webkit-transform"]="translate3d(0,0,0)",this.canvas.style["-moz-transform"]="translate3d(0,0,0)",this.canvas.style["-ms-transform"]="translate3d(0,0,0)",this.canvas.style["-o-transform"]="translate3d(0,0,0)",this.canvas.style["-transform"]="translate3d(0,0,0)",this.canvas.oncontextmenu=function(t){t.preventDefault()},document.getElementById(n)?(document.getElementById(n).innerHTML="",document.getElementById(n).appendChild(this.canvas),document.getElementById(n).style.overflow="hidden"):document.body.appendChild(this.canvas),this.renderContext=this.canvas.getContext("2d"),this.canvasScale=new t.Point(1,1),this.offset=t.DOMUtil.getOffset(this.canvas),this.bounds=new t.Rectangle(this.offset.x,this.offset.y,o,r)}return __extends(i,e),i.NAME="RenderCanvas",Object.defineProperty(i.prototype,"x",{get:function(){return this.bounds.x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.bounds.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.bounds.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.bounds.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this.bounds.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this.bounds.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this.renderContext.globalAlpha},set:function(t){this.renderContext.globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"backgroundColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this.canvas.style.backgroundColor=this._bgColor},enumerable:!0,configurable:!0}),i.prototype.setSize=function(t,e){this.clear(),this.canvas.width=t,this.canvas.height=e},i.prototype.translate=function(t,e){this.renderContext.translate(t,e)},i.prototype.rotate=function(t){this.renderContext.rotate(t)},i.prototype.scale=function(t,e){this.renderContext.scale(t,e)},i.prototype.setTransform=function(t,e,i,n,o,r){this.renderContext.setTransform(t,e,i,n,o,r)},i.prototype.drawImage=function(t,e,i,n,o,r,s,a,h){this.renderContext.drawImage(t,e,i,n,o,r,s,a,h)},i.prototype.getImageData=function(t,e,i,n){return this.renderContext.getImageData(t,e,i,n)},i.prototype.putImageData=function(t,e,i,n,o,r,s){this.renderContext.putImageData(t,e,i,n,o,r,s)},i.prototype.createImageData=function(t,e){return this.renderContext.createImageData(t,e)},Object.defineProperty(i.prototype,"globalCompositeOperation",{get:function(){return this.renderContext.globalCompositeOperation},set:function(t){this.renderContext.globalCompositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillStyle",{get:function(){return this.renderContext.fillStyle},set:function(t){this.renderContext.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strokeStyle",{get:function(){return this.renderContext.strokeStyle},set:function(t){this.renderContext.strokeStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineWidth",{get:function(){return this.renderContext.lineWidth},set:function(t){this.renderContext.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"font",{get:function(){return this.renderContext.font},set:function(t){this.renderContext.font=t},enumerable:!0,configurable:!0}),i.prototype.clip=function(){this.renderContext.clip()},i.prototype.beginPath=function(){this.renderContext.beginPath()},i.prototype.closePath=function(){this.renderContext.closePath()},i.prototype.rect=function(t,e,i,n){this.renderContext.rect(t,e,i,n)},i.prototype.arc=function(t,e,i,n,o,r){this.renderContext.arc(t,e,i,n,o,r)},i.prototype.moveTo=function(t,e){this.renderContext.moveTo(t,e)},i.prototype.lineTo=function(t,e){this.renderContext.lineTo(t,e)},i.prototype.arcTo=function(t,e,i,n,o){this.renderContext.arcTo(t,e,i,n,o)},i.prototype.fill=function(){this.renderContext.fill()},i.prototype.fillRect=function(t,e,i,n){this.renderContext.fillRect(t,e,i,n)},i.prototype.fillText=function(t,e,i,n){this.renderContext.fillText(t,e,i,n)},i.prototype.stroke=function(){this.renderContext.stroke()},i.prototype.strokeRect=function(t,e,i,n){this.renderContext.strokeRect(t,e,i,n)},i.prototype.strokeText=function(t,e,i,n){this.renderContext.strokeText(t,e,i,n)},i.prototype.clearRect=function(t,e,i,n){this.renderContext.clearRect(t,e,i,n)},i.prototype.createLinearGradient=function(t,e,i,n){this.renderContext.createLinearGradient(t,e,i,n)},i.prototype.createRadialGradient=function(t,e,i,n,o,r){this.renderContext.createRadialGradient(t,e,i,n,o,r)},i.prototype.createPattern=function(t,e){this.renderContext.createPattern(t,e)},i.prototype.clear=function(){this.renderContext.clearRect(0,0,this.width,this.height)},i.prototype.save=function(){this.renderContext.save()},i.prototype.restore=function(){this.renderContext.restore()},i.prototype.destroy=function(){this.clear(),this.canvas=null,this.renderContext=null,this.offset=null,this.bounds=null,e.prototype.destroy.call(this)},i}(t.Element);t.RenderCanvas=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i,o,r){"undefined"==typeof i&&(i=n.DEFAULT_TICKRATE),"undefined"==typeof o&&(o=!0),"undefined"==typeof r&&(r=n.NAME),e.call(this,r),this._tickRate=i,this._useInternalUpdate=o,this._deferredMethods=[],this._timeManagers=[],this._runningTimeManagers=[],this.startSignal=new t.Signal,this.stopSignal=new t.Signal,this.tick=new t.Signal,this.preTick=new t.Signal,this.postTick=new t.Signal,this.frame=new t.Signal,this.preFrame=new t.Signal,this.postFrame=new t.Signal,this._tickMS=1e3/this._tickRate,this._tickCap=4*this._tickMS,this._intervalScale=1,this._virtualTime=0,this._lastTime=-1,this._isRunning=!1,DEBUG&&(this._profiler=this.create(t.Profiler,r+"Profiler"))}return __extends(n,e),n.NAME="TimeManager",n.DEFAULT_TICKRATE=60,Object.defineProperty(n.prototype,"platformTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"virtualTime",{get:function(){return this._virtualTime},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tickRate",{get:function(){return this._tickRate},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tickMS",{get:function(){return this._tickMS},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"intervalScale",{get:function(){return this._intervalScale},set:function(t){this._intervalScale=t;for(var e=0;e<this._timeManagers.length;e++)this._timeManagers[e].intervalScale*=t},enumerable:!0,configurable:!0}),n.prototype.start=function(){var t=this;if(!this._isRunning){if(this._useInternalUpdate&&(this._timeoutID=window.requestAnimationFrame(function(){return t.onRequestAnimationFrame()})),this._runningTimeManagers.length>0){for(var e=0;e<this._runningTimeManagers.length;e++)this._runningTimeManagers[e].start();this._runningTimeManagers=[]}else for(var e=0;e<this._timeManagers.length;e++)this._timeManagers[e].start();DEBUG&&(this._profiler.add("tick","rgb(0,128,0)"),this._profiler.add("frame","rgb(128,0,0)"),this._profiler.add("update","rgb(0,128,0)"),this._profiler.add("system","rgb(128,128,0)")),this._isRunning=!0,this._lastTime=-1,this._prevTime=window.performance.now(),this.startSignal.dispatch(),LOGGING&&this._log.log(this.name+" Started")}},n.prototype.stop=function(){if(this._isRunning){this._useInternalUpdate&&window.cancelAnimationFrame(this._timeoutID);for(var t=0;t<this._timeManagers.length;t++)this._timeManagers[t].isRunning&&this._runningTimeManagers.push(this._timeManagers[t]),this._timeManagers[t].stop();this._isRunning=!1,this.stopSignal.dispatch(),LOGGING&&this._log.log(this.name+" Stopped")}},n.prototype.getTimeManager=function(t,e,i){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=this.tickRate);for(var o,r=0;r<this._timeManagers.length;r++)if(this._timeManagers[r].name==t){o=this._timeManagers[r];break}return o||(o=this.create(n,i,!1,t),o.intervalScale*=this.intervalScale,this._timeManagers.push(o)),this.addTickedObject(o,e),o},n.prototype.releaseTimeManager=function(t,e){"undefined"==typeof e&&(e=!0),-1!=this._runningTimeManagers.indexOf(t)&&this._runningTimeManagers.splice(this._runningTimeManagers.indexOf(t),1),this.removeTickedObject(t),t.reset(),e&&(-1!=this._timeManagers.indexOf(t)&&this._timeManagers.splice(this._timeManagers.indexOf(t),1),t.destroy())},n.prototype.addTickedObject=function(t,e){"undefined"==typeof e&&(e=0),this.tick.add(t.onTick,t,e)},n.prototype.removeTickedObject=function(t){this.tick.remove(t.onTick,t)},n.prototype.addAnimatedObject=function(t,e){"undefined"==typeof e&&(e=0),this.frame.add(t.onFrame,t,e)},n.prototype.removeAnimatedObject=function(t){this.frame.remove(t.onFrame,t)},n.prototype.callLater=function(t,e){"undefined"==typeof e&&(e=1);var n=i.COUNT++;return this._deferredMethods.push(new i(n,t,this._virtualTime+e)),n},n.prototype.removeCallLater=function(t){for(var e,i=0;i<this._deferredMethods.length;i++)e=this._deferredMethods[i],e&&e.id==t&&(e.method=null,e.args=null,this._deferredMethods[i]=null,this._deferredMethods.splice(i,1))},n.prototype.removeAllCallLaters=function(){this._deferredMethods=[]},n.prototype.onTick=function(){this._update()},n.prototype.onRequestAnimationFrame=function(){var t=this;this._update(),this._timeoutID=window.requestAnimationFrame(function(){return t.onRequestAnimationFrame()})},n.prototype._update=function(){if(this._isRunning){if(DEBUG&&this._profiler.end("system"),this._currentTime=window.performance.now(),this._lastTime<0)return void(this._lastTime=this._currentTime);this._deltaTime=this._currentTime-this._prevTime,this._frameTime=this.clamp(this._currentTime-this._lastTime,this._tickMS,this._tickCap),this._deltaTime>this._tickMS&&(this._isRunning&&this._advance(this._frameTime*this._intervalScale),this._prevTime=this._currentTime-this._deltaTime%this._tickMS),this._lastTime=this._currentTime,DEBUG&&this._profiler&&this._profiler.begin("system",Math.max(this._tickMS-(window.performance.now()-this._currentTime),0))}},n.prototype._advance=function(t){this._virtualTime+=t;for(var e=this._deferredMethods.length-1;e>=0;e--)if(this._deferredMethod=this._deferredMethods[e],this._deferredMethod&&this._deferredMethod.method){if(this._deferredMethod.due<this._virtualTime){if(this._deferredMethod.method.apply(null,this._deferredMethod.args),!(this._deferredMethod&&this._deferredMethods.length>0))return;this._deferredMethod.method=null,this._deferredMethod.args=null,this._deferredMethods[e]=null,this._deferredMethods.splice(e,1)}this._deferredMethod=null}DEBUG&&this._profiler.begin("tick"),this.preTick.dispatch(),this.tick.dispatch(t/1e3),this.postTick.dispatch(),DEBUG&&this._profiler.end("tick"),DEBUG&&this._profiler.begin("frame"),this.preFrame.dispatch(),this.frame.dispatch(t/1e3),this.postFrame.dispatch(),DEBUG&&this._profiler.end("frame"),DEBUG&&(this._profiler.end("update"),this._profiler.begin("update"))},n.prototype.reset=function(){for(var t=this._timeManagers.length-1;t>=0;t--)this.releaseTimeManager(this._timeManagers[t]);this.stop(),this.startSignal.removeAll(),this.stopSignal.removeAll(),this.tick.removeAll(),this.preTick.removeAll(),this.postTick.removeAll(),this.frame.removeAll(),this.preFrame.removeAll(),this.postFrame.removeAll(),this._deferredMethods=[]},n.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},n.prototype.destroy=function(){this.reset(),e.prototype.destroy.call(this),this._timeManagers=null,this._runningTimeManagers=null,this.startSignal=null,this.stopSignal=null,this.tick=null,this.preTick=null,this.postTick=null,this.frame=null,this.preFrame=null,this.postFrame=null,this._deferredMethods=null,this._deferredMethod=null,this._profiler=null},n}(t.Group);t.TimeManager=e;var i=function(){function t(t,e,i,n){"undefined"==typeof i&&(i=1),this.id=t,this.method=e,this.due=i,this.args=n}return t.COUNT=0,t}();t.DeferredMethod=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this._timeManager=e,this.priority=0}return __extends(e,t),e.prototype.onFrame=function(){},e.prototype._onRegister=function(){this._timeManager.addAnimatedObject(this,this.priority),t.prototype._onRegister.call(this)},e.prototype._onUnregister=function(){this._timeManager.removeAnimatedObject(this),t.prototype._onUnregister.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._timeManager=null},e}(t.Component);t.AnimatedComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r){"undefined"==typeof r&&(r=t.EngineConstants.SPATIAL),e.call(this,i),this._renderManager=n,this._spatialReference=r,this._worldTransform=new t.Matrix,this._localTransform=new t.Matrix,this._position=new t.Point,this._registration=new t.Point,this._center=new t.Point,this._offset=new t.Point,this._extents=new t.Rectangle,this._localTransform.identity(),this._worldTransform.identity(),this._width=1,this._height=1,this._registrationX=0,this._registrationY=0,this._positionX=0,this._positionY=0,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._layerIndex=0,this._zIndex=0,this._visible=!0,this._alpha=1,this._roundedPixels=!1,this._transformDirty=!0,this._layerIndexDirty=!0,this._zIndexDirty=!0,this.priority=-1,this._previousLayerIndex=-1,this._renderRect=new t.Rectangle,this._renderOffset=new t.Point,this._renderID=-1,this._isMask=!1,this._isBlinking=!1,this._isShaking=!1,o&&(this.view=o)}return __extends(i,e),i.NAME="RenderComponent",Object.defineProperty(i.prototype,"isDirty",{get:function(){return this._transformDirty},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isShaking",{get:function(){return this._isShaking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFlashing",{get:function(){return this._isFlashing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return.5*this._width*Math.abs(this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return.5*this._height*Math.abs(this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width*Math.abs(this._scaleX)},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height*Math.abs(this._scaleY)},set:function(t){this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._positionY+this._offsetY},set:function(t){this.y=t-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._positionX+this._offsetX},set:function(t){this.x=t-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._positionX+this._width*this._scaleX+this._offsetX},set:function(t){this.x=t-this._width*this._scaleX-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._positionY+this._height*this._scaleY+this._offsetY},set:function(t){this.y=t-this._height*this._scaleY-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._positionX+.5*this._width+this._offsetX},set:function(t){this.x=t-.5*this._width-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._positionY+.5*this._height+this._offsetY},set:function(t){this.y=t-.5*this._height-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._tint},set:function(e){if(this._tint=e,null==this._tint&&this._renderBuffer)this._renderContext.clearRect(0,0,this._renderSource.width,this._renderSource.height),this._renderContext.drawImage(this._renderSource,0,0,this._renderSource.width,this._renderSource.height);else{var i=t.ColorUtil.hexToARGB(this._tint);this._renderBuffer||(this._renderBuffer=document.createElement("canvas"),this._renderBuffer.width=this._renderSource.width,this._renderBuffer.height=this._renderSource.height,this._renderContext=this._renderBuffer.getContext("2d"),this._renderContext.drawImage(this._renderSource,0,0,this._renderSource.width,this._renderSource.height),this._view=this._renderBuffer),this._renderContext.fillStyle="rgba("+i[1]+", "+i[2]+", "+i[3]+", "+i[0]/255+")",this._renderContext.fillRect(0,0,this._renderSource.width,this._renderSource.height),this._renderContext.globalCompositeOperation="multiply",this._renderContext.drawImage(this._renderSource,0,0,this._renderSource.width,this._renderSource.height),this._renderContext.globalCompositeOperation="destination-atop",this._renderContext.drawImage(this._renderSource,0,0,this._renderSource.width,this._renderSource.height),this._renderContext.globalCompositeOperation="source-over"}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._mask},set:function(t){this._isMask||(this._mask&&(this._mask._renderComponent._isMask=!1),this._mask=t,this._maskRenderComponent=this._mask._renderComponent,this._maskRenderComponent._isMask=!0,this._mask.visible=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._view},set:function(t){var e=this._inRenderManager;e&&this._removeFromRenderManager(),this._renderSource=t,this._renderSource instanceof HTMLImageElement?(this._view=document.createElement("canvas"),this._view.width=this._renderSource.width,this._view.height=this._renderSource.height,this._renderContext=this._view.getContext("2d"),this._renderContext.drawImage(this._renderSource,0,0,this._renderSource.width,this._renderSource.height)):this._renderSource instanceof HTMLCanvasElement?(this._view=this._renderSource,this._renderContext=this._view.getContext("2d")):this._view=this._renderSource,this._width=this._view?this._view.width:0,this._height=this._view?this._view.height:0,this._renderOffset.x=0,this._renderOffset.y=0,this._renderRect.x=0,this._renderRect.y=0,this._renderRect.width=this._width,this._renderRect.height=this._height,this._registrationX=this.halfWidth,this._registrationY=this.halfHeight,e&&this._addToRenderManager()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this._localTransform},set:function(t){if(this._localTransform!=t){var e=t.a,i=t.b,n=t.c,o=t.d;this._positionX=t.tx,this._positionY=t.ty,this._scaleX=Math.sqrt(e*e+i*i),this._rotation=0!=this._scaleX?Math.atan2(i,e):0,this._scaleY=o*Math.cos(this._rotation)-n*Math.sin(this._rotation),this._registrationX=0,this._registrationY=0,this._localTransform=t,this._transformDirty=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._positionX},set:function(t){this._positionX!=t&&(this._positionX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._positionY},set:function(t){this._positionY!=t&&(this._positionY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._registrationX},set:function(t){this._registrationX!=t&&(this._registrationX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._registrationY},set:function(t){this._registrationY!=t&&(this._registrationY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX!=t&&(this._offsetX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY!=t&&(this._offsetY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!=t&&(this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!=t&&(this._rotation=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._layerIndex},set:function(t){this._layerIndex!=t&&(this._layerIndex=t,this._layerIndexDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex!=t&&(this._zIndex=t,this._zIndexDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"roundedPixels",{get:function(){return this._roundedPixels},set:function(t){this._roundedPixels!=t&&(this._roundedPixels=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position.setTo(this._positionX,this._positionY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._registration.setTo(this._registrationX,this._registrationY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.setTo(this._positionX+this._width*Math.abs(this._scaleX)*.5+this._offsetX,this._positionY+this._height*Math.abs(this._scaleY)*.5+this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset.setTo(this._offsetX,this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){var t=this._width,e=this._height,i=0,n=0,o=t*(1-i),r=t*-i,s=e*(1-n),a=e*-n,h=this._worldTransform,l=h.a,c=h.c,u=h.b,p=h.d,d=h.tx,f=h.ty,_=l*r+u*a+d,g=p*a+c*r+f,m=l*o+u*a+d,y=p*a+c*o+f,v=l*o+u*s+d,b=p*s+c*o+f,C=l*r+u*s+d,S=p*s+c*r+f,E=-1/0,A=-1/0,x=1/0,O=1/0;return x=x>_?_:x,x=x>m?m:x,x=x>v?v:x,x=x>C?C:x,O=O>g?g:O,O=O>y?y:O,O=O>b?b:O,O=O>S?S:O,E=_>E?_:E,E=m>E?m:E,E=v>E?v:E,E=C>E?C:E,A=g>A?g:A,A=y>A?y:A,A=b>A?b:A,A=S>A?S:A,this._extents.setTo(x,O,E-x,A-O)},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){var t=this;e.prototype._onRegister.call(this),this._timeManager.callLater(function(){return t._addToRenderManager()})},i.prototype._onReset=function(){e.prototype._onReset.call(this),this._owner.getComponent(this._spatialReference)&&(this._spatialComponent=this._owner.getComponent(this._spatialReference)),this._parent=this._owner._parent,this._children=this._owner._children},i.prototype._onUnregister=function(){e.prototype._onUnregister.call(this),this._spatialComponent=null,this._parent=null,this._children=null,this._removeFromRenderManager()},i.prototype._addToRenderManager=function(){!this._inRenderManager&&this._renderManager&&(this._renderManager.addRenderer(this),this._inRenderManager=!0,this._previousLayerIndex=this._layerIndex,this._layerIndexDirty=this._zIndexDirty=!1,this.updateNode(!0))},i.prototype._removeFromRenderManager=function(){this._inRenderManager&&this._renderManager&&(this._renderManager.removeRenderer(this),this._inRenderManager=!1)},i.prototype.globalToLocal=function(t){return this._worldTransform.transformPointInverse(t)},i.prototype.localToGlobal=function(t){return this._worldTransform.transformPoint(t)},i.prototype.onFrame=function(t){this.owner&&(this.updateReferences(),this.updateNode(),e.prototype.onFrame.call(this,t))},i.prototype.blink=function(e,i,n,o){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=.25),"undefined"==typeof o&&(o=!1),(!this._isBlinking||o)&&(this._blinkTimer||(this._blinkTimer=this.create(t.Timer,this._timeManager,i,e),this._blinkTimer.timerSignal.add(this._onBlink,this),this._blinkTimer.completeSignal.add(this._onBlinkComplete,this)),o&&this._currentAlpha&&(this._alpha=this._currentAlpha),this._currentAlpha=this._alpha,this._blinkAlpha=n,this._blinkTimer.reset(),this._blinkTimer.repeatCount=e,this._blinkTimer.delay=i/e,this._blinkTimer.start(),this._isBlinking=!0)},i.prototype.stopBlink=function(){this._isBlinking&&this._onBlinkComplete()},i.prototype._onBlink=function(){this._alpha=this._alpha==this._currentAlpha?this._blinkAlpha:this._currentAlpha},i.prototype._onBlinkComplete=function(){this._alpha=this._currentAlpha,this._isBlinking=!1,this._blinkTimer.reset()},i.prototype.shake=function(e,i,n){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=2),this._isShaking||(this._shakeTimer||(this._shakeTimer=this.create(t.Timer,this._timeManager,i,e),this._shakeTimer.timerSignal.add(this._onShake,this),this._shakeTimer.completeSignal.add(this._onShakeComplete,this)),this._currentOffsetX=this.offsetX,this._currentOffsetY=this.offsetY,this._shakeStrength=n,this._shakeTimer.reset(),this._shakeTimer.repeatCount=e,this._shakeTimer.delay=i/e,this._shakeTimer.start(),this._isShaking=!0)
},i.prototype.stopShake=function(){this._isShaking&&this._onShakeComplete()},i.prototype._onShake=function(){this.offsetX=this._currentOffsetX+t.Random.integer(-this._shakeStrength,this._shakeStrength),this.offsetY=this._currentOffsetY+t.Random.integer(-this._shakeStrength,this._shakeStrength)},i.prototype._onShakeComplete=function(){this.offsetX=this._currentOffsetX,this.offsetY=this._currentOffsetY,this._isShaking=!1,this._shakeTimer.reset()},i.prototype.flash=function(e,i,n){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),this._flashTimer||(this._flashTimer=this.create(t.Timer,this._timeManager,i,e),this._flashTimer.timerSignal.add(this._onFlash,this),this._flashTimer.completeSignal.add(this._onFlashComplete,this)),this._flashTimer.reset(),this._flashTimer.repeatCount=e,this._flashTimer.delay=i/e,this._flashColor=n,this.tint=this._flashColor,this._flashTimer.start(),this._isFlashing=!0},i.prototype.stopFlash=function(){this._isFlashing&&this._onFlashComplete()},i.prototype._onFlash=function(){this.tint=null!=this.tint?null:this._flashColor},i.prototype._onFlashComplete=function(){this._isFlashing=!1,this.tint=null,this._flashTimer&&this._flashTimer.reset()},i.prototype.render=function(t,e,i){this._isMask||(!this._parent||this._parent.destroyed||(i*=this._parent.alpha,this._parent.visible&&0!=i&&0!=this._parent.scaleX&&0!=this._parent.scaleY))&&(i*=this._alpha,this._visible&&0!=i&&0!=this._scaleX&&0!=this._scaleY&&(1!=i&&(this._globalAlpha=t.alpha,t.alpha=i),this._renderMatrix=this._worldTransform.clone(),this._renderMatrix.multiply(e),this._roundedPixels?t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx+.5|0,this._renderMatrix.ty+.5|0):t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx,this._renderMatrix.ty),t.drawImage(this._view,this._renderRect.x,this._renderRect.y,this._renderRect.width,this._renderRect.height,this._renderOffset.x,this._renderOffset.y,this._renderRect.width,this._renderRect.height),1!=i&&(t.alpha=this._globalAlpha),this._renderManager._draws++))},i.prototype.updateReferences=function(){if(this._spatialComponent&&(this.x=this._spatialComponent.x,this.y=this._spatialComponent.y,this.rotation=this._spatialComponent.rotation),this._zIndexDirty&&this._renderManager&&(this._renderManager.getLayer(this._layerIndex,!0).markDirty(),this._zIndexDirty=!1),this._layerIndexDirty&&this._renderManager){var t=this._layerIndex;this._layerIndex=this._previousLayerIndex,-1!=this._previousLayerIndex&&this._removeFromRenderManager(),this._layerIndex=t,this._addToRenderManager(),this._previousLayerIndex=this._layerIndex,this._layerIndexDirty=!1}},i.prototype.updateTransform=function(t,e){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!1),(this._transformDirty||t)&&(e&&this.updateReferences(),this._localTransform.identity(),this._localTransform.translate(this._positionX+this._registrationX,this._positionY+this._registrationY),this._localTransform.scale(this._scaleX,this._scaleY),this._localTransform.rotate(this._rotation*(Math.PI/180)),this._localTransform.translate(-this._registrationX+this._offsetX,-this._registrationY+this._offsetY),this._transformDirty=!1)},i.prototype.updateNode=function(t){if("undefined"==typeof t&&(t=!1),this._updateChildrenTransform=t,this._transformDirty&&(this.updateTransform(),this._updateChildrenTransform=!0),(this._updateChildrenTransform||t)&&(this._worldTransform.identity(),this._worldTransform.multiply(this._localTransform),this._parent=this._owner._parent,this._parent&&!this._parent.destroyed&&this._worldTransform.multiply(this._parent._worldTransform)),null!=this._children)for(var e=0;e<this._children.length;e++)this._children[e]._updateNode(this._updateChildrenTransform)},i.prototype._applyMask=function(){},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._position=null,this._registration=null,this._center=null,this._offset=null,this._extents=null,this._localTransform=null,this._worldTransform=null,this._blinkTimer=null,this._shakeTimer=null,this._renderSource=null,this._renderContext=null,this._renderManager=null,this._maskRenderComponent=null,this._renderMatrix=null,this._view=null},i}(t.AnimatedComponent);t.RenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this._timeManager=e,this.priority=0}return __extends(e,t),e.prototype.onTick=function(){},e.prototype._onRegister=function(){this._timeManager.addTickedObject(this,this.priority),t.prototype._onRegister.call(this)},e.prototype._onUnregister=function(){this._timeManager.removeTickedObject(this),t.prototype._onUnregister.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._timeManager=null},e}(t.Component);t.TickedComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n,o){"undefined"==typeof o&&(o=0),e.call(this,t,i),this._spriteSheets={},this._defaultFrame=o,n&&this.addSpriteSheet(n,!0)}return __extends(i,e),Object.defineProperty(i.prototype,"spriteSheet",{get:function(){return this._currentSpriteSheet},set:function(t){this._currentSpriteSheet=t,this._view?this._view=this._currentSpriteSheet.image:this.view=this._currentSpriteSheet.image,this.frameData||this.setFrame(this._defaultFrame),this.updateFrame(!0)},enumerable:!0,configurable:!0}),i.prototype.setFrame=function(e){this._currentSpriteSheet&&(t.ObjectUtil.isString(e)&&(this.frameData=this._currentSpriteSheet.getFrame(e)),t.ObjectUtil.isNumber(e)&&(this.frameData=this._currentSpriteSheet.getFrame(this._currentSpriteSheet.data.frames[e].filename)),this.frameData&&(this._width=this.frameData.offset.width,this._height=this.frameData.offset.height,this.registrationX=.5*this.frameData.offset.width+this.offsetX,this.registrationY=.5*this.frameData.offset.height+this.offsetY))},i.prototype.setSpriteSheet=function(t){this._currentSpriteSheet&&this._currentSpriteSheet.name==t||(this.spriteSheet=this._spriteSheets[t])},i.prototype.addSpriteSheet=function(t,e){"undefined"==typeof e&&(e=!0),this._spriteSheets[t.name]=t,e&&this.setSpriteSheet(t.name)},i.prototype.getSpriteSheet=function(e){return"undefined"==typeof e&&(e=t.SpriteSheet.NAME),this._spriteSheets[e]},i.prototype.removeSpriteSheet=function(t){this._spriteSheets[t]=null,delete this._spriteSheets[t]},i.prototype.onFrame=function(t){this.view&&this.owner&&((this.visible||this._isMask)&&this.updateFrame(),e.prototype.onFrame.call(this,t))},i.prototype.updateFrame=function(t){"undefined"==typeof t&&(t=!1),this.frameData&&(this._renderRect=this.frameData.region,this._renderOffset.x=this.frameData.offset.x,this._renderOffset.y=this.frameData.offset.y,this._width=this.frameData.offset.width,this._height=this.frameData.offset.height,this.registrationX=.5*this._width+this.offsetX,this.registrationY=.5*this._height+this.offsetY)},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._spriteSheets)this._spriteSheets[t]=null,delete this._spriteSheets[t];this._spriteSheets=null,this._currentSpriteSheet=null,this.frameData=null},i}(t.RenderComponent);t.SpriteSheetRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(t,e)}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.add=function(e,i){return"undefined"==typeof i&&(i=new t),i.setTo(this.x+e.x,this.y+e.y)},t.prototype.addTo=function(t,e){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(this.x+t,this.y+e)},t.prototype.subtractFrom=function(t,e){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this.setTo(this.x-t,this.y-e)},t.prototype.invert=function(){return this.setTo(this.y,this.x)},t.prototype.clamp=function(t,e){return this.clampX(t,e),this.clampY(t,e),this},t.prototype.clampX=function(t,e){return this.x=Math.max(Math.min(this.x,e),t),this},t.prototype.clampY=function(t,e){return this.x=Math.max(Math.min(this.x,e),t),this.y=Math.max(Math.min(this.y,e),t),this},t.prototype.clone=function(e){return"undefined"==typeof e&&(e=new t),e.setTo(this.x,this.y)},t.prototype.copyFrom=function(t){return this.setTo(t.x,t.y)},t.prototype.copyTo=function(t){return t.setTo(this.x,this.y)},t.prototype.distanceTo=function(t,e){"undefined"==typeof e&&(e=!1);var i=this.x-t.x,n=this.y-t.y;return e===!0?Math.round(Math.sqrt(i*i+n*n)):Math.sqrt(i*i+n*n)},t.distanceBetween=function(t,e,i){"undefined"==typeof i&&(i=!1);var n=t.x-e.x,o=t.y-e.y;return i===!0?Math.round(Math.sqrt(n*n+o*o)):Math.sqrt(n*n+o*o)},t.prototype.distanceCompare=function(t,e){return this.distanceTo(t)>=e?!0:!1},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y?!0:!1},t.interpolate=function(e,i,n){return new t(n*e.x+(1-n)*i.x,n*e.y+(1-n)*i.y)},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.polar=function(e,i){return new t(e*Math.cos(i),e*Math.sin(i))},t.prototype.setTo=function(t,e){return this.x=t,this.y=e,this},t.prototype.subtract=function(e,i){return"undefined"==typeof i&&(i=new t),i.setTo(this.x-e.x,this.y-e.y)},t.prototype.normalize=function(t){var e=this.length;if(e>0){var i=t/e;this.x*=i,this.y*=i}},t.prototype.toString=function(){return"[{Point (x="+this.x+" y="+this.y+")}]"},t}();t.Point=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x=0,this.y=0,this.width=0,this.height=0,this.setTo(t,e,i,n)}return Object.defineProperty(e.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t<this.y?0:this.y+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new t.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},set:function(t){var e=this.x-t;this.width+e<0?(this.width=0,this.x=t):(this.width+=e,this.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t<this.x?0:t-this.x},enumerable:!0,configurable:!0}),e.prototype.size=function(e){return"undefined"==typeof e&&(e=new t.Point),e.setTo(this.width,this.height)},Object.defineProperty(e.prototype,"volume",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},set:function(t){var e=this.y-t;this.height+e<0?(this.height=0,this.y=t):(this.height+=e,this.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new t.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){return"undefined"==typeof t&&(t=new e),t.setTo(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom?!0:!1},e.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},e.prototype.containsRect=function(t){return t.volume>this.volume?!1:t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom?!0:!1},e.prototype.copyFrom=function(t){return this.setTo(t.x,t.y,t.width,t.height)},e.prototype.copyTo=function(t){return t.copyFrom(this)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height?!0:!1},e.prototype.inflate=function(t,e){return isNaN(t)||isNaN(e)||(this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e),this},e.prototype.inflatePoint=function(t){return this.inflate(t.x,t.y)},e.prototype.intersection=function(t,i){return"undefined"==typeof i&&(i=new e),this.intersects(t)===!0&&(i.x=Math.max(t.x,this.x),i.y=Math.max(t.y,this.y),i.width=Math.min(t.right,this.right)-i.x,i.height=Math.min(t.bottom,this.bottom)-i.y),i},e.prototype.intersects=function(t){return t.x>=this.right?!1:t.right<=this.x?!1:t.bottom<=this.y?!1:t.y>=this.bottom?!1:!0},e.prototype.overlap=function(t){return t.x+t.width>this.x&&t.x<this.x+this.width&&t.y+t.height>this.y&&t.y<this.y+this.height},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.width<1||this.height<1?!0:!1},enumerable:!0,configurable:!0}),e.prototype.offset=function(t,e){return isNaN(t)||isNaN(e)||(this.x+=t,this.y+=e),this},e.prototype.offsetPoint=function(t){return this.offset(t.x,t.y)},e.prototype.setEmpty=function(){return this.setTo(0,0,0,0)},e.prototype.setTo=function(t,e,i,n){return isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||(this.x=t,this.y=e,i>0&&(this.width=i),n>0&&(this.height=n)),this},e.prototype.union=function(t,i){return"undefined"==typeof i&&(i=new e),i.setTo(Math.min(t.x,this.x),Math.min(t.y,this.y),Math.max(t.right,this.right),Math.max(t.bottom,this.bottom))},e.prototype.toString=function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.isEmpty+")}]"},e}();t.Rectangle=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function o(t,n,r,s){"undefined"==typeof r&&(r=o.NAME),"undefined"==typeof s&&(s=i.JSON),e.call(this,r),this._image=t,this._data=n,this.parseData(s)}return __extends(o,e),o.NAME="SpriteSheet",Object.defineProperty(o.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),o.prototype.parseData=function(e){this._regions={},this._frames={};var n,o,r,s,a,h,l,c,u,p,d;switch(e){case i.JSON:var f;if(this._data)for(var _=0;_<this._data.frames.length;_++)f=this._data.frames[_],n=f.filename,o=f.frame.x,r=f.frame.y,s=f.frame.w,a=f.frame.h,h=f.spriteSourceSize.x,l=f.spriteSourceSize.y,c=f.sourceSize.w,u=f.sourceSize.h,p=new t.Rectangle(o,r,s,a),d=new t.Rectangle(h,l,c,u),this.addFrame(n,p,d);else this._data={frames:[{filename:this.name}]},this.addFrame(this.name,new t.Rectangle(0,0,this._image.width,this._image.height),new t.Rectangle(0,0,this._image.width,this._image.height));break;case i.STARLING:}},o.prototype.getRegion=function(t){return this._regions[t]},o.prototype.getOffset=function(t){return this._frames[t]},o.prototype.getFrame=function(t){return this._frames[t]},o.prototype.getFrames=function(t){"undefined"==typeof t&&(t="");var e=[],i=[];for(var n in this._regions)0==n.indexOf(t)&&i.push(n);i.sort(this.sortCaseInsensitive);for(var o=0,r=i.length;r>o;o++)e.push(this.getFrame(i[o]));return e},o.prototype.addFrame=function(t,e,i){this._regions[t]=e,this._frames[t]=new n(e,i)},o.prototype.removeFrame=function(t){this._frames[t].destroy(),delete this._frames[t]},o.prototype.destroy=function(){var t;for(t in this._regions)this._regions[t]=null,delete this._regions[t];var i;for(t in this._frames)i=this._frames[t],i.destroy(),this._frames[t]=null,delete this._frames[t];i=null,this._data=null,this._image=null,this._frames=null,this._regions=null,e.prototype.destroy.call(this)},o.prototype.sortCaseInsensitive=function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0},o}(t.Element);t.SpriteSheet=e;var i=function(){function t(){}return t.JSON="JSON",t.STARLING="starling",t}();t.SpriteSheetFormat=i;var n=function(){function t(t,e){this.region=t,this.offset=e,this.destroyed=!1}return t.prototype.destroy=function(){this.region=null,this.offset=null,this.destroyed=!0},t}();t.FrameData=n}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof r&&(r=1e3),"undefined"==typeof s&&(s=i.PLAY_ONCE),e.call(this,n),this._frames=o,this._duration=r,this._defaultRepeatCount=s,this._currentRepeatCount=this._defaultRepeatCount,this.completeSignal=new t.Signal,this.repeatSignal=new t.Signal,this._elapsed=0,this._frameIndex=0,this._isAnimating=!1,this._totalFrames=this._frames.length,this._frameDuration=this._duration/this._totalFrames/1e3}return __extends(i,e),i.NAME="SpriteSheetAnimation",i.FRAME_CURRENT="current",i.FRAME_RANDOM="random",i.LOOP=-1,i.PLAY_ONCE=0,Object.defineProperty(i.prototype,"isAnimating",{get:function(){return this._isAnimating},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._frames[this._frameIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this._totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"repeatCount",{get:function(){return this._currentRepeatCount},set:function(t){this._defaultRepeatCount=t,this._currentRepeatCount=this._defaultRepeatCount},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t,this._frameDuration=Math.abs(this._duration)/this._totalFrames/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this._frameIndex},set:function(t){this._frameIndex=t%this._totalFrames},enumerable:!0,configurable:!0}),i.prototype.play=function(t,e,i,n){"undefined"==typeof t&&(t=Number.MIN_VALUE),"undefined"==typeof e&&(e=0),t!=Number.MIN_VALUE&&(this._currentRepeatCount=t),this.completeSignal.removeAll(),this.repeatSignal.removeAll(),void 0!=i&&this.completeSignal.addOnce(i),void 0!=n&&this.repeatSignal.add(n),this._frameIndex=e%this._totalFrames,this._isAnimating=!0},i.prototype.stop=function(){this._isAnimating=!1,this._frameIndex=0,this._currentRepeatCount=this._defaultRepeatCount},i.prototype.finish=function(){this._isAnimating=!1,this._frameIndex=this._totalFrames-1,this._currentRepeatCount=this._defaultRepeatCount,this.repeatSignal.removeAll(),this.completeSignal.dispatch()},i.prototype.restart=function(){this.stop(),this.play()},i.prototype.animate=function(t){if(this._isAnimating&&(this._elapsed+=t,this._repeat=!1,this._elapsed>=this._frameDuration&&(this._count=Math.floor(this._elapsed/this._frameDuration),this._frameIndex+this._count>=this._totalFrames&&(this._repeat=!0),this._frameIndex=(this._frameIndex+this._count)%this._totalFrames,this._elapsed=0),this._repeat)){if(0==this._currentRepeatCount)return void this.finish();this._currentRepeatCount>0&&this._currentRepeatCount--,this.repeatSignal.dispatch(this._currentRepeatCount)}},i.prototype.destroy=function(){this.completeSignal.removeAll(),this.repeatSignal.removeAll(),this._frames.length=0,this._frames=null,this.completeSignal=null,this.repeatSignal=null,e.prototype.destroy.call(this)},i}(t.Element);t.SpriteSheetAnimation=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t),this._renderComponent=i,this._animations={},this._totalAnimations=0,this._isPaused=!1}return __extends(i,e),i.NAME="SpriteSheetAnimationComponent",Object.defineProperty(i.prototype,"currentAnimation",{get:function(){return this._currentAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalAnimations",{get:function(){return this._totalAnimations},enumerable:!0,configurable:!0}),i.prototype.addAnimation=function(e,i,n,o){"undefined"==typeof n&&(n=1e3),"undefined"==typeof o&&(o=0),this._animations[e]=this.create(t.SpriteSheetAnimation,e,i,n,o),this._totalAnimations++},i.prototype.getAnimation=function(t){return this._animations[t]},i.prototype.removeAnimation=function(t){this._animations[t].destroy(),this._animations[t]=null,delete this._animations[t],this._totalAnimations--},i.prototype.play=function(t,e,i,n,o){"undefined"==typeof e&&(e=Number.MIN_VALUE),"undefined"==typeof i&&(i=0);var r=this._animations[t];this._renderComponent&&r&&(this._currentAnimation=r,this._currentAnimation.frameIndex=i,this._renderComponent.frameData=this._currentAnimation.currentFrame,this._currentAnimation.play(e,i,n,o)),LOGGING&&(r||this._log.warn("Unable to find animation: "+t))},i.prototype.pause=function(){this._isPaused=!this._isPaused},i.prototype.suspend=function(){this._isPaused=!0},i.prototype.resume=function(){this._isPaused=!1},i.prototype.restart=function(){this._currentAnimation&&this._currentAnimation.restart()},i.prototype.stop=function(){this._currentAnimation&&this._currentAnimation.stop()},i.prototype.onTick=function(t){this._currentAnimation&&!this._isPaused&&(this._currentAnimation.animate(t),this._renderComponent.frameData=this._currentAnimation.currentFrame)},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._animations)this._animations[t]=null,delete this._animations[t];this._currentAnimation=null,this._animations=null,this._renderComponent=null},i}(t.TickedComponent);t.SpriteSheetAnimationComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e,i){"undefined"==typeof i&&(i=-1),this.element=t,this.position=e,this.time=i}return t.prototype.clear=function(){this.element=null,this.position=null,this.time=-1},t.prototype.destroy=function(){this.clear()},t}();t.RayResult=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){e.call(this,i),this._spatialManager=n,this.active=!1,this.width=1,this.height=1,this._x=0,this._y=0,this.velocityX=0,this.velocityY=0,this.rotation=0,this.angularVelocity=0,this.collisionOffsetX=0,this.collisionOffsetY=0,this._center=new t.Point,this._position=new t.Point,this._velocity=new t.Point,this._extents=new t.Rectangle}return __extends(i,e),i.NAME="SpatialComponent",Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return.5*this.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return.5*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._x+this.width},set:function(t){this._x=t-this.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._y+this.height},set:function(t){this._y=t-this.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._x+.5*this.width},set:function(t){this._x=t-.5*this.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._y+.5*this.height},set:function(t){this._y=t-.5*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.x=this._x+.5*this.width,this._center.y=this._y+.5*this.height,this._center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position.x=this._x,this._position.y=this._y,this._position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocity",{get:function(){return this._velocity.x=this.velocityX,this._velocity.y=this.velocityY,this._velocity},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._extents.x=this._x,this._extents.y=this._y,this._extents.width=this.width,this._extents.height=this.height,this._extents},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){e.prototype._onRegister.call(this),this.active=!0,this._spatialManager.addSpatialComponent(this)},i.prototype._onUnregister=function(){e.prototype._onUnregister.call(this),this.active=!1,this._spatialManager.removeSpatialComponent(this)},i.prototype.onTick=function(t){this.active&&(this._x+=this.velocityX*t,this._y+=this.velocityY*t,this.rotation+=this.angularVelocity*t)},i.prototype.setType=function(t){this.type=this._spatialManager.typeManager.getBitMask(t)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._spatialManager=null,this._center=null,this._position=null,this._velocity=null,this._extents=null,this.type=null},i}(t.TickedComponent);t.SpatialComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r){e.call(this,i,n),this._spatialManager=o,this._inputManager=r,this._camera=this._renderManager.camera,this._entities=[],this.priority=-100,this.layerIndex=100,this._lineBuffer=7,this._pt=new t.Point,this._result=new t.Point,this._draws=0,this._renderManager.getLayer(this.layerIndex,!0).cameraTransformOptions=t.TransformOptions.SCALE,this._profiler=this.create(t.Profiler,name+"Profiler"),this._profiler.add("debug","rgb(255,255,255)")}return __extends(i,e),i.prototype._onRegister=function(){this.addEntities(this._owner),e.prototype._onRegister.call(this)},i.prototype._onUnregister=function(){this.removeEntities(),e.prototype._onUnregister.call(this)},i.prototype.addEntity=function(e){if(!this.hasEntity(e)){var i=e.getComponent(t.EngineConstants.RENDER),n=e.getComponent(t.EngineConstants.SPATIAL);(i||n)&&this._entities.push(e)}},i.prototype.hasEntity=function(t){return-1!=this._entities.indexOf(t)},i.prototype.addEntities=function(e){var i,n=e.getByType(t.Entity);e instanceof t.GameEntity&&this.addEntity(e);for(var o=0;o<n.length;o++)i=n[o],i?i instanceof t.Group&&this.addEntities(i):i instanceof t.GameEntity&&this.addEntity(i)},i.prototype.removeEntity=function(t){for(var e=0;e<this._entities.length;e++)if(this._entities[e].name==t)return void this._entities.splice(e,1)},i.prototype.removeEntities=function(t){for(var e=this._entities.length-1;e>=0;e--)(t&&-1!=this._entities[e].name.indexOf(t)||!t)&&this._entities.splice(e,1)},i.prototype.onFrame=function(i){this._profiler.begin("debug");var n,o;if(this._draws=0,this._renderContext.font="6px Monaco",this._inputManager._inputPointers.length!=t.InputManager.NUM_POINTERS){this._renderContext.fillStyle="rgba(255,255,153,0.25)",this._renderContext.beginPath();for(var r in this._inputManager._activeInputPointers)this._pointer=this._inputManager._activeInputPointers[r],this._pointer.isDown||(this._renderContext.moveTo(this._pointer.x,this._pointer.y),this._renderContext.arc(this._pointer.x,this._pointer.y,0==this._pointer.id?18:32,0,2*Math.PI));this._renderContext.closePath(),this._renderContext.fill(),this._draws++,this._renderContext.fillStyle="rgba(255,255,153,.75)",this._renderContext.beginPath();for(var r in this._inputManager._activeInputPointers)this._pointer=this._inputManager._activeInputPointers[r],this._pointer.isDown&&(this._renderContext.moveTo(this._pointer.x,this._pointer.y),this._renderContext.arc(this._pointer.x,this._pointer.y,0==this._pointer.id?18:32,0,2*Math.PI));this._renderContext.closePath(),this._renderContext.fill(),this._draws++,this._log.log("INPUT")}for(n=0;n<this._entities.length;n++)if(this._entity=this._entities[n],!this._entity.destroyed&&0!=this._entity.visible&&this._entity._debugInfo!=t.DebugInfo.NONE){if(this._renderComponents=this._entity.getComponentsByType(t.RenderComponent),this._renderComponents){for(this._renderContext.lineWidth=.5,this._renderContext.strokeStyle="rgb(255,0,0)",this._renderContext.fillStyle="rgba(255,0,0,0.25)",this._renderContext.beginPath(),o=0;o<this._renderComponents.length;o++)if((this._entity._debugInfo&t.DebugInfo.RENDER_BOUNDS)==t.DebugInfo.RENDER_BOUNDS&&(this._renderComponent=this._renderComponents[o],this._renderComponent.visible))if(this._renderLayer=this._renderManager.getLayer(this._renderComponent.layerIndex,!0),this._position=this._renderLayer.cameraTransformOptions==t.TransformOptions.NONE?this._renderComponent.position:this._camera.globalToLocal(this._renderComponent.position),this._center=this._renderLayer.cameraTransformOptions==t.TransformOptions.NONE?this._renderComponent.center:this._camera.globalToLocal(this._renderComponent.center),this._renderContext.moveTo(this._position.x,this._position.y),this._renderContext.arc(this._position.x,this._position.y,2,0,2*Math.PI),this._renderContext.moveTo(this._position.x+this._renderComponent.registrationX,this._position.y+this._renderComponent.registrationY),this._renderContext.arc(this._position.x+this._renderComponent.registrationX,this._position.y+this._renderComponent.registrationY,2,0,2*Math.PI),this._renderContext.moveTo(this._center.x,this._center.y),this._renderContext.arc(this._center.x,this._center.y,2,0,2*Math.PI),this._renderComponent instanceof t.TileRenderComponent){this._tileRenderComponent=this._renderComponent,this._topRow=this.clamp(Math.floor((this._camera.top-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._bottomRow=this.clamp(Math.ceil((this._camera.bottom-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._leftCol=this.clamp(Math.floor((this._camera.left-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols),this._rightCol=this.clamp(Math.ceil((this._camera.right-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols);for(var s=this._topRow;s<this._bottomRow;s++)for(var a=this._leftCol;a<this._rightCol;a++)this._tile=this._tileRenderComponent.tiles[s*this._tileRenderComponent.cols+a],this._tile&&this._tile.type&&this._renderContext.rect(this._position.x+a*this._tile.width,this._position.y+s*this._tile.height,this._tile.width,this._tile.height)}else 0!=this._renderComponent.rotation?(this._pt.x=this._position.x+this._renderComponent.offsetX,this._pt.y=this._position.y+this._renderComponent.offsetY,this._pt=this.rotatePoint(this._pt,this._center,this._renderComponent.rotation),this._renderContext.moveTo(this._pt.x,this._pt.y),this._pt.x=this._position.x+this._renderComponent.offsetX+this._renderComponent.width,this._pt.y=this._position.y+this._renderComponent.offsetY,this._pt=this.rotatePoint(this._pt,this._center,this._renderComponent.rotation),this._renderContext.lineTo(this._pt.x,this._pt.y),this._pt.x=this._position.x+this._renderComponent.offsetX+this._renderComponent.width,this._pt.y=this._position.y+this._renderComponent.offsetY+this._renderComponent.height,this._pt=this.rotatePoint(this._pt,this._center,this._renderComponent.rotation),this._renderContext.lineTo(this._pt.x,this._pt.y),this._pt.x=this._position.x+this._renderComponent.offsetX,this._pt.y=this._position.y+this._renderComponent.offsetY+this._renderComponent.height,this._pt=this.rotatePoint(this._pt,this._center,this._renderComponent.rotation),this._renderContext.lineTo(this._pt.x,this._pt.y),this._pt.x=this._position.x+this._renderComponent.offsetX,this._pt.y=this._position.y+this._renderComponent.offsetY,this._pt=this.rotatePoint(this._pt,this._center,this._renderComponent.rotation),this._renderContext.lineTo(this._pt.x,this._pt.y)):(this._renderContext.moveTo(this._position.x+this._renderComponent.offsetX,this._position.y+this._renderComponent.offsetY),this._renderContext.rect(this._position.x+this._renderComponent.offsetX,this._position.y+this._renderComponent.offsetY,this._renderComponent.width,this._renderComponent.height));
this._renderContext.closePath(),this._renderContext.fill(),this._renderContext.stroke(),this._draws+=2}if(this._spatialComponents=this._entity.getComponentsByType(t.SpatialComponent),this._spatialComponents){for(this._renderContext.strokeStyle="rgb(0,0,255)",this._renderContext.fillStyle="rgba(0,0,255,0.25)",this._renderContext.beginPath(),o=0;o<this._spatialComponents.length;o++)(this._entity._debugInfo&t.DebugInfo.SPATIAL_BOUNDS)==t.DebugInfo.SPATIAL_BOUNDS&&(this._spatialComponent=this._spatialComponents[o],this._spatialComponent.active&&(this._position=this._camera.globalToLocal(this._spatialComponent.position),this._center=this._camera.globalToLocal(this._spatialComponent.center),this._renderContext.moveTo(this._position.x,this._position.y),this._renderContext.arc(this._position.x,this._position.y,2,0,2*Math.PI),this._renderContext.moveTo(this._center.x,this._center.y),this._renderContext.arc(this._center.x,this._center.y,2,0,2*Math.PI),this._renderContext.moveTo(this._position.x,this._position.y),this._renderContext.rect(this._position.x,this._position.y,this._spatialComponent.width,this._spatialComponent.height)));for(this._renderContext.closePath(),this._renderContext.fill(),this._renderContext.stroke(),this._draws+=2,this._renderContext.lineWidth=1,this._renderContext.strokeStyle="rgb(0,255,0)",this._renderContext.beginPath(),o=0;o<this._spatialComponents.length;o++)(this._entity._debugInfo&t.DebugInfo.VELOCITY)==t.DebugInfo.VELOCITY&&(this._spatialComponent=this._spatialComponents[o],this._spatialComponent.active&&(this._center=this._camera.globalToLocal(this._spatialComponent.center),this._renderContext.moveTo(this._center.x,this._center.y),this._renderContext.lineTo(this._center.x+this._spatialComponent.velocityX/10,this._center.y+this._spatialComponent.velocityY/10)));this._renderContext.closePath(),this._renderContext.stroke(),this._draws++}if(this._spatialComponent=null,this._renderComponent=null,this._animationComponent=this._entity.getComponent(t.EngineConstants.ANIMATION),this._renderComponents&&this._renderComponents.length>0&&(this._renderComponent=this._renderComponents[0],this._renderLayer=this._renderManager.getLayer(this._renderComponent.layerIndex,!0),this._position=this._renderLayer.cameraTransformOptions==t.TransformOptions.NONE?this._renderComponent.position:this._camera.globalToLocal(this._renderComponent.position),this._center=this._renderLayer.cameraTransformOptions==t.TransformOptions.NONE?this._renderComponent.center:this._camera.globalToLocal(this._renderComponent.center),this._linePos=this._renderComponent.height),this._spatialComponents&&this._spatialComponents.length>0&&(this._spatialComponent=this._spatialComponents[0],this._position=this._camera.globalToLocal(this._spatialComponent.position),this._center=this._camera.globalToLocal(this._spatialComponent.center),this._linePos=this._spatialComponent.height),this._renderContext.fillStyle="rgb(255,255,255)",this._renderComponent instanceof t.TileRenderComponent&&(this._entity._debugInfo&t.DebugInfo.TYPE)==t.DebugInfo.TYPE){this._tileRenderComponent=this._renderComponent,this._topRow=this.clamp(Math.floor((this._camera.top-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._bottomRow=this.clamp(Math.ceil((this._camera.bottom-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._leftCol=this.clamp(Math.floor((this._camera.left-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols),this._rightCol=this.clamp(Math.ceil((this._camera.right-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols);for(var s=this._topRow;s<this._bottomRow;s++)for(var a=this._leftCol;a<this._rightCol;a++)this._tile=this._tileRenderComponent.tiles[s*this._tileRenderComponent.cols+a],this._tile&&this._tile.type&&(this._renderContext.fillText(this._tile.type.typeNames.toString(),this._position.x+a*this._tile.width,this._position.y+this._tile.height+s*this._tile.height-3),this._draws++)}this._info="",this._lineHeight=5,(this._entity._debugInfo&t.DebugInfo.NAME)==t.DebugInfo.NAME&&(this._info+=this._entity.name+" "),this._renderComponent&&(this._entity._debugInfo&t.DebugInfo.Z_INFO)==t.DebugInfo.Z_INFO&&(this._info+=this._renderComponent.layerIndex+"|"+this._renderComponent.zIndex+"|"+this._renderComponent._renderID),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._lineHeight),this._draws++,this._spatialComponent?(this._info="",(this._entity._debugInfo&t.DebugInfo.POSITION)==t.DebugInfo.POSITION&&(this._info+=(this._spatialComponent.x+.5|0)+","+(this._spatialComponent.y+.5|0)+" "),(this._entity._debugInfo&t.DebugInfo.CENTER)==t.DebugInfo.CENTER&&(this._info+="{"+(this._spatialComponent.centerX+.5|0)+","+(this._spatialComponent.centerY+.5|0)+"} "),(this._entity._debugInfo&t.DebugInfo.VELOCITY)==t.DebugInfo.VELOCITY&&(this._info+="["+(this._spatialComponent.velocityX+.5|0)+","+(this._spatialComponent.velocityY+.5|0)+"]"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++,this._info="",this._lineHeight+=this._lineBuffer,(this._entity._debugInfo&t.DebugInfo.DIMENSIONS)==t.DebugInfo.DIMENSIONS&&(this._info+=this._spatialComponent.width+"x"+this._spatialComponent.height+" "),(this._entity._debugInfo&t.DebugInfo.TYPE)==t.DebugInfo.TYPE&&this._spatialComponent.type&&(this._info+="["+this._spatialComponent.type.typeNames.toString()+"]"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++):this._renderComponent&&(this._info="",(this._entity._debugInfo&t.DebugInfo.POSITION)==t.DebugInfo.POSITION&&(this._info+=(this._renderComponent.x+.5|0)+","+(this._renderComponent.y+.5|0)+" "),(this._entity._debugInfo&t.DebugInfo.CENTER)==t.DebugInfo.CENTER&&(this._info+="{"+(this._renderComponent.centerX+.5|0)+","+(this._renderComponent.centerY+.5|0)+"}"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++,this._info="",this._lineHeight+=this._lineBuffer,(this._entity._debugInfo&t.DebugInfo.DIMENSIONS)==t.DebugInfo.DIMENSIONS&&(this._info+=this._renderComponent.width+"x"+this._renderComponent.height),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++),this._animationComponent&&this._animationComponent.currentAnimation&&(this._entity._debugInfo&t.DebugInfo.ANIMATION)==t.DebugInfo.ANIMATION&&(this._lineHeight+=this._lineBuffer,this._info="["+this._animationComponent.totalAnimations+"]",this._info+=" "+this._animationComponent.currentAnimation.name,this._info+=" "+(this._animationComponent.currentAnimation.frameIndex+1)+"/"+this._animationComponent.currentAnimation.totalFrames,this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++)}this._profiler.end("debug"),e.prototype.onFrame.call(this,i)},i.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},i.prototype.rotatePoint=function(t,e,i){if(0==i)return t;var n=i*(Math.PI/180),o=t.x-e.x,r=t.y-e.y,s=Math.cos(n),a=Math.sin(n);return this._result.x=e.x+o*s-r*a|0,this._result.y=e.y+r*s+o*a|0,this._result},i}(t.RenderComponent);t.DebugRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o){"undefined"==typeof o&&(o=i.NAME),e.call(this,o),this._timeManager=n,this._receivesOnTick=!1,this._children=[],this.data={},this._debugInfo=t.DebugInfo.ALL}return __extends(i,e),i.NAME="GameEntity",i.prototype.set=function(t){for(var e in t)this[e]=t[e]},i.prototype.enableOnTick=function(t){"undefined"==typeof t&&(t=0),this._timeManager.addTickedObject(this,t),this._receivesOnTick=!0},i.prototype.disableOnTick=function(){this._timeManager.removeTickedObject(this),this._receivesOnTick=!1},i.prototype.enable=function(){},i.prototype.disable=function(){},i.prototype.reset=function(){},i.prototype.onTick=function(){},i.prototype.addChild=function(t){return this.addChildAt(t,this._children.length)},i.prototype.addChildAt=function(t,e){t._parent&&t._parent.removeChild(t);var i=this.getChildIndex(t);return-1!=i&&this.removeChildAt(i),t._parent=this,this._updateNode(!0),t._updateNode(!0),this._children.splice(e,0,t),t},i.prototype.removeChild=function(t){var e=this._children.indexOf(t);e>=0&&this.removeChildAt(e)},i.prototype.removeChildAt=function(t){t<this._children.length&&(this._children[t]._parent=null,this._children.splice(t,1),this._updateNode(!0))},i.prototype.getChildAt=function(t){return t<this._children.length?this._children[t]:null},i.prototype.getChildIndex=function(t){return this._children.indexOf(t)},i.prototype.swapChildren=function(t,e){var i=this.getChildIndex(t),n=this.getChildIndex(e);this._children[i]=e,this._children[n]=t},i.prototype.removeAllChildren=function(){for(;this._children.length>0;)this.removeChildAt(0)},i.prototype.globalToLocal=function(){return null},i.prototype.localToGlobal=function(){return null},i.prototype._updateNode=function(){},i.prototype.destroy=function(){this._receivesOnTick&&this.disableOnTick(),this._parent&&this._parent.removeChild(this),this.removeAllChildren(),e.prototype.destroy.call(this),this.data=null,this._parent=null,this._children=null,this._timeManager=null},i}(t.Entity);t.GameEntity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r,s){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s=i.NAME),e.call(this,t,s),this._renderManager=n,this._canvas=document.createElement("canvas"),this._renderContext=this._canvas.getContext("2d"),this._canvas.width=o,this._canvas.height=r,this._timeManager&&this._renderManager&&this._createRenderComponent()}return __extends(i,e),i.NAME="CanvasGraphic",Object.defineProperty(i.prototype,"renderContext",{get:function(){return this._renderContext},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isShaking",{get:function(){return this._renderComponent.isShaking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFlashing",{get:function(){return this._renderComponent.isFlashing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._renderComponent.tint},set:function(t){this._renderComponent.tint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._renderComponent.mask},set:function(t){this._renderComponent.mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._renderComponent.view},set:function(t){this._renderComponent.view=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._renderComponent.compositeOperation},set:function(t){this._renderComponent.compositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._renderComponent.x},set:function(t){this._renderComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._renderComponent.y},set:function(t){this._renderComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._renderComponent.rotation},set:function(t){this._renderComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._renderComponent.centerX},set:function(t){this._renderComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._renderComponent.centerY},set:function(t){this._renderComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._renderComponent.top},set:function(t){this._renderComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._renderComponent.left},set:function(t){this._renderComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._renderComponent.right},set:function(t){this._renderComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._renderComponent.bottom},set:function(t){this._renderComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return this._renderComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return this._renderComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._renderComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._renderComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._renderComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_worldTransform",{get:function(){return this._renderComponent._worldTransform},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){this._renderComponent=this.create(t.RenderComponent,this._timeManager,this._renderManager,this._canvas),this.addComponent(this._renderComponent,t.EngineConstants.RENDER)},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},i.prototype.stopBlink=function(){this._renderComponent.stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},i.prototype.stopShake=function(){this._renderComponent.stopShake()},i.prototype.flash=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),this._renderComponent.flash(t,e,i)},i.prototype.stopFlash=function(){this._renderComponent.stopFlash()},i.prototype.setSize=function(t,e){this._canvas.width=t,this._canvas.height=e},i.prototype.translateContext=function(t,e){this._renderContext.translate(t,e)},i.prototype.rotateContext=function(t){this._renderContext.rotate(t)},i.prototype.scaleContext=function(t,e){this._renderContext.scale(t,e)},i.prototype.setTransform=function(t,e,i,n,o,r){this._renderContext.setTransform(t,e,i,n,o,r)},i.prototype.drawImage=function(t,e,i,n,o,r,s,a,h){r||(r=e),s||(s=i),a||(a=n),h||(h=o),this._renderContext.drawImage(t,e,i,n,o,r,s,a,h),this._renderManager._draws++},i.prototype.getImageData=function(t,e,i,n){return this._renderContext.getImageData(t,e,i,n)},i.prototype.putImageData=function(t,e,i,n,o,r,s){this._renderContext.putImageData(t,e,i,n,o,r,s)},i.prototype.createImageData=function(t,e){return this._renderContext.createImageData(t,e)},Object.defineProperty(i.prototype,"globalCompositeOperation",{set:function(t){this._renderContext.globalCompositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillStyle",{set:function(t){this._renderContext.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strokeStyle",{set:function(t){this._renderContext.strokeStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineWidth",{set:function(t){this._renderContext.lineWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineJoin",{set:function(t){this._renderContext.lineJoin=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineCap",{set:function(t){this._renderContext.lineCap=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOffsetX",{set:function(t){this._renderContext.shadowOffsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOffsetY",{set:function(t){this._renderContext.shadowOffsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowBlur",{set:function(t){this._renderContext.shadowBlur=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowColor",{set:function(t){this._renderContext.shadowColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"font",{set:function(t){this._renderContext.font=t},enumerable:!0,configurable:!0}),i.prototype.clip=function(){this._renderContext.clip()},i.prototype.beginPath=function(){this._renderContext.beginPath()},i.prototype.closePath=function(){this._renderContext.closePath()},i.prototype.rect=function(t,e,i,n){this._renderContext.rect(t,e,i,n)},i.prototype.arc=function(t,e,i,n,o,r){this._renderContext.arc(t,e,i,n,o,r)},i.prototype.moveTo=function(t,e){this._renderContext.moveTo(t,e)},i.prototype.lineTo=function(t,e){this._renderContext.lineTo(t,e)},i.prototype.arcTo=function(t,e,i,n,o){this._renderContext.arcTo(t,e,i,n,o)},i.prototype.quadraticCurveTo=function(t,e,i,n){this._renderContext.quadraticCurveTo(t,e,i,n)},i.prototype.fill=function(){this._renderContext.fill(),this._renderManager._draws++},i.prototype.fillRect=function(t,e,i,n){this._renderContext.fillRect(t,e,i,n),this._renderManager._draws++},i.prototype.fillText=function(t,e,i,n){this._renderContext.fillText(t,e,i,n),this._renderManager._draws++},i.prototype.stroke=function(){this._renderContext.stroke(),this._renderManager._draws++},i.prototype.strokeRect=function(t,e,i,n){this._renderContext.strokeRect(t,e,i,n),this._renderManager._draws++},i.prototype.strokeText=function(t,e,i,n){this._renderContext.strokeText(t,e,i,n),this._renderManager._draws++},i.prototype.clearRect=function(t,e,i,n){this._renderContext.clearRect(t,e,i,n)},i.prototype.createLinearGradient=function(t,e,i,n){return this._renderContext.createLinearGradient(t,e,i,n)},i.prototype.createRadialGradient=function(t,e,i,n,o,r){return this._renderContext.createRadialGradient(t,e,i,n,o,r)},i.prototype.createPattern=function(t,e){return this._renderContext.createPattern(t,e)},i.prototype.clear=function(){this._renderContext.clearRect(0,0,this.width,this.height)},i.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},i.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},i.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},i.prototype.destroy=function(){this.clear(),e.prototype.destroy.call(this),this._canvas=null,this._renderContext=null,this._renderComponent=null,this._renderManager=null},i}(t.GameEntity);t.CanvasGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.NONE=1,t.RENDER_BOUNDS=2,t.SPATIAL_BOUNDS=4,t.NAME=8,t.Z_INFO=16,t.POSITION=32,t.CENTER=64,t.VELOCITY=128,t.DIMENSIONS=256,t.TYPE=512,t.ANIMATION=1024,t.ALL=t.RENDER_BOUNDS|t.SPATIAL_BOUNDS|t.NAME|t.Z_INFO|t.POSITION|t.VELOCITY|t.DIMENSIONS|t.TYPE|t.ANIMATION,t}();t.DebugInfo=e;var i=function(i){function n(e){i.call(this,e.timeManager,e.renderManager,e.width,e.height,n.NAME),this._game=e,this._spatialManager=this._game.spatialManager,this._inputManager=this._game.inputManager,this._camera=this._renderManager.camera,this._entities=[],this.layerIndex=t.EngineConstants.LAYERINDEX_DEBUG,this._lineBuffer=7,this._pt=new t.Point,this._result=new t.Point,this._draws=0,this._renderManager.getLayer(this.layerIndex,!0).cameraTransformOptions=t.TransformOptions.NONE,this._profiler=this.create(t.Profiler,name+"Profiler"),this._profiler.add("debug","rgb(255,255,255)"),this._timeManager.preFrame.add(this.onFrame,this)}return __extends(n,i),n.NAME="DebugRenderGraphic",n.prototype.addEntity=function(e){if(!this.hasEntity(e)){var i=e.getComponent(t.EngineConstants.RENDER),n=e.getComponent(t.EngineConstants.SPATIAL);(i||n)&&this._entities.push(e)}},n.prototype.hasEntity=function(t){return-1!=this._entities.indexOf(t)},n.prototype.addEntities=function(e){var i,n=e.getByType(t.Entity);e instanceof t.GameEntity&&this.addEntity(e);for(var o=0;o<n.length;o++)i=n[o],i?i instanceof t.Group&&this.addEntities(i):i instanceof t.GameEntity&&this.addEntity(i)},n.prototype.removeEntity=function(t){for(var e=0;e<this._entities.length;e++)if(this._entities[e].name==t)return void this._entities.splice(e,1)},n.prototype.removeEntities=function(t){for(var e=this._entities.length-1;e>=0;e--)(t&&-1!=this._entities[e].name.indexOf(t)||!t)&&this._entities.splice(e,1)},n.prototype.removeAllEntities=function(){for(var t=this._entities.length-1;t>=0;t--)this._entities.splice(t,1);this._entities=[]},n.prototype.onFrame=function(){this._profiler.begin("debug");var i,n;if(this._draws=0,this._renderContext.font="8px Monaco",this._renderContext.clearRect(0,0,this.width,this.height),this._inputManager._inputPointers.length!=t.InputManager.NUM_POINTERS){this._renderContext.fillStyle="rgba(255,255,153,0.25)",this._renderContext.beginPath();for(var o in this._inputManager._activeInputPointers)this._pointer=this._inputManager._activeInputPointers[o],this._pointer.isDown||(this._renderContext.moveTo(this._pointer.x,this._pointer.y),this._renderContext.arc(this._pointer.x,this._pointer.y,0==this._pointer.id?18:32,0,2*Math.PI));this._renderContext.closePath(),this._renderContext.fill(),this._draws++,this._renderContext.fillStyle="rgba(255,255,153,.75)",this._renderContext.beginPath();for(var o in this._inputManager._activeInputPointers)this._pointer=this._inputManager._activeInputPointers[o],this._pointer.isDown&&(this._renderContext.moveTo(this._pointer.x,this._pointer.y),this._renderContext.arc(this._pointer.x,this._pointer.y,0==this._pointer.id?18:32,0,2*Math.PI));this._renderContext.closePath(),this._renderContext.fill(),this._draws++}for(i=0;i<this._entities.length;i++)if(this._entity=this._entities[i],!this._entity.destroyed&&0!=this._entity.visible&&this._entity._debugInfo!=e.NONE&&this._entity!==this){if(this._renderComponents=this._entity.getComponentsByType(t.RenderComponent),this._renderComponents){for(this._renderContext.lineWidth=.5,this._renderContext.strokeStyle="rgb(255,0,0)",this._renderContext.fillStyle="rgba(255,0,0,0.25)",this._renderContext.beginPath(),n=0;n<this._renderComponents.length;n++)if((this._entity._debugInfo&e.RENDER_BOUNDS)==e.RENDER_BOUNDS&&(this._debugRenderComponent=this._renderComponents[n],this._debugRenderComponent.visible))if(this._renderLayer=this._renderManager.getLayer(this._debugRenderComponent.layerIndex,!0),this._extents=this._debugRenderComponent.extents,this._position=this._renderLayer.cameraTransformOptions==t.TransformOptions.NONE?this._extents.topLeft:this._camera.globalToLocal(this._extents.topLeft),this._renderContext.moveTo(this._position.x,this._position.y),this._renderContext.arc(this._position.x,this._position.y,2,0,2*Math.PI),this._renderContext.moveTo(this._debugRenderComponent.x+this._debugRenderComponent.registrationX,this._debugRenderComponent.y+this._debugRenderComponent.registrationY),this._renderContext.arc(this._debugRenderComponent.x+this._debugRenderComponent.registrationX,this._debugRenderComponent.y+this._debugRenderComponent.registrationY,2,0,2*Math.PI),this._debugRenderComponent instanceof t.TileRenderComponent){this._tileRenderComponent=this._debugRenderComponent,this._topRow=this.clamp(Math.floor((this._camera.top-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._bottomRow=this.clamp(Math.ceil((this._camera.bottom-this._tileRenderComponent.y)/this._tileRenderComponent.tileHeight),0,this._tileRenderComponent.rows),this._leftCol=this.clamp(Math.floor((this._camera.left-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols),this._rightCol=this.clamp(Math.ceil((this._camera.right-this._tileRenderComponent.x)/this._tileRenderComponent.tileWidth),0,this._tileRenderComponent.cols);for(var r=this._topRow;r<this._bottomRow;r++)for(var s=this._leftCol;s<this._rightCol;s++)this._tile=this._tileRenderComponent.tiles[r*this._tileRenderComponent.cols+s],this._tile&&this._tile.type&&this._renderContext.rect(this._position.x+s*this._tile.width,this._position.y+r*this._tile.height,this._tile.width,this._tile.height)}else this._renderContext.moveTo(this._position.x+this._debugRenderComponent.offsetX,this._position.y+this._debugRenderComponent.offsetY),this._renderContext.rect(this._position.x+this._debugRenderComponent.offsetX,this._position.y+this._debugRenderComponent.offsetY,this._extents.width,this._extents.height);this._renderContext.closePath(),this._renderContext.fill(),this._renderContext.stroke(),this._draws+=2}this._renderContext.fillStyle="rgb(255,255,255)",this._info="",this._lineHeight=5,(this._entity._debugInfo&e.NAME)==e.NAME&&(this._info+=this._entity.name+" "),this._debugRenderComponent&&(this._entity._debugInfo&e.Z_INFO)==e.Z_INFO&&(this._info+=this._debugRenderComponent.layerIndex+"|"+this._debugRenderComponent.zIndex+"|"+this._debugRenderComponent._renderID),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._lineHeight),this._draws++,this._debugSpatialComponent?(this._info="",(this._entity._debugInfo&e.POSITION)==e.POSITION&&(this._info+=(this._debugSpatialComponent.x+.5|0)+","+(this._debugSpatialComponent.y+.5|0)+" "),(this._entity._debugInfo&e.CENTER)==e.CENTER&&(this._info+="{"+(this._debugSpatialComponent.centerX+.5|0)+","+(this._debugSpatialComponent.centerY+.5|0)+"} "),(this._entity._debugInfo&e.VELOCITY)==e.VELOCITY&&(this._info+="["+(this._debugSpatialComponent.velocityX+.5|0)+","+(this._debugSpatialComponent.velocityY+.5|0)+"]"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++,this._info="",this._lineHeight+=this._lineBuffer,(this._entity._debugInfo&e.DIMENSIONS)==e.DIMENSIONS&&(this._info+=this._debugSpatialComponent.width+"x"+this._debugSpatialComponent.height+" "),(this._entity._debugInfo&e.TYPE)==e.TYPE&&this._debugSpatialComponent.type&&(this._info+="["+this._debugSpatialComponent.type.typeNames.toString()+"]"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++):this._debugRenderComponent&&(this._info="",(this._entity._debugInfo&e.POSITION)==e.POSITION&&(this._info+=(this._debugRenderComponent.x+.5|0)+","+(this._debugRenderComponent.y+.5|0)+" "),(this._entity._debugInfo&e.CENTER)==e.CENTER&&(this._info+="{"+(this._debugRenderComponent.centerX+.5|0)+","+(this._debugRenderComponent.centerY+.5|0)+"}"),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++,this._info="",this._lineHeight+=this._lineBuffer,(this._entity._debugInfo&e.DIMENSIONS)==e.DIMENSIONS&&(this._info+=(this._debugRenderComponent.width+.5|0)+"x"+(this._debugRenderComponent.height+.5|0)),this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++),this._debugAnimationComponent&&this._debugAnimationComponent.currentAnimation&&(this._entity._debugInfo&e.ANIMATION)==e.ANIMATION&&(this._lineHeight+=this._lineBuffer,this._info="["+this._debugAnimationComponent.totalAnimations+"]",this._info+=" "+this._debugAnimationComponent.currentAnimation.name,this._info+=" "+(this._debugAnimationComponent.currentAnimation.frameIndex+1)+"/"+this._debugAnimationComponent.currentAnimation.totalFrames,this._renderContext.fillText(this._info,this._position.x,this._position.y+this._linePos+this._lineHeight),this._draws++)}this._profiler.end("debug")},n.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},n.prototype.rotatePoint=function(t,e,i){if(0==i)return t;var n=i*(Math.PI/180),o=t.x-e.x,r=t.y-e.y,s=Math.cos(n),a=Math.sin(n);return this._result.x=e.x+o*s-r*a|0,this._result.y=e.y+r*s+o*a|0,this._result},n}(t.CanvasGraphic);t.DebugRenderGraphic=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){e.call(this,n.timeManager,n.renderManager,n.width,64,i.NAME),this._game=n,this._timeManager=this._game.timeManager,this._spatialManager=this._game.spatialManager,this._fontSize=10,this._graphHeight=32,this._ms=20,this._msHeight=this._graphHeight/this._ms,this._marks=[],this._clocks={},this._watch={},this._drawX=0,this._drawY=0,this._textX=0,this._textY=0,this._frames=0,this._count=0,this._16ms=Math.round(this._graphHeight-16*this._msHeight),this._graph=document.createElement("canvas"),this._graphContext=this._graph.getContext("2d"),this._graph.width=this._game.width,this._graph.height=this._graphHeight,this._graphContext.fillStyle="rgb(80,80,80)",this._graphContext.fillRect(0,this._16ms,this._graph.width,1),this.layerIndex=t.EngineConstants.LAYERINDEX_STATS,this._renderManager.getLayer(this.layerIndex,!0).cameraTransformOptions=t.TransformOptions.NONE,this._renderManager.getLayer(this.layerIndex,!0).preventAutoReset=!0,this._renderFunction=this.renderFull,this._type=i.FULL,this._timeManager.postFrame.add(this.onFrame,this)
}return __extends(i,e),i.NAME="Stats",i.FULL="full",i.MINIMAL="minimal",i.prototype.onDown=function(){switch(this._type){case i.FULL:this.setType(i.MINIMAL);break;case i.MINIMAL:this.setType(i.FULL)}},i.prototype.setType=function(t){switch(this._type=t,this._type){case i.FULL:this.width=this._game.width,this.height=64,this._renderFunction=this.renderFull;break;case i.MINIMAL:this.width=150,this.height=14,this._renderFunction=this.renderMinimal}switch(this._game.settings.statsPosition){case 1:this.top=0,this.left=0;break;case 2:this.centerX=this._game.width/2;break;case 3:this.right=this._game.width;break;case 4:this.centerY=this._game.height/2;break;case 5:this.centerX=this._game.width/2,this.centerY=this._game.height/2;break;case 6:this.right=this._game.width,this.centerY=this._game.height/2;break;case 7:this.bottom=this._game.height;break;case 8:this.centerX=this._game.width/2,this.bottom=this._game.height;break;case 9:this.right=this._game.width,this.bottom=this._game.height}},i.prototype.addWatch=function(t,e,i){this._watch[t]={element:e,prop:i}},i.prototype.addMark=function(t,e){"undefined"==typeof e&&(e="rgba(255,255,255,.5)"),this._marks.push({message:t,color:e})},i.prototype.addClock=function(t,e){this._clocks[t]=e},i.prototype.onFrame=function(){this._tileMaps=this._game.getByType(t.TileMap),this._spatialQueries=this._spatialManager._checks;for(var e=0;e<this._tileMaps.length;e++)this._spatialQueries+=this._tileMaps[e]._checks;this._renderContext.clearRect(0,0,this._game.width,this._game.height),this._renderContext.fillStyle="rgb(32,32,32)",this._renderContext.fillRect(0,0,this.width,this.height),this._sec=Math.floor(window.performance.now()/1e3+.5),this._min=Math.floor(this._sec/60),this._hr=Math.floor(this._min/60),this._frames++,this._textX=8,this._drawX=this._graph.width-1,this._drawY=this._graphHeight,this._graphContext.drawImage(this._graph,-1,0),this._graphContext.fillStyle="rgb(32,32,32)",this._graphContext.fillRect(this._drawX,0,1,this._graphHeight);for(var i in this._clocks)this._clock=this._clocks[i],this._clock&&(this._drawY-=this._clock.ms*this._msHeight,this._graphContext.fillStyle=this._clock.color,this._graphContext.fillRect(this._drawX,this._drawY,1,this._clock.ms*this._msHeight));30==this._frames&&(this._graphContext.fillStyle="rgb(255,255,255)",this._graphContext.fillRect(this._drawX,this._graphHeight-4,1,4)),60==this._frames&&(this._graphContext.font="7px Monaco",this._graphContext.fillStyle="rgb(255,255,255)",this._graphContext.textAlign="right",this._graphContext.textBaseline="top",this._graphContext.fillText(t.NumberUtil.addLeadingZeros(this._sec,2),this._drawX-1,this._graphHeight-7),this._graphContext.fillRect(this._drawX,this._graphHeight-6,1,6),this._frames=0),this._graphContext.fillStyle="rgba(255,255,255,.25)",this._graphContext.fillRect(this._drawX,this._16ms,1,1),this._graphContext.font="8px Monaco",this._graphContext.textAlign="right",this._graphContext.textBaseline="top";for(var n,e=0;e<this._marks.length;e++)n=this._marks[e],this._graphContext.fillStyle=n.color,this._graphContext.fillRect(this._drawX,0,1,this._graphHeight),this._graphContext.fillText(n.message,this._drawX-1,this._textY),this._textY=(this._textY+8)%24;this._marks=[],this._renderFunction.apply(this)},i.prototype.renderFull=function(){this._renderContext.drawImage(this._graph,0,this._graphHeight-16),this._renderContext.font="8px Monaco",this._renderContext.fillStyle="rgba(255,255,255,.5)",this._renderContext.fillText("16ms",10,this._graphHeight+this._16ms-16),this._renderContext.font=this._fontSize+"px Monaco",this._renderContext.fillStyle="rgb(255,255,255)",this._info="",this._info+="L:"+this._renderManager.layerCount+" | ",this._info+="E:"+this.getEntityCount(this._game)+" | ",this._info+="DC:"+this._renderManager._draws.toString()+" | ",this._info+="GS:"+this._spatialManager.gridSize+" | ",this._info+="SQ:"+this._spatialQueries,this._renderContext.fillText(this._info,this.width-(this._renderContext.measureText(this._info).width+10),this._fontSize+4),this._info="";for(var e in this._clocks)this._clock=this._clocks[e],this._clock&&(this._renderContext.fillStyle=this._clock.color,this._renderContext.fillRect(this._textX,this.height-13,8,8),this._info=e+":"+this._clock.msAvg.toFixed(2),this._renderContext.fillStyle="rgb(255,255,255)",this._renderContext.fillText(this._info,this._textX+12,this.height-(this._fontSize-4)),this._textX+=25+this._renderContext.measureText(this._info).width);this._hr%=24,this._min%=60,this._sec%=60,this._info="",this._info+=this._timeManager._profiler.clocks.update.fps+" | ",this._info+=this._timeManager._profiler.clocks.update.msAvg.toFixed(2)+" | ",this._info+=t.NumberUtil.addLeadingZeros(this._hr,2)+":"+t.NumberUtil.addLeadingZeros(this._min,2)+":"+t.NumberUtil.addLeadingZeros(this._sec,2),this._renderContext.fillText(this._info,this.width-(this._renderContext.measureText(this._info).width+10),this.height-4),this._info="";var i,n;for(var e in this._watch)i=this._watch[e],n=i.element[i.prop],this.isNumber(n)&&(n=parseInt(n)),this._info+=e+":"+n+" ";""!=this._info&&this._renderContext.fillText(this._info,10,this._fontSize+4)},i.prototype.renderMinimal=function(){this._hr%=24,this._min%=60,this._sec%=60,this._info="",this._info+=this._timeManager._profiler.clocks.update.fps+" | ",this._info+=this._timeManager._profiler.clocks.update.msAvg.toFixed(2)+" | ",this._info+=t.NumberUtil.addLeadingZeros(this._hr,2)+":"+t.NumberUtil.addLeadingZeros(this._min,2)+":"+t.NumberUtil.addLeadingZeros(this._sec,2),this._renderContext.font=this._fontSize+"px Monaco",this._renderContext.fillStyle="rgb(255,255,255)",this._renderContext.fillText(this._info,this.width-(this._renderContext.measureText(this._info).width+10),this.height-4)},i.prototype.getEntityCount=function(e){var i,n=0,o=e.getByType(t.Entity);e instanceof t.Entity&&n++;for(var r=0;r<o.length;r++)i=o[r],i?i instanceof t.Group&&(n+=this.getEntityCount(i)):i instanceof t.Entity&&n++;return n},i.prototype.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i.prototype.destroy=function(){this._timeManager.postFrame.remove(this.onFrame,this),e.prototype.destroy.call(this),this._marks=[],this._game=null,this._timeManager=null,this._spatialManager=null,this._graph=null,this._graphContext=null,this._clocks=null,this._watch=null,this._clock=null,this._tileMaps=null,this._renderFunction=null,this._inputComponent=null},i}(t.CanvasGraphic);t.Stats=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t){this._timeStampOffset=0,this.stats=t}return e.prototype.output=function(e){e.level==t.Log.MARK&&this.stats.addMark(e.message)},e.prototype.clear=function(){this._timeStampOffset=this.getTimer()},e.prototype.getTimeStamp=function(){return this.getTimer()-this._timeStampOffset},e.prototype.getTimer=function(){return(new Date).getTime()-this._startTime},e.prototype.destroy=function(){this.filters=null},e}();t.StatsTarget=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i){"undefined"==typeof i&&(i=e.NAME),t.call(this,i),this.clocks={}}return __extends(e,t),e.NAME="Profiler",e.prototype.add=function(t,e){this.clocks[t]=new i(t,e)},e.prototype.begin=function(t,e){"undefined"==typeof e&&(e=0),this.clocks[t].begin(e)},e.prototype.end=function(t){this.clocks[t].end()},e}(t.Element);t.Profiler=e;var i=function(){function t(t,e){this.name=t,this.color=e,this.startTime=window.performance.now(),this.prevTime=this.startTime,this.frames=0,this.ms=0,this.msMin=1/0,this.msMax=0,this.msAvg=0,this.fps=0,this.fpsMin=1/0,this.fpsMax=0,this.fpsAvg=0}return t.prototype.begin=function(t){"undefined"==typeof t&&(t=0),this.startTime=window.performance.now()+t},t.prototype.end=function(){var t=window.performance.now();this.ms=t-this.startTime,this.msMin=Math.min(this.msMin,this.ms),this.msMax=Math.max(this.msMax,this.ms),this.msAvg=.8*this.msAvg+.2*this.ms,this.frames++,t>this.prevTime+1e3&&(this.fps=Math.round(1e3*this.frames/(t-this.prevTime)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this.fpsAvg=.8*this.fpsAvg+.2*this.fps,this.prevTime=t,this.frames=0)},t}();t.Clock=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.easeNone=function(t,e,i,n){return i*t/n+e},t.easeIn=function(t,e,i,n){return i*t/n+e},t.easeOut=function(t,e,i,n){return i*t/n+e},t.easeInOut=function(t,e,i,n){return i*t/n+e},t}();t.Linear=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.easeIn=function(t,e,i,n){return i*(t/=n)*t+e},t.easeOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},t.easeInOut=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},t}();t.Quadratic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i,n){"undefined"==typeof n&&(n=null),e.call(this,i),this.bounds=n,this.active=!0,this._spatialComponents=[],this._boundsInfo=[],this.boundsSignal=new t.Signal,this.reboundFactor=1,this.priority=1}return __extends(n,e),n.NAME="BoundsComponent",n.NONE=0,n.SOLID=1,n.WRAP=2,n.BOUNCE=4,n.LEFT="left",n.RIGHT="right",n.TOP="top",n.BOTTOM="bottom",n.prototype._onRegister=function(){this._level=this._owner,!this.bounds&&this._level&&(this.bounds=new t.Rectangle(0,0,this._level.screenWidth,this._level.screenHeight)),e.prototype._onRegister.call(this)},n.prototype.addSprites=function(e,o,r){"undefined"==typeof o&&(o="none"),"undefined"==typeof r&&(r=t.EngineConstants.SPATIAL);var s,a,h=new i;if(t.ObjectUtil.isNumber(o)&&(h.left=o,h.right=o,h.top=o,h.bottom=o),t.ObjectUtil.isString(o))switch(o.toLowerCase()){default:case"none":h.left=n.NONE,h.right=n.NONE,h.top=n.NONE,h.bottom=n.NONE;break;case"solid":h.left=n.SOLID,h.right=n.SOLID,h.top=n.SOLID,h.bottom=n.SOLID;break;case"wrap":h.left=n.WRAP,h.right=n.WRAP,h.top=n.WRAP,h.bottom=n.WRAP;break;case"bounce":h.left=n.BOUNCE,h.right=n.BOUNCE,h.top=n.BOUNCE,h.bottom=n.BOUNCE}if(o.hasOwnProperty("left")&&o.hasOwnProperty("right")&&o.hasOwnProperty("top")&&o.hasOwnProperty("bottom")){if(t.ObjectUtil.isNumber(o.left)&&(h.left=o.left),t.ObjectUtil.isNumber(o.right)&&(h.right=o.right),t.ObjectUtil.isNumber(o.top)&&(h.top=o.top),t.ObjectUtil.isNumber(o.bottom)&&(h.bottom=o.bottom),t.ObjectUtil.isString(o.left))switch(o.left.toLowerCase()){case"none":h.left=n.NONE;break;case"solid":h.left=n.SOLID;break;case"wrap":h.left=n.WRAP;break;case"bounce":h.left=n.BOUNCE}if(t.ObjectUtil.isString(o.right))switch(o.right.toLowerCase()){case"none":h.right=n.NONE;break;case"solid":h.right=n.SOLID;break;case"wrap":h.right=n.WRAP;break;case"bounce":h.right=n.BOUNCE}if(t.ObjectUtil.isString(o.top))switch(o.top.toLowerCase()){case"none":h.top=n.NONE;break;case"solid":h.top=n.SOLID;break;case"wrap":h.top=n.WRAP;break;case"bounce":h.top=n.BOUNCE}if(t.ObjectUtil.isString(o.bottom))switch(o.bottom.toLowerCase()){case"none":h.bottom=n.NONE;break;case"solid":h.bottom=n.SOLID;break;case"wrap":h.bottom=n.WRAP;break;case"bounce":h.bottom=n.BOUNCE}}if(t.ObjectUtil.isString(e)&&this._level&&(s=this._level.get(e),s&&(a=s.getComponent(r)))){if(-1!=this._spatialComponents.indexOf(a))return;this._spatialComponents.push(a),this._boundsInfo.push(h)}if(e instanceof t.GameEntity&&(s=e,a=s.getComponent(r))){if(-1!=this._spatialComponents.indexOf(a))return;this._spatialComponents.push(a),this._boundsInfo.push(h)}if(t.ObjectUtil.isArray(e))for(var l=0;l<e.length;l++)if(e[l]instanceof t.GameEntity&&(s=e[l]),t.ObjectUtil.isString(e[l])&&this._level&&(s=this._level.get(e[l])),a=s.getComponent(r)){if(-1!=this._spatialComponents.indexOf(a))return;this._spatialComponents.push(a),this._boundsInfo.push(h)}},n.prototype.removeSprites=function(e,i){"undefined"==typeof i&&(i=t.EngineConstants.SPATIAL);var n,o;if(t.ObjectUtil.isString(e)&&this._level&&(n=this._level.get(e),n&&(o=n.getComponent(i)))){var r=this._spatialComponents.indexOf(o);-1!=r&&(this._spatialComponents.splice(r,1),this._boundsInfo.splice(r,1))}if(e instanceof t.GameEntity&&(n=e,o=n.getComponent(i))){var r=this._spatialComponents.indexOf(o);-1!=r&&(this._spatialComponents.splice(r,1),this._boundsInfo.splice(r,1))}if(t.ObjectUtil.isArray(e))for(var s=0;s<e.length;s++)if(e[s]instanceof t.GameEntity&&(n=e[s]),t.ObjectUtil.isString(e[s])&&this._level&&(n=this._level.get(e[s])),o=n.getComponent(i)){var r=this._spatialComponents.indexOf(o);-1!=r&&(this._spatialComponents.splice(r,1),this._boundsInfo.splice(r,1))}},n.prototype.onTick=function(t){if(this.active&&this.bounds){for(var i=this._spatialComponents.length-1;i>=0;i--)this._spatialComponent=this._spatialComponents[i],this._info=this._boundsInfo[i],this._spatialComponent.active&&(this._spatialComponent.left<=this.bounds.left&&(this._info.left==n.WRAP&&this._spatialComponent.right<this.bounds.left&&(this._spatialComponent.left=this.bounds.right,this.boundsSignal.dispatch(this._spatialComponent.owner,n.LEFT,this._info.left)),this._info.left==n.SOLID&&(this._spatialComponent.left=this.bounds.left+1,this._spatialComponent.velocityX=0,this.boundsSignal.dispatch(this._spatialComponent.owner,n.LEFT,this._info.left)),this._info.left==n.BOUNCE&&(this._spatialComponent.left=this.bounds.left+1,this._spatialComponent.velocityX*=-this.reboundFactor,this.boundsSignal.dispatch(this._spatialComponent.owner,n.LEFT,this._info.left))),this._spatialComponent.right>=this.bounds.right&&(this._info.right==n.WRAP&&this._spatialComponent.left>this.bounds.right&&(this._spatialComponent.right=this.bounds.left,this.boundsSignal.dispatch(this._spatialComponent.owner,n.RIGHT,this._info.right)),this._info.right==n.SOLID&&(this._spatialComponent.right=this.bounds.right-1,this._spatialComponent.velocityX=0,this.boundsSignal.dispatch(this._spatialComponent.owner,n.RIGHT,this._info.right)),this._info.right==n.BOUNCE&&(this._spatialComponent.right=this.bounds.right-1,this._spatialComponent.velocityX*=-this.reboundFactor,this.boundsSignal.dispatch(this._spatialComponent.owner,n.RIGHT,this._info.right))),this._spatialComponent.top<=this.bounds.top&&(this._info.top==n.WRAP&&this._spatialComponent.bottom<this.bounds.top&&(this._spatialComponent.top=this.bounds.bottom,this.boundsSignal.dispatch(this._spatialComponent.owner,n.BOTTOM,this._info.bottom)),this._info.top==n.SOLID&&(this._spatialComponent.top=this.bounds.top+1,this._spatialComponent.velocityY=0,this.boundsSignal.dispatch(this._spatialComponent.owner,n.BOTTOM,this._info.bottom)),this._info.top==n.BOUNCE&&(this._spatialComponent.top=this.bounds.top+1,this._spatialComponent.velocityY*=-this.reboundFactor,this.boundsSignal.dispatch(this._spatialComponent.owner,n.BOTTOM,this._info.bottom))),this._spatialComponent.bottom>=this.bounds.bottom&&(this._info.bottom==n.WRAP&&this._spatialComponent.top>this.bounds.bottom&&(this._spatialComponent.bottom=this.bounds.top,this.boundsSignal.dispatch(this._spatialComponent.owner,n.TOP,this._info.top)),this._info.bottom==n.SOLID&&(this._spatialComponent.bottom=this.bounds.bottom-1,this._spatialComponent.velocityY=0,this.boundsSignal.dispatch(this._spatialComponent.owner,n.TOP,this._info.top)),this._info.bottom==n.BOUNCE&&(this._spatialComponent.bottom=this.bounds.bottom,this._spatialComponent.velocityY*=-this.reboundFactor,this.boundsSignal.dispatch(this._spatialComponent.owner,n.TOP,this._info.top))));e.prototype.onTick.call(this,t)}},n.prototype.destroy=function(){this.boundsSignal.removeAll(),this.boundsSignal=null,this.bounds=null,this._level=null,this._spatialComponent=null,this._info=null,this._spatialComponents=null,this._boundsInfo=null,e.prototype.destroy.call(this)},n}(t.TickedComponent);t.BoundsComponent=e;var i=function(){function t(){this.left=e.SOLID,this.right=e.SOLID,this.top=e.SOLID,this.bottom=e.SOLID}return t}();t.BoundsInfo=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t){e.call(this,t),this.posX=0,this.posY=0,this.speedX=0,this.speedY=0,this.scrollXFactor=1,this.scrollYFactor=1,this.mode=i.MODE_SPEED}return __extends(i,e),i.NAME="CanvasScrollerComponent",i.MODE_POSITION="position",i.MODE_SPEED="speed",i.prototype._onRegister=function(){var i=this._owner.getComponent(t.EngineConstants.RENDER),n=i.view;this._renderContext=i._renderContext,this._renderSource=document.createElement("canvas"),this._renderSource.width=n.width,this._renderSource.height=n.height,this._renderSource.getContext("2d").drawImage(n,0,0,n.width,n.height),e.prototype._onRegister.call(this)},i.prototype.onFrame=function(t){this.mode=i.MODE_POSITION,(this.mode=i.MODE_SPEED)&&(this.posX-=this.speedX*t,Math.abs(this.posX)>this._renderSource.width&&(this.posX=0),this._renderContext.clearRect(0,0,this._renderSource.width,this._renderSource.height),this._renderContext.drawImage(this._renderSource,this.posX,0),this._renderContext.drawImage(this._renderSource,this._renderSource.width-Math.abs(this.posX)-1,0)),e.prototype.onFrame.call(this,t)},i}(t.AnimatedComponent);t.CanvasScrollerComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o){e.call(this,i),this._spatialManager=n,this._typeManager=this._spatialManager.typeManager,this._componentReference=o,this.collisionSignal=new t.Signal,this._collisionOffsets=[],this.priority=1,this.offsetX=0,this.offsetY=0,this.active=!0,this._collisionFunc=this.checkRectCollision}return __extends(i,e),i.TOP=1,i.BOTTOM=2,i.LEFT=4,i.RIGHT=8,i.RECTANGLE=0,i.CIRCLE=1,Object.defineProperty(i.prototype,"spatialComponent",{get:function(){return this._spatialComponent},set:function(t){this._spatialComponent=t},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){this._spatialComponent=this._componentReference?this._owner.getComponent(this._componentReference):this._owner.getComponentByType(t.SpatialComponent),e.prototype._onRegister.call(this)},i.prototype._onReset=function(){this._spatialComponent=this._componentReference?this._owner.getComponent(this._componentReference):this._owner.getComponentByType(t.SpatialComponent),e.prototype._onReset.call(this)},i.prototype.addCollisionType=function(e){this._collisionsMask||(this._collisionsMask=this.create(t.BitMask,this._typeManager,"default"),this._collisionsMask.name="BitMask_CollisionsMask"),this._collisionNames||(this._collisionTypes=[],this._collisionNames=[]),"[object String]"===Object.prototype.toString.call(e)&&this._collisionNames.push(e),"[object Array]"===Object.prototype.toString.call(e)&&this._collisionNames.concat(e),this._collisionTypes.push(this._typeManager.getBitMask(e)),this._collisionsMask.typeNames=this._collisionNames},i.prototype.removeCollisionType=function(t){this._collisionsMask&&this._collisionNames&&("[object String]"===Object.prototype.toString.call(t)&&-1!=this._collisionNames.indexOf(t)&&this._collisionNames.splice(this._collisionNames.indexOf(t),1),-1!=this._collisionTypes.indexOf(this._typeManager.getBitMask(t))&&this._collisionTypes.splice(this._collisionTypes.indexOf(this._typeManager.getBitMask(t)),1),this._collisionsMask.typeNames=this._collisionNames)},i.prototype.setDetectionType=function(t){switch(t){case i.RECTANGLE:this._collisionFunc=this.checkRectCollision;break;case i.CIRCLE:this._collisionFunc=this.checkCircCollision}},i.prototype.onTick=function(t){this.active&&this._spatialComponent&&(this._collisionFunc(),e.prototype.onTick.call(this,t))},i.prototype.checkRectCollision=function(){this._queryRect=this._spatialComponent.extents,this._queryRect.x+=this.offsetX,this._queryRect.y+=this.offsetY,this._collisions=this._spatialManager.queryRectangle(this._queryRect,this._collisionsMask);for(var t=this._collisions.length-1;t>=0;t--)if(this._collider=this._collisions[t],this._collider!==this._spatialComponent)if(this._topOffset=this._spatialComponent.top-this._collider.bottom,this._bottomOffset=this._spatialComponent.bottom-this._collider.top,this._leftOffset=this._spatialComponent.left-this._collider.right,this._rightOffset=this._spatialComponent.right-this._collider.left,this._topOffset=this._topOffset<0?-this._topOffset:this._topOffset,this._bottomOffset=this._bottomOffset<0?-this._bottomOffset:this._bottomOffset,this._leftOffset=this._leftOffset<0?-this._leftOffset:this._leftOffset,this._rightOffset=this._rightOffset<0?-this._rightOffset:this._rightOffset,this._collisionOffsets[0]=this._topOffset,this._collisionOffsets[1]=this._bottomOffset,this._collisionOffsets[2]=this._leftOffset,this._collisionOffsets[3]=this._rightOffset,this._collisionOffsets.sort(this.sortOffsets),this._collisionOffset=this._collisionOffsets[0],this._collisionOffset==this._topOffset&&(this._loc=i.TOP),this._collisionOffset==this._bottomOffset&&(this._loc=i.BOTTOM),this._collisionOffset==this._leftOffset&&(this._loc=i.LEFT),this._collisionOffset==this._rightOffset&&(this._loc=i.RIGHT),this._collisionTypes)for(var e=this._collisionTypes.length-1;e>=0;e--)this._collider.type&&this._collisionTypes[e]&&this._typeManager.doTypesOverlap(this._collider.type,this._collisionTypes[e])&&this.collisionSignal.dispatch(this._spatialComponent,this._collider,this._loc,this._collisionOffset,this._collisionNames[e]);else this.collisionSignal.dispatch(this._spatialComponent,this._collider,this._loc,this._collisionOffset)},i.prototype.checkCircCollision=function(){this._queryPoint=this._spatialComponent.center,this._queryPoint.x+=this.offsetX,this._queryPoint.y+=this.offsetY,this._collisions=this._spatialManager.queryCircle(this._queryPoint,this._spatialComponent.halfWidth-5,this._collisionsMask);for(var t=this._collisions.length-1;t>=0;t--)if(this._collider=this._collisions[t],this._collider!==this._spatialComponent)if(this._collisionTypes)for(var e=this._collisionTypes.length-1;e>=0;e--)this._collider.type&&this._collisionTypes[e]&&this._typeManager.doTypesOverlap(this._collider.type,this._collisionTypes[e])&&this.collisionSignal.dispatch(this._spatialComponent,this._collider,this._collisionNames[e]);else this.collisionSignal.dispatch(this._spatialComponent,this._collider)},i.prototype.sortOffsets=function(t,e){return t>=e?1:-1},i.prototype.destroy=function(){this.collisionSignal.removeAll(),this.active=!1,this.collisionSignal=null,this._spatialComponent=null,this._collider=null,this._collisions=null,this._collisionOffsets=null,this._collisionTypes=null,this._collisionNames=null,this._collisionsMask=null,this._spatialManager=null,this._typeManager=null,this._queryRect=null,this._collisionFunc=null,e.prototype.destroy.call(this)},i}(t.TickedComponent);t.CollisionComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i){e.call(this),this._inputMap=i,this.upSignal=new t.Signal,this.downSignal=new t.Signal,this.leftSignal=new t.Signal,this.rightSignal=new t.Signal,this._mappings=[],this._right=0,this._left=0,this._up=0,this._down=0,this._direction=0}return __extends(i,e),i.NAME="DirectionComponent",Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){this.active=!0,e.prototype._onRegister.call(this)},i.prototype._onUnregister=function(){this.active=!1,e.prototype._onUnregister.call(this)},i.prototype.registerControls=function(e){e.hasOwnProperty("up")&&this.registerControl(e.up,t.Direction.UP),e.hasOwnProperty("down")&&this.registerControl(e.down,t.Direction.DOWN),e.hasOwnProperty("left")&&this.registerControl(e.left,t.Direction.LEFT),e.hasOwnProperty("right")&&this.registerControl(e.right,t.Direction.RIGHT)},i.prototype.registerControl=function(e,i){var n=this;switch(i){case t.Direction.UP:this._inputMap.mapActionToHandler(e,function(t){return n._onUp(t)});break;case t.Direction.DOWN:this._inputMap.mapActionToHandler(e,function(t){return n._onDown(t)});break;case t.Direction.LEFT:this._inputMap.mapActionToHandler(e,function(t){return n._onLeft(t)});break;case t.Direction.RIGHT:this._inputMap.mapActionToHandler(e,function(t){return n._onRight(t)})}this._mappings.push(e)},i.prototype.unregisterControls=function(){for(var t=0;t<this._mappings.length;t++)this._inputMap.unmapAction(this._mappings[t]);this._mappings=[]},i.prototype._onLeft=function(e){this._left!=e&&(this._direction+=1==e?t.Direction.LEFT:-t.Direction.LEFT),this._left=e,this.active&&this.leftSignal.dispatch(this._left)},i.prototype._onRight=function(e){this._right!=e&&(this._direction+=1==e?t.Direction.RIGHT:-t.Direction.RIGHT),this._right=e,this.active&&this.rightSignal.dispatch(this._right)},i.prototype._onUp=function(e){this._up!=e&&(this._direction+=1==e?t.Direction.UP:-t.Direction.UP),this._up=e,this.active&&this.upSignal.dispatch(this._up)},i.prototype._onDown=function(e){this._down!=e&&(this._direction+=1==e?t.Direction.DOWN:-t.Direction.DOWN),this._down=e,this.active&&this.downSignal.dispatch(this._down)},i.prototype.destroy=function(){this.upSignal.removeAll(),this.downSignal.removeAll(),this.leftSignal.removeAll(),this.rightSignal.removeAll();for(var t=0;t<this._mappings.length;t++)this._inputMap.unmapAction(this._mappings[t]);e.prototype.destroy.call(this),this._inputMap=null,this._mappings=null,this.upSignal=null,this.downSignal=null,this.leftSignal=null,this.rightSignal=null},i}(t.Component);t.DirectionComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){t.call(this,i),this._timeManager=e,this.speedX=1,this.speedY=1,this.dragX=1,this.dragY=1,this.priority=-1,this._speedDirty=!0}return __extends(e,t),e.NAME="ControlComponent",Object.defineProperty(e.prototype,"speedX",{get:function(){return this._speedX},set:function(t){this._speedX!=t&&(this._speedX=t,this._speedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedY",{get:function(){return this._speedY},set:function(t){this._speedY!=t&&(this._speedY=t,this._speedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speedX},set:function(t){this._speedX!=t&&(this._speedX=t,this._speedY=t,this._speedDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drag",{get:function(){return this.dragX},set:function(t){this.dragX=t,this.dragY=t},enumerable:!0,configurable:!0}),e.prototype._onRegister=function(){this._timeManager.addTickedObject(this,this.priority),this._sprite=this._owner,t.prototype._onRegister.call(this)},e.prototype._onUnregister=function(){this._timeManager.removeTickedObject(this),this._sprite=null,t.prototype._onUnregister.call(this)},e.prototype.onTick=function(t){this._speedDirty&&(this._speed=Math.sqrt(this._speedX*this._speedX+this._speedY*this._speedY)*this.drag,this._speedDirty=!1),this.active&&this._sprite&&this._sprite.active&&(this._sprite.velocityX*=Math.exp(-this.dragX*t),this._sprite.velocityY*=Math.exp(-this.dragY*t),this._sprite.velocityX+=(this._right-this._left)*this._speed*t,this._sprite.velocityY+=(this._down-this._up)*this._speed*t)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._sprite=null,this._timeManager=null},e}(t.DirectionComponent);t.ControlComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n){"undefined"==typeof n&&(n=null),e.call(this,t,i),this._offsetX=0,this._offsetY=0,n&&this.setType(n)}return __extends(i,e),i.NAME="OffsetSpatialComponent",Object.defineProperty(i.prototype,"x",{get:function(){return this._offsetX},set:function(t){this._offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._offsetY},set:function(t){this._offsetY=t},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){this._parent=this._owner.getComponent(t.EngineConstants.SPATIAL),e.prototype._onRegister.call(this)},i.prototype.onTick=function(){this._parent&&this.active&&(this._x=this._parent.x+this._offsetX,this._y=this._parent.y+this._offsetY,this.rotation=this._parent.rotation)},i.prototype.destroy=function(){this._parent=null,e.prototype.destroy.call(this)},i}(t.SpatialComponent);t.OffsetSpatialComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o){e.call(this,i),this._soundManager=n,this._camera=o,this._soundManager._support==t.SoundSupport.WEBAUDIO&&(this._listener=this._soundManager._audioContext.listener),this._sounds={}}return __extends(i,e),i.NAME="PositionalAudioComponent",i.prototype._onRegister=function(){this._entity=this._owner,e.prototype._onRegister.call(this)},i.prototype.registerSound=function(t,e){this._sounds[t]=e},i.prototype.onTick=function(i){var n,o;for(var r in this._sounds)this._soundManager.isSoundPlaying(r)&&(o=this._soundManager.getSound(r),n=this._sounds[r],n.distance&&(o.volume=t.MathUtil.clamp(t.MathUtil.map(t.GeomUtil.getDistance(this._entity.centerX,this._entity.centerY,this._camera.centerX,this._camera.centerY),0,n.distance,100*o._defaultVolume,0)*(n.distanceMultiplier||1),0,100*o._defaultVolume)));e.prototype.onTick.call(this,i)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._soundManager=null,this._camera=null,this._entity=null,this._sounds=null},i}(t.TickedComponent);t.PositionalAudioComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(){e.call(this),this._children=[],this._localTransform=new t.Matrix,this._worldTransform=new t.Matrix,this._registration=new t.Point,this._position=new t.Point,this._center=new t.Point,this._offset=new t.Point,this._extents=new t.Rectangle,this._width=1,this._height=1,this._registrationX=0,this._registrationY=0,this._positionX=0,this._positionY=0,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformDirty=!0}return __extends(i,e),i.NAME="Node2DComponent",Object.defineProperty(i.prototype,"halfWidth",{get:function(){return.5*this._width*(this._scaleX<0?-this._scaleX:this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return.5*this._height*(this._scaleY<0?-this._scaleY:this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._positionY+this._offsetY},set:function(t){this.y=t-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._positionX+this._offsetX},set:function(t){this.x=t-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._positionX+this._width*this._scaleX+this._offsetX},set:function(t){this.x=t-this._width*this._scaleX-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._positionY+this._height*this._scaleY+this._offsetY},set:function(t){this.y=t-this._height*this._scaleY-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._positionX+this._width*(this._scaleX<0?-this._scaleX:this._scaleX)*.5+this._offsetX},set:function(t){this.x=t-this._width*(this._scaleX<0?-this._scaleX:this._scaleX)*.5-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._positionY+this._height*(this._scaleY<0?-this._scaleY:this._scaleY)*.5+this._offsetY},set:function(t){this.y=t-this._height*(this._scaleY<0?-this._scaleY:this._scaleY)*.5-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this._localTransform},set:function(t){if(this._localTransform!=t){var e=t.a,i=t.b,n=t.c,o=t.d;this._positionX=t.tx,this._positionY=t.ty,this._scaleX=Math.sqrt(e*e+i*i),this._rotation=0!=this._scaleX?Math.atan2(i,e):0,this._scaleY=o*Math.cos(this._rotation)-n*Math.sin(this._rotation),this._registrationX=0,this._registrationY=0,this._localTransform=t,this._transformDirty=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width*(this._scaleX<0?-this._scaleX:this._scaleX)},set:function(t){this._scaleX=t/this._width,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height*(this._scaleY<0?-this._scaleY:this._scaleY)
},set:function(t){this._scaleY=t/this._height,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._positionX},set:function(t){this._positionX!=t&&(this._positionX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._positionY},set:function(t){this._positionY!=t&&(this._positionY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._registrationX},set:function(t){this._registrationX!=t&&(this._registrationX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._registrationY},set:function(t){this._registrationY!=t&&(this._registrationY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX!=t&&(this._offsetX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY!=t&&(this._offsetY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!=t&&(this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!=t&&(this._rotation=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position.setTo(this._positionX,this._positionY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._registration.setTo(this._registrationX,this._registrationY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.setTo(this._positionX+this._width*(this._scaleX<0?-this._scaleX:this._scaleX)*.5+this._offsetX,this._positionY+this._height*(this._scaleY<0?-this._scaleY:this._scaleY)*.5+this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset.setTo(this._offsetX,this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._extents.setTo(this._positionX,this._positionY,this._width*this._scaleX,this._height*this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),i.prototype.updateTransform=function(t){"undefined"==typeof t&&(t=!1),(this._transformDirty||t)&&(this._localTransform.identity(),this._localTransform.translate(this._positionX+this._registrationX,this._positionY+this._registrationY),this._localTransform.scale(this._scaleX,this._scaleY),this._localTransform.rotate(this._rotation*(Math.PI/180)),this._localTransform.translate(-this._registrationX+this._offsetX,-this._registrationY+this._offsetY),this._transformDirty=!1)},i.prototype.updateNode=function(t){"undefined"==typeof t&&(t=!1),this._updateChildrenTransform=!1,this._transformDirty&&(this.updateTransform(),this._updateChildrenTransform=!0),(this._updateChildrenTransform||t)&&(this._worldTransform.identity(),this._worldTransform.multiply(this._localTransform),this._parent&&this._worldTransform.multiply(this._parent._worldTransform));for(var e=0;e<this._children.length;e++)this._children[e].updateNode(this._updateChildrenTransform)},i.prototype.addChild=function(t){return this.addChildAt(t,this._children.length)},i.prototype.addChildAt=function(t,e){var i=this.getChildIndex(t);return-1!=i&&this.removeChildAt(i),t._parent=this,this._children.splice(e,0,t),t},i.prototype.removeChild=function(t){var e=this._children.indexOf(t);e>=0&&this.removeChildAt(e)},i.prototype.removeChildAt=function(t){t<this._children.length&&(this._children[t]._parent=null,this._children.splice(t,1))},i.prototype.getChildAt=function(t){return t<this._children.length?this._children[t]:null},i.prototype.getChildIndex=function(t){return this._children.indexOf(t)},i.prototype.swapChildren=function(t,e){var i=this.getChildIndex(t),n=this.getChildIndex(e);this._children[i]=e,this._children[n]=t},i.prototype.removeAllChildren=function(){for(;this._children.length>0;)this.removeChildAt(0)},i.prototype.globalToLocal=function(t){var e=this._localTransform.clone();return e.invert(),e.transformPoint(t)},i.prototype.localToGlobal=function(t){return this._localTransform.transformPoint(t)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._parent=null,this._children=null,this._position=null,this._registration=null,this._center=null,this._offset=null,this._extents=null,this._localTransform=null,this._worldTransform=null},i}(t.Component);t.Node2DComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.RENDER="Render",t.SPATIAL="Spatial",t.ANIMATION="Animation",t.INPUT="Input",t.LAYERINDEX_GAMEUI_UNDERLAY=90,t.LAYERINDEX_GAMEUI=91,t.LAYERINDEX_GAMEUI_OVERLAY=92,t.LAYERINDEX_TRANSITION=950,t.LAYERINDEX_DEBUG=999,t.LAYERINDEX_STATS=1e3,t}();t.EngineConstants=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.NORMAL="source-over",t.ADD="lighter",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.DARKEN="darken",t.LIGHTEN="lighten",t.COLOR_DODGE="color-dodge",t.COLOR_BURN="color-burn",t.HARD_LIGHT="hard-light",t.SOFT_LIGHT="soft-light",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t.HUE="hue",t.SATURATION="saturation",t.COLOR="color",t.LUMINOSITY="luminosity",t}();t.BlendMode=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,s),this._timeManager=n,this._renderManager=o,this._viewPort=r,this._transform=new t.Matrix,this._position=new t.Point,this._registration=new t.Point,this._center=new t.Point,this._offset=new t.Point,this._extents=new t.Rectangle,this._relativeTrackedPosition=new t.Point,this.trackOffset=new t.Point,this.trackLead=new t.Point(0,0),this._isShaking=!1,this._isFlashing=!1,this.reset(),this._timeManager.addTickedObject(this,-1)}return __extends(i,e),i.NAME="Camera",Object.defineProperty(i.prototype,"isShaking",{get:function(){return this._isShaking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFlashing",{get:function(){return this._isFlashing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return.5*this._width/this.abs(this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return.5*this._height/this.abs(this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width/this.abs(this._scaleX)},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height/this.abs(this._scaleY)},set:function(t){this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._positionY/this._scaleY+this._registrationY-this._registrationY/this._scaleY},set:function(t){this.y=this._scaleY*(t-this._registrationY+this._registrationY/this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._positionX/this._scaleX+this._registrationX-this._registrationX/this._scaleX},set:function(t){this.x=this._scaleX*(t-this._registrationX+this._registrationX/this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.left+this._width/this.abs(this._scaleX)+this._offsetX},set:function(t){this.x=t-this._width/this.abs(this._scaleX)-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._positionY+this._height/this.abs(this._scaleY)+this._offsetY},set:function(t){this.y=t-this._height/this.abs(this._scaleY)-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._positionX+this._width/this.abs(this._scaleX)*.5+this._offsetX},set:function(t){this._positionX=t-this._width/this.abs(this._scaleX)*.5-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._positionY+this._height/this.abs(this._scaleY)*.5+this._offsetY},set:function(t){this._positionY=t-this._height/this.abs(this._scaleY)*.5-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pan",{get:function(){return this._positionX},set:function(t){this._positionX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tilt",{get:function(){return this._positionY},set:function(t){this._positionY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoom",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this._transform},set:function(t){if(this._transform!=t){var e=t.a,i=t.b,n=t.c,o=t.d;this._positionX=t.tx,this._positionY=t.ty,this._scaleX=Math.sqrt(e*e+i*i),this._rotation=0!=this._scaleX?Math.atan2(i,e):0,this._scaleY=o*Math.cos(this._rotation)-n*Math.sin(this._rotation),this._registrationX=0,this._registrationY=0,this._transform=t,this._transformDirty=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._positionX},set:function(t){this._positionX!=t&&(this._positionX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._positionY},set:function(t){this._positionY!=t&&(this._positionY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._registrationX},set:function(t){this._registrationX!=t&&(this._registrationX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._registrationY},set:function(t){this._registrationY!=t&&(this._registrationY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX!=t&&(this._offsetX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY!=t&&(this._offsetY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!=t&&(this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!=t&&(this._rotation=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position.setTo(this._positionX,this._positionY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._registration.setTo(this._registrationX,this._registrationY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.setTo(this._positionX+this._width*this.abs(this._scaleX)*.5+this._offsetX,this._positionY+this._height*this.abs(this._scaleY)*.5+this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset.setTo(this._offsetX,this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._extents.setTo(this.left,this.top,this._width/this._scaleX,this._height/this._scaleY)},enumerable:!0,configurable:!0}),i.prototype.initialize=function(t){for(var e in t)this[e]=t[e]},i.prototype.globalToLocal=function(t){return this.updateTransform(),this._transform.transformPoint(t)},i.prototype.localToGlobal=function(t){return this.updateTransform(),this._transform.transformPointInverse(t)},i.prototype.inView=function(e,i){return i.cameraTransformOptions==t.TransformOptions.NONE?!0:!0},i.prototype.onTick=function(){if(this._zoomOffsetX=this._registrationX-this._registrationX*this._scaleX,this._zoomOffsetY=this._registrationY-this._registrationY*this._scaleY,this.trackEntity&&!this.trackEntity.destroyed){if(this.trackThreshold)this._relativeTrackedPosition.setTo(this.trackEntity.centerX,this.trackEntity.centerY),this._relativeTrackedPosition=this._transform.transformPoint(this._relativeTrackedPosition),this._relativeTrackedPosition.x<this.trackThreshold.left&&(this._positionX+=this._relativeTrackedPosition.x-this.trackThreshold.left),this._relativeTrackedPosition.x>this.trackThreshold.right&&(this._positionX+=this._relativeTrackedPosition.x-this.trackThreshold.right),this._relativeTrackedPosition.y<this.trackThreshold.top&&(this._positionY+=this._relativeTrackedPosition.y-this.trackThreshold.top),this._relativeTrackedPosition.y>this.trackThreshold.bottom&&(this._positionY+=this._relativeTrackedPosition.y-this.trackThreshold.bottom);else{if(0==this.rotation)this._positionX=this.trackEntity.centerX-this.trackOffset.x,this._positionY=this.trackEntity.centerY-this.trackOffset.y;else{var t=this.trackEntity.x+this.trackEntity.halfWidth-this.trackOffset.x,e=this.trackEntity.y+this.trackEntity.halfHeight-this.trackOffset.y,i=Math.cos(this.rotation*(180/Math.PI)),n=Math.sin(this.rotation*(180/Math.PI));this._positionX=t*i-e*n,this._positionY=e*i+t*n}this._positionX*=this._scaleX,this._positionY*=this._scaleY}this._transformDirty=!0}this.trackBounds&&(this._positionX=this.clamp(this._positionX,this.trackBounds.x+this._zoomOffsetX,(this.trackBounds.width-this._width)*this._scaleX-this._zoomOffsetX)+this._offsetX,this._positionY=this.clamp(this._positionY,this.trackBounds.y+this._zoomOffsetY,(this.trackBounds.height-this._height)*this._scaleY-this._zoomOffsetY)+this._offsetY,this._transformDirty=!0),this.updateTransform()},i.prototype.flash=function(e,i,n,o,r){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=""),"undefined"==typeof o&&(o=.5),"undefined"==typeof r&&(r=!0);var s=this;this._flashMask||(this._flashMask=this.create(t.RectGraphic,this._timeManager,this._renderManager,this.width,this.height,n,"FlashMask"),this._flashMask.layerIndex=t.EngineConstants.LAYERINDEX_GAMEUI_UNDERLAY,this._flashMask.zIndex=-99),this._flashAlpha=o,this._flashFade=r,this._flashMask.color=n,this._flashMask.alpha=o,this._flashMask.visible=!0,r?TweenMax.from(this._flashMask,i/1e3/e,{alpha:0,repeat:e,yoyo:!0,onComplete:function(){return s._onFlashComplete()}}):(this._flashTimer||(this._flashTimer=this.create(t.Timer,this._timeManager,i,e),this._flashTimer.timerSignal.add(this._onFlash,this),this._flashTimer.completeSignal.add(this._onFlashComplete,this)),this._flashTimer.reset(),this._flashTimer.repeatCount=e,this._flashTimer.delay=i/e,this._flashTimer.start()),this._isFlashing=!0},i.prototype.stopFlash=function(){this._isFlashing&&this._onFlashComplete()},i.prototype._onFlash=function(){this._flashMask.visible=!this._flashMask.visible},i.prototype._onFlashComplete=function(){TweenMax.killTweensOf(this._flashMask),this._isFlashing=!1,this._flashMask.visible=!1,this._flashTimer&&this._flashTimer.reset()},i.prototype.shake=function(e,i,n){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=4),this._shakeTimer||(this._shakeTimer=this.create(t.Timer,this._timeManager,i,e),this._shakeTimer.timerSignal.add(this._onShake,this),this._shakeTimer.completeSignal.add(this._onShakeComplete,this)),this._currentOffsetX=this.trackEntity?this.trackOffset.x:this.offsetX,this._currentOffsetY=this.trackEntity?this.trackOffset.y:this.offsetY,this._shakeStrength=n,this._shakeTimer.reset(),this._shakeTimer.repeatCount=e,this._shakeTimer.delay=i/e,this._shakeTimer.start(),this._isShaking=!0},i.prototype.stopShake=function(){this._isShaking&&this._onShakeComplete()},i.prototype._onShake=function(){this.trackEntity?(this.trackOffset.x=this._currentOffsetX+t.Random.integer(-this._shakeStrength,this._shakeStrength),this.trackOffset.y=this._currentOffsetY+t.Random.integer(-this._shakeStrength,this._shakeStrength)):(this.offsetX=this._currentOffsetX+t.Random.integer(-this._shakeStrength,this._shakeStrength),this.offsetY=this._currentOffsetY+t.Random.integer(-this._shakeStrength,this._shakeStrength))},i.prototype._onShakeComplete=function(){this.trackEntity?(this.trackOffset.x=this._currentOffsetX,this.trackOffset.y=this._currentOffsetY):(this.offsetX=this._currentOffsetX,this.offsetY=this._currentOffsetY),this._isShaking=!1,this._shakeTimer.reset()},i.prototype.updateTransform=function(t){"undefined"==typeof t&&(t=!1),(this._transformDirty||t)&&(this._transform.identity(),this._transform.translate(-this._positionX+this._registrationX,-this._positionY+this._registrationY),this._transform.scale(this._scaleX,this._scaleY),this._transform.rotate(this._rotation*(Math.PI/180)),this._transform.translate(-this._registrationX+this._offsetX,-this._registrationY+this._offsetY),this._transformDirty=!1)},i.prototype.reset=function(){this._transform.identity(),this._positionX=this._viewPort.x,this._positionY=this._viewPort.y,this._width=this._viewPort.width,this._height=this._viewPort.height,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._alpha=1,this._registrationX=this.halfWidth,this._registrationY=this.halfHeight,this.trackOffset.x=this.halfWidth,this.trackOffset.y=this.halfHeight,this.trackEntity=null,this.trackThreshold=null,this.trackBounds=null,this._transformDirty=!0},i.prototype.destroy=function(){this._timeManager.removeTickedObject(this),this.trackEntity=null,this.trackBounds=null,this.trackThreshold=null,this.trackOffset=null,this._relativeTrackedPosition=null,this._position=null,this._registration=null,this._center=null,this._offset=null,this._extents=null,this._shakeTimer=null,this._flashTimer=null,this._flashMask=null,this._transform=null,this._timeManager=null,this._renderManager=null,this._viewPort=null,this._renderExtents=null,e.prototype.destroy.call(this)},i.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},i.prototype.abs=function(t){return Math.abs(t)},i}(t.Entity);t.Camera=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n,o,r){"undefined"==typeof o&&(o=!0),"undefined"==typeof r&&(r=!0),e.call(this,t,i),this._absolutePositioning=o,this._useGamePosition=r,n&&(this.view=n)}return __extends(i,e),i.NAME="DOMRenderComponent",Object.defineProperty(i.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"htmlElement",{get:function(){return this._htmlElement},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"absolutePositioning",{get:function(){return this._absolutePositioning},set:function(t){this._absolutePositioning=t,this._style.left=this._absolutePositioning?"0px":this._origX+"px",this._style.top=this._absolutePositioning?"0px":this._origY+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width*this.abs(this._scaleX)},set:function(t){this._width=t,this._styleDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height*this.abs(this._scaleY)},set:function(t){this._height=t,this._styleDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._view},set:function(e){this._view=t.ObjectUtil.isString(e)?document.getElementById(e):e,this._style=this._view.style,this._style.position="absolute",this._width=parseInt(this._view.offsetWidth),this._height=parseInt(this._view.offsetHeight),this._origX=parseInt(this._view.offsetLeft),this._origY=parseInt(this._view.offsetTop),this._absolutePositioning&&(this._style.left="0px",this._style.top="0px"),this._renderManager.renderCanvas.offset=t.DOMUtil.getOffset(this._renderManager.renderCanvas.canvas),this._style.transformOrigin=this._style.WebkitTransformOrigin=this._style.msTransformOrigin=this._style.MozTransformOrigin=this._style.OTransformOrigin="0% 0%",this._registrationX=this.halfWidth,this._registrationY=this.halfHeight,this._htmlElement=this._view,this._styleDirty=!0},enumerable:!0,configurable:!0}),i.prototype.render=function(t,e){this._style.visibility=this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY?"visible":"hidden",this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY&&(this._renderMatrix=this._localTransform.clone(),this._renderMatrix.tx/=t.canvasScale.x,this._renderMatrix.ty/=t.canvasScale.y,this._useGamePosition&&this._renderMatrix.translate(t.offset.x,t.offset.y),this._renderMatrix.multiply(e),this._style.opacity=this.alpha,this._transformValue="matrix("+this._renderMatrix.a+","+this._renderMatrix.b+","+this._renderMatrix.c+","+this._renderMatrix.d+","+(this._renderMatrix.tx+.5|0),this._style.transform=this._style.WebkitTransform=this._style.OTransform=this._style.msTransform=this._transformValue+","+(this._renderMatrix.ty+.5|0)+")",this._style.MozTransform=this._transformValue+"px,"+(this._renderMatrix.ty+.5|0)+"px)")},i.prototype.updateReferences=function(){this._spatialComponent&&(this.x=this._spatialComponent.x,this.y=this._spatialComponent.y,this.rotation=this._spatialComponent.rotation),this._styleDirty&&(this._style.width=this._width+"px",this._style.height=this._height+"px",this._styleDirty=!1)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._htmlElement=null,this._style=null},i.prototype.abs=function(t){return(t^t>>31)-(t>>31)},i}(t.RenderComponent);t.DOMRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o,r){"undefined"==typeof o&&(o=!0),"undefined"==typeof r&&(r=!0),t.call(this,e,i,n,o,r)}return __extends(e,t),e.NAME="SimpleDOMRenderComponent",e.prototype.render=function(t,e){this._style.visibility=this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY?"visible":"hidden",this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY&&(this._renderMatrix=this._worldTransform.clone(),this._useGamePosition&&this._renderMatrix.translate(t.offset.x,t.offset.y),this._renderMatrix.multiply(e),this._style.opacity=this.alpha,this._style.left=(this._renderMatrix.tx+.5|0)+"px",this._style.top=(this._renderMatrix.ty+.5|0)+"px")},e}(t.DOMRenderComponent);t.SimpleDOMRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){t.call(this,e,i),this._emitters=[],this._particles=[]}return __extends(e,t),e.NAME="ParticleRenderComponent",Object.defineProperty(e.prototype,"emitters",{get:function(){return this._emitters},set:function(t){for(var e=this._emitters.length-1;e>=0;e--)this.removeEmitter(this._emitters[e]);for(var e=t.length-1;e>=0;e--)this.addEmitter(t[e])},enumerable:!0,configurable:!0}),e.prototype.addEmitter=function(t){this._emitters.push(t),t.particleCreated.add(this.particleAdded,this),t.particleAdded.add(this.particleAdded,this),t.particleDead.add(this.particleRemoved,this),t.particleRemoved.add(this.particleRemoved,this);for(var e=0;e<t.particles.length;e++)this._addParticle(t.particles[e])},e.prototype.removeEmitter=function(t){for(var e=0;e<this._emitters.length;++e)if(this._emitters[e]==t){this._emitters.splice(e,1),t.particleCreated.remove(this.particleAdded,this),t.particleAdded.remove(this.particleAdded,this),t.particleDead.remove(this.particleRemoved,this),t.particleRemoved.remove(this.particleRemoved,this);for(var i=0;i<t.particles.length;i++)this._removeParticle(t.particles[i]);return}},e.prototype.particleAdded=function(t){this._addParticle(t)},e.prototype.particleRemoved=function(t){this._removeParticle(t)},e.prototype._addParticle=function(t){this._particles.push(t)},e.prototype._removeParticle=function(t){var e=this._particles.indexOf(t);-1!=e&&this._particles.splice(e,1)},e.prototype.destroy=function(){this._emitters=null,this._particles=null,t.prototype.destroy.call(this)},e}(t.RenderComponent);t.ParticleRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){t.call(this,e,i),this._width=n,this._height=o,this._canvas=document.createElement("canvas"),this._renderContext=this._canvas.getContext("2d"),this._canvas.width=Math.ceil(this._width),this._canvas.height=Math.ceil(this._height),this.clearBetweenFrames=!0,this.clearAlpha=1,this.view=this._canvas}return __extends(e,t),e.NAME="CanvasParticleRenderComponent",e.prototype.onFrame=function(e){if(this.owner){if(this._renderContext.setTransform(1,0,0,1,0,0),this.clearBetweenFrames&&(1==this.clearAlpha?this._renderContext.clearRect(0,0,this._width,this._height):(this.compositeOperation&&(this._renderContext.globalCompositeOperation="destination-out"),this._renderContext.fillStyle="rgba(0, 0, 0, "+this.clearAlpha+")",this._renderContext.fillRect(0,0,this._width,this._height))),this._len=this._particles.length,this._len){this._renderContext.save(),this.compositeOperation&&(this._renderContext.globalCompositeOperation=this.compositeOperation);for(var i=this._len;i--;)this._drawParticle(this._particles[i]);this._renderContext.restore()}t.prototype.onFrame.call(this,e)}},e.prototype._drawParticle=function(t){t.image&&(this._matrix=t.matrixTransform,this._matrix.translate(-this._positionX,-this._positionY),1!=t.alpha&&(this._prevAlpha=this._renderContext.globalAlpha,this._renderContext.globalAlpha=t.alpha),this._renderContext.setTransform(this._matrix.a,this._matrix.b,this._matrix.c,this._matrix.d,this._matrix.tx+.5|0,this._matrix.ty+.5|0),this._renderContext.drawImage(t.image,0,0,t.image.width,t.image.height,0,0,t.image.width,t.image.height),1!=t.alpha&&(this._renderContext.globalAlpha=this._prevAlpha))},e.prototype.destroy=function(){this._matrix=null,this._canvas=null,this._renderContext=null,t.prototype.destroy.call(this)},e}(t.ParticleRenderComponent);t.CanvasParticleRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){t.call(this,e,i)}return __extends(e,t),e.NAME="GameEntityParticleRenderComponent",e.prototype._addParticle=function(e){t.prototype._addParticle.call(this,e),this._gameEntity=e.image,this._gameEntity.active=!0,this._gameEntity.visible=!0,this._gameEntity.centerX=e.x,this._gameEntity.centerY=e.y,this._gameEntity.scale=e.scale,this._gameEntity.rotation=e.rotation,this._gameEntity.alpha=e.alpha},e.prototype._removeParticle=function(e){this._gameEntity=e.image,this._gameEntity.active=!1,this._gameEntity.visible=!1,t.prototype._removeParticle.call(this,e)},e.prototype.onFrame=function(e){if(this.owner){for(var i=0,n=this._particles.length;n>i;i++)this._particle=this._particles[i],this._gameEntity.centerX=this._particle.x,this._gameEntity.centerY=this._particle.y,this._gameEntity.scale=this._particle.scale,this._gameEntity.rotation=this._particle.rotation,this._gameEntity.alpha=this._particle.alpha;t.prototype.onFrame.call(this,e)}},e.prototype.destroy=function(){this._gameEntity=null,this._particle=null,t.prototype.destroy.call(this)},e}(t.ParticleRenderComponent);t.GameEntityParticleRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n,o){e.call(this,t,i),this._width=n,this._height=o,this._canvas=document.createElement("canvas"),this._renderContext=this._canvas.getContext("2d"),this._canvas.width=Math.ceil(this._width),this._canvas.height=Math.ceil(this._height),this.clearBetweenFrames=!0,this.clearAlpha=1,this.pixelSize=1,this.view=this._canvas}return __extends(i,e),i.NAME="PixelParticleRenderComponent",i.prototype.onFrame=function(t){if(this.owner){if(this.clearBetweenFrames&&(1==this.clearAlpha?this._renderContext.clearRect(0,0,this._width,this._height):(this.compositeOperation&&(this._renderContext.globalCompositeOperation="destination-out"),this._renderContext.fillStyle="rgba(0, 0, 0, "+this.clearAlpha+")",this._renderContext.fillRect(0,0,this._width,this._height))),this._len=this._particles.length,this._len){this._renderContext.save(),this.compositeOperation&&(this._renderContext.globalCompositeOperation=this.compositeOperation);for(var i=this._len;i--;)this._drawParticle(this._particles[i]);this._renderContext.restore()}e.prototype.onFrame.call(this,t)}},i.prototype._drawParticle=function(e){e&&(this._colors=t.ColorUtil.hexToARGB(e.color),this._renderContext.fillStyle="rgba("+this._colors[1]+", "+this._colors[2]+", "+this._colors[3]+", "+e.alpha+")",this._renderContext.fillRect(e.x,e.y,this.pixelSize,this.pixelSize))},i.prototype.sortByColor=function(t,e){return t.color-e.color},i.prototype.destroy=function(){this._colors=null,this._canvas=null,this._renderContext=null,e.prototype.destroy.call(this)},i}(t.ParticleRenderComponent);t.PixelParticleRenderComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a){"undefined"==typeof o&&(o=-1),"undefined"==typeof r&&(r=-1),"undefined"==typeof s&&(s=-1),"undefined"==typeof a&&(a=i.NAME),e.call(this,a+o),this._timeManager=n,this._index=o,this._width=r,this._height=s,this._transform=new t.Matrix,this._position=new t.Point,this._registration=new t.Point,this._center=new t.Point,this._offset=new t.Point,this._extents=new t.Rectangle,this._renderComponents=[],this.sortFunction=this._defaultSortFunction,this._isBlinking=!1,this._isShaking=!1,this.preventAutoReset=!1,this.reset(),this._timeManager.addAnimatedObject(this,-1)}return __extends(i,e),i.NAME="RenderLayer",Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isShaking",{get:function(){return this._isShaking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDirty",{get:function(){return this._indexDirty},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return.5*this._width*this.abs(this._scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return.5*this._height*this.abs(this._scaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width*this._scaleX},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height*this._scaleY
},set:function(t){this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._positionY+this._offsetY},set:function(t){this.y=t-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._positionX+this._offsetX},set:function(t){this.x=t-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._positionX+this._width*this._scaleX+this._offsetX},set:function(t){this.x=t-this._width*this._scaleX-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._positionY+this._height*this._scaleY+this._offsetY},set:function(t){this.y=t-this._height*this._scaleY-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._positionX+this._width*this.abs(this._scaleX)*.5+this._offsetX},set:function(t){this._positionX=t-this._width*this.abs(this._scaleX)*.5-this._offsetX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._positionY+this._height*this.abs(this._scaleY)*.5+this._offsetY},set:function(t){this._positionY=t-this._height*this.abs(this._scaleY)*.5-this._offsetY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this._transform},set:function(t){if(this._transform!=t){var e=t.a,i=t.b,n=t.c,o=t.d;this._positionX=t.tx,this._positionY=t.ty,this._scaleX=Math.sqrt(e*e+i*i),this._rotation=0!=this._scaleX?Math.atan2(i,e):0,this._scaleY=o*Math.cos(this._rotation)-n*Math.sin(this._rotation),this._registrationX=0,this._registrationY=0,this._transform=t,this._transformDirty=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._positionX},set:function(t){this._positionX!=t&&(this._positionX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._positionY},set:function(t){this._positionY!=t&&(this._positionY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._registrationX},set:function(t){this._registrationX!=t&&(this._registrationX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._registrationY},set:function(t){this._registrationY!=t&&(this._registrationY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX!=t&&(this._offsetX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY!=t&&(this._offsetY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!=t&&(this._scaleX=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!=t&&(this._scaleY=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!=t&&(this._rotation=t,this._transformDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position.setTo(this._positionX,this._positionY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._registration.setTo(this._registrationX,this._registrationY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.setTo(this._positionX+this._width*this.abs(this._scaleX)*.5+this._offsetX,this._positionY+this._height*this.abs(this._scaleY)*.5+this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset.setTo(this._offsetX,this._offsetY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._extents.setTo(this._positionX,this._positionY,this._width*this._scaleX,this._height*this._scaleY)},enumerable:!0,configurable:!0}),i.prototype.addRenderer=function(t){-1==this._renderComponents.indexOf(t)&&(this._renderComponents.push(t),this._indexDirty=!0)},i.prototype.removeRenderer=function(t){var e=this._renderComponents.indexOf(t);-1!=e&&(this._renderComponents.splice(e,1),this._indexDirty=!0)},i.prototype.getRenderers=function(){return this._renderComponents},i.prototype.onFrame=function(){this.updateTransform(),this.sortRenderers()},i.prototype.blink=function(e,i,n,o){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=.25),"undefined"==typeof o&&(o=!1),(!this._isBlinking||o)&&(this._blinkTimer||(this._blinkTimer=this.create(t.Timer,this._timeManager,i,e),this._blinkTimer.timerSignal.add(this._onBlink,this),this._blinkTimer.completeSignal.add(this._onBlinkComplete,this)),o&&this._currentAlpha&&(this._alpha=this._currentAlpha),this._currentAlpha=this._alpha,this._blinkAlpha=n,this._blinkTimer.reset(),this._blinkTimer.repeatCount=e,this._blinkTimer.delay=i/e,this._blinkTimer.start(),this._isBlinking=!0)},i.prototype.stopBlink=function(){this._isBlinking&&this._onBlinkComplete()},i.prototype._onBlink=function(){this._alpha=this._alpha==this._currentAlpha?this._blinkAlpha:this._currentAlpha},i.prototype._onBlinkComplete=function(){this._alpha=this._currentAlpha,this._isBlinking=!1,this._blinkTimer.reset()},i.prototype.shake=function(e,i,n){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=2),this._shakeTimer||(this._shakeTimer=this.create(t.Timer,this._timeManager,i,e),this._shakeTimer.timerSignal.add(this._onShake,this),this._shakeTimer.completeSignal.add(this._onShakeComplete,this)),this._currentOffsetX=this.offsetX,this._currentOffsetY=this.offsetY,this._shakeStrength=n,this._shakeTimer.reset(),this._shakeTimer.repeatCount=e,this._shakeTimer.delay=i/e,this._shakeTimer.start(),this._isShaking=!0},i.prototype.stopShake=function(){this._isShaking&&this._onShakeComplete()},i.prototype._onShake=function(){this.offsetX=this._currentOffsetX+t.Random.integer(-this._shakeStrength,this._shakeStrength),this.offsetY=this._currentOffsetY+t.Random.integer(-this._shakeStrength,this._shakeStrength)},i.prototype._onShakeComplete=function(){this.offsetX=this._currentOffsetX,this.offsetY=this._currentOffsetY,this._isShaking=!1,this._shakeTimer.reset()},i.prototype.updateTransform=function(t){"undefined"==typeof t&&(t=!1),(this._transformDirty||t)&&(this._transform.identity(),this._transform.translate(this._positionX+this._registrationX,this._positionY+this._registrationY),this._transform.scale(this._scaleX,this._scaleY),this._transform.rotate(this._rotation*(Math.PI/180)),this._transform.translate(-this._registrationX+this._offsetX,-this._registrationY+this._offsetY),this._transformDirty=!1)},i.prototype.reset=function(){this._transform.identity(),this._renderComponents.length=0,this._width=1,this._height=1,this._registrationX=0,this._registrationY=0,this._positionX=0,this._positionY=0,this._offsetX=0,this._offsetY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._visible=!0,this._alpha=1,this._transformDirty=!0,this._indexDirty=!0,this.cameraTransformOptions=t.TransformOptions.ALL,this.cameraPanXFactor=1,this.cameraPanYFactor=1},i.prototype.sortRenderers=function(t){if("undefined"==typeof t&&(t=!1),this._indexDirty||t){this._renderComponents.sort(this.sortFunction),this._firstRenderer=null,this._lastRenderer=null;for(var e=0,i=this._renderComponents.length;i>e;e++)null==this._firstRenderer?(this._firstRenderer=this._renderComponents[e],this._lastRenderer=this._renderComponents[e]):(this._lastRenderer._next=this._renderComponents[e],this._lastRenderer=this._renderComponents[e]);this._indexDirty=!1}},i.prototype.markDirty=function(){this._indexDirty=!0},i.prototype._defaultSortFunction=function(t,e){return t.zIndex-e.zIndex},i.prototype.destroy=function(){this._timeManager.removeAnimatedObject(this),this._renderComponents.length=0,this._position=null,this._registration=null,this._center=null,this._offset=null,this._extents=null,this._blinkTimer=null,this._shakeTimer=null,this._renderComponents=null,this._transform=null,this.sortFunction=null,e.prototype.destroy.call(this)},i.prototype.abs=function(t){return(t^t>>31)-(t>>31)},i}(t.Group);t.RenderLayer=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,s),this._timeManager=n,this._renderCanvas=r,this._camera=this.create(t.Camera,this._timeManager,this,o,t.Camera.NAME),this._renderLayers=[],this.sortFunction=this._defaultSortFunction,this._timeManager.addAnimatedObject(this,-10),DEBUG&&(this._profiler=this.create(t.Profiler,s+"Profiler"),this._profiler.add("render","rgb(128,0,0)"))}return __extends(i,e),i.NAME="RenderManager",Object.defineProperty(i.prototype,"renderCanvas",{get:function(){return this._renderCanvas},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerCount",{get:function(){return this._renderLayers.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDirty",{get:function(){return this._sortDirty},enumerable:!0,configurable:!0}),i.prototype.addRenderer=function(t){this.getLayer(t.layerIndex,!0).addRenderer(t),this._sortDirty=!0},i.prototype.removeRenderer=function(t){this.getLayer(t.layerIndex).removeRenderer(t),this._sortDirty=!0},i.prototype.getRenderers=function(t){return this.getLayer(t).getRenderers()},i.prototype.getLayer=function(e,i){"undefined"==typeof i&&(i=!1);for(var n,o=0,r=this._renderLayers.length;r>o;o++)if(n=this._renderLayers[o],n.index==e)return n;return i&&(n=this.create(t.RenderLayer,this._timeManager,e),n.registrationX=this._camera.halfWidth,n.registrationY=this._camera.halfHeight,this._renderLayers.push(n),this.sortLayers(!0)),LOGGING&&e>this._renderLayers.length&&!i&&this._log.warn("Layer index out of range"),n},i.prototype.getLayers=function(){return this._renderLayers},i.prototype.removeAllLayers=function(){for(var t=0;t<this._renderLayers.length;t++)this._renderLayers[t].destroy(),this._renderLayers[t]=null;this._renderLayers=[]},i.prototype.reset=function(){this._camera.reset();for(var t=0;t<this._renderLayers.length;t++)this._renderLayers[t].preventAutoReset||this._renderLayers[t].reset()},i.prototype.onFrame=function(){for(DEBUG&&this._profiler.begin("render"),this.sortLayers(),this._renderCanvas.clear(),this._renderCanvas.save(),this._renderID=0,this._draws=0,this._layer=this._firstLayer;this._layer;)if(this._layer.visible){for(this._renderMatrix=this._layer.transform.clone(),this._layer.cameraTransformOptions==t.TransformOptions.ALL?(this._cameraMatrix=this._camera.transform.clone(),this._cameraMatrix.tx*=this._layer.cameraPanXFactor,this._cameraMatrix.ty*=this._layer.cameraPanYFactor,this._renderMatrix.multiply(this._cameraMatrix)):this._layer.cameraTransformOptions!=t.TransformOptions.NONE&&(this._renderMatrix.translate(-this._camera.registrationX,-this._camera.registrationY),this._layer.cameraTransformOptions&t.TransformOptions.SCALE&&this._renderMatrix.scale(this._camera.scaleX,this._camera.scaleY),this._layer.cameraTransformOptions&t.TransformOptions.ROTATE&&this._renderMatrix.rotate(this._camera.rotation*(Math.PI/180)),this._layer.cameraTransformOptions&t.TransformOptions.TRANSLATE&&this._renderMatrix.translate(this._camera.x*this._layer.cameraPanXFactor+this._camera.offsetX,this._camera.y*this._layer.cameraPanYFactor+this._camera.offsetY),this._renderMatrix.translate(this._camera.registrationX,this._camera.registrationY)),this._renderAlpha=this._layer.alpha*this._camera.alpha,this._renderComponent=this._layer._firstRenderer;this._renderComponent&&(this._renderComponent.view&&this._camera.inView(this._renderComponent,this._layer)&&(this._renderComponent._renderID=this._renderID++,this._renderComponent.render(this._renderCanvas,this._renderMatrix,this._renderAlpha)),this._renderComponent!=this._layer._lastRenderer);)this._renderComponent=this._renderComponent._next;if(this._layer==this._lastLayer)break;this._layer=this._layer._next}else this._layer=this._layer._next;this._renderCanvas.restore(),DEBUG&&this._profiler.end("render")},i.prototype.clear=function(){this._renderCanvas.clear()},i.prototype.sortLayers=function(t){if("undefined"==typeof t&&(t=!1),this._sortDirty||t){this._renderLayers.sort(this.sortFunction),this._firstLayer=null,this._lastLayer=null;for(var e=0,i=this._renderLayers.length;i>e;e++)null==this._firstLayer?(this._firstLayer=this._renderLayers[e],this._lastLayer=this._renderLayers[e]):(this._lastLayer._next=this._renderLayers[e],this._lastLayer=this._renderLayers[e]);this._sortDirty=!1}},i.prototype.markDirty=function(){this._sortDirty=!0},i.prototype._defaultSortFunction=function(t,e){return t.index-e.index},i.prototype.destroy=function(){this._timeManager.removeAnimatedObject(this),e.prototype.destroy.call(this),this._timeManager=null,this._renderCanvas=null,this._renderLayers=null,this._camera=null,this._layer=null,this.sortFunction=null,this._profiler=null},i}(t.Group);t.RenderManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t}();t.RenderSession=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s){"undefined"==typeof n&&(n=-1),"undefined"==typeof o&&(o=1),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=e.NAME+e.COUNT++),t.call(this,s),this.index=n,this.width=o,this.height=r,this.row=-1,this.col=-1,this._frames=i,this._duration=1e3,this._defaultRepeatCount=-1,this._currentRepeatCount=this._defaultRepeatCount,this._totalFrames=this._frames.length,this._frameDuration=this._duration/this._totalFrames/1e3,this._frameIndex=0,this._elapsed=0}return __extends(e,t),e.NAME="Tile",e.COUNT=0,Object.defineProperty(e.prototype,"isAnimated",{get:function(){return this._frames.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._frames[this._frameIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeatCount",{get:function(){return this._currentRepeatCount},set:function(t){this._defaultRepeatCount=t,this._currentRepeatCount=this._defaultRepeatCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t,this._frameDuration=Math.abs(this._duration)/this._totalFrames/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameIndex",{get:function(){return this._frameIndex},set:function(t){this._frameIndex=t%this._totalFrames},enumerable:!0,configurable:!0}),e.prototype.animate=function(t){this.isAnimated&&(this._elapsed+=t,this._repeat=!1,this._elapsed>=this._frameDuration&&(this._count=Math.floor(this._elapsed/this._frameDuration),this._frameIndex+this._count>=this._totalFrames&&(this._repeat=!0),this._frameIndex=(this._frameIndex+this._count)%this._totalFrames,this._elapsed=0),this._repeat&&(this._currentRepeatCount>0&&this._currentRepeatCount--,0==this._currentRepeatCount&&(this._frameIndex=this._totalFrames-1,this._currentRepeatCount=this._defaultRepeatCount)))},e.prototype.setType=function(t,e){this.type=t.getBitMask(e)},e.prototype.clone=function(t){var i=t.create(e,this._frames,this.index,this.width,this.height,this.name+e.COUNT++);return i.duration=this.duration,i.repeatCount=this.repeatCount,i.frameIndex=this.frameIndex,this.type&&(i.type=this.type),i},e.prototype.destroy=function(){this._frames=null,this.type=null,this.data=null,t.prototype.destroy.call(this)},e}(t.Element);t.Tile=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o,r,s){t.call(this,e,i),this.showDebug=!1,this._camera=this._renderManager.camera,this._tileSet=n,this._tileSheet=this._tileSet.tileSheet,this._tileWidth=this._tileSet.tileWidth,this._tileHeight=this._tileSet.tileHeight,this._tiles=o,this._rows=r,this._cols=s,this._width=this._cols*this._tileWidth,this._height=this._rows*this._tileHeight,this._view=document.createElement("canvas"),this._isPrerendered=!1,this._renderMethod=this.renderTiles}return __extends(e,t),Object.defineProperty(e.prototype,"tileSet",{get:function(){return this._tileSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiles",{get:function(){return this._tiles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),e.prototype.setTile=function(){},e.prototype.onFrame=function(t){return},e.prototype.prerender=function(t,e,n,o,r,s){"undefined"==typeof n&&(n=this._tileSet),"undefined"==typeof o&&(o=this._tiles),"undefined"==typeof r&&(r=this._rows),"undefined"==typeof s&&(s=this._cols),this._tileChunks||(this._tileChunks=[]),this._chunkWidth=n.tileWidth*t,this._chunkHeight=n.tileHeight*e,this._chunkRows=r/e,this._chunkCols=s/t;for(var a,h=0;r>h;h+=e)for(var l=0;s>l;l+=t){a=this._tileChunks[h/e*this._chunkCols+l/t],a||(a=this.create(i,this._chunkWidth,this._chunkHeight));for(var c=0;r>c;c++)for(var u=0;s>u;u++)this._tile=o[(h+c)*s+(l+u)],this._tile&&this._tile.currentFrame&&(this._region=this._tile.currentFrame.region,this._offset=this._tile.currentFrame.offset,a._renderContext.drawImage(n.tileSheet.image,this._region.x,this._region.y,this._region.width,this._region.height,u*this._tileWidth+this._offset.x,c*this._tileHeight+this._offset.y,this._region.width,this._region.height));this._tileChunks[h/e*this._chunkCols+l/t]=a}this._isPrerendered=!0,this._renderMethod=this.renderChunks},e.prototype.render=function(t,e,i){this._renderMethod(t,e,i)},e.prototype.renderChunks=function(t,e,i){if((!this._parent||(i*=this._parent.alpha,this._parent.visible&&0!=i&&0!=this._parent.scaleX&&0!=this._parent.scaleY))&&(i*=this._alpha,this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY)){1!=i&&(this._globalAlpha=t.alpha,t.alpha=i),this._renderMatrix=this._worldTransform.clone(),this._renderMatrix.multiply(e),this._roundedPixels?t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx+.5|0,this._renderMatrix.ty+.5|0):t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx,this._renderMatrix.ty),this._topRow=this.clamp(Math.floor((this._camera.top-this._camera.offsetY-this.y)/this._chunkHeight),0,this._chunkRows),this._bottomRow=this.clamp(Math.ceil((this._camera.bottom/this._camera.scaleY-this._camera.offsetY-this.y)/this._chunkHeight),0,this._chunkRows),this._leftCol=this.clamp(Math.floor((this._camera.left-this._camera.offsetX-this.x)/this._chunkWidth),0,this._chunkCols),this._rightCol=this.clamp(Math.ceil((this._camera.right/this._camera.scaleX-this._camera.offsetX-this.x)/this._chunkWidth),0,this._chunkCols);for(var n=this._topRow;n<this._bottomRow;n++)for(var o=this._leftCol;o<this._rightCol;o++)this._chunk=this._tileChunks[n*this._chunkCols+o],this._chunk&&(t.drawImage(this._chunk._canvas,0,0,this._chunk.width,this._chunk.height,o*this._chunk.width,n*this._chunk.height,this._chunk.width,this._chunk.height),this._renderManager._draws++);1!=i&&(t.alpha=this._globalAlpha)}},e.prototype.renderTiles=function(t,e,i){if((!this._parent||(i*=this._parent.alpha,this._parent.visible&&0!=i&&0!=this._parent.scaleX&&0!=this._parent.scaleY))&&(i*=this._alpha,this._visible&&0!=this._alpha&&0!=this._scaleX&&0!=this._scaleY)){1!=i&&(this._globalAlpha=t.alpha,t.alpha=i),this._renderMatrix=this._worldTransform.clone(),this._renderMatrix.multiply(e),this._roundedPixels?t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx+.5|0,this._renderMatrix.ty+.5|0):t.setTransform(this._renderMatrix.a,this._renderMatrix.b,this._renderMatrix.c,this._renderMatrix.d,this._renderMatrix.tx,this._renderMatrix.ty),this._topRow=this.clamp(Math.floor((this._camera.top-this._camera.offsetY-this.y)/this._tileHeight),0,this._rows),this._bottomRow=this.clamp(Math.ceil((this._camera.bottom/this._camera.scaleY-this._camera.offsetY-this.y)/this._tileHeight),0,this._rows),this._leftCol=this.clamp(Math.floor((this._camera.left-this._camera.offsetX-this.x)/this._tileWidth),0,this._cols),this._rightCol=this.clamp(Math.ceil((this._camera.right/this._camera.scaleX-this._camera.offsetX-this.x)/this._tileWidth),0,this._cols);for(var n=this._topRow;n<this._bottomRow;n++)for(var o=this._leftCol;o<this._rightCol;o++)this._tile=this._tiles[n*this._cols+o],this._tile&&this._tile.currentFrame&&(this._region=this._tile.currentFrame.region,this._offset=this._tile.currentFrame.offset,t.drawImage(this._tileSheet.image,this._region.x,this._region.y,this._region.width,this._region.height,o*this._tileWidth+this._offset.x,n*this._tileHeight+this._offset.y,this._region.width,this._region.height),this._renderManager._draws++);1!=i&&(t.alpha=this._globalAlpha)}},e.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._renderContext=null,this._camera=null,this._tileSet=null,this._tileSheet=null,this._tiles=null,this._tileChunks=null,this._chunk=null,this._tile=null,this._rect=null,this._region=null,this._offset=null,this._renderMethod=null},e}(t.RenderComponent);t.TileRenderComponent=e;var i=function(t){function e(i,n,o){"undefined"==typeof o&&(o=e.NAME+e.COUNT++),t.call(this,o),this._canvas=document.createElement("canvas"),this._renderContext=this._canvas.getContext("2d"),this.width=i,this.height=n,this._canvas.width=this.width,this._canvas.height=this.height}return __extends(e,t),e.NAME="TileChunk",e.COUNT=0,e.prototype.destroy=function(){this._canvas=null,this._renderContext=null,t.prototype.destroy.call(this)},e}(t.Element);t.TileChunk=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){if("undefined"==typeof s&&(s=i.NAME+i.COUNT++),e.call(this,r.hasOwnProperty("name")?r.name:s),this._typeManager=n,this._tileSheet=o,this._data=r,this.tiles=[],this._data.hasOwnProperty("tileWidth")&&(this._tileWidth=this._data.tileWidth),this._data.hasOwnProperty("tileHeight")&&(this._tileHeight=this._data.tileHeight),this._data.hasOwnProperty("tileSize")&&(this._tileWidth=this._data.tileSize,this._tileHeight=this._data.tileSize),this._data.hasOwnProperty("tiles")){var a,h,l,s,c=0;for(h in this._data.tiles)l=this._data.tiles[h],l.hasOwnProperty("frames")||(l.frames="*"),a=this.create(t.Tile,this._tileSheet.getFrames(l.frames),c++,this._tileWidth,this._tileHeight,l.name),l.hasOwnProperty("frameIndex")&&(a.frameIndex=l.frameIndex),l.hasOwnProperty("repeatCount")&&(a.repeatCount=l.repeatCount),l.hasOwnProperty("duration")&&(a.duration=parseInt(l.duration)),l.hasOwnProperty("type")&&a.setType(this._typeManager,l.type.replace(/\s/g,"").split(",")),this.tiles.push(a)}}return __extends(i,e),i.NAME="TileSet",i.COUNT=0,Object.defineProperty(i.prototype,"tileSheet",{get:function(){return this._tileSheet},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),i.prototype.getTile=function(t){return this.tiles[t-1]},i.prototype.getTileByName=function(t){for(var e=0,i=this.tiles.length;i>e;e++)if(this.tiles[e].name==t)return this.tiles[e];return null},i.prototype.destroy=function(){this.tiles=null,this._data=null,this._tileSheet=null,this._typeManager=null,e.prototype.destroy.call(this)},i}(t.Group);t.TileSet=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function o(t,n,r,s){"undefined"==typeof r&&(r=o.NAME),"undefined"==typeof s&&(s=i.JSON),e.call(this,r),this._image=t,this._data=n,this.parseData(s)}return __extends(o,e),o.NAME="TileSheet",Object.defineProperty(o.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),o.prototype.parseData=function(e){this._regions={},this._frames={};var i,n,o,r,s,a,h,l,c,u,p;switch(e){case t.SpriteSheetFormat.JSON:for(var d,f=0;f<this._data.frames.length;f++)d=this._data.frames[f],i=d.filename,n=d.frame.x,o=d.frame.y,r=d.frame.w,s=d.frame.h,a=d.spriteSourceSize.x,h=d.spriteSourceSize.y,l=d.sourceSize.w,c=d.sourceSize.h,u=new t.Rectangle(n,o,r,s),p=new t.Rectangle(a,h,l,c),this.addFrame(i,u,p);break;case t.SpriteSheetFormat.STARLING:}},o.prototype.getRegion=function(t){return this._regions[t]},o.prototype.getOffset=function(t){return this._frames[t]},o.prototype.getFrame=function(t){return this._frames[t]},o.prototype.getFrames=function(t){"undefined"==typeof t&&(t="");var e=[],i=[];for(var n in this._regions)0==n.indexOf(t)&&i.push(n);i.sort(this.sortCaseInsensitive);for(var o=0,r=i.length;r>o;o++)e.push(this.getFrame(i[o]));return e},o.prototype.addFrame=function(t,e,i){this._regions[t]=e,this._frames[t]=new n(e,i)},o.prototype.removeFrame=function(t){this._frames[t].destroy(),delete this._frames[t]},o.prototype.destroy=function(){var t;for(t in this._regions)this._regions[t]=null,delete this._regions[t];var i;for(t in this._frames)i=this._frames[t],i.destroy(),this._frames[t]=null,delete this._frames[t];i=null,this._data=null,this._image=null,this._frames=null,this._regions=null,e.prototype.destroy.call(this)},o.prototype.sortCaseInsensitive=function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0},o}(t.Element);t.TileSheet=e;var i=function(){function t(){}return t.JSON="JSON",t}();t.TileSheetFormat=i;var n=function(){function t(t,e){this.region=t,this.offset=e,this.destroyed=!1}return t.prototype.destroy=function(){this.region=null,this.offset=null,this.destroyed=!0},t}();t.TileData=n}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i){"undefined"==typeof i&&(i=32),t.call(this,e.NAME),this.gridSize=i,this._spatialComponents=[],this._grid=[],this._cache=[],this._positions=[]}return __extends(e,t),e.NAME="SpatialGrid",Object.defineProperty(e.prototype,"gridSize",{get:function(){return this._gridSize},set:function(t){this._gridSize=t,this._offset=1024*this._gridSize},enumerable:!0,configurable:!0}),e.prototype.addSpatialComponent=function(t){-1==this._spatialComponents.indexOf(t)&&this._spatialComponents.push(t)},e.prototype.removeSpatialComponent=function(t){this._spatialComponents.splice(this._spatialComponents.indexOf(t),1)},e.prototype.hasSpatialComponent=function(t){return-1!=this._spatialComponents.indexOf(t)},e.prototype.queryRectangle=function(t){return this.query((t.x+.5*t.width+this._offset)/this._gridSize<<11|(t.y+.5*t.height+this._offset)/this._gridSize)},e.prototype.queryPoint=function(t){return this.query((t.x+this._offset)/this._gridSize<<11|(t.y+this._offset)/this._gridSize)},e.prototype.queryPosition=function(t,e){return this.query((t+this._offset)/this._gridSize<<11|(e+this._offset)/this._gridSize)},e.prototype.query=function(t){if(this._cache[t])return this._cache[t];var e=this._grid[t];return null==e&&(e=[]),this._grid[t-2048-1]&&(e=e.concat(this._grid[t-2048-1])),this._grid[t-1]&&(e=e.concat(this._grid[t-1])),this._grid[t+2048-1]&&(e=e.concat(this._grid[t+2048-1])),this._grid[t-2048]&&(e=e.concat(this._grid[t-2048])),this._grid[t+2048]&&(e=e.concat(this._grid[t+2048])),this._grid[t-2048+1]&&(e=e.concat(this._grid[t-2048+1])),this._grid[t+1]&&(e=e.concat(this._grid[t+1])),this._grid[t+2048+1]&&(e=e.concat(this._grid[t+2048+1])),this._cache[t]=e,e},e.prototype.refresh=function(){this._positions=[];for(var t=0,e=this._spatialComponents.length;e>t;t++)this._spatialComponent=this._spatialComponents[t],this._index=(this._spatialComponent.centerX+this._spatialComponent.collisionOffsetX+this._offset)/this._gridSize<<11|(this._spatialComponent.centerY+this._spatialComponent.collisionOffsetY+this._offset)/this._gridSize,this._positions[this._index]?this._positions[this._index].push(this._spatialComponent):this._positions[this._index]=[this._spatialComponent];this._cache=[],this._grid=this._positions,this._spatialComponent=null},e.prototype.calculateGridSize=function(){for(var t,e=0,i=this._firstSpatial,n=0;n<this._spatialComponents.length;n++)i=this._spatialComponents[n],i.width>e&&(e=i.width,t=i.owner.name),i.height>e&&(e=i.height,t=i.owner.name);this.gridSize=e,LOGGING&&this._log.log("Spatial Grid Size: "+this.gridSize+" ("+t+")")},e.prototype.reset=function(){this._spatialComponents=[],this._positions=[],this._grid=[],this._cache=[],this.gridSize=0},e.prototype.destroy=function(){t.prototype.destroy.call(this),this._spatialComponents=null,this._spatialComponent=null,this._grid=null,this._cache=null,this._positions=null},e}(t.Element);t.SpatialGrid=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof r&&(r=i.DEFAULT_GRIDSIZE),"undefined"==typeof s&&(s=i.NAME),e.call(this,s),this._timeManager=n,this._typeManager=o,this._gridSize=r,this._spatialGrid=this.create(t.SpatialGrid,this._gridSize),this._timeManager.addTickedObject(this,0)}return __extends(i,e),i.NAME="SpatialManager",i.DEFAULT_GRIDSIZE=128,Object.defineProperty(i.prototype,"typeManager",{get:function(){return this._typeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gridSize",{get:function(){return this._spatialGrid.gridSize},set:function(t){this._spatialGrid.gridSize=t},enumerable:!0,configurable:!0}),i.prototype.addSpatialComponent=function(t){this._spatialGrid.addSpatialComponent(t)},i.prototype.removeSpatialComponent=function(t){this._spatialGrid.removeSpatialComponent(t)},i.prototype.calculateGridSize=function(){this._spatialGrid.calculateGridSize()},i.prototype.refreshGrid=function(){this._spatialGrid.refresh()},i.prototype.onTick=function(){this._spatialGrid.refresh(),DEBUG&&(this._checks=0)},i.prototype.queryRectangle=function(t,e){for(var i=[],n=this._spatialGrid.queryRectangle(t),o=0,r=n.length;r>o;o++)this._spatialComponent=n[o],!this._spatialComponent.active||t.equals(this._spatialComponent.extents)||e&&!this._spatialComponent.type||e&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,e)||this._spatialComponent.left+this._spatialComponent.collisionOffsetX<t.right&&t.left<this._spatialComponent.right+this._spatialComponent.collisionOffsetX&&this._spatialComponent.top+this._spatialComponent.collisionOffsetY<t.bottom&&t.top<this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY&&i.push(this._spatialComponent);
return this._spatialComponent=null,DEBUG&&this._checks++,i},i.prototype.queryOffsetRectangle=function(t,e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0);for(var o=[],r=this._spatialGrid.queryRectangle(t),s=0,a=r.length;a>s;s++)this._spatialComponent=r[s],!this._spatialComponent.active||t===this._spatialComponent.extents||n&&!this._spatialComponent.type||n&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,n)||this._spatialComponent.left+this._spatialComponent.collisionOffsetX<t.right+e&&t.left+e<this._spatialComponent.right+this._spatialComponent.collisionOffsetX&&this._spatialComponent.top+this._spatialComponent.collisionOffsetY<t.bottom+i&&t.top+i<this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY&&o.push(this._spatialComponent);return this._spatialComponent=null,DEBUG&&this._checks++,o},i.prototype.queryCircle=function(t,e,i){for(var n=[],o=this._spatialGrid.queryPoint(t),r=0,s=o.length;s>r;r++)this._spatialComponent=o[r],!this._spatialComponent.active||i&&!this._spatialComponent.type||i&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,i)||(this._px=t.x-this.clamp(t.x,this._spatialComponent.left+this._spatialComponent.collisionOffsetX,this._spatialComponent.right+this._spatialComponent.collisionOffsetX),this._py=t.y-this.clamp(t.y,this._spatialComponent.top+this._spatialComponent.collisionOffsetY,this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY),this._px*this._px+this._py*this._py<e*e&&n.push(this._spatialComponent));return this._spatialComponent=null,DEBUG&&this._checks++,n},i.prototype.queryCirclePosition=function(t,e,i,n){for(var o=[],r=this._spatialGrid.queryPosition(t,e),s=0,a=r.length;a>s;s++)this._spatialComponent=r[s],!this._spatialComponent.active||n&&!this._spatialComponent.type||n&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,n)||(this._px=t-this.clamp(t,this._spatialComponent.left+this._spatialComponent.collisionOffsetX,this._spatialComponent.right+this._spatialComponent.collisionOffsetX),this._py=e-this.clamp(e,this._spatialComponent.top+this._spatialComponent.collisionOffsetY,this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY),this._px*this._px+this._py*this._py<i*i&&o.push(this._spatialComponent));return this._spatialComponent=null,DEBUG&&this._checks++,o},i.prototype.queryPoint=function(t,e){for(var i=[],n=this._spatialGrid.queryPoint(t),o=0,r=n.length;r>o;o++)this._spatialComponent=n[o],!this._spatialComponent.active||e&&!this._spatialComponent.type||e&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,e)||(this._px=t.x,this._py=t.y,this._px>this._spatialComponent.left+this._spatialComponent.collisionOffsetX&&this._px<this._spatialComponent.right+this._spatialComponent.collisionOffsetX&&this._py>this._spatialComponent.top+this._spatialComponent.collisionOffsetY&&this._py<this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY&&i.push(this._spatialComponent));return this._spatialComponent=null,DEBUG&&this._checks++,i},i.prototype.queryPosition=function(t,e,i){for(var n,o,r=[],s=this._spatialGrid.queryPosition(t,e),a=0,h=s.length;h>a;a++)this._spatialComponent=s[a],!this._spatialComponent.active||i&&!this._spatialComponent.type||i&&this._spatialComponent.type&&!this._typeManager.doTypesOverlap(this._spatialComponent.type,i)||(n=t,o=e,n>this._spatialComponent.left+this._spatialComponent.collisionOffsetX&&n<this._spatialComponent.right+this._spatialComponent.collisionOffsetX&&o>this._spatialComponent.top+this._spatialComponent.collisionOffsetY&&o<this._spatialComponent.bottom+this._spatialComponent.collisionOffsetY&&r.push(this._spatialComponent));return this._spatialComponent=null,DEBUG&&this._checks++,r},i.prototype.queryLine=function(e,i,n){var o,r=new t.Point,s=[],a=!1,h=i.y-e.y,l=i.x-e.x;(h^h>>31)-(h>>31)>(l^l>>31)-(l>>31)&&(h^=l,l^=h,h^=l,a=!0);var c,u=0>l?-1:1,p=0==l?h:h/l;if(a)for(c=0;c!=l;c+=u)r.x=e.x+c*p,r.y=e.y+c,o=this.queryPoint(r,n),o.length>0&&s.push(new t.RayResult(o[c],r,c/l));else for(c=0;c!=l;c+=u)r.x=e.x+c,r.y=e.y+c*p,o=this.queryPoint(r,n),o.length>0&&s.push(new t.RayResult(o[c],r,c/l));return DEBUG&&this._checks++,s},i.prototype.castRay=function(e,i,n){var o,r=new t.Point,s=new t.RayResult,a=!1,h=i.y-e.y,l=i.x-e.x,c=Math.floor(l);(h^h>>31)-(h>>31)>(l^l>>31)-(l>>31)&&(h^=l,l^=h,h^=l,a=!0);var u,p=0>l?-1:1,d=0==l?h:h/l;if(a){for(u=0;u!=c;u+=p)if(r.x=e.x+u*d,r.y=e.y+u,o=this.queryPoint(r,n),o.length>0){s.element=o[0],s.position=r,s.time=u/l;break}}else for(u=0;u!=c;u+=p)if(r.x=e.x+u,r.y=e.y+u*d,o=this.queryPoint(r,n),o.length>0){s.element=o[0],s.position=r,s.time=u/l;break}return DEBUG&&this._checks++,s},i.prototype.reset=function(){this._spatialGrid.reset()},i.prototype.destroy=function(){this._timeManager.removeTickedObject(this),this._spatialComponent=null,this._spatialGrid=null,this._typeManager=null,this._timeManager=null,e.prototype.destroy.call(this)},i.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},i}(t.Group);t.SpatialManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i,n){this.bootstrap(),e.call(this,i),this.bootSignal=new t.Signal,this.initSignal=new t.Signal,this.startupSignal=new t.Signal,this.shutdownSignal=new t.Signal,this.pauseSignal=new t.Signal,this.suspendSignal=new t.Signal,this.resumeSignal=new t.Signal,this._booted=!1,this._wasMuted=!1,this._configure(n)}return __extends(n,e),Object.defineProperty(n.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"config",{get:function(){return this._settings.config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"strings",{get:function(){return this._settings.strings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._settings.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._settings.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sceneManager",{get:function(){return this._settings.getSceneManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"resourceManager",{get:function(){return this._settings.getResourceManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"soundManager",{get:function(){return this._settings.getSoundManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputManager",{get:function(){return this._settings.getInputManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputMap",{get:function(){return this._settings.getInputMap()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"timeManager",{get:function(){return this._settings.getTimeManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"typeManager",{get:function(){return this._settings.getTypeManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spatialManager",{get:function(){return this._settings.getSpatialManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"renderManager",{get:function(){return this._settings.getRenderManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"objectPool",{get:function(){return this._settings.getObjectPool()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sharedData",{get:function(){return this._settings.getSharedData()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"intervalScale",{get:function(){return this.timeManager.intervalScale},set:function(t){this.timeManager.intervalScale=t,TweenMax.globalTimeScale(t)},enumerable:!0,configurable:!0}),n.prototype.bootstrap=function(){t.Log.getTargetByType(t.ConsoleTarget)||t.Log.addTarget(new t.ConsoleTarget);for(var e=0,n=Date.now(),o=["ms","moz","webkit","o"],r=0;r<o.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[o[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[o[r]+"CancelAnimationFrame"]||window[o[r]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+n)},n);return e=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),!window.performance){window.performance={};for(var r=0;r<o.length&&!window.performance.now;r++)window.performance.now=window.performance[o[r]+"Now"]}if(window.performance.now||(window.performance.now=function(){return Date.now()-n}),!navigator.getUserMedia)for(var r=0;r<o.length&&!navigator.getUserMedia;r++)navigator.getUserMedia=navigator[o[r]+"GetUserMedia"];if(!window.URL)for(var r=0;r<o.length&&!window.URL;r++)window.URL=navigator[o[r]+"URL"];t.EnvUtil.init(),-1==i.CAPABILITY&&(t.EnvUtil.isDesktop&&(t.EnvUtil.screenWidth<1024&&(i.CAPABILITY=i.BASIC),1024==t.EnvUtil.screenWidth&&(i.CAPABILITY=i.LOW),t.EnvUtil.screenWidth>1024&&t.EnvUtil.screenWidth<1440&&(i.CAPABILITY=i.MEDIUM),t.EnvUtil.screenWidth>=1440&&(i.CAPABILITY=i.HIGH)),t.EnvUtil.isMobile&&(t.EnvUtil.isiPhone&&(480==t.EnvUtil.screenWidth&&(i.CAPABILITY=i.BASIC),960==t.EnvUtil.screenWidth&&(i.CAPABILITY=i.LOW),t.EnvUtil.screenWidth>=1136&&(i.CAPABILITY=i.HIGH)),t.EnvUtil.isiPad&&(1024==t.EnvUtil.screenWidth&&(i.CAPABILITY=i.LOW),t.EnvUtil.screenWidth>=2048&&(i.CAPABILITY=i.MEDIUM)),t.EnvUtil.isAndroidPhone&&t.EnvUtil.screenWidth>=1080&&(i.CAPABILITY=i.MEDIUM),t.EnvUtil.isAndroidTablet&&navigator.userAgent.match("Nexus 7")&&1200==t.EnvUtil.screenWidth&&(i.CAPABILITY=i.MEDIUM))),t.Log.log(new t.LogMessage(t.Log.PRINT,"","################################{ JMG Avota }###############################")),this.printRuntimeEnvironment(),t.Log.log(new t.LogMessage(t.Log.PRINT,"","############################################################################"))},n.prototype.printRuntimeEnvironment=function(){switch(t.Log.log(new t.LogMessage(t.Log.PRINT,"","Version:	"+t.VERSION)),t.EnvUtil.isDesktop&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Environment:	Desktop")),t.EnvUtil.isMobile&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Environment:	Mobile")),t.EnvUtil.isiOS&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS: 	iOS")),t.EnvUtil.isAndroid&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS:	Android")),t.EnvUtil.isChromeOS&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS:	ChromeOS")),t.EnvUtil.isMacOS&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS:	MacOS")),t.EnvUtil.isLinux&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS:	Linux")),t.EnvUtil.isWindows&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","OS:	Windows")),t.EnvUtil.isiPhone&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	iPhone")),t.EnvUtil.isiPad&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	iPad")),t.EnvUtil.isiPod&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	iPod")),t.EnvUtil.isAndroidPhone&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	Android Phone")),t.EnvUtil.isAndroidTablet&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	Android Tablet")),2==t.EnvUtil.pixelRatio&&(t.EnvUtil.isiPhone||t.EnvUtil.isiPad||t.EnvUtil.isiPod)&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	Retina Enabled")),t.Log.log(new t.LogMessage(t.Log.PRINT,"","Device:	Resolution: "+t.EnvUtil.screenWidth+"x"+t.EnvUtil.screenHeight)),t.EnvUtil.isLandscape&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Orientation:	Landscape")),t.EnvUtil.isPortrait&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Orientation:	Portrait")),t.EnvUtil.isSafari&&!t.EnvUtil.isMobile&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	Safari")),t.EnvUtil.isSafari&&t.EnvUtil.isMobile&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	Mobile Safari")),t.EnvUtil.isChrome&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	Chrome")),t.EnvUtil.isFirefox&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	Firefox")),t.EnvUtil.isIE&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	IE")),t.EnvUtil.isWebApp&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser:	WebApp Mode")),t.EnvUtil.isCocoonJS&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser: CocoonJS")),(t.EnvUtil.isSafari||t.EnvUtil.isChrome||t.EnvUtil.isFirefox||t.EnvUtil.isIE)&&t.Log.log(new t.LogMessage(t.Log.PRINT,"","Browser Version:	"+t.EnvUtil.browserVersion)),i.CAPABILITY){case i.BASIC:t.Log.log(new t.LogMessage(t.Log.PRINT,"","Performance:		Basic"));break;case i.LOW:t.Log.log(new t.LogMessage(t.Log.PRINT,"","Performance:		Low"));break;case i.MEDIUM:t.Log.log(new t.LogMessage(t.Log.PRINT,"","Performance:		Medium"));break;case i.HIGH:t.Log.log(new t.LogMessage(t.Log.PRINT,"","Performance:		High"));break;case i.EXTREME:t.Log.log(new t.LogMessage(t.Log.PRINT,"","Performance:		Extreme"))}t.Log.log(t.EnvUtil.hasWebAudio?new t.LogMessage(t.Log.PRINT,"","Audio:		WebAudio"):t.EnvUtil.hasAudioTag?new t.LogMessage(t.Log.PRINT,"","Audio:		AudioTag"):new t.LogMessage(t.Log.WARN,"","Audio:		N/A")),t.Log.log(new t.LogMessage(t.Log.PRINT,"","URL:"+t.EnvUtil.url))},n.prototype._configure=function(e){LOGGING&&this._log.log("Configuring"),t.EnvUtil.isMobile&&(e.tickRate=30),this._settings=new t.GameSettings(this,e),t.Log.setLevel(this._settings.logLevel),t.Log.setFilters(this._settings.logFilters)},n.prototype._onLoaded=function(t){e.prototype._onLoaded.call(this,t),this._settings.autoStartup&&this.startup()},n.prototype._onUnload=function(t){e.prototype._onUnload.call(this,t),this._settings.autoShutdown&&this.shutdown()},n.prototype._boot=function(){if(LOGGING&&this._log.log("Booting"),!this._settings)throw new Error("Application must be configured before booting.");this.resourceManager.loadedSignal.add(this._onBootResourceLoaded,this),this.resourceManager.failedSignal.add(this._onBootResourceFailed,this),this._settings.resourcePath&&(this.resourceManager.resourcePath=this._settings.resourcePath),this._settings.config&&!this._settings.configPath&&this._setConfig(this._settings.config),this._settings.strings&&!this._settings.stringsPath&&this._setStrings(this._settings.strings),-1===this._settings.gamePerformance&&(this._settings.gamePerformance=i.CAPABILITY),this._checkBootResources()},n.prototype._checkBootResources=function(){if(!this._settings.configPath||this._settings.config||this.resourceManager.isLoaded(this._settings.configPath)||this.resourceManager.isLoading(this._settings.configPath)||this.resourceManager.load(this._settings.configPath,"ConfigResource"),!this._settings.stringsPath||this._settings.strings||this.resourceManager.isLoaded(this._settings.stringsPath)||this.resourceManager.isLoading(this._settings.stringsPath)||this.resourceManager.load(this._settings.stringsPath,"StringsResource"),this.config&&this.config.hasOwnProperty("external"))for(var t,e=0;e<this.config.external.length;e++)t=this.config.external[e],this.resourceManager.isLoaded(t.path)||this.resourceManager.isLoading(t.path)||this.resourceManager.load(t.path,t.name);this._checkBootProgress()},n.prototype._onBootResourceLoaded=function(t){switch(t.path){case this._settings.configPath:LOGGING&&this._log.log("Config Loaded"),this._setConfig(t.data);break;case this._settings.stringsPath:LOGGING&&this._log.log("Strings Loaded"),this._setStrings(t.data);break;default:LOGGING&&this._log.log("Boot Resource Loaded: "+t.name)}this._checkBootResources()},n.prototype._onBootResourceFailed=function(){0==this.resourceManager.loadingCount&&this._onBootComplete()},n.prototype._checkBootProgress=function(){0==this.resourceManager.loadingCount&&this._onBootComplete()},n.prototype._onBootComplete=function(){LOGGING&&this._log.log("Booted"),this.resourceManager.loadedSignal.remove(this._onBootResourceLoaded,this),this.resourceManager.failedSignal.remove(this._onBootResourceFailed,this),this._booted=!0,this.bootSignal.dispatch(),this.init()},n.prototype.init=function(){if(LOGGING&&this._log.log("Initialized"),this.config&&(this.config.hasOwnProperty("config")&&this._settings.setParams(this.config.config),this.config.hasOwnProperty("browserSupport")&&(this._settings.browserSupport=this.config.browserSupport),this.config.hasOwnProperty("minPerformance")&&(this._settings.minPerformance=this.config.minPerformance),this.config.hasOwnProperty("gamePerformance")&&(this._settings.gamePerformance=this.config.gamePerformance),this._settings.gamePerformance!==i.CAPABILITY))switch(i.CAPABILITY=this._settings.gamePerformance,i.CAPABILITY){case i.BASIC:LOGGING&&this._log.warn("Performance Override: BASIC");break;case i.LOW:LOGGING&&this._log.warn("Performance Override: LOW");break;case i.MEDIUM:LOGGING&&this._log.warn("Performance Override: MEDIUM");break;case i.HIGH:LOGGING&&this._log.warn("Performance Override: HIGH");break;case i.EXTREME:LOGGING&&this._log.warn("Performance Override: EXTREME")}if(""!=this._settings.unsupportedCookiesImagePath&&!t.EnvUtil.hasCookies){var e=new Image;return e.id="unsupported",e.src=this._settings.unsupportedCookiesImagePath,document.getElementById(this._settings.parent).innerHTML="",document.getElementById(this._settings.parent).appendChild(e),void this.destroy()}if(this._settings.browserSupport)for(var n,o=0;o<this._settings.browserSupport.length;o++)if(n=this._settings.browserSupport[o],!(n.type&&t.EnvUtil.browserName!=n.type||n.platform&&t.EnvUtil.platformName!=n.platform)&&(n.minVersion<0||parseFloat(t.EnvUtil.browserVersion)<n.minVersion))return void this._onUnsupportedBrowser();return i.CAPABILITY<this._settings.minPerformance?void this._onUnsupportedDevice():(this._settings.unsupportedOrientationImagePath&&(this._settings.orientationImage=new Image,this._settings.orientationImage.src=this._settings.unsupportedOrientationImagePath),this._settings.bgColor&&this._setBackgroundColor(this._settings.bgColor),this._settings.basePath&&(this.resourceManager.resourcePath=this._settings.basePath),this.updateCanvas(),this._settings.debug?LOGGING&&this._log.print("[############[DEBUG ENABLED]############]"):LOGGING||t.Log.removeAllTargets(),DEBUG&&(this._stats=this.create(t.Stats,this),this._stats.alpha=this._settings.statsAlpha,this._stats.setType(this._settings.statsType),LOGGING&&t.Log.addTarget(new t.StatsTarget(this._stats))),t.Log.setLevel(this._settings.logLevel),t.Log.setFilters(this._settings.logFilters),t.EnvUtil.isiOS&&!t.EnvUtil.isCocoonJS&&this.inputManager.inputDown.addOnce(this.soundManager.createEmptyBuffer,this.soundManager),this.timeManager.start(),this.orientationChangeSignal.add(this._onChangeOrientation,this),this.visibilityChangeSignal.add(this._onChangeVisibility,this),this.initSignal.addOnce(this._checkResources,this),this._settings.autoInit&&this.initSignal.dispatch(),void(t.EnvUtil.isPortrait&&this._onChangeOrientation(t.EnvUtil.orientation)))},n.prototype._checkResources=function(){if(LOGGING&&this._log.log("Checking Resources"),this.config&&this.config.hasOwnProperty("resources")&&this.config.resources.length>0){var t;if(this.config.hasOwnProperty("loader")&&this.config.loader.length>0){this.resourceManager.failedSignal.addOnce(this._onLoaderFailed,this),this.resourceManager.loadedSignal.add(this._onLoaderLoaded,this);for(var e=0;e<this.config.loader.length;e++)t=this.config.loader[e],this.resourceManager.load(t.path,t.name);return}this._loadResources()}0==this.resourceManager.loadingCount&&this._onLoadingComplete()},n.prototype._onLoaderLoaded=function(){0==this.resourceManager.loadingCount&&this._onLoaderComplete()},n.prototype._onLoaderFailed=function(){this.resourceManager.failedSignal.remove(this._onLoaderFailed,this),this.resourceManager.loadedSignal.remove(this._onLoaderLoaded,this),this._loadResources()},n.prototype._onLoaderComplete=function(){this.resourceManager.failedSignal.remove(this._onLoaderFailed,this),this.resourceManager.loadedSignal.remove(this._onLoaderLoaded,this),this._loadResources()},n.prototype._loadResources=function(){this._loader=this.create(this.settings.gameLoader,this),this._loader.loadCompleteSignal.addOnce(this._onLoadingComplete,this),this._loader.loadFailedSignal.addOnce(this._onLoadingFailed,this),this._loader.loadResources(this.config.resources)},n.prototype._onLoadingFailed=function(){0==this.resourceManager.loadingCount&&this._onLoadingComplete()},n.prototype._onLoadingComplete=function(){if(this._loader){this._loader.loadCompleteSignal.remove(this._onLoadingComplete,this),this._loader.loadFailedSignal.remove(this._onLoadingFailed,this);var t;if(this.config.hasOwnProperty("loader"))for(var e=0;e<this.config.loader.length;e++)t=this.config.loader[e],this.resourceManager.unload(this.resourceManager.getResource(t.path));this._loader.destroy()}this._setup()},n.prototype._setup=function(){this.config&&(this.config.hasOwnProperty("controls")&&this.registerControls(this.config.controls),this.config.hasOwnProperty("assets")&&this.registerAssets(this.config.assets)),this.startup()},n.prototype._setBackgroundColor=function(t){this._settings.getCanvas().backgroundColor=t},n.prototype._setConfig=function(t){this._settings.config=t,t.strings&&t.strings.path&&(this._settings.stringsPath=t.strings.path),LOGGING&&this._log.debug("Config Set")},n.prototype._setStrings=function(t){this._settings.strings=t,LOGGING&&this._log.debug("Strings Set")},n.prototype.registerControls=function(e){if(0!=e.length){LOGGING&&this._log.log("Registering Controls");for(var i,n,o=0;o<e.length;o++)i=e[o].input,n=e[o].value,this.inputMap.mapKeyToAction(t.InputKey[i],n),LOGGING&&this._log.log("[Key] "+i+" -> [Action] "+n)}},n.prototype.registerAssets=function(e){if(0!=e.length){LOGGING&&this._log.log("Registering Assets");for(var i,n,o,r,s,a,h=0;h<e.length;h++){i=e[h],a=!1;for(var l=0;l<this.config.resources.length;l++)if(s=this.config.resources[l],s.name===i.name||s.name===i.source){a=this.resourceManager.isLoaded(s.path);break}a&&(i.hasOwnProperty("type")&&"audio"===i.type.toLowerCase()&&!this.soundManager.hasSound(i.name)&&(n=i.hasOwnProperty("loop")&&1==i.loop?!0:!1,o=i.hasOwnProperty("volume")?i.volume:100,r=i.hasOwnProperty("category")?i.category:null,this.soundManager.addSound(i.name,this.getAsset(i.name),r,n,o)),i.hasOwnProperty("type")&&"audiosprite"===i.type.toLowerCase()&&this.soundManager.hasSound(i.source)&&(n=i.hasOwnProperty("loop")&&1==i.loop?!0:!1,o=i.hasOwnProperty("volume")?i.volume:this.soundManager.getSound(i.source).volume,r=i.hasOwnProperty("category")?i.category:this.soundManager.getSound(i.source).category.name,this.soundManager.addSoundCuePoint(i.source,i.name,i.start,i.duration,n,o,r)))}for(var h=0;h<e.length;h++){i=e[h],a=!1;for(var l=0;l<this.config.resources.length;l++)if(s=this.config.resources[l],s.name===i.name||s.name===i.source){a=this.resourceManager.isLoaded(s.path);break}a&&this.soundManager._support==t.SoundSupport.WEBAUDIO&&i.hasOwnProperty("type")&&"audio"===i.type.toLowerCase()&&this.resourceManager.unload(this.resourceManager.getResource(s.path))}}},n.prototype.startup=function(){var t=this;return this._booted?(LOGGING&&this._log.info("Startup ["+this.name+"]"),this.inputMap.mapActionToHandler("mute",function(e){return t.mute(e)}),DEBUG&&(this._stats.addClock("R",this.timeManager._profiler.clocks.frame),this._stats.addClock("U",this.timeManager._profiler.clocks.tick)),this.updateCanvas(),void this.startupSignal.dispatch()):void this._boot()},n.prototype.shutdown=function(){LOGGING&&this._log.info("Shutdown ["+this.name+"]"),this.inputMap.unmapAction("mute"),this.shutdownSignal.dispatch(),this._settings.autoDestroy&&this.destroy()},n.prototype.setScene=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];this.sceneManager.setState.apply(this.sceneManager,[t].concat(e))},n.prototype.getAsset=function(e,i){"undefined"==typeof i&&(i=this.config.resources);for(var n,o=0;o<i.length;o++)if(i[o].name==e){n=this.resourceManager.getResource(i[o].path);break}return n instanceof t.ImageResource?n.image:n instanceof t.JSONResource?n.json:n instanceof t.JSResource?n.js:n instanceof t.CSSResource?n.css:n instanceof t.XMLResource?n.xml:n instanceof t.SoundResource?n.soundData:n?n:void(LOGGING&&this._log.error("Unable to find asset: "+e))},n.prototype.unloadResources=function(t,e){"undefined"==typeof e&&(e=this.config.resources);for(var i,n,o=0;o<t.length;o++){for(var r=0;r<e.length;r++)if(e[r].name===t[o]){n=e[r];break}n&&(i=this.resourceManager.getResource(n.path),this.soundManager.hasSound(n.name)&&this.soundManager.removeSound(n.name),this.resourceManager.unload(i))}},n.prototype.pause=function(t){"undefined"==typeof t&&(t=1),1==t&&(this.timeManager.isRunning?(this.timeManager.stop(),TweenMax.pauseAll(),this.suspendSignal.dispatch(),this.pauseSignal.dispatch(!0)):(this.timeManager.start(),TweenMax.resumeAll(),this.resumeSignal.dispatch(),this.pauseSignal.dispatch(!1)),LOGGING&&this._log.info("Pause"))},n.prototype.resume=function(t){"undefined"==typeof t&&(t=1),1!=t||this.timeManager.isRunning||(this.timeManager.start(),TweenMax.resumeAll(),this.resumeSignal.dispatch(),this.pauseSignal.dispatch(!1),LOGGING&&this._log.info("Resume"))},n.prototype.suspend=function(t){"undefined"==typeof t&&(t=1),1==t&&this.timeManager.isRunning&&(this.timeManager.stop(),TweenMax.pauseAll(),this.suspendSignal.dispatch(),this.pauseSignal.dispatch(!0),LOGGING&&this._log.info("Suspend"))},n.prototype.mute=function(t){1==t&&this.soundManager.mute()},n.prototype._onResize=function(t){this.updateCanvas(),e.prototype._onResize.call(this,t)},n.prototype._onOrientationChange=function(t){this.updateCanvas(),e.prototype._onOrientationChange.call(this,t)},n.prototype._onChangeVisibility=function(t){t?(this._wasMuted=this.soundManager.isMuted,this._wasMuted||this.soundManager.mute()):this._wasMuted||this.soundManager.mute()},n.prototype._onChangeOrientation=function(){if(this._settings.orientationImage){if(t.EnvUtil.isLandscape&&(document.getElementsByTagName("canvas")[0].style.display="inline",this._settings.orientationImage.parentNode&&document.getElementById(this._settings.parent).removeChild(this._settings.orientationImage)),t.EnvUtil.isPortrait){document.getElementsByTagName("canvas")[0].style.display="none",document.getElementById(this._settings.parent).appendChild(this._settings.orientationImage);var e=Math.min(window.innerWidth/this._settings.width,window.innerHeight/this._settings.height),i=this._settings.width*e,n=this._settings.height*e;i<this._settings.width&&(this._settings.orientationImage.style.width=i+"px"),n<this._settings.height&&(this._settings.orientationImage.style.height=n+"px")}this.updateCanvas()}},n.prototype._onUnsupportedBrowser=function(){if(LOGGING&&this._log.fatal("Unsupported Browser."),""!=this._settings.unsupportedBrowserImagePath){var t=new Image;t.id="unsupported",t.src=this._settings.unsupportedBrowserImagePath,document.getElementById(this._settings.parent).innerHTML="",document.getElementById(this._settings.parent).appendChild(t)}this.destroy()},n.prototype._onUnsupportedDevice=function(){if(LOGGING&&this._log.fatal("Unsupported Device."),""!=this._settings.unsupportedDeviceImagePath){var t=new Image;t.id="unsupported",t.src=this._settings.unsupportedDeviceImagePath,document.getElementById(this._settings.parent).innerHTML="",document.getElementById(this._settings.parent).appendChild(t)}this.destroy()},n.prototype.updateCanvas=function(){if(this._booted){t.EnvUtil.isMobile&&(t.EnvUtil.isiPhone||t.EnvUtil.isiPod)&&t.EnvUtil.isLandscape&&"6"==t.EnvUtil.browserVersion.charAt(0)&&(document.documentElement.scrollHeight<window.outerHeight/window.devicePixelRatio&&(document.documentElement.style.height=window.outerHeight/window.devicePixelRatio+"px"),setTimeout(function(){window.scrollTo(1,1)},0),navigator.userAgent.match(/Android|iPhone/gi)&&window.scrollTo(0,1));var e,i,n=Math.min((-1!=this._settings.displayWidth?this._settings.displayWidth:window.innerWidth)/this._settings.width,(-1!=this._settings.displayHeight?this._settings.displayHeight:window.innerHeight)/this._settings.height);switch(this._settings.scaleMode){case t.ScaleMode.EXACT_FIT:e=-1!=this._settings.displayWidth?this._settings.displayWidth:window.innerWidth,i=-1!=this._settings.displayHeight?this._settings.displayHeight:window.innerHeight,this.renderManager.renderCanvas.canvas.style.width=e+"px",this.renderManager.renderCanvas.canvasScale.x=this._settings.width/e,this.inputManager._canvasScale.x=this.renderManager.renderCanvas.canvasScale.x,this.renderManager.renderCanvas.canvas.style.height=i+"px",this.renderManager.renderCanvas.canvasScale.y=this._settings.height/i,this.inputManager._canvasScale.y=this.renderManager.renderCanvas.canvasScale.y;break;case t.ScaleMode.SHOW_ALL:e=this._settings.width*n,i=this._settings.height*n,t.EnvUtil.isMobile||-1!=this._settings.displayWidth||-1!=this._settings.displayHeight?(this.renderManager.renderCanvas.canvas.style.width=e+"px",this.renderManager.renderCanvas.canvasScale.x=this._settings.width/e,this.inputManager._canvasScale.x=this.renderManager.renderCanvas.canvasScale.x,this.renderManager.renderCanvas.canvas.style.height=i+"px",this.renderManager.renderCanvas.canvasScale.y=this._settings.height/i,this.inputManager._canvasScale.y=this.renderManager.renderCanvas.canvasScale.y):t.EnvUtil.isDesktop&&(e<this._settings.width&&(this.renderManager.renderCanvas.canvas.style.width=e+"px",this.renderManager.renderCanvas.canvasScale.x=this._settings.width/e,this.inputManager._canvasScale.x=this.renderManager.renderCanvas.canvasScale.x),i<this._settings.height&&(this.renderManager.renderCanvas.canvas.style.height=i+"px",this.renderManager.renderCanvas.canvasScale.y=this._settings.height/i,this.inputManager._canvasScale.y=this.renderManager.renderCanvas.canvasScale.y));break;case t.ScaleMode.SHOW_ALL_MAX:e=this._settings.width*n,i=this._settings.height*n,this.renderManager.renderCanvas.canvas.style.width=e+"px",this.renderManager.renderCanvas.canvasScale.x=this._settings.width/e,this.inputManager._canvasScale.x=this.renderManager.renderCanvas.canvasScale.x,this.renderManager.renderCanvas.canvas.style.height=i+"px",this.renderManager.renderCanvas.canvasScale.y=this._settings.height/i,this.inputManager._canvasScale.y=this.renderManager.renderCanvas.canvasScale.y}this.renderManager.renderCanvas.offset=t.DOMUtil.getOffset(this.renderManager.renderCanvas.canvas)}},n.prototype.destroy=function(){this.timeManager.stop(),this.bootSignal.removeAll(),this.initSignal.removeAll(),this.startupSignal.removeAll(),this.shutdownSignal.removeAll(),this.pauseSignal.removeAll(),this.resumeSignal.removeAll(),this.suspendSignal.removeAll(),e.prototype.destroy.call(this),this.bootSignal=null,this.initSignal=null,this.startupSignal=null,this.shutdownSignal=null,this.pauseSignal=null,this.resumeSignal=null,this.suspendSignal=null,this._settings=null},n}(t.Context);t.Game=e;var i=function(){function t(){}return t.CAPABILITY=-1,t.BASIC=1,t.LOW=2,t.MEDIUM=3,t.HIGH=4,t.EXTREME=5,t}();t.GamePerformance=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r){"undefined"==typeof r&&(r=i.NAME),e.call(this,r),this._game=n,this._strings=o?JSON.parse(JSON.stringify(o)):null,this.loadCompleteSignal=new t.Signal,this.loadFailedSignal=new t.Signal}return __extends(i,e),i.NAME="GameLoader",i.prototype._onCreate=function(){e.prototype._onCreate.call(this),this._game.settings.showLoader&&(this._createLoader(),this._progressBar&&(this._progressBar.scaleX=0))},i.prototype.loadResources=function(t){this._game.resourceManager.progressSignal.add(this._onProgressUpdate,this),this._game.resourceManager.failedSignal.add(this._onLoadingFailed,this),this._game.resourceManager.completeSignal.addOnce(this._onLoadingComplete,this);for(var e,i=0;i<t.length;i++)e=t[i],e.autoload&&(e.hasOwnProperty("options")?this._game.resourceManager.load(e.path,e.name,e.options):this._game.resourceManager.load(e.path,e.name));0==this._game.resourceManager.loadingCount&&this._onLoadingComplete()
},i.prototype._onProgressUpdate=function(t,e){this._progressBar&&(this._progressBar.scaleX=t/e)},i.prototype._onLoadingFailed=function(){this.loadFailedSignal.dispatch()},i.prototype._onLoadingComplete=function(){this._game.resourceManager.progressSignal.remove(this._onProgressUpdate,this),this._game.resourceManager.failedSignal.remove(this._onLoadingFailed,this),this._game.resourceManager.completeSignal.remove(this._onLoadingComplete,this),this.loadCompleteSignal.dispatch()},i.prototype._createLoader=function(){var e=this.create(t.RectGraphic,this._game.timeManager,this._game.renderManager,this._game.settings.width,this._game.settings.height,"#999999"),i=this.create(t.TextGraphic,this._game.timeManager,this._game.renderManager,{},"TitleText");e.layerIndex=t.EngineConstants.LAYERINDEX_GAMEUI,i.layerIndex=t.EngineConstants.LAYERINDEX_GAMEUI,i.zIndex=1,i.centerX=this._game.width/2,i.centerY=this._game.height/2-40;var n=this.create(t.RectGraphic,this._game.timeManager,this._game.renderManager,310,35,"#000000");n.layerIndex=t.EngineConstants.LAYERINDEX_GAMEUI,n.zIndex=1,n.centerX=this._game.width/2,n.centerY=this._game.height/2+40,this._progressBar=this.create(t.RectGraphic,this._game.timeManager,this._game.renderManager,300,25,"#FFFFFF"),this._progressBar.layerIndex=t.EngineConstants.LAYERINDEX_GAMEUI,this._progressBar.zIndex=2,this._progressBar.registrationX=0,this._progressBar.centerX=this._game.width/2,this._progressBar.centerY=this._game.height/2+40,this._progressBar.scaleX=0,this.localize()},i.prototype.localize=function(){if(this._strings)for(var e=this.getByType(t.TextGraphic),i=0;i<e.length;i++)for(var n=0;n<this._strings.length;n++)e[i].name==this._strings[n].name&&(e[i].text=this._strings[n].value,this._strings[n].style&&e[i].setStyle(this._strings[n].style))},i.prototype.destroy=function(){this.loadCompleteSignal.removeAll(),this.loadFailedSignal.removeAll(),e.prototype.destroy.call(this),this.loadCompleteSignal=null,this.loadFailedSignal=null,this._game=null,this._strings=null},i}(t.Group);t.GameLoader=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof n&&(n=!0),e.call(this,i),this._destroyOnExit=n,this.enteredSignal=new t.Signal,this.exitedSignal=new t.Signal}return __extends(i,e),i.prototype.enter=function(){LOGGING&&this._log.log("Entered"),this.active=!0,this.enteredSignal.dispatch()},i.prototype.exit=function(){this.active=!1,this.exitedSignal.dispatch(),LOGGING&&this._log.log("Exited"),this._destroyOnExit&&this.destroy()},i.prototype.destroy=function(){this._destroyOnExit=!1,this.active&&this.exit(),this.enteredSignal.removeAll(),this.exitedSignal.removeAll(),this.enteredSignal=null,this.exitedSignal=null,this.stateManager=null,e.prototype.destroy.call(this)},i}(t.Group);t.StateElement=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){"undefined"==typeof n&&(n=i.NAME),e.call(this,n),this.stateChangedSignal=new t.Signal}return __extends(i,e),i.NAME="StateManager",i.prototype.setState=function(e){for(var i=[],n=0;n<arguments.length-1;n++)i[n]=arguments[n+1];var o=this._state;if(null!=o&&o.exit(),e instanceof Function)switch(i.length){case 0:this._state=new e;break;case 1:this._state=new e(i[0]);break;case 2:this._state=new e(i[0],i[1]);break;case 3:this._state=new e(i[0],i[1],i[2]);break;case 4:this._state=new e(i[0],i[1],i[2],i[3]);break;case 5:this._state=new e(i[0],i[1],i[2],i[3],i[4]);break;case 6:this._state=new e(i[0],i[1],i[2],i[3],i[4],i[5]);break;case 7:this._state=new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6]);break;case 8:this._state=new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]);break;case 9:this._state=new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8]);break;case 10:this._state=new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9])}else{if(!(e instanceof t.StateElement))return void(LOGGING&&this._log.warn("Invalid object passed to setState"));this._state=e}this.context&&(this._state.context=this.context),this.group&&(this._state.group=this.group),this._state.stateManager=this,this._state._onCreate(),this.stateChangedSignal.dispatch(o,this._state),this._state.enter()},i}(t.Element);t.StateManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){"undefined"==typeof n&&(n=i.NAME),e.call(this,n),this._resources={},this._loadingResources={},this._loadingCount=0,this.resourcePath="",this.completeSignal=new t.Signal,this.loadedSignal=new t.Signal,this.failedSignal=new t.Signal,this.progressSignal=new t.Signal}return __extends(i,e),i.NAME="ResourceManager",Object.defineProperty(i.prototype,"loadingCount",{get:function(){return this._loadingCount},enumerable:!0,configurable:!0}),i.prototype.loadItems=function(t,e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null);for(var n=0;n<t.length;n++)this.load(t[n],e+n,i)},i.prototype.load=function(e,i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),LOGGING&&this._log.log("Load resource: "+e);var o,r;if(this._resources[e])LOGGING&&this._log.log("Resource already loaded: "+e),r=this._resources[e],this.loadedSignal.dispatch(r);else{if(this._loadingResources[this.resourcePath+e])return void(LOGGING&&this._log.log("Resource still loading: "+e));var s=e.substr(e.lastIndexOf(".")+1,4);switch(s){case"jpg":case"png":o=t.ImageResource;break;case"xml":o=t.XMLResource;break;case"css":o=t.CSSResource;break;case"json":o=t.JSONResource;break;case"js":o=t.JSResource;break;case"swf":o=t.SWFResource;break;case"mp3":case"wav":case"ogg":case"aac":o=t.SoundResource;break;case"woff":case"eot":case"ttf":o=t.FontResource}r=this.create(o,this,i,n),r.loadCompleteSignal.addOnce(this.onLoad,this),r.loadErrorSignal.addOnce(this.onLoadError,this),this._loadingResources[this.resourcePath+e]=r,this._loadingCount++,r.load(this.resourcePath+e)}},i.prototype.isLoaded=function(t){return null!=this._resources[t]},i.prototype.isLoading=function(t){return null!=this._loadingResources[this.resourcePath+t]},i.prototype.getResource=function(t){var e;return this.isLoaded(t)&&(e=this._resources[t]),e},i.prototype.unload=function(t,e){"undefined"==typeof e&&(e=!0),t&&(LOGGING&&this._log.log("Unload resource: "+(this.resourcePath+t.path)),e&&t.destroy(),this._resources[t.path]=null,delete this._resources[t.path])},i.prototype.onLoad=function(t){var e=-1==t.path.indexOf(this.resourcePath)?t.path:t.path.substring(t.path.indexOf(this.resourcePath)+this.resourcePath.length,t.path.length),i=0;for(var n in this._loadingResources)i++;if(t.loadCompleteSignal.remove(this.onLoad,this),t.loadErrorSignal.remove(this.onLoadError,this),t.path=e,this._resources[e]=t,this._loadingCount--,this.progressSignal.dispatch(i-this._loadingCount,i),0==this._loadingCount){for(var n in this._loadingResources)this._loadingResources[n]=null,delete this._loadingResources[n];this.completeSignal.dispatch(t)}this.loadedSignal.dispatch(t)},i.prototype.onLoadError=function(){this._loadingCount--,this.failedSignal.dispatch()},i.prototype.destroy=function(){var t,i;for(t in this._loadingResources)i=this._loadingResources[t],this.unload(i),this._loadingResources[t]=null,delete this._loadingResources[t];for(t in this._resources)i=this._resources[t],this.unload(i),this._resources[t]=null,delete this._resources[t];this.completeSignal.removeAll(),this.loadedSignal.removeAll(),this.progressSignal.removeAll(),this.failedSignal.removeAll(),this.completeSignal=null,this.loadedSignal=null,this.progressSignal=null,this.failedSignal=null,this._resources=null,this._loadingResources=null,e.prototype.destroy.call(this)},i}(t.Group);t.ResourceManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r){"undefined"==typeof r&&(r=i.NAME),e.call(this,r),this._timeManager=n,this._renderManager=o,this._camera=this._renderManager.camera,this._keyState=[],this._previousKeyState=[],this._keysJustPressed=[],this._keysJustReleased=[],this._inputObjects=[],this.keyDown=new t.Signal,this.keyUp=new t.Signal,this.inputOver=new t.Signal,this.inputOut=new t.Signal,this.inputDown=new t.Signal,this.inputUp=new t.Signal,this.inputMove=new t.Signal,this._inputPointers=[],this._activeInputPointers={},this._inputPosition=new t.Point;for(var s=0;s<i.NUM_POINTERS;s++)this._inputPointers[s]=this.create(t.InputPointer,this);this._preventPropagation=!0,this._initialized=!1,this._canvasScale=new t.Point(1,1),this._pt=new t.Point,this.initialize(o.renderCanvas.canvas)}return __extends(i,e),i.NAME="InputManager",i.NUM_POINTERS=11,Object.defineProperty(i.prototype,"inputX",{get:function(){return this._primaryInputPointer?this._primaryInputPointer.x:-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputY",{get:function(){return this._primaryInputPointer?this._primaryInputPointer.y:-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputPrevX",{get:function(){return this._primaryInputPointer?this._primaryInputPointer.prevX:-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputPrevY",{get:function(){return this._primaryInputPointer?this._primaryInputPointer.prevY:-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isInputDown",{get:function(){return this._primaryInputPointer?this._primaryInputPointer.isDown:!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputPosition",{get:function(){return this._inputPosition.x=this.inputX,this._inputPosition.y=this.inputY,this._inputPosition},enumerable:!0,configurable:!0}),i.prototype.initialize=function(t){this._initialized||(this._canvas=t,this._onMouseDownListener=this.onMouseDown.bind(this),this._onMouseMoveListener=this.onMouseMove.bind(this),this._onMouseUpListener=this.onMouseUp.bind(this),this._onTouchStartListener=this.onTouchStart.bind(this),this._onTouchMoveListener=this.onTouchMove.bind(this),this._onTouchEndListener=this.onTouchEnd.bind(this),this._onTouchCancelListener=this.onTouchEnd.bind(this),this._onKeyDownListener=this.onKeyDown.bind(this),this._onKeyUpListener=this.onKeyUp.bind(this),this._canvas.addEventListener("mousedown",this._onMouseDownListener,!1),this._canvas.addEventListener("mousemove",this._onMouseMoveListener,!1),this._canvas.addEventListener("mouseup",this._onMouseUpListener,!1),this._canvas.addEventListener("touchstart",this._onTouchStartListener,!1),this._canvas.addEventListener("touchmove",this._onTouchMoveListener,!1),this._canvas.addEventListener("touchend",this._onTouchEndListener,!1),this._canvas.addEventListener("touchcancel",this._onTouchEndListener,!1),this._canvas.addEventListener("MSPointerDown",this._onTouchStartListener,!1),this._canvas.addEventListener("MSPointerMove",this._onTouchMoveListener,!1),this._canvas.addEventListener("MSPointerUp",this._onTouchEndListener,!1),this._canvas.addEventListener("MSPointerCancel",this._onTouchEndListener,!1),window.addEventListener("keydown",this._onKeyDownListener,!1),window.addEventListener("keyup",this._onKeyUpListener,!1),this._timeManager.addTickedObject(this,10),this._initialized=!0)},i.prototype.onTick=function(){for(var t=0,e=this._keyState.length;e>t;t++)this._keysJustPressed[t]=this._keyState[t]&&!this._previousKeyState[t]?!0:!1,this._keysJustReleased[t]=!this._keyState[t]&&this._previousKeyState[t]?!0:!1,this._previousKeyState[t]=this._keyState[t];this._primaryInputPointer&&0!=this._primaryInputPointer.id&&(this._primaryInputPointer.isDown||this._primaryInputPointer.x!=this._primaryInputPointer.prevX||this._primaryInputPointer.y!=this._primaryInputPointer.prevY||(delete this._activeInputPointers[this._primaryInputPointer.id],this._inputPointers.push(this._primaryInputPointer)))},i.prototype.addInputObject=function(t){this._inputObjects.push(t)},i.prototype.removeInputObject=function(t){this._inputObjects.splice(this._inputObjects.indexOf(t),1)},i.prototype.wasKeyJustPressed=function(t){return this._keysJustPressed[t]},i.prototype.wasKeyJustReleased=function(t){return this._keysJustReleased[t]},i.prototype.isKeyDown=function(t){return this._keyState[t]},i.prototype.isAnyKeyDown=function(){for(var t=0,e=this._keyState.length-1;e>t;t++)if(this._keyState[t])return!0;return!1},i.prototype.getObjectsUnderPointer=function(t){return"undefined"==typeof t&&(t=-1),-1===t&&this._primaryInputPointer&&(t=this._primaryInputPointer.id),this._activeInputPointers[t].getObjectsUnderPointer()},i.prototype.onKeyDown=function(e){this.keyDown.dispatch(e.keyCode),this._keyState[e.keyCode]=!0,(e.keyCode==t.InputKey.SPACE||e.keyCode==t.InputKey.UP||e.keyCode==t.InputKey.DOWN||e.keyCode==t.InputKey.LEFT||e.keyCode==t.InputKey.RIGHT)&&this.preventDefault(e)},i.prototype.onKeyUp=function(e){this.keyUp.dispatch(e.keyCode),this._keyState[e.keyCode]=!1,(e.keyCode==t.InputKey.SPACE||e.keyCode==t.InputKey.UP||e.keyCode==t.InputKey.DOWN||e.keyCode==t.InputKey.LEFT||e.keyCode==t.InputKey.RIGHT)&&this.preventDefault(e)},i.prototype.onMouseDown=function(t){this._canvasOffset=this._renderManager.renderCanvas.offset,this.onInputDown((t.pageX-this._canvasOffset.x)*this._canvasScale.x,(t.pageY-this._canvasOffset.y)*this._canvasScale.y,t.button||0)},i.prototype.onMouseUp=function(t){this._canvasOffset=this._renderManager.renderCanvas.offset,this.onInputUp((t.pageX-this._canvasOffset.x)*this._canvasScale.x,(t.pageY-this._canvasOffset.y)*this._canvasScale.y,t.button||0)},i.prototype.onMouseMove=function(t){this._canvasOffset=this._renderManager.renderCanvas.offset,this.onInputMove((t.pageX-this._canvasOffset.x)*this._canvasScale.x,(t.pageY-this._canvasOffset.y)*this._canvasScale.y,t.button||0)},i.prototype.onTouchStart=function(t){this._changedTouches=t.changedTouches||[t],this._canvasOffset=this._renderManager.renderCanvas.offset;for(var e=0,i=this._changedTouches.length;i>e;e++)this.onInputDown((this._changedTouches[e].pageX-this._canvasOffset.x)*this._canvasScale.x,(this._changedTouches[e].pageY-this._canvasOffset.y)*this._canvasScale.y,this._changedTouches[e].identifier);this._preventPropagation&&this.preventDefault(t)},i.prototype.onTouchMove=function(t){this._changedTouches=t.changedTouches||[t],this._canvasOffset=this._renderManager.renderCanvas.offset;for(var e=0,i=this._changedTouches.length;i>e;e++)this.onInputMove((this._changedTouches[e].pageX-this._canvasOffset.x)*this._canvasScale.x,(this._changedTouches[e].pageY-this._canvasOffset.y)*this._canvasScale.y,this._changedTouches[e].identifier);this._preventPropagation&&this.preventDefault(t)},i.prototype.onTouchEnd=function(t){this._changedTouches=t.changedTouches||[t],this._canvasOffset=this._renderManager.renderCanvas.offset;for(var e=0,i=this._changedTouches.length;i>e;e++)this.onInputUp((this._changedTouches[e].pageX-this._canvasOffset.x)*this._canvasScale.x,(this._changedTouches[e].pageY-this._canvasOffset.y)*this._canvasScale.y,this._changedTouches[e].identifier);this._preventPropagation&&this.preventDefault(t)},i.prototype.onInputDown=function(t,e,n){"undefined"==typeof n&&(n=0),this._pt.x=t,this._pt.y=e;var o=this._activeInputPointers[n]?this._activeInputPointers[n]:this._inputPointers.pop();this._inputPointers.length==i.NUM_POINTERS-1&&(this._primaryInputPointer=o),o.start(this._pt.x,this._pt.y,n),this.inputDown.dispatch(this._pt.x,this._pt.y,n),this._activeInputPointers[n]=o},i.prototype.onInputUp=function(t,e,i){"undefined"==typeof i&&(i=0),this._pt.x=t,this._pt.y=e;var n=this._activeInputPointers[i];n.end(this._pt.x,this._pt.y,i),this.inputUp.dispatch(this._pt.x,this._pt.y,i),this._inputPointers.push(n),delete this._activeInputPointers[i]},i.prototype.onInputMove=function(t,e,n){"undefined"==typeof n&&(n=0),this._pt.x=t,this._pt.y=e;var o=this._activeInputPointers[n]?this._activeInputPointers[n]:this._inputPointers.pop();this._inputPointers.length==i.NUM_POINTERS-1&&(this._primaryInputPointer=o),o.move(this._pt.x,this._pt.y,n),this.inputMove.dispatch(this._pt.x,this._pt.y,n),this._activeInputPointers[n]=o},i.prototype.preventDefault=function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},i.prototype.destroy=function(){this._initialized&&(this._canvas.removeEventListener("mousedown",this._onMouseDownListener,!1),this._canvas.removeEventListener("mousemove",this._onMouseMoveListener,!1),this._canvas.removeEventListener("mouseup",this._onMouseUpListener,!1),this._canvas.removeEventListener("touchstart",this._onTouchStartListener,!1),this._canvas.removeEventListener("touchmove",this._onTouchMoveListener,!1),this._canvas.removeEventListener("touchend",this._onTouchEndListener,!1),this._canvas.removeEventListener("MSPointerDown",this._onTouchStartListener,!1),this._canvas.removeEventListener("MSPointerMove",this._onTouchMoveListener,!1),this._canvas.removeEventListener("MSPointerUp",this._onTouchEndListener,!1),window.removeEventListener("keydown",this._onKeyDownListener,!1),window.removeEventListener("keyup",this._onKeyUpListener,!1),this._timeManager.removeTickedObject(this)),this.keyDown.removeAll(),this.keyUp.removeAll(),this.inputOver.removeAll(),this.inputOut.removeAll(),this.inputDown.removeAll(),this.inputUp.removeAll(),this.inputMove.removeAll(),this._inputObjects.length=0,this._inputPointers.length=0,this._activeInputPointers=null,this._primaryInputPointer=null,this._inputPointers=null,this.keyDown=null,this.keyUp=null,this.inputOver=null,this.inputOut=null,this.inputDown=null,this.inputUp=null,this.inputMove=null,this._inputObjects=null,this._keyState=null,this._previousKeyState=null,this._keysJustPressed=null,this._keysJustReleased=null,this._canvasOffset=null,this._pt=null,this._timeManager=null,this._renderManager=null,this._camera=null,this._canvas=null,this._inputPosition=null,this._pointer=null,this._onMouseDownListener=null,this._onMouseMoveListener=null,this._onMouseUpListener=null,this._onTouchStartListener=null,this._onTouchMoveListener=null,this._onTouchEndListener=null,this._onTouchCancelListener=null,this._onKeyDownListener=null,this._onKeyUpListener=null,e.prototype.destroy.call(this)},i}(t.Group);t.InputManager=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=0),this._keyCode=t}return t.INVALID=0,t.BACKSPACE=8,t.TAB=9,t.ENTER=13,t.COMMAND=15,t.SHIFT=16,t.CONTROL=17,t.ALT=18,t.PAUSE=19,t.CAPS_LOCK=20,t.ESCAPE=27,t.SPACE=32,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.INSERT=45,t.DELETE=46,t.ZERO=48,t.ONE=49,t.TWO=50,t.THREE=51,t.FOUR=52,t.FIVE=53,t.SIX=54,t.SEVEN=55,t.EIGHT=56,t.NINE=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.NUM0=96,t.NUM1=97,t.NUM2=98,t.NUM3=99,t.NUM4=100,t.NUM5=101,t.NUM6=102,t.NUM7=103,t.NUM8=104,t.NUM9=105,t.MULTIPLY=106,t.ADD=107,t.NUMENTER=108,t.SUBTRACT=109,t.DECIMAL=110,t.DIVIDE=111,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.NUM_LOCK=144,t.SCROLL_LOCK=145,t.COLON=186,t.PLUS=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.BACKSLASH=191,t.TILDE=192,t.LEFT_BRACKET=219,t.SLASH=220,t.RIGHT_BRACKET=221,t.QUOTE=222,t.MOUSE_BUTTON=253,t.MOUSE_X=254,t.MOUSE_Y=255,t.MOUSE_WHEEL=256,t.MOUSE_HOVER=257,t.MOUSE_MOVE=258,t.TOUCH_TOUCH=300,t.TOUCH_X=301,t.TOUCH_Y=302,t.TOUCH_MOVE=303,t.INPUT_INPUT=500,t.INPUT_X=501,t.INPUT_Y=502,t.INPUT_MOVE=503,t.getKeyFromString=function(e){return String.fromCharCode(t[e])},t.getKeyFromCode=function(t){return String.fromCharCode(t)},Object.defineProperty(t.prototype,"keyCode",{get:function(){return this._keyCode},enumerable:!0,configurable:!0}),t}();t.InputKey=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(t,i){"undefined"==typeof i&&(i=n.NAME),e.call(this,i),this._inputManager=t,this._lastInputX=Number.NEGATIVE_INFINITY,this._lastInputY=Number.NEGATIVE_INFINITY,this._keyMap=[],this._bindings={},this.setInputManager(this._inputManager)}return __extends(n,e),n.NAME="InputMap",n.prototype.setInputManager=function(t){this._inputManager&&(this._inputManager.keyDown.remove(this.onKeyDown,this),this._inputManager.keyUp.remove(this.onKeyUp,this),this._inputManager.inputDown.remove(this.onInputDown,this),this._inputManager.inputUp.remove(this.onInputUp,this),this._inputManager.inputMove.remove(this.onInputMove,this)),this._inputManager=t,this._isRegistered=!1},n.prototype.getKeyCodeForAction=function(t){for(var e=0,i=this._keyMap.length;i>e;e++)if(this._keyMap[e]===t)return e},n.prototype.getKeyForAction=function(t){for(var e=0,i=this._keyMap.length;i>e;e++)if(this._keyMap[e]===t)return String.fromCharCode(e)},n.prototype.mapKeyToAction=function(e,i){this._keyMap[e]||(e==t.InputKey.MOUSE_BUTTON||e==t.InputKey.TOUCH_TOUCH||e==t.InputKey.INPUT_INPUT?(this._inputManager.inputDown.add(this.onInputDown,this),this._inputManager.inputUp.add(this.onInputUp,this)):e==t.InputKey.MOUSE_X&&!this._keyMap[t.InputKey.MOUSE_Y]||e==t.InputKey.MOUSE_Y&&!this._keyMap[t.InputKey.MOUSE_X]||e==t.InputKey.MOUSE_MOVE||e==t.InputKey.TOUCH_X&&!this._keyMap[t.InputKey.TOUCH_Y]||e==t.InputKey.TOUCH_Y&&!this._keyMap[t.InputKey.TOUCH_X]||e==t.InputKey.TOUCH_MOVE||e==t.InputKey.INPUT_X&&!this._keyMap[t.InputKey.INPUT_Y]||e==t.InputKey.INPUT_Y&&!this._keyMap[t.InputKey.INPUT_X]||e==t.InputKey.INPUT_MOVE?this._inputManager.inputMove.add(this.onInputMove,this):this._isRegistered||(this._inputManager.keyDown.add(this.onKeyDown,this),this._inputManager.keyUp.add(this.onKeyUp,this),this._isRegistered=!0)),this._keyMap[e]=i},n.prototype.mapActionToHandler=function(t,e){for(var n=[],o=0;o<arguments.length-2;o++)n[o]=arguments[o+2];this._bindings[t]||(this._bindings[t]=[]),this._bindings[t].push(new i(e,n))},n.prototype.mapKeyToHandler=function(t,e){for(var i=[],n=0;n<arguments.length-2;n++)i[n]=arguments[n+2];var o=t.toString();this.mapKeyToAction(t,o),this.mapActionToHandler.apply(this,[o,e].concat(i))},n.prototype.unmapKey=function(t,e){"undefined"==typeof e&&(e=!0),this._keyMap[t]&&(e&&this.unmapAction(this._keyMap[t]),this._keyMap[t]=null,delete this._keyMap[t])},n.prototype.unmapAction=function(t){if(this._bindings&&this._bindings[t]){for(var e=this._bindings[t],i=0;i<e.length;i++)e[i].handler=null,e[i].args=null;e=null,this._bindings[t]=null,delete this._bindings[t]}},n.prototype.unmapAll=function(){for(var t in this._bindings)this.unmapAction(t)},n.prototype.onKeyDown=function(t){this._inputManager.isKeyDown(t)||this.onInputEvent(t,1)},n.prototype.onKeyUp=function(t){this._inputManager.isKeyDown(t)&&this.onInputEvent(t,0)},n.prototype.onInputDown=function(e,i,n){"undefined"==typeof n&&(n=0),this.onInputEvent(t.InputKey.MOUSE_BUTTON,1,n),this.onInputEvent(t.InputKey.TOUCH_TOUCH,1,n),this.onInputEvent(t.InputKey.INPUT_INPUT,1,n)},n.prototype.onInputUp=function(e,i,n){"undefined"==typeof n&&(n=0),this.onInputEvent(t.InputKey.MOUSE_BUTTON,0,n),this.onInputEvent(t.InputKey.TOUCH_TOUCH,0,n),this.onInputEvent(t.InputKey.INPUT_INPUT,0,n)},n.prototype.onInputMove=function(e,i,n){"undefined"==typeof n&&(n=0),this.onInputEvent(t.InputKey.MOUSE_X,e,n),this.onInputEvent(t.InputKey.MOUSE_Y,i,n),this.onInputEvent(t.InputKey.TOUCH_X,e,n),this.onInputEvent(t.InputKey.TOUCH_Y,i,n),this.onInputEvent(t.InputKey.INPUT_X,e,n),this.onInputEvent(t.InputKey.INPUT_Y,i,n),this.onInputEvent(t.InputKey.MOUSE_MOVE,e,i,n),this.onInputEvent(t.InputKey.TOUCH_MOVE,e,i,n),this.onInputEvent(t.InputKey.INPUT_MOVE,e,i,n)},n.prototype.onInputEvent=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];var n=this._keyMap[t];if(n&&this._bindings[n])for(var o=this._bindings[n],r=0;r<o.length;r++)o[r].handler.apply(null,o[r].args?e.concat(o[r].args):e)},n.prototype.destroy=function(){this._inputManager&&(this._inputManager.inputDown.remove(this.onInputDown,this),this._inputManager.inputUp.remove(this.onInputUp,this),this._inputManager.inputMove.remove(this.onInputMove,this),this._inputManager.keyDown.remove(this.onKeyDown,this),this._inputManager.keyUp.remove(this.onKeyUp,this));for(var t=0;t<this._keyMap.length-1;t++)this._keyMap[t]=null,delete this._keyMap[t];var i;for(i in this._bindings){for(var n=this._bindings[i],t=0;t<n.length;t++)n[t].handler=null,n[t].args=null;n.length=0,n=null,this._bindings[i]=null,delete this._bindings[i]}this._keyMap=null,this._bindings=null,this._inputManager=null,e.prototype.destroy.call(this)},n}(t.Element);t.InputMap=e;var i=function(){function t(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];this.handler=t,this.args=e}return t}();t.InputData=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i){"undefined"==typeof i&&(i=n.NAME),e.call(this,i),this._pools=new t.Dictionary,this._instances=new t.Dictionary}return __extends(n,e),n.NAME="ObjectPool",n.DEFAULT_ALLOCATION=32,n.prototype.allocate=function(t,e,o,r,s,a){"undefined"==typeof o&&(o=n.DEFAULT_ALLOCATION),"undefined"==typeof s&&(s=!0);var h;a?(this._pools.get(a)||this._pools.put(a,new i(r,s)),h=this._pools.get(a)):(this._pools.get(t)||this._pools.put(t,new i(r,s)),h=this._pools.get(t)),h.allocate(o,t,e)},n.prototype.insert=function(t,e){var n;this._pools.get(t)||this._pools.put(t,new i),n=this._pools.get(t),n.insert(e)},n.prototype.getObject=function(t,e,i){var n=this._pools.get(t),o=n.getObject(),r=this._instances.get(t);return r||(this._instances.put(t,[]),r=this._instances.get(t)),r.push(o),e&&o[e].apply(o,i),o},n.prototype.hasObject=function(t){return null!=this._pools.get(t)},n.prototype.poolLength=function(t){return this._pools.get(t).size||0},n.prototype.poolUsedLength=function(t){return this._pools.get(t).used||-1},n.prototype.poolUnusedLength=function(t){return this._pools.get(t).unused||-1},n.prototype.releaseObject=function(t,e){var i=this._pools.get(e)||this._pools.get(t.name),n=this._instances.get(e)||this._instances.get(t.name);i.releaseObject(n.splice(n.indexOf(t),1)[0])},n.prototype.getInstances=function(t){var e=this._instances.get(t);return e?e.concat():[]},n.prototype.getAllInstances=function(){var t=[];for(var e in this._instances)t=t.concat(this._instances.get(e).concat());return t},n.prototype.getAll=function(){var t=[];for(var e in this._pools)t=t.concat(this._pools.get(e).getContents().concat());return t},n.prototype.purge=function(t){var e=this._pools.get(t),i=this._instances.get(t);if(i&&i.length>0)for(var n=0;n<i.length;n++)e.releaseObject(i[n]);var o=e.getContents();return e.destroy(),this._pools.remove(t),this._instances.remove(t),o},n.prototype.destroy=function(){this._pools.clear(),this._instances.clear(),this._pools=null,this._instances=null,e.prototype.destroy.call(this)},n}(t.Element);t.ObjectPool=e;var i=function(t){function e(e,i){"undefined"==typeof i&&(i=!1),this._parent=e,this._isDynamic=i,this._initialSize=0,this._currentSize=0,this._used=0,t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this._currentSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"used",{get:function(){return this._used},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unused",{get:function(){return this._currentSize-this._used},enumerable:!0,configurable:!0}),e.prototype.allocate=function(t,e,i){this.releasePool(),this._allocateFactory=new o(e,i,this._parent),this._initialSize=this._currentSize=t,this._head=this._tail=new n,this._head.data=this._allocateFactory.create();for(var r,s=1;s<this._initialSize;s++)r=new n,r.data=this._allocateFactory.create(),r.next=this._head,this._head=r;this._emptyNode=this._allocNode=this._head,this._tail.next=this._head,LOGGING&&this._log.trace("Allocated "+t+" objects")},e.prototype.insert=function(t){var e,i;if(0===this._currentSize){for(this.releasePool(),this._initialSize=this._currentSize=t.length,this._head=this._tail=new n,this._head.data=t[0],e=1;e<this._initialSize;e++)i=new n,i.data=t[e],i.next=this._head,this._head=i;this._emptyNode=this._allocNode=this._head,this._tail.next=this._head}else{this._currentSize+=t.length;var o=(this._tail,this._tail);for(e=0;e<t.length;e++)i=new n,i.data=t[e],o.next=i,o=i;this._tail=o,this._tail.next=this._emptyNode=this._head,this._allocNode=this._head}LOGGING&&this._log.trace("Inserted "+this._initialSize+" objects")},e.prototype.getObject=function(){var t;if(this._used===this._currentSize)if(this._isDynamic){this._currentSize+=this._initialSize;for(var e,i=this._tail,o=this._tail,r=0;r<this._initialSize;r++)e=new n,e.data=this._allocateFactory.create(),o.next=e,o=e;this._tail=o,this._tail.next=this._emptyNode=this._head,this._allocNode=i.next,t=this.getObject()}else LOGGING&&this._log.error("Pool empty");else t=this._allocNode.data,this._allocNode.data=null,this._allocNode=this._allocNode.next,this._used++;return t},e.prototype.initializeObjects=function(t,e){for(var i=this._head;i&&(i.data[t].apply(i.data,e),i!==this._tail);)i=i.next},e.prototype.releaseObject=function(t){this.used>0&&(this._used--,this._emptyNode.data=t,this._emptyNode=this._emptyNode.next)},e.prototype.getContents=function(){for(var t=[],e=this._head;e&&(t.push(e.data),e!==this._tail);)e=e.next;return t},e.prototype.purge=function(){var t,e;if(0===this._used){if(this._currentSize>this._initialSize){for(t=0,e=this._head;++t<this._initialSize;)e=e.next;this._tail=e,this._allocNode=this._emptyNode=this._head,this._currentSize=this._initialSize}}else{var i=[];for(e=this._head;e&&(e.data||(i[t++]=e),e!==this._tail);)e=e.next;for(this._currentSize=this._used=i.length,this._head=this._tail=i[0],t=1;t<this._currentSize;t++)e=i[t],e.next=this._head,this._head=e;if(this._emptyNode=this._allocNode=this._head,this._tail.next=this._head,this._used<this._initialSize){this._currentSize=this._initialSize;var o=this._tail,r=this._tail,s=this._initialSize-this._used;for(t=0;s>t;t++)e=new n,e.data=this._allocateFactory.create(),r.next=e,r=e;this._tail=r,this._tail.next=this._emptyNode=this._head,this._allocNode=o.next}}},e.prototype.releasePool=function(){for(var t,e=this._head;e;)t=e.next,e.next=null,e.data=null,e=t;this._head=this._tail=this._emptyNode=this._allocNode=t=null},e.prototype.destroy=function(){this.releasePool(),this._allocateFactory&&this._allocateFactory.destroy(),this._allocateFactory=null,this._parent=null,t.prototype.destroy.call(this)},e}(t.AbstractBase);t.PoolType=i;var n=function(){function t(){}return t}();t.PoolNode=n;var o=function(){function t(t,e,i){this._parent=i,this._class=t,this._args=e}return t.prototype.create=function(){if(this._parent){var t;return this._args?(t=this._args.concat(),t.unshift(this._class)):t=[this._class],this._parent.create.apply(this._parent,t)}if(!(this._args&&this._args.length>0))return new this._class;switch(this._args.length){case 1:return new this._class(this._args[0]);case 2:return new this._class(this._args[0],this._args[1]);case 3:return new this._class(this._args[0],this._args[1],this._args[2]);case 4:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3]);case 5:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4]);case 6:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4],this._args[5]);case 7:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4],this._args[5],this._args[6]);case 8:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4],this._args[5],this._args[6],this._args[7]);case 9:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4],this._args[5],this._args[6],this._args[7],this._args[8]);case 10:return new this._class(this._args[0],this._args[1],this._args[2],this._args[3],this._args[4],this._args[5],this._args[6],this._args[7],this._args[8],this._args[9])}},t.prototype.destroy=function(){this._args.length=0,this._parent=null,this._class=null,this._args=null,this.destroyed=!0},t}();t.AllocateFactory=o}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.FIXED=0,t.SHOW_ALL=1,t.SHOW_ALL_MAX=2,t.EXACT_FIT=3,t
}();t.ScaleMode=e;var i=function(){function i(t,e){this.destroyed=!1,this._game=t,this._setDefaults(),e&&this.setParams(e)}return i.DEFAULT_WIDTH=750,i.DEFAULT_HEIGHT=500,i.DEFAULT_BGCOLOR="#000000",i.DEFAULT_FILEFORMAT="json",i.DEFAULT_AUDIOFORMAT="auto",i.DEFAULT_TICKRATE=t.TimeManager.DEFAULT_TICKRATE,i.DEFAULT_GRIDSIZE=t.SpatialManager.DEFAULT_GRIDSIZE,i.DEFAULT_SCALEMODE=e.SHOW_ALL,i.DEFAULT_PERFORMANCE=2,i.DEFAULT_BROWSERSUPPORT=[{type:"MSIE",minVersion:9},{type:"Chrome",minVersion:29},{type:"Firefox",minVersion:23},{type:"Safari",minVersion:6}],i.DEFAULT_STATSALPHA=.8,i.DEFAULT_STATSTYPE=t.Stats.MINIMAL,i.DEFAULT_STATSPOSITION=9,i.prototype._setDefaults=function(){this.x=0,this.y=0,this.width=i.DEFAULT_WIDTH,this.height=i.DEFAULT_HEIGHT,this.bgColor=i.DEFAULT_BGCOLOR,this.tickRate=i.DEFAULT_TICKRATE,this.spatialGridSize=i.DEFAULT_GRIDSIZE,this.displayWidth=-1,this.displayHeight=-1,this.volume=100,this.mute=!1,this.autoInit=!0,this.autoStartup=!0,this.autoShutdown=!0,this.autoDestroy=!1,this.gameLoader=t.GameLoader,this.showLoader=!0,this.scaleMode=i.DEFAULT_SCALEMODE,this.browserSupport=i.DEFAULT_BROWSERSUPPORT,this.debug=!1,this.logLevel=t.Log.ALL,this.logFilters=[],this.major=0,this.minor=0,this.build=1,this.parent="",this.basePath="",this.resourcePath="",this.configPath="",this.stringsPath="",this.unsupportedOrientationImagePath="",this.unsupportedCookiesImagePath="",this.unsupportedBrowserImagePath="",this.statsAlpha=i.DEFAULT_STATSALPHA,this.statsPosition=i.DEFAULT_STATSPOSITION,this.statsType=i.DEFAULT_STATSTYPE,this.fileFormat=i.DEFAULT_FILEFORMAT,this.audioFormat=i.DEFAULT_AUDIOFORMAT,this.minPerformance=i.DEFAULT_PERFORMANCE,this.gamePerformance=-1},i.prototype.setParams=function(t){for(var e in t)this[e]=t[e]},i.prototype.getSceneManager=function(){return this._sceneManager?this._sceneManager:this._sceneManager=this._game.create(t.StateManager)},i.prototype.getResourceManager=function(){return this._resourceManager?this._resourceManager:this._resourceManager=this._game.create(t.ResourceManager)},i.prototype.getSoundManager=function(){return this._soundManager?this._soundManager:this._soundManager=this._game.create(t.SoundManager,this.getTimeManager(),this.audioFormat)},i.prototype.getInputManager=function(){return this._inputManager?this._inputManager:this._inputManager=this._game.create(t.InputManager,this.getTimeManager(),this.getRenderManager())},i.prototype.getInputMap=function(){return this._inputMap?this._inputMap:this._inputMap=this._game.create(t.InputMap,this.getInputManager())},i.prototype.getTimeManager=function(){return this._timeManager?this._timeManager:this._timeManager=this._game.create(t.TimeManager,this.tickRate)},i.prototype.getTypeManager=function(){return this._typeManager?this._typeManager:this._typeManager=this._game.create(t.BitMaskManager)},i.prototype.getSpatialManager=function(){return this._spatialManager?this._spatialManager:this._spatialManager=this._game.create(t.SpatialManager,this.getTimeManager(),this.getTypeManager(),this.spatialGridSize)},i.prototype.getRenderManager=function(){return this._renderManager?this._renderManager:this._renderManager=this._game.create(t.RenderManager,this.getTimeManager(),new t.Rectangle(this.x,this.y,this.width,this.height),this.getCanvas())},i.prototype.getCanvas=function(){return this._renderCanvas?this._renderCanvas:this._renderCanvas=this._game.create(t.RenderCanvas,this.parent,this.width,this.height)},i.prototype.getObjectPool=function(){return this._objectPool?this._objectPool:this._objectPool=this._game.create(t.ObjectPool)},i.prototype.getSharedData=function(){return this._sharedData?this._sharedData:this._sharedData=this._game.create(t.SharedData)},i.prototype.destroy=function(){this._game=null,this._sceneManager=null,this._soundManager=null,this._resourceManager=null,this._inputManager=null,this._inputMap=null,this._timeManager=null,this._spatialManager=null,this._renderManager=null,this._renderCanvas=null,this._sharedData=null,this._objectPool=null,this.destroyed=!0},i}();t.GameSettings=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r){"undefined"==typeof r&&(r=i.NAME),e.call(this,t,r),this._renderManager=n,this._image=o,this._timeManager&&this._renderManager&&this._createRenderComponent()}return __extends(i,e),i.NAME="ImageGraphic",Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._renderComponent.tint},set:function(t){this._renderComponent.tint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._renderComponent.mask},set:function(t){this._renderComponent.mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._renderComponent.view},set:function(t){this._renderComponent.view=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._renderComponent.compositeOperation},set:function(t){this._renderComponent.compositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._renderComponent.x},set:function(t){this._renderComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._renderComponent.y},set:function(t){this._renderComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._renderComponent.rotation},set:function(t){this._renderComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._renderComponent.centerX},set:function(t){this._renderComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._renderComponent.centerY},set:function(t){this._renderComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._renderComponent.top},set:function(t){this._renderComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._renderComponent.left},set:function(t){this._renderComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._renderComponent.right},set:function(t){this._renderComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._renderComponent.bottom},set:function(t){this._renderComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return this._renderComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return this._renderComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._renderComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._renderComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._renderComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_worldTransform",{get:function(){return this._renderComponent._worldTransform},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){this._renderComponent=this.create(t.RenderComponent,this._timeManager,this._renderManager,this._image),this.addComponent(this._renderComponent,t.EngineConstants.RENDER)},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},i.prototype.stopBlink=function(){this._renderComponent.stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},i.prototype.stopShake=function(){this._renderComponent.stopShake()},i.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},i.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},i.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._image=null,this._renderComponent=null,this._renderManager=null},i}(t.GameEntity);t.ImageGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r){"undefined"==typeof r&&(r=i.NAME),e.call(this,t,n,null,r),this._animationInfo={},this._timeManager&&this._renderManager&&this._createAnimationComponent(),o&&this.addSpriteSheet(o,!0)}return __extends(i,e),i.NAME="AnimatedGraphic",Object.defineProperty(i.prototype,"currentAnimation",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAnimating",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.isAnimating},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"repeatCount",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.repeatCount},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.repeatCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.duration},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.frameIndex},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.frameIndex=t},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){this._spriteSheetRenderComponent=this.create(t.SpriteSheetRenderComponent,this._timeManager,this._renderManager),this._renderComponent=this._spriteSheetRenderComponent,this.addComponent(this._spriteSheetRenderComponent,t.EngineConstants.RENDER)},i.prototype._createAnimationComponent=function(){this._spriteSheetAnimationComponent=this.create(t.SpriteSheetAnimationComponent,this._timeManager,this._spriteSheetRenderComponent),this.addComponent(this._spriteSheetAnimationComponent,t.EngineConstants.ANIMATION)},i.prototype.addSpriteSheet=function(t,e){return"undefined"==typeof e&&(e=!1),this._spriteSheetRenderComponent.addSpriteSheet(t,e)},i.prototype.getSpriteSheet=function(t){return this._spriteSheetRenderComponent.getSpriteSheet(t)},i.prototype.removeSpriteSheet=function(t){this._spriteSheetRenderComponent.removeSpriteSheet(t)},i.prototype.addAnimation=function(e,i,n,o,r){"undefined"==typeof o&&(o=1e3),"undefined"==typeof r&&(r=t.SpriteSheetAnimation.PLAY_ONCE),this._animationInfo[e]=i;var s,a=this.getSpriteSheet(i);a&&(s=a.getFrames(n)),this._spriteSheetAnimationComponent.addAnimation(e,s,o,r)},i.prototype.getAnimation=function(t){return this._spriteSheetAnimationComponent.getAnimation(t)},i.prototype.removeAnimation=function(t){this._spriteSheetAnimationComponent.removeAnimation(t)},i.prototype.setFrame=function(t){this._spriteSheetRenderComponent.setFrame(t)},i.prototype.play=function(e,i,n,o,r){"undefined"==typeof e&&(e=t.SpriteSheetAnimation.NAME),"undefined"==typeof i&&(i=Number.MIN_VALUE),"undefined"==typeof n&&(n=0);var s=this._animationInfo[e];s&&this._spriteSheetRenderComponent.setSpriteSheet(s),n==t.SpriteSheetAnimation.FRAME_CURRENT&&this.currentAnimation&&(n=this.currentAnimation.frameIndex),n==t.SpriteSheetAnimation.FRAME_RANDOM&&(n=t.Random.integer(1,this._spriteSheetAnimationComponent.getAnimation(e).totalFrames-1)),this._spriteSheetAnimationComponent.play(e,i,n,o,r),this._offset=this._spriteSheetAnimationComponent.currentAnimation.frames[0].offset,this._spriteSheetRenderComponent.width=this._offset.width,this._spriteSheetRenderComponent.height=this._offset.height,this._spriteSheetRenderComponent.registrationX=this._offset.width/2,this._spriteSheetRenderComponent.registrationY=this._offset.height/2},i.prototype.pause=function(){this._spriteSheetAnimationComponent.pause()},i.prototype.suspend=function(){this._spriteSheetAnimationComponent.suspend()},i.prototype.resume=function(){this._spriteSheetAnimationComponent.resume()},i.prototype.restart=function(){this._spriteSheetAnimationComponent.restart()},i.prototype.stop=function(){this._spriteSheetAnimationComponent.stop()},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._animationInfo)this._animationInfo[t]=null,delete this._animationInfo[t];this._spriteSheetRenderComponent=null,this._spriteSheetAnimationComponent=null,this._animationInfo=null,this._offset=null},i}(t.ImageGraphic);t.AnimatedGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a,h,l){"undefined"==typeof s&&(s=i.NAME),"undefined"==typeof a&&(a=!0),"undefined"==typeof h&&(h=!0),"undefined"==typeof l&&(l=!0),e.call(this,n,s),this._renderManager=o,this._element=t.ObjectUtil.isString(r)?document.getElementById(r):r,this._timeManager&&this._renderManager&&this._createRenderComponent(a,h,l)}return __extends(i,e),i.NAME="HTMLGraphic",Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"style",{get:function(){return this._renderComponent.style},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"absolutePositioning",{get:function(){return this._renderComponent.absolutePositioning},set:function(t){this._renderComponent.absolutePositioning=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._renderComponent.view},set:function(t){this._renderComponent.view=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._renderComponent.x},set:function(t){this._renderComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._renderComponent.y},set:function(t){this._renderComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._renderComponent.rotation},set:function(t){this._renderComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._renderComponent.centerX},set:function(t){this._renderComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._renderComponent.centerY},set:function(t){this._renderComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._renderComponent.top},set:function(t){this._renderComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._renderComponent.left},set:function(t){this._renderComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._renderComponent.right},set:function(t){this._renderComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._renderComponent.bottom},set:function(t){this._renderComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return this._renderComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return this._renderComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._renderComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._renderComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._renderComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(e,i,n){"undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1),this._renderComponent=n?this.create(t.SimpleDOMRenderComponent,this._timeManager,this._renderManager,this._element,e,i):this.create(t.DOMRenderComponent,this._timeManager,this._renderManager,this._element,e,i),this.addComponent(this._renderComponent,t.EngineConstants.RENDER)},i.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},i.prototype.stopBlink=function(){this._renderComponent.stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},i.prototype.stopShake=function(){this._renderComponent.stopShake()},i.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},i.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._element=null,this._renderComponent=null,this._renderManager=null},i}(t.GameEntity);t.HTMLGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s="rgba(255,255,255,1)"),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,r,a),this._color=s,this._dirty=!0,this._stroke=!1,this.enableOnTick()}return __extends(e,t),e.NAME="ShapeGraphic",Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokeStyle",{set:function(t){this._renderContext.strokeStyle=t,this._stroke=!0,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{set:function(t){this._renderContext.lineWidth=t,this._stroke=!0,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype.onTick=function(){this._dirty&&this._draw()},e.prototype._draw=function(){this._stroke&&this.stroke(),this._dirty=!1},e}(t.CanvasGraphic);t.ShapeGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r="rgba(255,255,255,1)"),"undefined"==typeof s&&(s=!1),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,o,r,a),this._useGradient=s}return __extends(e,t),e.NAME="DotGraphic",Object.defineProperty(e.prototype,"radius",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t,this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useGradient",{get:function(){return this._useGradient},set:function(t){this._useGradient=t,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype._draw=function(){if(this.clear(),this._useGradient){var e=document.createElement("div");e.style.color=this.color;var i=e.style.color.split(","),n=this._renderContext.createRadialGradient(this.radius/2,this.radius/2,0,this.radius/2,this.radius/2,this.radius/2);n.addColorStop(0,this.color),n.addColorStop(1,"rgba("+i[0].replace(/[^\d.]/g,"")+","+i[1].replace(/[^\d.]/g,"")+","+i[2].replace(/[^\d.]/g,"")+",0)"),this.fillStyle=n}else this.fillStyle=this.color;this.beginPath(),this.moveTo(this.radius/2,this.radius/2),this.arc(this.radius/2,this.radius/2,this.radius/2,0,2*Math.PI),this.closePath(),this.fill(),t.prototype._draw.call(this)},e}(t.ShapeGraphic);t.DotGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s="rgba(255,255,255,1)"),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,r,s,a)}return __extends(e,t),e.NAME="RectGraphic",e.prototype._draw=function(){this.fillStyle=this.color,this.beginPath(),this.rect(0,0,this._renderComponent._width,this._renderComponent._height),this.closePath(),this.fill(),t.prototype._draw.call(this)},e}(t.ShapeGraphic);t.RectGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r="rgba(255,255,255,1)"),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,o,r,a),this._useCircle=s}return __extends(e,t),e.NAME="SparkleGraphic",Object.defineProperty(e.prototype,"radius",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t,this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCircle",{get:function(){return this._useCircle},set:function(t){this._useCircle=t,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype._draw=function(){if(this.beginPath(),this.strokeStyle=this.color,this.moveTo(this.radius/2,0),this.lineTo(this.radius/2,this.radius),this.moveTo(0,this.radius/2),this.lineTo(this.radius,this.radius/2),this.closePath(),this.lineWidth=1,this.stroke(),this.useCircle){var e=this.createRadialGradient(this.radius/2,this.radius/2,1,this.radius/2,this.radius/2,this.radius/2);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(.4,"rgba(255,255,255,.6)"),e.addColorStop(1,"rgba(255,255,255,0)"),this.fillStyle=e,this.arc(this.radius/2,this.radius/2,this.radius/4,0,2*Math.PI),this.fill()}t.prototype._draw.call(this)},e}(t.ShapeGraphic);t.SparkleGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a,h){"undefined"==typeof o&&(o=5),"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s=40),"undefined"==typeof a&&(a="rgba(255,255,255,1)"),"undefined"==typeof h&&(h=e.NAME),t.call(this,i,n,r,r,a,h),this._numPoints=o,this._outerRadius=r,this._innerRadius=s}return __extends(e,t),e.NAME="StarGraphic",Object.defineProperty(e.prototype,"numPoints",{get:function(){return this._numPoints},set:function(t){this._numPoints=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this._outerRadius},set:function(t){this._outerRadius=t,this._renderComponent.width=t,this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this._innerRadius},set:function(t){this._innerRadius=t,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype._draw=function(){var e,i,n=Math.PI/2*3,o=Math.PI/this._numPoints,r=this._outerRadius/2,s=this._innerRadius/2;this.fillStyle=this.color,this.beginPath(),this.moveTo(this.halfWidth,this.halfHeight-r);for(var a=0;a<this._numPoints;a++)e=this.halfWidth+Math.cos(n)*r,i=this.halfHeight+Math.sin(n)*r,this.lineTo(e,i),n+=o,e=this.halfWidth+Math.cos(n)*s,i=this.halfHeight+Math.sin(n)*s,this.lineTo(e,i),n+=o;this.lineTo(this.halfWidth,this.halfHeight-r),this.closePath(),this.fill(),t.prototype._draw.call(this)},e}(t.ShapeGraphic);t.StarGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof o&&(o=100),"undefined"==typeof r&&(r=85),"undefined"==typeof s&&(s="rgba(255,255,255,1)"),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,r,s,a)}return __extends(e,t),e.NAME="TriangleGraphic",e.prototype._draw=function(){this.fillStyle=this.color,this.beginPath(),this.moveTo(this.width/2,0),this.lineTo(this.width,this.height),this.lineTo(0,this.height),this.closePath(),this.fill(),t.prototype._draw.call(this)},e}(t.ShapeGraphic);t.TriangleGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s){"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=e.NAME),t.call(this,i,n,o,s),this.setFrame(r)}return __extends(e,t),e.NAME="SingleFrameGraphic",e.prototype.setFrame=function(t){this._spriteSheetRenderComponent.setFrame(t)},e}(t.AnimatedGraphic);t.SingleFrameGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof i&&(i=!0),t.call(this,e,i),this._components={}}return __extends(e,t),e.prototype.addComponent=function(t,e){return t.owner||this._components[e]?void(LOGGING&&this._log.warn(e+" is already registered with "+t.owner.name)):(this._components[e]=t,t.register(this,e),void this._resetComponents())},e.prototype.removeComponent=function(t){return t&&t.owner==this&&this._components[t.name]?(this._components[t.name]=null,delete this._components[t.name],t.unregister(),void this._resetComponents()):void(LOGGING&&this._log.warn(t.name+" is not registered with this entity"))},e.prototype.removeComponentByName=function(t){var e=this.getComponent(t);return e&&e.owner==this&&this._components[e.name]?(this._components[e.name]=null,delete this._components[e.name],e.unregister(),void this._resetComponents()):void(LOGGING&&this._log.warn(e.name+" is not registered with this entity"))},e.prototype.getComponent=function(t){return this._components[t]},e.prototype.getComponentByType=function(t){var e;for(var i in this._components)if(e=this._components[i],e instanceof t)return e;return null},e.prototype.getComponentsByType=function(t){var e,i=[];for(var n in this._components)e=this._components[n],e instanceof t&&i.push(e);return i},e.prototype.getComponents=function(){var t=[];for(var e in this._components)t.push(this._components[e]);return t},e.prototype._registerComponents=function(){var t;for(var e in this._components)t=this._components[e],t.isRegistered||t.register(this,t.name);
this._resetComponents()},e.prototype._resetComponents=function(){var t;for(var e in this._components)t=this._components[e],t.reset()},e.prototype.destroy=function(){var e;for(var i in this._components)e=this._components[i],e&&!e.destroyed&&e.destroy(),this._components[i]=null,delete this._components[i];this._components=null,t.prototype.destroy.call(this)},e}(t.StateElement);t.StateEntity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof o&&(o=i.NAME),"undefined"==typeof s&&(s=!0),e.call(this,o,s),this._game=n,this._config=r?JSON.parse(JSON.stringify(r)):null,this.pauseSignal=new t.Signal,this.suspendSignal=new t.Signal,this.resumeSignal=new t.Signal,this._resetRenderManager=!0,this._resetSpatialManager=!0,this.enteredSignal.add(this._onEnterScene,this),this.exitedSignal.add(this._onExitScene,this)}return __extends(i,e),i.NAME="GameScene",Object.defineProperty(i.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strings",{get:function(){return this._strings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalConfig",{get:function(){return this._game.config},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalStrings",{get:function(){return this._game.strings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeManager",{get:function(){return this._timeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalTimeManager",{get:function(){return this._game.timeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sceneManager",{get:function(){return this._game.sceneManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"resourceManager",{get:function(){return this._game.resourceManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soundManager",{get:function(){return this._game.soundManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"objectPool",{get:function(){return this._game.objectPool},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sharedData",{get:function(){return this._game.sharedData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"typeManager",{get:function(){return this._game.typeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputManager",{get:function(){return this._game.inputManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputMap",{get:function(){return this._game.inputMap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spatialManager",{get:function(){return this._game.spatialManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderManager",{get:function(){return this._game.renderManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"camera",{get:function(){return this._game.renderManager.camera},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenCenterX",{get:function(){return this._game.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenCenterY",{get:function(){return this._game.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenWidth",{get:function(){return this._game.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenHeight",{get:function(){return this._game.height},enumerable:!0,configurable:!0}),i.prototype._onCreate=function(){e.prototype._onCreate.call(this),this._timeManager=this.globalTimeManager.getTimeManager(this.name+t.TimeManager.NAME,-1,this._tickRate)},i.prototype._onEnterScene=function(){var t=this;self.focus(),this.inputMap.mapActionToHandler("pause",function(e){return t.pause(e)}),this._timeManager.addTickedObject(this,0),this._timeManager.start(),LOGGING&&this._log.mark(this.name+" Entered")},i.prototype._onExitScene=function(){this.inputMap.unmapAction("pause"),this._timeManager.removeTickedObject(this),this._timeManager.stop(),this._resetSpatialManager&&this.spatialManager.reset(),this._resetRenderManager&&this.renderManager.reset(),LOGGING&&this._log.mark(this.name+" Exited")},i.prototype.onTick=function(){},i.prototype.setScene=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];this._game.setScene.apply(this._game,[t].concat(e))},i.prototype.getAsset=function(t,e){return"undefined"==typeof e&&(e=this._game.config.resources),this._game.getAsset(t,e)},i.prototype.pause=function(t){"undefined"==typeof t&&(t=1),1==t&&(this._timeManager.isRunning?(this._timeManager.stop(),TweenMax.pauseAll(),this.suspendSignal.dispatch(),this.pauseSignal.dispatch(!0)):(this._timeManager.start(),TweenMax.resumeAll(),this.resumeSignal.dispatch(),this.pauseSignal.dispatch(!1)),LOGGING&&(this._log.info("Pause"),this._log.mark("Pause")))},i.prototype.resume=function(t){"undefined"==typeof t&&(t=1),1!=t||this._timeManager.isRunning||(this._timeManager.start(),TweenMax.resumeAll(),this.resumeSignal.dispatch(),this.pauseSignal.dispatch(!1),LOGGING&&(this._log.info("Resume"),this._log.mark("Resume")))},i.prototype.suspend=function(t){"undefined"==typeof t&&(t=1),1==t&&this._timeManager.isRunning&&(this._timeManager.stop(),TweenMax.pauseAll(),this.suspendSignal.dispatch(),this.pauseSignal.dispatch(!0),LOGGING&&(this._log.info("Suspend"),this._log.mark("Suspend")))},i.prototype.mute=function(t){"undefined"==typeof t&&(t=1),1==t&&this.soundManager.mute()},i.prototype.show=function(t){this.get(t).visible=!0},i.prototype.hide=function(t){this.get(t).visible=!1},i.prototype.transitionIn=function(e,i,n,o,r,s,a,h,l){"undefined"==typeof e&&(e="#000000"),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n="circle"),"undefined"==typeof o&&(o="in"),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=null),"undefined"==typeof h&&(h=null),"undefined"==typeof l&&(l=null);var c=new t.Transition(this._timeManager,this.renderManager,{color:e,width:this.screenWidth,height:this.screenHeight});c.start({type:n,delay:s,direction:o,position:r,duration:i,ease:l||Sine.easeOut,onComplete:a,onCompleteParams:h})},i.prototype.transitionOut=function(e,i,n,o,r,s,a,h,l){"undefined"==typeof e&&(e="#000000"),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n="circle"),"undefined"==typeof o&&(o="out"),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=null),"undefined"==typeof h&&(h=null),"undefined"==typeof l&&(l=null);var c=new t.Transition(this._timeManager,this.renderManager,{color:e,width:this.screenWidth,height:this.screenHeight});c.start({type:n,delay:s,direction:o,position:r,duration:i,ease:l||Sine.easeOut,onComplete:a,onCompleteParams:h})},i.prototype.killAllTweens=function(){for(var t,e=this.getAll(),i=0;i<e.length;i++)t=e[i],TweenMax.killTweensOf(t);TweenMax.killTweensOf(this)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.globalTimeManager.releaseTimeManager(this._timeManager),this.pauseSignal.removeAll(),this.resumeSignal.removeAll(),this.suspendSignal.removeAll(),this.pauseSignal=null,this.resumeSignal=null,this.suspendSignal=null,this._timeManager=null,this._config=null,this._game=null},i}(t.StateEntity);t.GameScene=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r){"undefined"==typeof n&&(n=e.NAME),"undefined"==typeof r&&(r=!0),t.call(this,i,n,o,r)}return __extends(e,t),e.NAME="Level",e}(t.GameScene);t.Level=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a){"undefined"==typeof o&&(o=i.NAME),"undefined"==typeof a&&(a=!0),e.call(this,n,o,r,a),this._strings=s?JSON.parse(JSON.stringify(s)):null,this.buttonSignal=new t.Signal,this.enteredSignal.addOnce(this.onEnterScreen,this,-1)}return __extends(i,e),i.NAME="Screen",i.prototype.onEnterScreen=function(){this._strings&&this.localize(this._strings),this.globalStrings&&this.globalStrings.hasOwnProperty("buttons")&&this.localizeButtons(this.globalStrings.buttons),this.soundManager.muteSignal.add(this._onMuted,this),this._onMuted(),this.pauseSignal.add(this._onPaused,this)},i.prototype.loadResources=function(t,e){"undefined"==typeof e&&(e=this.globalConfig.resources),this.resourceManager.progressSignal.add(this._onLoadingProgress,this),this.resourceManager.failedSignal.add(this._onLoadingFailed,this),this.resourceManager.completeSignal.addOnce(this._onLoadingComplete,this),this._progressBar&&(this._progressBar.scaleX=0);for(var i,n=0;n<t.length;n++){for(var o=0;o<e.length;o++)if(e[o].name==t[n]){i=e[o];break}if(i){var r=i.path.substr(i.path.lastIndexOf(".")+1,4);if(("mp3"===r||"wav"===r||"ogg"===r||"aac"===r)&&this.soundManager.hasSound(i.name))continue;this.resourceManager.isLoaded(i.path)||this.resourceManager.load(i.path,i.name)}}0==this.resourceManager.loadingCount&&this._onLoadingComplete()},i.prototype._onLoadingProgress=function(t,e){this._progressBar&&(this._progressBar.scaleX=t/e)},i.prototype._onLoadingFailed=function(){},i.prototype._onLoadingComplete=function(){this.resourceManager.progressSignal.remove(this._onLoadingProgress,this),this.resourceManager.failedSignal.remove(this._onLoadingFailed,this),this.resourceManager.completeSignal.remove(this._onLoadingComplete,this),this.globalConfig.hasOwnProperty("assets")&&this._game.registerAssets(this.globalConfig.assets)},i.prototype.unloadResources=function(t,e){"undefined"==typeof e&&(e=this.globalConfig.resources),this._game.unloadResources(t,e)},i.prototype._buttonHandler=function(e,i,n){switch(i){case t.Button.UP:LOGGING&&this._log.trace("{BUTTON_UP | "+e.name+"}");break;case t.Button.OVER:LOGGING&&this._log.trace("{BUTTON_OVER | "+e.name+"}");break;case t.Button.OUT:LOGGING&&this._log.trace("{BUTTON_OUT | "+e.name+"}");break;case t.Button.DOWN:LOGGING&&this._log.trace("{BUTTON_DOWN | "+e.name+"}")}this.destroyed||this.buttonSignal.dispatch(e,i,n)},i.prototype._onMuted=function(t){"undefined"==typeof t&&(t=!1)},i.prototype._onPaused=function(t){"undefined"==typeof t&&(t=!1)},i.prototype.enableButton=function(e,i){"undefined"==typeof i&&(i=1),t.ObjectUtil.isString(e)&&(e=this.get(e)),e.inputUp.add(this._buttonHandler,this),e.inputOver.add(this._buttonHandler,this),e.inputDown.add(this._buttonHandler,this),e.inputOut.add(this._buttonHandler,this),e.enabled=!0,e.visible=!0,e.alpha=i,e.play(t.Button.UP)},i.prototype.disableButton=function(e,i){"undefined"==typeof i&&(i=1),t.ObjectUtil.isString(e)&&(e=this.get(e)),e.inputUp.remove(this._buttonHandler,this),e.inputOver.remove(this._buttonHandler,this),e.inputDown.remove(this._buttonHandler,this),e.inputOut.remove(this._buttonHandler,this),e.enabled=!1,e.alpha=i},i.prototype.enableButtons=function(e){"undefined"==typeof e&&(e=1);for(var i,n=this.getByType(t.Button),o=0,r=n.length;r>o;o++)i=n[o],i&&this.enableButton(i,e)},i.prototype.disableButtons=function(e){"undefined"==typeof e&&(e=1);for(var i,n=this.getByType(t.Button),o=0,r=n.length;r>o;o++)i=n[o],i&&this.disableButton(i,e)},i.prototype.enableButtonSet=function(e,i){"undefined"==typeof i&&(i=1);for(var n,o=0,r=e.length;r>o;o++)n=e[o],t.ObjectUtil.isString(n)&&(n=this.get(n)),n&&this.enableButton(n,i)},i.prototype.disableButtonSet=function(e,i){"undefined"==typeof i&&(i=1);for(var n,o=0,r=e.length;r>o;o++)n=e[o],t.ObjectUtil.isString(n)&&(n=this.get(n)),n&&this.disableButton(n,i)},i.prototype.setLabel=function(t,e){this.get(t).text=e},i.prototype.toggleMute=function(t,e){this.soundManager.mute(),this.checkMute(t,e)},i.prototype.checkMute=function(t,e){var i=this.get(e),n=this.get(t);i&&n&&(this.soundManager.isMuted?(n.visible=!0,n.active=!0,i.visible=!1,i.active=!1):(i.visible=!0,i.active=!0,n.visible=!1,n.active=!1))},i.prototype.localizeButtons=function(e){for(var i=this.getByType(t.Button),n=0,o=i.length;o>n;n++)for(var r=0,s=e.length;s>r;r++)i[n].name==e[r].name&&(i[n].textLabel.text=e[r].value,e[r].style&&i[n].textLabel.setStyle(e[r].style))},i.prototype.localize=function(e){this.localizeButtons(e);for(var i=this.getByType(t.TextGraphic),n=0,o=i.length;o>n;n++)for(var r=0,s=e.length;s>r;r++)i[n].name==e[r].name&&(i[n].text=e[r].value,e[r].style&&i[n].setStyle(e[r].style))},i.prototype.destroy=function(){this.killAllTweens(),this.soundManager.muteSignal.remove(this._onMuted,this),this.buttonSignal.removeAll(),this.buttonSignal=null,this._progressBar=null,this._strings=null,e.prototype.destroy.call(this)},i}(t.GameScene);t.Screen=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(e){"undefined"==typeof e&&(e=this.__defaultSeed),this.__defaultSeed=t.count,this.seed=e||t.count++}return t.count=1e9*Math.random(),t._defaultSeed=t.count,t._seed=t._defaultSeed,Object.defineProperty(t,"defaultSeed",{get:function(){return t._defaultSeed},enumerable:!0,configurable:!0}),Object.defineProperty(t,"seed",{get:function(){return t._seed},set:function(e){t._seed=t._defaultSeed=Math.abs(e)},enumerable:!0,configurable:!0}),t.integer=function(e,i){return"undefined"==typeof e&&(e=0/0),"undefined"==typeof i&&(i=0/0),isNaN(e)?t.generate():(isNaN(i)&&(i=e,e=0),i=e>i?e:i,e=i>e?e:i,Math.floor(e+(i+1-e)*t["float"]()))},t["float"]=function(e,i){return"undefined"==typeof e&&(e=0/0),"undefined"==typeof i&&(i=0/0),isNaN(e)?t.generate()/2147483647:(isNaN(i)&&(i=e,e=0),i=e>i?e:i,e=i>e?e:i,e+(i-e)*t["float"]())},t["boolean"]=function(e){return"undefined"==typeof e&&(e=.5),t["float"]()<e},t.sign=function(e){return"undefined"==typeof e&&(e=.5),t["float"]()<e?1:-1},t.bit=function(e){return"undefined"==typeof e&&(e=.5),t["float"]()<e?1:0},t.color=function(){return Math.floor(16777215*t.integer())},t.cssColor=function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},t.reset=function(){t._seed=t._defaultSeed},t.generate=function(){return t._seed=16807*t._seed%2147483647},Object.defineProperty(t.prototype,"defaultSeed",{get:function(){return this.__defaultSeed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seed",{get:function(){return this.__seed},set:function(t){this.__seed=this.__defaultSeed=Math.abs(t)},enumerable:!0,configurable:!0}),t.prototype.integer=function(t,e){return"undefined"==typeof t&&(t=0/0),"undefined"==typeof e&&(e=0/0),isNaN(t)?this.generate():(isNaN(e)&&(e=t,t=0),e=t>e?t:e,t=e>t?t:e,Math.round(t+(e-t)*this["float"]()))},t.prototype["float"]=function(t,e){return"undefined"==typeof t&&(t=0/0),"undefined"==typeof e&&(e=0/0),isNaN(t)?this.generate()/2147483647:(isNaN(e)&&(e=t,t=0),e=t>e?t:e,t=e>t?t:e,t+(e-t)*this["float"]())},t.prototype["boolean"]=function(t){return"undefined"==typeof t&&(t=.5),this["float"]()<t},t.prototype.sign=function(t){return"undefined"==typeof t&&(t=.5),this["float"]()<t?1:-1},t.prototype.bit=function(t){return"undefined"==typeof t&&(t=.5),this["float"]()<t?1:0},t.prototype.color=function(){return Math.floor(16777215*this.integer())},t.prototype.cssColor=function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},t.prototype.reset=function(){this.__seed=this.__defaultSeed},t.prototype.generate=function(){return this.__seed=16807*this.__seed%2147483647},t}();t.Random=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,t,s),this._renderManager=n,this._spatialManager=o,this._image=r,this._timeManager&&this._renderManager&&this._createRenderComponent(),this._timeManager&&this._spatialManager&&this._createSpatialComponent()}return __extends(i,e),i.NAME="ImageSprite",Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._renderComponent.tint},set:function(t){this._renderComponent.tint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._renderComponent.mask},set:function(t){this._renderComponent.mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._renderComponent.view},set:function(t){this._renderComponent.view=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"active",{get:function(){return this._spatialComponent.active},set:function(t){this._spatialComponent.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._renderComponent.compositeOperation},set:function(t){this._renderComponent.compositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._spatialComponent.x},set:function(t){this._spatialComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._spatialComponent.y},set:function(t){this._spatialComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._spatialComponent.width},set:function(t){this._spatialComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._spatialComponent.height},set:function(t){this._spatialComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._spatialComponent.rotation},set:function(t){this._spatialComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._spatialComponent.centerX},set:function(t){this._spatialComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._spatialComponent.centerY},set:function(t){this._spatialComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._spatialComponent.top},set:function(t){this._spatialComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._spatialComponent.left},set:function(t){this._spatialComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._spatialComponent.right},set:function(t){this._spatialComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._spatialComponent.bottom},set:function(t){this._spatialComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._spatialComponent.type},set:function(t){this._spatialComponent.type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocityX",{get:function(){return this._spatialComponent.velocityX},set:function(t){this._spatialComponent.velocityX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocityY",{get:function(){return this._spatialComponent.velocityY},set:function(t){this._spatialComponent.velocityY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularVelocity",{get:function(){return this._spatialComponent.angularVelocity},set:function(t){this._spatialComponent.angularVelocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return this._spatialComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return this._spatialComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._spatialComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._spatialComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._spatialComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_worldTransform",{get:function(){return this._renderComponent._worldTransform},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){this._renderComponent=this.create(t.RenderComponent,this._timeManager,this._renderManager,this._image),this.addComponent(this._renderComponent,t.EngineConstants.RENDER)},i.prototype._createSpatialComponent=function(){this._spatialComponent=this.create(t.SpatialComponent,this._timeManager,this._spatialManager),this._renderComponent&&(this._spatialComponent.width=this._renderComponent.width,this._spatialComponent.height=this._renderComponent.height),this.addComponent(this._spatialComponent,t.EngineConstants.SPATIAL)},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},i.prototype.stopBlink=function(){this._renderComponent.stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},i.prototype.stopShake=function(){this._renderComponent.stopShake()},i.prototype.setCollisionArea=function(t,e,i,n){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this._spatialComponent.width=t,this._spatialComponent.height=e,this._renderComponent.offsetY=n,this._renderComponent.offsetX=i},i.prototype.setType=function(t){this.type=this._spatialManager.typeManager.getBitMask(t)},i.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},i.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},i.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._image=null,this._spatialComponent=null,this._renderComponent=null,this._spatialManager=null,this._renderManager=null},i}(t.GameEntity);t.ImageSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,t,n,o,null,s),this._animationInfo={},this._timeManager&&this._renderManager&&this._createAnimationComponent(),r&&this.addSpriteSheet(r,!0)}return __extends(i,e),i.NAME="AnimatedSprite",Object.defineProperty(i.prototype,"currentAnimation",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAnimating",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.isAnimating},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"repeatCount",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.repeatCount},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.repeatCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.duration},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this._spriteSheetAnimationComponent.currentAnimation.frameIndex},set:function(t){this._spriteSheetAnimationComponent.currentAnimation.frameIndex=t},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){this._spriteSheetRenderComponent=this.create(t.SpriteSheetRenderComponent,this._timeManager,this._renderManager),this._renderComponent=this._spriteSheetRenderComponent,this.addComponent(this._spriteSheetRenderComponent,t.EngineConstants.RENDER)},i.prototype._createAnimationComponent=function(){this._spriteSheetAnimationComponent=this.create(t.SpriteSheetAnimationComponent,this._timeManager,this._spriteSheetRenderComponent),this.addComponent(this._spriteSheetAnimationComponent,t.EngineConstants.ANIMATION)},i.prototype.addSpriteSheet=function(t,e){return"undefined"==typeof e&&(e=!1),this._spriteSheetRenderComponent.addSpriteSheet(t,e)},i.prototype.getSpriteSheet=function(t){return this._spriteSheetRenderComponent.getSpriteSheet(t)},i.prototype.removeSpriteSheet=function(t){this._spriteSheetRenderComponent.removeSpriteSheet(t)},i.prototype.addAnimation=function(e,i,n,o,r){"undefined"==typeof o&&(o=1e3),"undefined"==typeof r&&(r=t.SpriteSheetAnimation.PLAY_ONCE),this._animationInfo[e]=i;var s,a=this.getSpriteSheet(i);a&&(s=a.getFrames(n)),this._spriteSheetAnimationComponent.addAnimation(e,s,o,r)},i.prototype.getAnimation=function(t){return this._spriteSheetAnimationComponent.getAnimation(t)},i.prototype.removeAnimation=function(t){this._spriteSheetAnimationComponent.removeAnimation(t)},i.prototype.setFrame=function(t){this._spriteSheetRenderComponent.setFrame(t)},i.prototype.play=function(e,i,n,o,r){"undefined"==typeof e&&(e=t.SpriteSheetAnimation.NAME),"undefined"==typeof i&&(i=Number.MIN_VALUE),"undefined"==typeof n&&(n=0);var s=this._animationInfo[e];s&&this._spriteSheetRenderComponent.setSpriteSheet(s),n==t.SpriteSheetAnimation.FRAME_CURRENT&&this.currentAnimation&&(n=this.currentAnimation.frameIndex),n==t.SpriteSheetAnimation.FRAME_RANDOM&&(n=t.Random.integer(1,this._spriteSheetAnimationComponent.getAnimation(e).totalFrames-1)),this._spriteSheetAnimationComponent.play(e,i,n,o,r),this._offset=this._spriteSheetAnimationComponent.currentAnimation.frames[0].offset,this._spriteSheetRenderComponent.registrationX=this._offset.width/2,this._spriteSheetRenderComponent.registrationY=this._offset.height/2},i.prototype.pause=function(){this._spriteSheetAnimationComponent.pause()},i.prototype.suspend=function(){this._spriteSheetAnimationComponent.suspend()},i.prototype.resume=function(){this._spriteSheetAnimationComponent.resume()},i.prototype.restart=function(){this._spriteSheetAnimationComponent.restart()},i.prototype.stop=function(){this._spriteSheetAnimationComponent.stop()},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._animationInfo)this._animationInfo[t]=null,delete this._animationInfo[t];this._spriteSheetRenderComponent=null,this._spriteSheetAnimationComponent=null,this._animationInfo=null,this._offset=null},i}(t.ImageSprite);t.AnimatedSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r,s,a){"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s=100),"undefined"==typeof a&&(a=t.ImageSprite.NAME),e.call(this,i,a),this._renderManager=n,this._spatialManager=o,this._canvas=document.createElement("canvas"),this._renderContext=this._canvas.getContext("2d"),this._canvas.width=r,this._canvas.height=s,this._timeManager&&this._renderManager&&this._createRenderComponent(),this._timeManager&&this._spatialManager&&this._createSpatialComponent()}return __extends(i,e),i.NAME="CanvasSprite",Object.defineProperty(i.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._renderComponent.tint},set:function(t){this._renderComponent.tint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._renderComponent.mask},set:function(t){this._renderComponent.mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view",{get:function(){return this._renderComponent.view},set:function(t){this._renderComponent.view=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"active",{get:function(){return this._spatialComponent.active},set:function(t){this._spatialComponent.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._renderComponent.compositeOperation},set:function(t){this._renderComponent.compositeOperation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._spatialComponent.x},set:function(t){this._spatialComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._spatialComponent.y},set:function(t){this._spatialComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._spatialComponent.width},set:function(t){this._spatialComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._spatialComponent.height},set:function(t){this._spatialComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._spatialComponent.rotation
},set:function(t){this._spatialComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._spatialComponent.centerX},set:function(t){this._spatialComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._spatialComponent.centerY},set:function(t){this._spatialComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._spatialComponent.top},set:function(t){this._spatialComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._spatialComponent.left},set:function(t){this._spatialComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._spatialComponent.right},set:function(t){this._spatialComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._spatialComponent.bottom},set:function(t){this._spatialComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._spatialComponent.type},set:function(t){this._spatialComponent.type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocityX",{get:function(){return this._spatialComponent.velocityX},set:function(t){this._spatialComponent.velocityX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocityY",{get:function(){return this._spatialComponent.velocityY},set:function(t){this._spatialComponent.velocityY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularVelocity",{get:function(){return this._spatialComponent.angularVelocity},set:function(t){this._spatialComponent.angularVelocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfWidth",{get:function(){return this._renderComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfHeight",{get:function(){return this._renderComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._spatialComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._spatialComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"extents",{get:function(){return this._spatialComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_worldTransform",{get:function(){return this._renderComponent._worldTransform},enumerable:!0,configurable:!0}),i.prototype._createRenderComponent=function(){void 0!=this._canvas&&(this._renderComponent=this.create(t.RenderComponent,this._timeManager,this._renderManager,this._canvas),this.addComponent(this._renderComponent,t.EngineConstants.RENDER))},i.prototype._createSpatialComponent=function(){this._spatialComponent=this.create(t.SpatialComponent,this._timeManager,this._spatialManager),this._renderComponent&&(this._spatialComponent.width=this._renderComponent.width,this._spatialComponent.height=this._renderComponent.height),this.addComponent(this._spatialComponent,t.EngineConstants.SPATIAL)},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},i.prototype.stopBlink=function(){this._renderComponent.stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},i.prototype.stopShake=function(){this._renderComponent.stopShake()},i.prototype.setSize=function(t,e){this.clear(),this._renderComponent.width=t,this._renderComponent.height=e,this.view.width=t,this.view.height=e,this._spatialComponent.width=t,this._spatialComponent.height=e},i.prototype.translateContext=function(t,e){this._renderContext.translate(t,e)},i.prototype.rotateContext=function(t){this._renderContext.rotate(t)},i.prototype.scaleContext=function(t,e){this._renderContext.scale(t,e)},i.prototype.setTransform=function(t,e,i,n,o,r){this._renderContext.setTransform(t,e,i,n,o,r)},i.prototype.drawImage=function(t,e,i,n,o,r,s,a,h){this._renderContext.drawImage(t,e,i,n,o,r,s,a,h),this._renderManager._draws++},i.prototype.getImageData=function(t,e,i,n){return this._renderContext.getImageData(t,e,i,n)},i.prototype.putImageData=function(t,e,i,n,o,r,s){this._renderContext.putImageData(t,e,i,n,o,r,s)},i.prototype.createImageData=function(t,e){return this._renderContext.createImageData(t,e)},Object.defineProperty(i.prototype,"fillStyle",{set:function(t){this._renderContext.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"strokeStyle",{set:function(t){this._renderContext.strokeStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineWidth",{set:function(t){this._renderContext.lineWidth=t},enumerable:!0,configurable:!0}),i.prototype.font=function(t){this._renderContext.font=t},i.prototype.clip=function(){this._renderContext.clip()},i.prototype.beginPath=function(){this._renderContext.beginPath()},i.prototype.closePath=function(){this._renderContext.closePath()},i.prototype.rect=function(t,e,i,n){this._renderContext.rect(t,e,i,n)},i.prototype.arc=function(t,e,i,n,o,r){this._renderContext.arc(t,e,i,n,o,r)},i.prototype.moveTo=function(t,e){this._renderContext.moveTo(t,e)},i.prototype.lineTo=function(t,e){this._renderContext.lineTo(t,e)},i.prototype.arcTo=function(t,e,i,n,o){this._renderContext.arcTo(t,e,i,n,o)},i.prototype.fill=function(){this._renderContext.fill(),this._renderManager._draws++},i.prototype.fillRect=function(t,e,i,n){this._renderContext.fillRect(t,e,i,n),this._renderManager._draws++},i.prototype.fillText=function(t,e,i,n){this._renderContext.fillText(t,e,i,n),this._renderManager._draws++},i.prototype.stroke=function(){this._renderContext.stroke(),this._renderManager._draws++},i.prototype.strokeRect=function(t,e,i,n){this._renderContext.strokeRect(t,e,i,n),this._renderManager._draws++},i.prototype.strokeText=function(t,e,i,n){this._renderContext.strokeText(t,e,i,n),this._renderManager._draws++},i.prototype.clearRect=function(t,e,i,n){this._renderContext.clearRect(t,e,i,n)},i.prototype.createLinearGradient=function(t,e,i,n){this._renderContext.createLinearGradient(t,e,i,n)},i.prototype.createRadialGradient=function(t,e,i,n,o,r){this._renderContext.createRadialGradient(t,e,i,n,o,r)},i.prototype.createPattern=function(t,e){this._renderContext.createPattern(t,e)},i.prototype.clear=function(){this._renderContext.clearRect(0,0,this.width,this.height)},i.prototype.setCollisionArea=function(t,e,i,n){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this._spatialComponent.width=t,this._spatialComponent.height=e,this._renderComponent.offsetY=n,this._renderComponent.offsetX=i},i.prototype.setType=function(t){this.type=this._spatialManager.typeManager.getBitMask(t)},i.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},i.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},i.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},i.prototype.destroy=function(){this.clear(),e.prototype.destroy.call(this),this._canvas=null,this._renderContext=null,this._spatialComponent=null,this._renderComponent=null,this._spatialManager=null,this._renderManager=null},i}(t.GameEntity);t.CanvasSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a,h){"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s=100),"undefined"==typeof a&&(a="rgba(255,255,255,1)"),"undefined"==typeof h&&(h=e.NAME),t.call(this,i,n,o,r,s,h),this._color=a,this._dirty=!0,this._draw(),this.enableOnTick()}return __extends(e,t),e.NAME="ShapeSprite",Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype.onTick=function(){this._dirty&&this._draw()},e.prototype._draw=function(){this._dirty=!1},e}(t.CanvasSprite);t.ShapeSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a,h){"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s="rgba(255,255,255,1)"),"undefined"==typeof a&&(a=!1),"undefined"==typeof h&&(h=e.NAME),t.call(this,i,n,o,r,r,s,h),this._useGradient=a}return __extends(e,t),e.NAME="DotSprite",Object.defineProperty(e.prototype,"radius",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t,this._renderComponent.height=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useGradient",{get:function(){return this._useGradient},set:function(t){this._useGradient=t,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype._draw=function(){if(this.clear(),this._useGradient){var e=document.createElement("div");e.style.color=this.color;var i=e.style.color.split(","),n=this._renderContext.createRadialGradient(this.radius/2,this.radius/2,0,this.radius/2,this.radius/2,this.radius/2);n.addColorStop(0,this.color),n.addColorStop(1,"rgba("+i[0].replace(/[^\d.]/g,"")+","+i[1].replace(/[^\d.]/g,"")+","+i[2].replace(/[^\d.]/g,"")+",0)"),this.fillStyle=n}else this.fillStyle=this.color;this.beginPath(),this.moveTo(this.radius/2,this.radius/2),this.arc(this.radius/2,this.radius/2,this.radius/2,0,2*Math.PI),this.closePath(),this.fill(),t.prototype._draw.call(this)},e}(t.ShapeSprite);t.DotSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r,s,a,h){"undefined"==typeof r&&(r=100),"undefined"==typeof s&&(s=100),"undefined"==typeof a&&(a="rgba(255,255,255,1)"),"undefined"==typeof h&&(h=t.RectGraphic.NAME),e.call(this,i,n,o,r,s,a,h)}return __extends(i,e),i.NAME="RectSprite",i.prototype._draw=function(){this.fillStyle=this.color,this.beginPath(),this.rect(0,0,this._renderComponent._width,this._renderComponent._height),this.closePath(),this.fill(),e.prototype._draw.call(this)},i}(t.ShapeSprite);t.RectSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(i,n,o,r,s,a){"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=e.NAME),t.call(this,i,n,o,r,a),this.setFrame(s)}return __extends(e,t),e.NAME="SingleFrameSprite",e.prototype.setFrame=function(t){this._spriteSheetRenderComponent.setFrame(t)},e}(t.AnimatedSprite);t.SingleFrameSprite=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r){e.call(this,i),this._typeManager=n,o&&(this._tileMap=o,this._tileWidth=this._tileMap.tileWidth,this._tileHeight=this._tileMap.tileHeight),this.priority=-1,this.offsetX=0,this.offsetY=0,this._componentReference=r,this.collisionSignal=new t.Signal,this._collisionOffsets=[],this.active=!0}return __extends(i,e),i.TOP=1,i.BOTTOM=2,i.LEFT=4,i.RIGHT=8,Object.defineProperty(i.prototype,"spatialComponent",{get:function(){return this._spatialComponent},set:function(t){this._spatialComponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileMap",{get:function(){return this._tileMap},set:function(t){this._tileMap=t,this._tileMap&&(this._tileWidth=this._tileMap.tileWidth,this._tileHeight=this._tileMap.tileHeight)},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){this._spatialComponent=this._componentReference?this._owner.getComponent(this._componentReference):this._owner.getComponentByType(t.SpatialComponent),e.prototype._onRegister.call(this)},i.prototype._onReset=function(){this._spatialComponent=this._componentReference?this._owner.getComponent(this._componentReference):this._owner.getComponentByType(t.SpatialComponent),e.prototype._onReset.call(this)},i.prototype.addCollisionType=function(e){this._collisionsMask||(this._collisionsMask=this.create(t.BitMask,this._typeManager,"default"),this._collisionsMask.name="BitMask_CollisionsMask"),this._collisionNames||(this._collisionTypes=[],this._collisionNames=[]),"[object String]"===Object.prototype.toString.call(e)&&this._collisionNames.push(e),"[object Array]"===Object.prototype.toString.call(e)&&this._collisionNames.concat(e),this._collisionTypes.push(this._typeManager.getBitMask(e)),this._collisionsMask.typeNames=this._collisionNames},i.prototype.onTick=function(i){if(this.active&&this._spatialComponent&&this._tileMap){this._queryRect=this._spatialComponent.extents.clone(),this._queryRect.x+=this.offsetX,this._queryRect.y+=this.offsetY,this._collisions=this._tileMap.queryRectangle(this._queryRect,this._collisionsMask);for(var n=this._collisions.length-1;n>=0;n--)if(this._collider=this._collisions[n],this._collider)if(this._topOffset=this._spatialComponent.top+this.offsetY-(this._collider.row*this._tileHeight+this._tileHeight),this._bottomOffset=this._spatialComponent.bottom+this.offsetY-this._collider.row*this._tileHeight,this._leftOffset=this._spatialComponent.left+this.offsetX-(this._collider.col*this._tileWidth+this._tileWidth),this._rightOffset=this._spatialComponent.right+this.offsetX-this._collider.col*this._tileWidth,this._topOffset=this._topOffset<0?-this._topOffset:this._topOffset,this._bottomOffset=this._bottomOffset<0?-this._bottomOffset:this._bottomOffset,this._leftOffset=this._leftOffset<0?-this._leftOffset:this._leftOffset,this._rightOffset=this._rightOffset<0?-this._rightOffset:this._rightOffset,this._collisionOffsets[0]=this._topOffset,this._collisionOffsets[1]=this._bottomOffset,this._collisionOffsets[2]=this._leftOffset,this._collisionOffsets[3]=this._rightOffset,this._collisionOffsets.sort(this.sortOffsets),this._collisionOffset=this._collisionOffsets[0],this._collisionOffset==this._topOffset&&(this._loc=t.CollisionComponent.TOP),this._collisionOffset==this._bottomOffset&&(this._loc=t.CollisionComponent.BOTTOM),this._collisionOffset==this._leftOffset&&(this._loc=t.CollisionComponent.LEFT),this._collisionOffset==this._rightOffset&&(this._loc=t.CollisionComponent.RIGHT),this._collisionTypes)for(var o=this._collisionTypes.length-1;o>=0;o--)this._collider.type&&this._typeManager.doTypesOverlap(this._collider.type,this._collisionTypes[o])&&this.collisionSignal.dispatch(this._spatialComponent,this._collider,this._loc,this._collisionOffset,this._collisionNames[o]);else this.collisionSignal.dispatch(this._spatialComponent,this._collider,this._loc,this._collisionOffset);e.prototype.onTick.call(this,i)}},i.prototype.sortOffsets=function(t,e){return t>=e?1:-1},i.prototype.destroy=function(){this.collisionSignal.removeAll(),this.active=!1,this.collisionSignal=null,this._spatialComponent=null,this._collider=null,this._collisions=null,this._collisionOffsets=null,this._collisionTypes=null,this._collisionNames=null,this._collisionsMask=null,this._tileMap=null,this._typeManager=null,this._queryRect=null,e.prototype.destroy.call(this)},i}(t.TickedComponent);t.TileCollisionComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(o,r,s,a,h,l,c){"undefined"==typeof l&&(l=i.TILED_JSON),"undefined"==typeof c&&(c=n.NAME),e.call(this,o,c),this._renderManager=r,this._typeManager=s,this._pt=new t.Point,this._result=new t.Point,this._rect=new t.Rectangle,this._rayResult=new t.RayResult,a&&h&&this.createTiles(a,h,l),!this._renderComponent&&this._timeManager&&this._renderManager&&this._tileSet&&this._tiles&&this._createRenderComponent(),DEBUG&&this.enableOnTick()}return __extends(n,e),n.NAME="TileMap",n.LAYER_OBJECT="objectgroup",n.LAYER_TILE="tilelayer",Object.defineProperty(n.prototype,"isBlinking",{get:function(){return this._renderComponent.isBlinking},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"roundedPixels",{get:function(){return this._renderComponent.roundedPixels},set:function(t){this._renderComponent.roundedPixels=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"x",{get:function(){return this._renderComponent.x},set:function(t){this._renderComponent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._renderComponent.y},set:function(t){this._renderComponent.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._renderComponent.width},set:function(t){this._renderComponent.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._renderComponent.height},set:function(t){this._renderComponent.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotation",{get:function(){return this._renderComponent.rotation},set:function(t){this._renderComponent.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"centerX",{get:function(){return this._renderComponent.centerX},set:function(t){this._renderComponent.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"centerY",{get:function(){return this._renderComponent.centerY},set:function(t){this._renderComponent.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"registrationX",{get:function(){return this._renderComponent.registrationX},set:function(t){this._renderComponent.registrationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"registrationY",{get:function(){return this._renderComponent.registrationY},set:function(t){this._renderComponent.registrationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"offsetX",{get:function(){return this._renderComponent.offsetX},set:function(t){this._renderComponent.offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"offsetY",{get:function(){return this._renderComponent.offsetY},set:function(t){this._renderComponent.offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this._renderComponent.top},set:function(t){this._renderComponent.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this._renderComponent.left},set:function(t){this._renderComponent.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this._renderComponent.right},set:function(t){this._renderComponent.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this._renderComponent.bottom},set:function(t){this._renderComponent.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"halfWidth",{get:function(){return this._renderComponent.halfWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"halfHeight",{get:function(){return this._renderComponent.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"center",{get:function(){return this._renderComponent.center},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return this._renderComponent.position},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"registration",{get:function(){return this._renderComponent.registration},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extents",{get:function(){return this._renderComponent.extents},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"offset",{get:function(){return this._renderComponent.offset},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tileData",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_renderID",{get:function(){return this._renderComponent._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_worldTransform",{get:function(){return this._renderComponent._worldTransform},enumerable:!0,configurable:!0}),n.prototype.createTiles=function(t,e,n){"undefined"==typeof n&&(n=i.TILED_JSON);var o,r=[];switch(this._data=e,this._tileSet=t,this._tileWidth=this._tileSet.tileWidth,this._tileHeight=this._tileSet.tileHeight,this._isAnimated=!1,n){case i.JSON:this._rows=this._data.length,this._cols=this._data[0].length;for(var s=0;s<this._rows;s++)for(var a=0;a<this._cols;a++)-1!=e[s][a]&&(o=t.getTile(e[s][a]).clone(this),o.row=s,o.col=a,o.isAnimated&&(this._isAnimated=!0)),r[s*this._cols+a]=o,o=null;break;case i.TILED_JSON:this._rows=this._data.height,this._cols=this._data.width;for(var s=0;s<this._rows;s++)for(var a=0;a<this._cols;a++)0!=e.data[s*this._cols+a]&&(o=t.getTile(e.data[s*this._cols+a]).clone(this),o.row=s,o.col=a,o.isAnimated&&(this._isAnimated=!0)),r[s*this._cols+a]=o,o=null}return this._tiles=r,!this._renderComponent&&this._timeManager&&this._renderManager&&this._tileSet&&this._tiles&&this._createRenderComponent(),this._tiles},n.prototype._createRenderComponent=function(){this._renderComponent=this.create(t.TileRenderComponent,this._timeManager,this._renderManager,this._tileSet,this._tiles,this._rows,this._cols),this.addComponent(this._renderComponent,t.EngineConstants.RENDER),this._isAnimated||(this._renderComponent._isPrerendered=!0),this.roundedPixels=!0},n.prototype.prerender=function(t,e,n,o,r){"undefined"==typeof r&&(r=i.TILED_JSON),this.createTiles(n,o,r),!this._renderComponent&&this._timeManager&&this._renderManager&&this._tileSet&&this._data&&this._createRenderComponent(),this._renderComponent&&this._renderComponent.prerender(t,e,this._tileSet,this._tiles,this._rows,this._cols)},n.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this._renderComponent.blink(t,e,i,n)},n.prototype.stopBlink=function(){this._renderComponent.stopBlink()},n.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this._renderComponent.shake(t,e,i)},n.prototype.stopShake=function(){this._renderComponent.stopShake()},n.prototype._updateNode=function(t){"undefined"==typeof t&&(t=!1),this._renderComponent.updateNode(t)},n.prototype.globalToLocal=function(t){return this._renderComponent.globalToLocal(t)},n.prototype.localToGlobal=function(t){return this._renderComponent.localToGlobal(t)},n.prototype.onTick=function(){DEBUG&&(this._checks=0)},n.prototype.setTile=function(e,i,n){if(t.ObjectUtil.isString(n)){var o=this._tileSet.getTileByName(n).clone(this);o.row=e,o.col=i,o.isAnimated&&(this._isAnimated=!0)}this._tiles[e*this._cols+i]=o},n.prototype.getTiles=function(){return this._tiles.concat()},n.prototype.getTile=function(t,e){return this._tiles[t*this._cols+e]},n.prototype.getTilesByIndex=function(t){for(var e=[],i=0;i<this._renderComponent.rows;i++)for(var n=0;n<this._renderComponent.cols;n++)this._tile=this._tiles[i*this._cols+n],this._tile.index===t&&e.push(this._tile);return e},n.prototype.getTilesByPrefix=function(t){for(var e=[],i=0;i<this._renderComponent.rows;i++)for(var n=0;n<this._renderComponent.cols;n++)this._tile=this._tiles[i*this._cols+n],(this._tile.name&&-1!=this._tile.name.indexOf(t)||this._tile.alias&&-1!=this._tile.alias.indexOf(t))&&e.push(this._tile);return e},n.prototype.getTilesByTag=function(t){for(var e=[],i=0;i<this._renderComponent.rows;i++)for(var n=0;n<this._renderComponent.cols;n++)this._tile=this._tiles[i*this._cols+n],this._tile.tag===t&&e.push(this._tile);return e},n.prototype.getTilesByType=function(t){for(var e=[],i=0;i<this._renderComponent.rows;i++)for(var n=0;n<this._renderComponent.cols;n++)this._tile=this._tiles[i*this._cols+n],this._typeManager.doTypesOverlap(t,this._tile.type)&&e.push(this._tile);return e},n.prototype.queryCircle=function(e,i,n){"undefined"==typeof n&&(n=null);var o=[];if(this._rect.setTo(e.x-i,e.y-i,2*i,2*i),this.querySection(this._rect,0,this._cols,0,this._rows)){this._tr=this.clamp(Math.floor((this._rect.top-this.y)/this._tileHeight),0,this._rows),this._br=this.clamp(Math.ceil((this._rect.bottom-this.y)/this._tileHeight),0,this._rows),this._lc=this.clamp(Math.floor((this._rect.left-this.x)/this._tileWidth),0,this._cols),this._rc=this.clamp(Math.ceil((this._rect.right-this.x)/this._tileWidth),0,this._cols),this._sr=i*i;for(var r=this._tr;r<this._br;r++)for(var s=this._lc;s<this._rc;s++)this._tile=this._tiles[r*this._cols+s],this._tile&&n&&this._tile.type&&!this._typeManager.doTypesOverlap(n,this._tile.type)||(r==this._tr||r==this._br-1||s==this._lc||s==this._rc-1)&&(this._pt=this.getClosestPoint(this._tile,e),t.GeomUtil.getDistanceSquared(this._pt.x,this._pt.y,e.x,e.y)>this._sr)||o.push(this._tile)}return o},n.prototype.queryRectangle=function(t,e){"undefined"==typeof e&&(e=null);var i=[];if(this.querySection(t,0,this._cols,0,this._rows)){this._tr=this.clamp(Math.floor((t.top-this.y)/this._tileHeight),0,this._rows),this._br=this.clamp(Math.ceil((t.bottom-this.y)/this._tileHeight),0,this._rows),this._lc=this.clamp(Math.floor((t.left-this.x)/this._tileWidth),0,this._cols),this._rc=this.clamp(Math.ceil((t.right-this.x)/this._tileWidth),0,this._cols);for(var n=this._tr;n<this._br;n++)for(var o=this._lc;o<this._rc;o++)this._tile=this._tiles[n*this._cols+o],this._tile&&e&&this._tile.type&&!this._typeManager.doTypesOverlap(e,this._tile.type)||i.push(this._tile)}return DEBUG&&this._checks++,i},n.prototype.queryPoint=function(t,e){"undefined"==typeof e&&(e=null);var i;return this._r=Math.floor(t.y/this._tileHeight),this._c=Math.floor(t.x/this._tileWidth),this._r<this._rows&&this._c<this._cols&&this._r>=0&&this._c>=0&&(i=this._tiles[this._r*this._cols+this._c]),DEBUG&&this._checks++,i&&e&&i.type&&!this._typeManager.doTypesOverlap(e,i.type)?null:i},n.prototype.queryPosition=function(t,e,i){"undefined"==typeof i&&(i=null);var n;return this._r=Math.floor(e/this._tileHeight),this._c=Math.floor(t/this._tileWidth),this._r<this._rows&&this._c<this._cols&&this._r>=0&&this._c>=0&&(n=this._tiles[this._r*this._cols+this._c]),DEBUG&&this._checks++,n&&i&&n.type&&!this._typeManager.doTypesOverlap(i,n.type)?null:n},n.prototype.querySection=function(t,e,i,n,o){return this._lc=this.x+e*this._tileWidth,this._rc=this._lc+i*this._tileWidth,this._tr=this.y+n*this._tileHeight,this._br=this._tr+o*this._tileWidth,t.top<this._br&&t.bottom>this._tr&&t.left<this._rc&&t.right>this._lc},n.prototype.queryLine=function(e,i,n){var o=[],r=!1,s=i.y-e.y,a=i.x-e.x;(s^s>>31)-(s>>31)>(a^a>>31)-(a>>31)&&(s^=a,a^=s,s^=a,r=!0);var h,l=0>a?-1:1,c=0==a?s:s/a;if(r)for(h=0;h!=a;h+=l)this._pt.x=e.x+h*c,this._pt.y=e.y+h,this._tile=this.queryPoint(this._pt,n),this._tile&&o.push(new t.RayResult(this._tile,this._pt,h/a));else for(h=0;h!=a;h+=l)this._pt.x=e.x+h,this._pt.y=e.y+h*c,this._tile=this.queryPoint(this._pt,n),this._tile&&o.push(new t.RayResult(this._tile,this._pt,h/a));return DEBUG&&this._checks++,o},n.prototype.castRay=function(t,e,i){this._rayResult.clear();var n=!1,o=e.y-t.y,r=e.x-t.x;(o^o>>31)-(o>>31)>(r^r>>31)-(r>>31)&&(o^=r,r^=o,o^=r,n=!0);var s,a=0>r?-1:1,h=0==r?o:o/r,l=Math.floor(r);if(n){for(s=0;s!=l;s+=a)if(this._pt.x=t.x+s*h,this._pt.y=t.y+s,this._tile=this.queryPoint(this._pt,i),this._tile){this._rayResult.element=this._tile,this._rayResult.position=this._pt,this._rayResult.time=s/r;break}}else for(s=0;s!=l;s+=a)if(this._pt.x=t.x+s,this._pt.y=t.y+s*h,this._tile=this.queryPoint(this._pt,i),this._tile){this._rayResult.element=this._tile,this._rayResult.position=this._pt,this._rayResult.time=s/r;break}return DEBUG&&this._checks++,this._rayResult},n.prototype.getClosestPoint=function(e,i){this._result.x=this.x+e.col*this._tileSet.tileWidth,this._result.y=this.y+e.row*this._tileSet.tileHeight;var n=this._result.x+this._tileSet.tileWidth,o=this._result.y+this._tileSet.tileHeight;return t.MathUtil.isInRange(i.x,this._result.x,n)?this._result.x=i.x:Math.abs(n-i.x)<Math.abs(this._result.x-i.x)&&(this._result.x=n),t.MathUtil.isInRange(i.y,this._result.y,o)?this._result.y=i.y:Math.abs(o-i.y)<Math.abs(this._result.y-i.y)&&(this._result.y=o),this._result},n.prototype.destroy=function(){this._rayResult.destroy(),e.prototype.destroy.call(this),this._canvas=null,this._renderComponent=null,this._renderManager=null,this._typeManager=null,this._tiles=null,this._tileSet=null,this._data=null,this._rayResult=null,this._tile=null,this._pt=null,this._result=null,this._rect=null},n.prototype.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t
},n}(t.GameEntity);t.TileMap=e;var i=function(){function t(){}return t.TILED_JSON="tiled",t.JSON="json",t}();t.TileMapFormat=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a,h){if(e.call(this,o,r,a,n),this._inputManager=s,this.inputOver=new t.Signal,this.inputOut=new t.Signal,this.inputDown=new t.Signal,this.inputUp=new t.Signal,this._labelOffsetX=0,this._labelOffsetY=0,this._label=this.create(t.TextGraphic,this._timeManager,this._renderManager,{text:" "}),h){h.hasOwnProperty("disabled")&&this.addAnimation(i.DISABLED,a.name,h.disabled.prefix,h.disabled.duration||1e3,h.disabled.repeat||-1),h.hasOwnProperty("down")&&this.addAnimation(i.DOWN,a.name,h.down.prefix,h.down.duration||1e3,h.down.repeat||-1),h.hasOwnProperty("over")&&this.addAnimation(i.OVER,a.name,h.over.prefix,h.over.duration||1e3,h.over.repeat||-1),h.hasOwnProperty("out")&&this.addAnimation(i.OUT,a.name,h.over.prefix,h.over.duration||1e3,h.over.repeat||-1),h.hasOwnProperty("up")&&(this.addAnimation(i.UP,a.name,h.up.prefix,h.up.duration||1e3,h.up.repeat||-1),this.play(i.UP)),h.hasOwnProperty("label")&&(h.label.hasOwnProperty("style")&&this._label.setStyle(h.label.style),h.label.hasOwnProperty("outline")&&(this._label.outline=h.label.outline),h.label.hasOwnProperty("outlineStrength")&&(this._label.outlineStrength=h.label.outlineStrength),h.label.hasOwnProperty("outlineColor")&&(this._label.outlineColor=h.label.outlineColor),h.label.hasOwnProperty("shadow")&&(this._label.shadow=h.label.shadow),h.label.hasOwnProperty("shadowStrength")&&(this._label.shadowStrength=h.label.shadowStrength),h.label.hasOwnProperty("shadowColor")&&(this._label.shadowColor=h.label.shadowColor),h.label.hasOwnProperty("shadowOffsetX")&&(this._label.shadowOffsetX=h.label.shadowOffsetX),h.label.hasOwnProperty("shadowOffsetY")&&(this._label.shadowOffsetY=h.label.shadowOffsetY),h.label.hasOwnProperty("italic")&&(this._label.italic=h.label.italic),h.label.hasOwnProperty("bold")&&(this._label.bold=h.label.bold),h.label.hasOwnProperty("color")&&(this._label.color=h.label.color),h.label.hasOwnProperty("size")&&(this._label.size=h.label.size),h.label.hasOwnProperty("font")&&(this._label.font=h.label.font),h.label.hasOwnProperty("text")&&(this._label.text=h.label.text),h.label.hasOwnProperty("offsetX")&&(this.labelOffsetX=h.label.offsetX),h.label.hasOwnProperty("offsetY")&&(this.labelOffsetY=h.label.offsetY));for(var l in h)void 0!=this[l]&&(this[l]=h[l])}this.addChild(this._label),this._updateLabel(),this._enabled=!1,this._inputManager&&this._createInputComponent()}return __extends(i,e),i.UP="up",i.DOWN="down",i.OVER="over",i.OUT="out",i.DISABLED="disabled",Object.defineProperty(i.prototype,"hitArea",{get:function(){return this._inputComponent.hitArea},set:function(t){this._inputComponent.hitArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ignoreTransparency",{get:function(){return this._inputComponent.ignoreTransparency},set:function(t){this._inputComponent.ignoreTransparency=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useHandCursor",{get:function(){return this._inputComponent.useHandCursor},set:function(t){this._inputComponent.useHandCursor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textLabel",{get:function(){return this._label},set:function(t){this._label=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"labelShadow",{get:function(){return this._label.shadow},set:function(t){this._label.shadow=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"labelShadowColor",{get:function(){return this._label.shadowColor},set:function(t){this._label.shadowColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"labelShadowStrength",{get:function(){return this._label.shadowStrength},set:function(t){this._label.shadowStrength=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"labelOffsetX",{get:function(){return this._labelOffsetX},set:function(t){this._labelOffsetX=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"labelOffsetY",{get:function(){return this._labelOffsetY},set:function(t){this._labelOffsetY=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"active",{get:function(){return this._enabled},set:function(t){this.enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t,this._inputComponent.enabled=t,this._enabled?void 0!=this.getAnimation(i.UP)&&this.play(i.UP):void 0!=this.getAnimation(i.DISABLED)&&this.play(i.DISABLED)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._renderComponent.visible},set:function(t){this._renderComponent.visible=t,t||(this.enabled=t),this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._renderComponent.alpha},set:function(t){this._renderComponent.alpha=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._renderComponent.x},set:function(t){this._renderComponent.x=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._renderComponent.y},set:function(t){this._renderComponent.y=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._renderComponent.centerX},set:function(t){this._renderComponent.centerX=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._renderComponent.centerY},set:function(t){this._renderComponent.centerY=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._renderComponent.scale},set:function(t){this._renderComponent.scale=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._renderComponent.scaleX},set:function(t){this._renderComponent.scaleX=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._renderComponent.scaleY},set:function(t){this._renderComponent.scaleY=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._renderComponent.rotation},set:function(t){this._renderComponent.rotation=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._renderComponent.top},set:function(t){this._renderComponent.top=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._renderComponent.left},set:function(t){this._renderComponent.left=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._renderComponent.right},set:function(t){this._renderComponent.right=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._renderComponent.bottom},set:function(t){this._renderComponent.bottom=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._renderComponent.layerIndex},set:function(t){this._renderComponent.layerIndex=t,this._updateLabel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._renderComponent.zIndex},set:function(t){this._renderComponent.zIndex=t,this._updateLabel()},enumerable:!0,configurable:!0}),i.prototype._createInputComponent=function(){this._inputComponent=this.create(t.InputComponent,this._inputManager),this._inputComponent.inputDown.add(this.onDown,this),this._inputComponent.inputUp.add(this.onUp,this),this._inputComponent.inputOver.add(this.onOver,this),this._inputComponent.inputOut.add(this.onOut,this),this.addComponent(this._inputComponent,t.EngineConstants.INPUT)},i.prototype._updateLabel=function(){this._label&&(this._label.centerX=this.halfWidth+this._labelOffsetX,this._label.centerY=this.halfHeight+this._labelOffsetY,this._label.alpha=this.alpha,this._label.visible=this.visible,this._label.layerIndex=this.layerIndex,this._label.zIndex=this.zIndex+1)},i.prototype.onDown=function(t,e,n,o){this._enabled&&(void 0!=this.getAnimation(i.DOWN)?this.play(i.DOWN):void 0!=this.getAnimation(i.OVER)&&this.play(i.OVER),this.inputDown.dispatch(this,i.DOWN,o))},i.prototype.onUp=function(t,e,n,o){this._enabled&&(void 0!=this.getAnimation(i.UP)&&this.play(i.UP),this.inputUp.dispatch(this,i.UP,o))},i.prototype.onOver=function(t,e,n,o){this._enabled&&(void 0!=this.getAnimation(i.OVER)&&this.play(i.OVER),this.inputOver.dispatch(this,i.OVER,o))},i.prototype.onOut=function(t,e,n,o){this._enabled&&(void 0!=this.getAnimation(i.UP)&&this.play(i.UP),this.inputOut.dispatch(this,i.OUT,o))},i.prototype.destroy=function(){this.inputOver.removeAll(),this.inputOut.removeAll(),this.inputDown.removeAll(),this.inputUp.removeAll(),e.prototype.destroy.call(this),this.inputOver=null,this.inputOut=null,this.inputDown=null,this.inputUp=null,this._label=null,this._inputComponent=null,this._inputManager=null},i}(t.AnimatedGraphic);t.Button=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r){"undefined"==typeof o&&(o=null),"undefined"==typeof r&&(r=i.NAME),e.call(this,r),this._scene=n,this._strings=o?JSON.parse(JSON.stringify(o)):null,this._layerIndex=i.LAYERINDEX,this.buttonSignal=new t.Signal,this.globalTimeManager.preTick.addOnce(this._init,this)}return __extends(i,e),i.NAME="GameUI",i.LAYERINDEX=t.EngineConstants.LAYERINDEX_GAMEUI,i.UI_TEXT="UIText",i.SCENE_TEXT="SceneText",i.GLOBAL_TEXT="GlobalText",Object.defineProperty(i.prototype,"strings",{get:function(){return this._strings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalConfig",{get:function(){return this._scene.globalConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalStrings",{get:function(){return this._scene.globalStrings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeManager",{get:function(){return this._timeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sceneTimeManager",{get:function(){return this._scene.timeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalTimeManager",{get:function(){return this._scene.globalTimeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sceneManager",{get:function(){return this._scene.sceneManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"resourceManager",{get:function(){return this._scene.resourceManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soundManager",{get:function(){return this._scene.soundManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"objectPool",{get:function(){return this._scene.objectPool},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sharedData",{get:function(){return this._scene.sharedData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"typeManager",{get:function(){return this._scene.typeManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputManager",{get:function(){return this._scene.inputManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inputMap",{get:function(){return this._scene.inputMap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spatialManager",{get:function(){return this._scene.spatialManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderManager",{get:function(){return this._scene.renderManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"camera",{get:function(){return this._scene.renderManager.camera},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenCenterX",{get:function(){return this._scene.screenCenterX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenCenterY",{get:function(){return this._scene.screenCenterY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenWidth",{get:function(){return this._scene.screenWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"screenHeight",{get:function(){return this._scene.screenHeight},enumerable:!0,configurable:!0}),i.prototype._onCreate=function(){e.prototype._onCreate.call(this),this._timeManager=this.globalTimeManager.getTimeManager(this.name+t.TimeManager.NAME,-1),this._timeManager.addTickedObject(this,0),this._timeManager.start(),this._messagePool=this.create(t.ObjectPool,"MessagePool"),this._messagePool.allocate(t.TextGraphic,[this.timeManager,this.renderManager],2,this,!0,i.UI_TEXT),this._messagePool.allocate(t.TextGraphic,[this.sceneTimeManager,this.renderManager],2,this,!0,i.SCENE_TEXT),this._messagePool.allocate(t.TextGraphic,[this.globalTimeManager,this.renderManager],2,this,!0,i.GLOBAL_TEXT),this._messages=[]},i.prototype._init=function(){this._strings&&this.localize(this._strings),this._scene.globalStrings&&this._scene.globalStrings.hasOwnProperty("buttons")&&this.localizeButtons(this._scene.globalStrings.buttons),this.renderManager.getLayer(i.LAYERINDEX,!0).cameraTransformOptions=t.TransformOptions.NONE,this.soundManager.muteSignal.add(this._onMuted,this),this._onMuted(),this._scene.pauseSignal.add(this._onPaused,this)},i.prototype._buttonHandler=function(e,i,n){switch(i){case t.Button.UP:LOGGING&&this._log.trace("{BUTTON_UP | "+e.name+"}");break;case t.Button.OVER:LOGGING&&this._log.trace("{BUTTON_OVER | "+e.name+"}");break;case t.Button.OUT:LOGGING&&this._log.trace("{BUTTON_OUT | "+e.name+"}");break;case t.Button.DOWN:LOGGING&&this._log.trace("{BUTTON_DOWN | "+e.name+"}")}this.destroyed||this.buttonSignal.dispatch(e,i,n)},i.prototype.onTick=function(){},i.prototype.showMessage=function(t,e,n,o,r,s,a){"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o=null),"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=null),"undefined"==typeof a&&(a=i.UI_TEXT);var h=this._messagePool.getObject(a);return h.data||(h.data={}),h.data.__type__=a,h.visible=!0,h.layerIndex=e.layerIndex||this._layerIndex,h.zIndex=e.zIndex||0,h.alpha=e.alpha||1,e.style?h.setStyle(e.style):(h.font=e.font,h.size=e.size,h.color=e.color,h.bold=e.bold||!1,h.italic=e.italic||!1),e.color&&(h.color=e.color),e.rotation&&(h.rotation=e.rotation),e.scale&&(h.scaleX=e.scale,h.scaleY=e.scale),e.outline&&(h.outline=e.outline,h.outlineStrength=e.outlineStrength||1,h.outlineColor=e.outlineColor||"#000000"),e.shadow&&(h.shadow=e.shadow,h.shadowStrength=e.shadowStrength||0,h.shadowColor=e.shadowColor||"#000000",h.shadowOffsetX=e.shadowOffsetX||0,h.shadowOffsetY=e.shadowOffsetY||0),h.gradient=e.gradient?e.gradient:null,h.text=" "+t+" ",o?(h.centerX=o.x,h.centerY=o.y,o=null):(h.centerX=this.screenCenterX,h.centerY=this.screenCenterY),e.offset&&(e.offset.x&&(h.centerX+=e.offset.x),e.offset.y&&(h.centerY+=e.offset.y)),h.registrationX=h.halfWidth,h.registrationY=h.halfHeight,this._messages.push(h),LOGGING&&this._log.trace("{MESSAGE | "+t+"}"),this._displayMessage(h,n,r,e.delay||0,s),h},i.prototype._displayMessage=function(t,e,i,n,o){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=null);var r=this,s=new TimelineMax({delay:n,onComplete:function(t,e){return"undefined"==typeof e&&(e=null),r._onMessageComplete(t,o)},onCompleteParams:[t,o]});t.data.timeline=s},i.prototype._onMessageComplete=function(t,e){"undefined"==typeof e&&(e=null),t&&!t.destroyed&&(t.data&&t.data.timeline&&(t.data.timeline=null),t.visible=!1,t.alpha=1,t.scaleX=1,t.scaleY=1,t.rotation=0,t.centerX=-1e3,t.centerY=-1e3,t.clear(),t.outline=!1,t.shadow=!1,this._messages.splice(this._messages.indexOf(t),1),this._messagePool.releaseObject(t,t.data.__type__),null!=e&&e.apply())},i.prototype._onMuted=function(t){"undefined"==typeof t&&(t=!1)},i.prototype._onPaused=function(t){"undefined"==typeof t&&(t=!1),t?this._timeManager.stop():this._timeManager.start()},i.prototype.enableButton=function(e,i){"undefined"==typeof i&&(i=1),e.inputUp.add(this._buttonHandler,this),e.inputOver.add(this._buttonHandler,this),e.inputDown.add(this._buttonHandler,this),e.inputOut.add(this._buttonHandler,this),e.enabled=!0,e.visible=!0,e.alpha=i,e.play(t.Button.UP)},i.prototype.disableButton=function(t,e){"undefined"==typeof e&&(e=1),t.inputUp.remove(this._buttonHandler,this),t.inputOver.remove(this._buttonHandler,this),t.inputDown.remove(this._buttonHandler,this),t.inputOut.remove(this._buttonHandler,this),t.enabled=!1,t.alpha=e},i.prototype.enableButtons=function(e){"undefined"==typeof e&&(e=1);for(var i,n=this.getByType(t.Button),o=0,r=n.length;r>o;o++)i=n[o],i&&this.enableButton(i,e)},i.prototype.disableButtons=function(e){"undefined"==typeof e&&(e=1);for(var i,n=this.getByType(t.Button),o=0,r=n.length;r>o;o++)i=n[o],i&&this.disableButton(i,e)},i.prototype.enableButtonSet=function(t,e){"undefined"==typeof e&&(e=1);for(var i,n=0,o=t.length;o>n;n++)i=t[n],i&&this.enableButton(i,e)},i.prototype.disableButtonSet=function(t,e){"undefined"==typeof e&&(e=1);for(var i,n=0,o=t.length;o>n;n++)i=t[n],i&&this.disableButton(i,e)},i.prototype.setLabel=function(t,e){this.get(t).text=e},i.prototype.show=function(t){this.get(t).visible=!0},i.prototype.hide=function(t){this.get(t).visible=!1},i.prototype.mute=function(t){"undefined"==typeof t&&(t=1),1==t&&this.soundManager.mute()},i.prototype.toggleMute=function(t,e){this.soundManager.mute(),this.checkMute(t,e)},i.prototype.checkMute=function(t,e){var i=this.get(e),n=this.get(t);i&&n&&(this.soundManager.isMuted?(n.visible=!0,n.active=!0,i.visible=!1,i.active=!1):(i.visible=!0,i.active=!0,n.visible=!1,n.active=!1))},i.prototype.transitionIn=function(e,i,n,o,r,s,a,h,l){"undefined"==typeof e&&(e="#000000"),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n="circle"),"undefined"==typeof o&&(o="in"),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=null),"undefined"==typeof h&&(h=null),"undefined"==typeof l&&(l=null);var c=new t.Transition(this._timeManager,this.renderManager,{color:e,width:this.screenWidth,height:this.screenHeight});c.start({type:n,delay:s,direction:o,position:r,duration:i,ease:l||Sine.easeOut,onComplete:a,onCompleteParams:h})},i.prototype.transitionOut=function(e,i,n,o,r,s,a,h,l){"undefined"==typeof e&&(e="#000000"),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n="circle"),"undefined"==typeof o&&(o="out"),"undefined"==typeof r&&(r=null),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=null),"undefined"==typeof h&&(h=null),"undefined"==typeof l&&(l=null);var c=new t.Transition(this._timeManager,this.renderManager,{color:e,width:this.screenWidth,height:this.screenHeight});c.start({type:n,delay:s,direction:o,position:r,duration:i,ease:l||Sine.easeOut,onComplete:a,onCompleteParams:h})},i.prototype.blink=function(t,e,i,n){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=.25),"undefined"==typeof n&&(n=!1),this.renderManager.getLayer(this._layerIndex,!0).blink(t,e,i,n)},i.prototype.stopBlink=function(){this.renderManager.getLayer(this._layerIndex,!0).stopBlink()},i.prototype.shake=function(t,e,i){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=1e3),"undefined"==typeof i&&(i=2),this.renderManager.getLayer(this._layerIndex,!0).shake(t,e,i)},i.prototype.stopShake=function(){this.renderManager.getLayer(this._layerIndex,!0).stopShake()},i.prototype.localizeButtons=function(e){for(var i=this.getByType(t.Button),n=0,o=i.length;o>n;n++)for(var r=0,s=e.length;s>r;r++)i[n].name==e[r].name&&(i[n].textLabel.text=e[r].value,e[r].style&&i[n].textLabel.setStyle(e[r].style))},i.prototype.localize=function(e){this.localizeButtons(e);for(var i=this.getByType(t.TextGraphic),n=0,o=i.length;o>n;n++)for(var r=0,s=e.length;s>r;r++)i[n].name==e[r].name&&(i[n].text=e[r].value,e[r].style&&i[n].setStyle(e[r].style))},i.prototype.killAllTweens=function(){for(var t,e=this.getAll(),i=0;i<e.length;i++)t=e[i],TweenMax.killTweensOf(t);TweenMax.killTweensOf(this)},i.prototype.destroy=function(){this.killAllTweens(),this._timeManager.stop(),this.soundManager.muteSignal.remove(this._onMuted,this),this._scene.pauseSignal.remove(this._onPaused,this),this.buttonSignal.removeAll(),e.prototype.destroy.call(this),this.globalTimeManager.releaseTimeManager(this._timeManager),this.buttonSignal=null,this._scene=null,this._timeManager=null},i}(t.Entity);t.GameUI=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r){"undefined"==typeof o&&(o=null),"undefined"==typeof r&&(r=i.NAME),e.call(this,n,o,r),this._layerIndex=i.LAYERINDEX_OVERLAY,this.callbackSignal=new t.Signal}return __extends(i,e),i.NAME="GameUIOverlay",i.LAYERINDEX_OVERLAY=t.EngineConstants.LAYERINDEX_GAMEUI_OVERLAY,i.LAYERINDEX_UNDERLAY=t.EngineConstants.LAYERINDEX_GAMEUI_UNDERLAY,i.prototype._init=function(){this._strings&&this.localize(this._strings),this._scene.globalStrings&&this._scene.globalStrings.hasOwnProperty("buttons")&&this.localizeButtons(this._scene.globalStrings.buttons),this.renderManager.getLayer(i.LAYERINDEX_OVERLAY,!0).cameraTransformOptions=t.TransformOptions.NONE,this.renderManager.getLayer(i.LAYERINDEX_UNDERLAY,!0).cameraTransformOptions=t.TransformOptions.NONE,this.soundManager.muteSignal.add(this._onMuted,this),this._onMuted(),this._scene.pauseSignal.add(this._onPaused,this),this.hideOverlay(null,!1)},i.prototype.showOverlay=function(e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=.5);var o,r=this,s=this.getAll();if(i)for(var a=new TimelineMax({onComplete:function(){return r._onShowComplete(e)},onCompleteParams:[e]}),h=0;h<s.length;h++)o=s[h],!o instanceof t.GameEntity||(o.active=!0,o.visible=!0,a.insert(TweenMax.from(o,n,{alpha:0})));else{for(var h=0;h<s.length;h++)o=s[h],!o instanceof t.GameEntity||(o.active=!0,o.visible=!0);this._timeManager.callLater(function(){return r._onShowComplete(e)})}this.enableButtons(),this.soundManager.muteSignal.add(this._onMuted,this),this._onMuted(),this._scene.pauseSignal.add(this._onPaused,this)},i.prototype._onShowComplete=function(t){t&&t.apply()},i.prototype.hideOverlay=function(e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=.5);var o,r=this,s=this.getAll();if(i)for(var a=new TimelineMax({onComplete:function(){return r._onHideComplete(e)},onCompleteParams:[e]}),h=0;h<s.length;h++)o=s[h],!o instanceof t.GameEntity||(o.active=!1,a.insert(TweenMax.to(o,n,{alpha:0,onComplete:function(){return r.hide(o.name)},onCompleteParams:[o.name]})));else{for(var h=0;h<s.length;h++)o=s[h],!o instanceof t.GameEntity||(o.active=!1,o.visible=!1);this._timeManager.callLater(function(){return r._onHideComplete(e)})}this.disableButtons(),this.soundManager.muteSignal.remove(this._onMuted,this),this._scene.pauseSignal.remove(this._onPaused,this)},i.prototype._onHideComplete=function(t){t&&t.apply()},i.prototype.destroy=function(){this.callbackSignal.removeAll(),e.prototype.destroy.call(this),this.callbackSignal=null},i}(t.GameUI);t.GameUIOverlay=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,n,o,r){if("undefined"==typeof r&&(r=i.NAME),e.call(this,t,n,1,1,r),this._italic=!1,this._bold=!1,this._color="rgb(255,255,255)",this._size=8,this._font="sans-serif",this._margin=0,this._outline=!1,this._outlineStrength=4,this._outlineColor="rgb(0,0,0)",this._shadow=!1,this._shadowStrength=12,this._shadowColor="rgb(0,0,0)",this._shadowOffsetX=0,this._shadowOffsetY=0,this._text=" ",this._align=i.ALIGN_LEFT,this._lineJoin="miter",this._miterLimit=2,this._cx=-1,this._cy=-1,this._b=-1,this._r=-1,this._t=-1,this._l=-1,this._dirty=!0,this._cXDirty=!1,this._cYDirty=!1,this._bDirty=!1,this._rDirty=!1,this._tDirty=!1,this._lDirty=!1,o){o.hasOwnProperty("style")&&this.setStyle(o.style);for(var s in o)void 0!=this[s]&&(this[s]=o[s])}this.enableOnTick()}return __extends(i,e),i.NAME="TextGraphic",i.ALIGN_LEFT="left",i.ALIGN_RIGHT="right",i.ALIGN_CENTER="center",i._heightCache={},Object.defineProperty(i.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._t},set:function(t){this._t=t,this._tDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._l},set:function(t){this._l=t,this._lDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._r},set:function(t){this._r=t,this._rDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._b},set:function(t){this._b=t,this._bDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._cx},set:function(t){this._cx=t,this._cXDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._cy},set:function(t){this._cy=t,this._cYDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){this._text!=t&&(this._text=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin!=t&&(this._margin=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!=t&&(this._lineHeight=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth!=t&&(this._lineWidth=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"font",{get:function(){return this._font},set:function(t){this._font!=t&&(this._font=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this._size},set:function(t){this._size!=t&&(this._size=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"align",{get:function(){return this._align},set:function(t){this._align!=t&&(this._align=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this._gradient=null,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gradient",{get:function(){return this._gradient},set:function(t){this._gradient!=t&&(this._gradient=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bold",{get:function(){return this._bold},set:function(t){this._bold!=t&&(this._bold=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"italic",{get:function(){return this._italic},set:function(t){this._italic!=t&&(this._italic=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outline",{get:function(){return this._outline},set:function(t){this._outline!=t&&(this._outline=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outlineStrength",{get:function(){return this._outlineStrength},set:function(t){this.outlineStrength!=t&&(this._outlineStrength=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this.outlineColor!=t&&(this._outlineColor=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadow",{get:function(){return this._shadow},set:function(t){this._shadow!=t&&(this._shadow=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowStrength",{get:function(){return this._shadowStrength},set:function(t){this.shadowStrength!=t&&(this._shadowStrength=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this.shadowColor!=t&&(this._shadowColor=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(t){this.shadowOffsetX!=t&&(this._shadowOffsetX=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(t){this.shadowOffsetY!=t&&(this._shadowOffsetY=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!=t&&(this._lineJoin=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!=t&&(this._miterLimit=t,this._dirty=!0)},enumerable:!0,configurable:!0}),i.prototype.clear=function(){this._text=" ",e.prototype.clear.call(this)},i.prototype.setStyle=function(e){var i=t.DOMUtil.getStyle(e);"bold"==i["font-weight"]&&(this.bold=!0),"normal"==i["font-weight"]&&(this.bold=!1),"bold"==i.fontWeight&&(this.bold=!0),"normal"==i.fontWeight&&(this.bold=!1),"italic"==i["font-style"]&&(this.italic=!0),"italic"==i.fontStyle&&(this.italic=!0),"normal"==i["font-style"]&&(this.italic=!1),"normal"==i.fontStyle&&(this.italic=!1),i["font-size"]&&(this.size=parseInt(i["font-size"])),i.fontSize&&(this.size=parseInt(i.fontSize)),i["font-family"]&&(this.font=i["font-family"]),i.fontFamily&&(this.font=i.fontFamily),i.color&&(this.color=i.color),i["text-align"]&&(this.align=i["text-align"]),i.textAlign&&(this.align=i.textAlign),i["line-height"]&&(this.lineHeight=parseInt(i["line-height"])),i.lineHeight&&(this.lineHeight=parseInt(i.lineHeight)),i.width&&(this.lineWidth=parseInt(i.width)),i.margin&&(this.margin=parseInt(i.margin)),i["outline-color"]&&(this.outline=!0,this.outlineColor=i["outline-color"]),i.outlineColor&&(this.outline=!0,this.outlineColor=i.outlineColor),i["outline-width"]&&(this.outline=!0,this.outlineStrength=parseInt(i["outline-width"])),i.outlineWidth&&(this.outline=!0,this.outlineStrength=parseInt(i.outlineWidth));i["text-shadow"]||i.textShadow;i.left&&(this.left=parseInt(i.left)),i.right&&(this.right=parseInt(i.right)),i.top&&(this.top=parseInt(i.top)),i.bottom&&(this.bottom=parseInt(i.bottom))},i.prototype.animateOn=function(e,i){"undefined"==typeof i&&(i=0);var n=this;this._text&&(this.animateCompleteSignal||(this.animateCompleteSignal=new t.Signal),this._charIndex=0,this._characters=this._text.split(""),this.clear(),this._displayTimer||(this._displayTimer=this.create(t.Timer,this._timeManager),this._displayTimer.timerSignal.add(this._onDisplayCharacter,this),this._displayTimer.completeSignal.add(this._onDisplayComplete,this)),this._displayTimer.reset(),this._displayTimer.delay=e,this._displayTimer.repeatCount=this._characters.length,this._timeManager.callLater(function(){return n._displayTimer.start()},i))},i.prototype.stopAnimate=function(t){"undefined"==typeof t&&(t=!0),this._displayTimer.reset(),t&&this._onDisplayComplete()},i.prototype._onDisplayCharacter=function(){this.text+=this._characters[this._charIndex++]},i.prototype._onDisplayComplete=function(){this.animateCompleteSignal.dispatch()},i.prototype.onTick=function(){this._dirty&&this.draw(),this._cXDirty&&(this._renderComponent.centerX=this._cx,this._cXDirty=!1),this._cYDirty&&(this._renderComponent.centerY=this._cy,this._cYDirty=!1),this._rDirty&&(this._renderComponent.right=this._r,this._rDirty=!1),this._bDirty&&(this._renderComponent.bottom=this._b,this._bDirty=!1),this._tDirty&&(this._renderComponent.top=this._t,this._tDirty=!1),this._lDirty&&(this._renderComponent.left=this._l,this._lDirty=!1)
},i.prototype.draw=function(){if(this._text&&0!==this._text.length){if(this._css="",this.italic&&(this._css+="italic "),this.bold&&(this._css+="bold "),this._css+=this._size+"pt ",this._css+=this._font,this._renderContext.font=this._css,this._buffer=0,this._outline&&(this._buffer+=.5*this._outlineStrength),this._shadow&&(this._buffer+=.5*this._shadowStrength),this._lines=this._text.split(/(?:\r\n|\r|\n)/),this._lineWidth){for(var e=0,n=0,o=this._lines.length;o>n;n++)e=this._renderContext.measureText(this._lines[n]).width,this._lines[n]=this.wordWrap(this._lines[n],Math.ceil(this._lineWidth/Math.ceil(Math.ceil(e+10*this._margin)/Math.ceil(this._lines[n].length))));this._lines=this._lines.join("\n").split(/(?:\r\n|\r|\n)/)}for(var r=[],e=0,s=0,n=0,o=this._lines.length;o>n;n++)e=this._renderContext.measureText(this._lines[n]).width,r[n]=e,e>s&&(s=e);var a=this._lineHeight||this.getFontHeight("font: "+this._css+";"),h=a*this._lines.length;if(s=this._lineWidth?this._lineWidth:s,this.width=Math.floor(s),this.height=Math.floor(h),this.registrationX=this.halfWidth,this.registrationY=this.halfHeight,this._outline&&(this.width+=this._outlineStrength,this.height+=this._outlineStrength),this._shadow&&(this.width+=this._shadowStrength+this._shadowOffsetX,this.height+=this._shadowStrength+this._shadowOffsetY),this.registrationX=.5*this.width,this.registrationY=.5*this.height,this._canvas.width=this.width,this._canvas.height=this.height,this._renderComponent._renderRect.width=this.width,this._renderComponent._renderRect.height=this.height,this._renderContext.lineJoin=this._lineJoin,this._renderContext.miterLimit=this._miterLimit,this._renderContext.font=this._css,this._renderContext.textBaseline="bottom",this._shadow&&(this._renderContext.shadowColor=this._shadowColor,this._renderContext.shadowBlur=this._shadowStrength,this._renderContext.shadowOffsetX=this._shadowOffsetX,this._renderContext.shadowOffsetY=this._shadowOffsetY),null==this._gradient||t.EnvUtil.isSafari||t.EnvUtil.isWebApp)this._renderContext.fillStyle=this._color;else{var l=0;this._gradientContext=this._renderContext.createLinearGradient(0,0,0,this.height);for(var o=0;o<this._gradient.length;o++)this._gradient[o].position=this._gradient[o].position/this._lines.length;for(var n=0;n<this._lines.length;n++){for(var o=0;o<this._gradient.length;o++)this._gradientContext.addColorStop(this._gradient[o].position+l,this._gradient[o].color);l=this._gradient[o-1].position}this._renderContext.fillStyle=this._gradientContext}this._outline&&(this._renderContext.strokeStyle=this._outlineColor,this._renderContext.lineWidth=this._outlineStrength,this._renderContext.lineJoin="round");for(var c,n=0,o=this._lines.length;o>n;n++)c=this._buffer+this._shadowOffsetX,this._align==i.ALIGN_RIGHT&&(c+=s-r[n]),this._align==i.ALIGN_CENTER&&(c+=(s-r[n])/2),this._outline&&this._renderContext.strokeText(this._lines[n],c,this._buffer-this._shadowOffsetY+a*(n+1)),this._renderContext.fillText(this._lines[n],c,this._buffer-this._shadowOffsetY+a*(n+1));this._dirty=!1}},i.prototype.getFontHeight=function(t){var e=i._heightCache[t];if(!e){var n=document.getElementsByTagName("body")[0],o=document.createElement("div"),r=document.createTextNode("M");o.appendChild(r),o.setAttribute("style",t+";position:absolute;top:0;left:0"),n.appendChild(o),e=o.offsetHeight,i._heightCache[t]=e,n.removeChild(o)}return e},i.prototype.wordWrap=function(t,e,i,n){return"undefined"==typeof i&&(i="\n"),"undefined"==typeof n&&(n=!1),0==t.length?t:t.match(new RegExp(".{1,"+e+"}(\\s|$)"+(n?"|.{"+e+"}|.+$":"|\\S+?(\\s|$)"),"g")).join(i)},i.prototype.destroy=function(){this.animateCompleteSignal&&this.animateCompleteSignal.removeAll(),this._displayTimer&&this._displayTimer.reset(),e.prototype.destroy.call(this),this.animateCompleteSignal=null,this._lines=null,this._color=null,this._gradient=null,this._displayTimer=null,this._characters=null,this._gradientContext=null},i}(t.CanvasGraphic);t.TextGraphic=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n,o,r){if(n._timeManager!==o._timeManager)throw LOGGING&&this._log.error(n.name+" & "+o.name+" must have the same TimeManager."),new Error(n.name+" & "+o.name+" must have the same TimeManager.");e.call(this,n._timeManager,i),this._buttonA=n,this._buttonB=o,this.inputOver=new t.Signal,this.inputOut=new t.Signal,this.inputDown=new t.Signal,this.inputUp=new t.Signal,r&&r.hasOwnProperty("state")&&(this._state=r.state),this._buttonA.inputOver.add(this.buttonHandler,this),this._buttonA.inputOut.add(this.buttonHandler,this),this._buttonA.inputDown.add(this.buttonHandler,this),this._buttonA.inputUp.add(this.buttonHandler,this),this._buttonB.inputOver.add(this.buttonHandler,this),this._buttonB.inputOut.add(this.buttonHandler,this),this._buttonB.inputDown.add(this.buttonHandler,this),this._buttonB.inputUp.add(this.buttonHandler,this),this.setState(this._state)}return __extends(i,e),i.STATE_A=0,i.STATE_B=1,i.STATE_ON=i.STATE_A,i.STATE_OFF=i.STATE_B,Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{get:function(){switch(this._state){case i.STATE_A:return this._buttonA.enabled;case i.STATE_B:return this._buttonB.enabled}},set:function(t){switch(this._state){case i.STATE_A:this._buttonA.enabled=t;break;case i.STATE_B:this._buttonB.enabled=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){switch(this._state){case i.STATE_A:return this._buttonA.visible;case i.STATE_B:return this._buttonB.visible}},set:function(t){switch(this._state){case i.STATE_A:this._buttonA.visible=t;break;case i.STATE_B:this._buttonB.visible=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ignoreTransparency",{get:function(){return this._buttonA.ignoreTransparency},set:function(t){this._buttonA.ignoreTransparency=t,this._buttonB.ignoreTransparency=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useHandCursor",{get:function(){return this._buttonA.useHandCursor},set:function(t){this._buttonA.useHandCursor=t,this._buttonB.useHandCursor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._buttonA.alpha},set:function(t){this._buttonA.alpha=t,this._buttonB.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._buttonA.x},set:function(t){this._buttonA.x=t,this._buttonB.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._buttonA.y},set:function(t){this._buttonA.y=t,this._buttonB.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerX",{get:function(){return this._buttonA.centerX},set:function(t){this._buttonA.centerX=t,this._buttonB.centerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"centerY",{get:function(){return this._buttonA.centerY},set:function(t){this._buttonA.centerY=t,this._buttonB.centerY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._buttonA.scale},set:function(t){this._buttonA.scale=t,this._buttonB.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._buttonA.scaleX},set:function(t){this._buttonA.scaleX=t,this._buttonB.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._buttonA.scaleY},set:function(t){this._buttonA.scaleY=t,this._buttonB.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._buttonA.rotation},set:function(t){this._buttonA.rotation=t,this._buttonB.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._buttonA.top},set:function(t){this._buttonA.top=t,this._buttonB.top=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._buttonA.left},set:function(t){this._buttonA.left=t,this._buttonB.left=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._buttonA.right},set:function(t){this._buttonA.right=t,this._buttonB.right=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._buttonA.bottom},set:function(t){this._buttonA.bottom=t,this._buttonB.bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerIndex",{get:function(){return this._buttonA.layerIndex},set:function(t){this._buttonA.layerIndex=t,this._buttonB.layerIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zIndex",{get:function(){return this._buttonA.zIndex},set:function(t){this._buttonA.zIndex=t,this._buttonB.zIndex=t},enumerable:!0,configurable:!0}),i.prototype.setState=function(t){switch(this._state=t,this._state){case i.STATE_A:this._buttonA.visible=!0,this._buttonA.active=!0,this._buttonB.visible=!1,this._buttonB.active=!1;break;case i.STATE_B:this._buttonA.visible=!1,this._buttonA.active=!1,this._buttonB.visible=!0,this._buttonB.active=!0}},i.prototype.buttonHandler=function(e,n,o){switch(n){case t.Button.OVER:this.inputOver.dispatch(this,t.Button.OVER,o,this._state);break;case t.Button.OUT:this.inputOut.dispatch(this,t.Button.OUT,o,this._state);break;case t.Button.DOWN:this.inputDown.dispatch(this,t.Button.DOWN,o,this._state);break;case t.Button.UP:switch(this._state){case i.STATE_A:this.setState(i.STATE_B);break;case i.STATE_B:this.setState(i.STATE_A)}this.inputDown.dispatch(this,t.Button.UP,o,this._state)}},i.prototype.destroy=function(){this.inputOver.removeAll(),this.inputOut.removeAll(),this.inputDown.removeAll(),this.inputUp.removeAll(),e.prototype.destroy.call(this),this.inputOver=null,this.inputOut=null,this.inputDown=null,this.inputUp=null,this._buttonA=null,this._buttonB=null},i}(t.GameEntity);t.ToggleButton=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,n,o,o.renderCanvas.width,o.renderCanvas.height,s),this._color="#000000",r&&r.hasOwnProperty("color")&&(this._color=r.color),this.completeSignal=new t.Signal,this.visible=!1,this.layerIndex=t.EngineConstants.LAYERINDEX_TRANSITION,this._renderManager.getLayer(this.layerIndex,!0).cameraTransformOptions=t.TransformOptions.NONE}return __extends(i,e),i.NAME="Transition",i.TYPE_CIRCLE="circle",i.TYPE_SQUARE="square",i.TYPE_WIPE="wipe",i.TYPE_FADE="fade",i.TYPE_CUSTOM="custom",i.IN="in",i.OUT="out",i.LEFT="left",i.RIGHT="right",i.prototype.start=function(e){var n=this,o=e.duration||1,r=e.ease||t.Linear.easeNone,s=e.direction||i.IN,a=e.delay||0,h=e.color||this._color,l=new TimelineLite({delay:a,onComplete:function(t){return n.onComplete(t)},onCompleteParams:[e]});switch(this.fillStyle=h,this.fillRect(0,0,this.width,this.height),this._type=e.type||i.TYPE_FADE,this._position=e.position||i.LEFT,LOGGING&&this._log.trace("{TRANSITION  | type: "+e.type+", direction: "+s+"}"),e.type){case i.TYPE_FADE:switch(s){case i.IN:l.insert(TweenLite.to(this,o,{alpha:0,ease:r}));break;case i.OUT:l.insert(TweenLite.from(this,o,{alpha:0,ease:r}))}break;case i.TYPE_CIRCLE:case i.TYPE_SQUARE:switch(this.globalCompositeOperation="destination-out",this._size=Math.max(this.width,this.height),s){case i.IN:l.insert(TweenMax.from(this,o,{_size:0,ease:r}));break;case i.OUT:l.insert(TweenMax.to(this,o,{_size:0,ease:r}))}break;case i.TYPE_WIPE:switch(this._size=this.width,s){case i.IN:this.globalCompositeOperation="destination-out",l.insert(TweenMax.from(this,o,{_size:0,ease:r}));break;case i.OUT:l.insert(TweenMax.from(this,o,{x:-this._size,ease:r}))}break;case i.TYPE_CUSTOM:switch(this._mask=e.mask,this._mask.visible=!1,e.motion&&l.insert(e.motion),s){case i.IN:l.append(TweenMax.to(this,.5,{alpha:0,ease:Strong.easeOut}),0);break;case i.OUT:}}return this.visible=!0,this._timeManager.addAnimatedObject(this),this},i.prototype.onComplete=function(e){this._timeManager.removeAnimatedObject(this),this.removeComponentByName(t.EngineConstants.RENDER),this.completeSignal.dispatch(),e.onComplete&&e.onComplete.apply(null,e.onCompleteParams?e.onCompleteParams:null),this.destroy()},i.prototype.onFrame=function(){switch(this._type){case i.TYPE_CIRCLE:this.beginPath(),this.arc(this.centerX,this.centerY,this._size,0,2*Math.PI,!1),this.closePath(),this.fill();break;case i.TYPE_SQUARE:this.beginPath(),this.rect(this.centerX-.5*this._size,this.centerY-.5*this._size,this._size,this._size),this.closePath(),this.fill();break;case i.TYPE_WIPE:switch(this.beginPath(),this._position){case i.LEFT:this.rect(0,0,this._size,this.height);break;case i.RIGHT:this.rect(this.width-this._size,0,this._size,this.height)}this.closePath(),this.fill();break;case i.TYPE_CUSTOM:var t=this._mask._renderComponent.transform;this.fillRect(0,0,this.width,this.height),this._renderContext.save(),this.globalCompositeOperation="destination-out",this._renderContext.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),this._renderContext.drawImage(this._mask.view,0,0),this._renderContext.restore()}},i.prototype.destroy=function(){this.completeSignal.removeAll(),this.completeSignal=null,e.prototype.destroy.call(this)},i}(t.CanvasGraphic);t.Transition=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.UP=2,t.DOWN=4,t.LEFT=8,t.RIGHT=16,t.UP_LEFT=t.UP|t.LEFT,t.UP_RIGHT=t.UP|t.RIGHT,t.DOWN_LEFT=t.DOWN|t.LEFT,t.DOWN_RIGHT=t.DOWN|t.RIGHT,t}();t.Direction=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e,i,n,o,r){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=o,this.ty=r}return e.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.prototype.setTo=function(t,e,i,n,o,r){return"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=o,this.ty=r,this},e.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},e.prototype.rotate=function(t){return this._cos=Math.cos(t),this._sin=Math.sin(t),this._ma=this.a*this._cos+this.c*this._sin,this._mb=this.b*this._cos+this.d*this._sin,this._mc=this.a*-this._sin+this.c*this._cos,this._md=this.b*-this._sin+this.d*this._cos,this.a=this._ma,this.b=this._mb,this.c=this._mc,this.d=this._md,this},e.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},e.prototype.multiply=function(t){return this._ma=this.a*t.a+this.b*t.c,this._mb=this.a*t.b+this.b*t.d,this._mc=this.c*t.a+this.d*t.c,this._md=this.c*t.b+this.d*t.d,this._mtx=this.tx*t.a+this.ty*t.c+t.tx,this._mty=this.tx*t.b+this.ty*t.d+t.ty,this.a=this._ma,this.b=this._mb,this.c=this._mc,this.d=this._md,this.tx=this._mtx,this.ty=this._mty,this},e.prototype.invert=function(){return this._d=1/(this.a*this.d-this.b*this.c),this._ma=this.d*this._d,this._mb=-this.b*this._d,this._mc=-this.c*this._d,this._md=this.a*this._d,this._mtx=this._d*(this.c*this.ty-this.d*this.tx),this._mty=this._d*(this.b*this.tx-this.a*this.ty),this.a=this._ma,this.b=this._mb,this.c=this._mc,this.d=this._md,this.tx=this._mtx,this.ty=this._mty,this},e.prototype.transformPoint=function(e,i){return"undefined"==typeof i&&(i=new t.Point),i.x=e.x*this.a+e.y*this.c+this.tx,i.y=e.x*this.b+e.y*this.d+this.ty,i},e.prototype.transformPointDelta=function(e,i){return"undefined"==typeof i&&(i=new t.Point),i.x=e.x*this.a+e.y*this.c,i.y=e.x*this.b+e.y*this.d,i},e.prototype.transformPointInverse=function(e,i){"undefined"==typeof i&&(i=new t.Point);var n=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*n*e.x+-this.c*n*e.y+(this.ty*this.c-this.tx*this.d)*n,i.y=this.a*n*e.y+-this.b*n*e.x+(-this.ty*this.a+this.tx*this.b)*n,i},e.prototype.clone=function(){return new e(this.a,this.b,this.c,this.d,this.tx,this.ty)},e.prototype.toString=function(){return"[{Matrix (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")}]"},e}();t.Matrix=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.NONE=1,t.TRANSLATE=2,t.ROTATE=4,t.SCALE=8,t.ALL=t.TRANSLATE|t.ROTATE|t.SCALE,t}();t.TransformOptions=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i){e.call(this),this._inputManager=i,this.inputOver=new t.Signal,this.inputOut=new t.Signal,this.inputDown=new t.Signal,this.inputUp=new t.Signal,this.inputMove=new t.Signal,this.enabled=!0,this.ignoreTransparency=!0,this.useHandCursor=!0}return __extends(i,e),Object.defineProperty(i.prototype,"_renderID",{get:function(){return this._inputObject._renderID},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hitArea",{get:function(){return this._hitArea||this._inputObject.extents.inflate(-5,-5)},set:function(t){this._hitArea=t},enumerable:!0,configurable:!0}),i.prototype._onRegister=function(){this._inputObject=this._owner,this._inputManager.addInputObject(this),e.prototype._onRegister.call(this)},i.prototype._onUnregister=function(){this._inputManager.removeInputObject(this),e.prototype._onUnregister.call(this)},i.prototype._onReset=function(){this._inputObject=this._owner,e.prototype._onReset.call(this)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.inputOver.removeAll(),this.inputOut.removeAll(),this.inputDown.removeAll(),this.inputUp.removeAll(),this.inputMove.removeAll(),this._hitArea=null,this.inputOver=null,this.inputOut=null,this.inputDown=null,this.inputUp=null,this.inputMove=null,this._inputManager=null,this._inputObject=null},i}(t.Component);t.InputComponent=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){e.call(this,i.NAME+i.COUNT++),this._inputManager=n,this.id=-1,this.x=-1,this.y=-1,this.prevX=-1,this.prevY=-1,this.isDown=!1,this._inputObjects=[],this._currentInput=[],this._previousInput=[],this._pt=new t.Point,this._renderInfo=new t.Rectangle}return __extends(i,e),i.NAME="InputPointer",i.COUNT=0,i.prototype.getObjectsUnderPointer=function(){var t=[],e=this._inputManager._inputObjects;if(0===e.length)return t;for(var i,n=0,o=e.length;o>n;n++)i=e[n],i.enabled&&(this._renderComponent=i.owner._renderComponent,this._renderRect=this._renderComponent._renderRect,this._renderOffset=this._renderComponent._renderOffset,this._renderInfo=i.hitArea,i.ignoreTransparency&&(this._pt=this._renderComponent.globalToLocal(this._pt.setTo(this.x,this.y)),this._alpha=this._renderComponent._renderContext.getImageData(this._renderRect.x+this._pt.x-this._renderOffset.x+this._renderComponent.offsetX,this._renderRect.y+this._pt.y-this._renderOffset.y+this._renderComponent.offsetY,1,1).data[3]/255,0==this._alpha)||this.rectContainsInput(this._renderInfo)&&t.push(i.owner));return t},i.prototype.start=function(t,e,i){if(this.prevX=this.x,this.prevY=this.y,this.x=t,this.y=e,this.id=i,this.isDown=!0,this.active=!0,this._inputObjects=this._inputManager._inputObjects,0!=this._inputObjects.length){for(var n,o,r=-1,s=0,a=this._inputObjects.length;a>s;s++)n=this._inputObjects[s],n.enabled&&(this._renderComponent=n.owner._renderComponent,this._renderRect=this._renderComponent._renderRect,this._renderOffset=this._renderComponent._renderOffset,this._renderInfo=n.hitArea,n.ignoreTransparency&&(this._pt=this._renderComponent.globalToLocal(this._pt.setTo(this.x,this.y)),this._alpha=this._renderComponent._renderContext.getImageData(this._renderRect.x+this._pt.x-this._renderOffset.x+this._renderComponent.offsetX,this._renderRect.y+this._pt.y-this._renderOffset.y+this._renderComponent.offsetY,1,1).data[3]/255,0==this._alpha)||this.rectContainsInput(this._renderInfo)&&n._renderID>r&&(r=n._renderID,o=n));o?(LOGGING&&this._log.mark(o.owner.name+" Down"),o.inputDown.dispatch(o.owner,this.x,this.y,this.id)):LOGGING&&this._log.mark("Input Down")}},i.prototype.end=function(t,e,i){if(this.prevX=this.x,this.prevY=this.y,this.x=t,this.y=e,this.id=i,this.isDown=!1,this.active=!1,this._inputObjects=this._inputManager._inputObjects,0!=this._inputObjects.length){for(var n,o,r=-1,s=0,a=this._inputObjects.length;a>s;s++)n=this._inputObjects[s],n.enabled&&(this._renderComponent=n.owner._renderComponent,this._renderRect=this._renderComponent._renderRect,this._renderOffset=this._renderComponent._renderOffset,this._renderInfo=n.hitArea,n.ignoreTransparency&&(this._pt=this._renderComponent.globalToLocal(this._pt.setTo(this.x,this.y)),this._alpha=this._renderComponent._renderContext.getImageData(this._renderRect.x+this._pt.x-this._renderOffset.x+this._renderComponent.offsetX,this._renderRect.y+this._pt.y-this._renderOffset.y+this._renderComponent.offsetY,1,1).data[3]/255,0==this._alpha)||this.rectContainsInput(this._renderInfo)&&n._renderID>r&&(r=n._renderID,o=n));o?(LOGGING&&this._log.mark(o.owner.name+" Up"),o.inputUp.dispatch(o.owner,this.x,this.y,this.id)):LOGGING&&this._log.mark("Input Up"),this._inputManager._canvas.style.cursor="default"}},i.prototype.move=function(t,e,i){if(this.prevX=this.x,this.prevY=this.y,this.x=t,this.y=e,this.id=i,this.active=!0,this._inputObjects=this._inputManager._inputObjects,0!=this._inputObjects.length){this._currentInput=[],this._topMostRenderID=-1,this._topMostInputObject=null;for(var n=0,o=this._inputObjects.length;o>n;n++)this._inputObject=this._inputObjects[n],this._inputObject.enabled&&(this._renderComponent=this._inputObject.owner._renderComponent,this._renderRect=this._renderComponent._renderRect,this._renderOffset=this._renderComponent._renderOffset,this._renderInfo=this._inputObject.hitArea,this.rectContainsInput(this._renderInfo)&&(this._currentInput.push(this._inputObject),this._inputObject.ignoreTransparency&&(this._pt=this._renderComponent.globalToLocal(this._pt.setTo(this.x,this.y)),this._alpha=this._renderComponent._renderContext.getImageData(this._renderRect.x+this._pt.x-this._renderOffset.x+this._renderComponent.offsetX,this._renderRect.y+this._pt.y-this._renderOffset.y+this._renderComponent.offsetY,1,1).data[3]/255,0==this._alpha)||this._inputObject._renderID>this._topMostRenderID&&(this._topMostRenderID=this._inputObject._renderID,this._topMostInputObject=this._inputObject)));for(var n=0,o=this._inputObjects.length;o>n;n++)this._inputObject=this._inputObjects[n],this._inputObject.enabled&&(this._currentIndex=this._currentInput.indexOf(this._inputObject),this._previousIndex=this._previousInput.indexOf(this._inputObject),this._inputObject.inputOut.getNumListeners()>0&&(this._inputObject==this._previousTopMostInputObject&&this._previousTopMostInputObject!=this._topMostInputObject?this._inputObject.inputOut.dispatch(this._inputObject.owner,this.x,this.y,this.id):-1==this._currentIndex&&-1!=this._previousIndex&&this._inputObject==this._topMostInputObject&&this._inputObject.inputOut.dispatch(this._inputObject.owner,this.x,this.y,this.id)),this._inputObject.inputOver.getNumListeners()>0&&this._inputObject!=this._previousTopMostInputObject&&this._inputObject==this._topMostInputObject&&this._inputObject.inputOver.dispatch(this._inputObject.owner,this.x,this.y,this.id));this._inputManager._canvas.style.cursor=this._topMostInputObject&&this._topMostInputObject.enabled&&this._topMostInputObject.useHandCursor?"pointer":"default",this._previousTopMostInputObject=this._topMostInputObject,this._previousInput=this._currentInput.concat(),this._topMostInputObject&&this._topMostInputObject.inputMove.getNumListeners()>0&&this._topMostInputObject.inputMove.dispatch(this._topMostInputObject.owner,this.x,this.y,i)}},i.prototype.rectContainsInput=function(t){return this.x>=t.x&&this.x<=t.x+t.width&&this.y>=t.y&&this.y<=t.y+t.height},i.prototype.destroy=function(){this._inputObjects=null,this._currentInput=null,this._previousInput=null,this._inputManager=null,this._pt=null,e.prototype.destroy.call(this)},i}(t.Element);t.InputPointer=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._priority=0}return Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!0,configurable:!0}),t.prototype.addedToEmitter=function(){},t.prototype.removedFromEmitter=function(){},t.prototype.update=function(){},t}();t.ActionBase=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.x=e,this.y=i}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;n.velX+=this._x*i,n.velY+=this._y*i},e}(t.ActionBase);t.Accelerate=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i){"undefined"==typeof i&&(i=null),e.call(this),this._easing=null==i?t.Linear.easeNone:i}return __extends(i,e),Object.defineProperty(i.prototype,"easing",{get:function(){return this._easing},set:function(t){this._easing=t},enumerable:!0,configurable:!0}),i.prototype.update=function(t,e,i){e.age+=i,e.age>=e.lifetime?(e.energy=0,e.isDead=!0):e.energy=this._easing(e.age,1,-1,e.lifetime)},i}(t.ActionBase);t.Age=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=100),t.call(this),this._gravityConst=1e4,this.power=e,this.x=i,this.y=n,this.epsilon=o}return __extends(e,t),Object.defineProperty(e.prototype,"power",{get:function(){return this._power/this._gravityConst},set:function(t){this._power=t*this._gravityConst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilonSq)},set:function(t){this._epsilonSq=t*t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){if(0!=e.mass){var n=e,o=this._x-n.x,r=this._y-n.y,s=o*o+r*r;if(0!=s){var a=Math.sqrt(s);s<this._epsilonSq&&(s=this._epsilonSq);var h=this._power*i/(s*a);n.velX+=o*h,n.velY+=r*h}}},e}(t.ActionBase);t.GravityWell=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=1),t.call(this,e,i,n,o)}return __extends(e,t),Object.defineProperty(e.prototype,"power",{get:function(){return-t.prototype.power},set:function(e){t.prototype.power=-e},enumerable:!0,configurable:!0}),e}(t.GravityWell);t.AntiGravity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.priority=10,this.maxDistance=e,this.acceleration=i}return __extends(e,t),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._max},set:function(t){this._max=t,this._maxSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acc},set:function(t){this._acc=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.spaceSort=!0},e.prototype.update=function(t,e,i){var n,o,r,s,a,h,l,c=e,u=t,p=u.particles,d=p.length,f=0,_=0;for(o=c.sortID-1;o>=0&&(n=p[o],!((a=n.x-c.x)<-this._max));--o)h=n.y-c.y,h>this._max||h<-this._max||(s=h*h+a*a,s<=this._maxSq&&s>0&&(r=1/Math.sqrt(s),f+=a*r,_+=h*r));for(o=c.sortID+1;d>o&&(n=p[o],!((a=n.x-c.x)>this._max));++o)h=n.y-c.y,h>this._max||h<-this._max||(s=h*h+a*a,s<=this._maxSq&&s>0&&(r=1/Math.sqrt(s),f+=a*r,_+=h*r));(0!=f||0!=_)&&(l=i*this._acc/Math.sqrt(f*f+_*_),c.velX+=l*f,c.velY+=l*_)},e}(t.ActionBase);t.ApproachNeighbours=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o,r){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=1),t.call(this),this.priority=-20,this.left=e,this.top=i,this.right=n,this.bottom=o,this.bounce=r}return __extends(e,t),Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(t){this._top=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(t){this._bottom=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounce",{get:function(){return this._bounce},set:function(t){this._bounce=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i,n=e,o=e.collisionRadius;n.velX>0&&(i=n.x+o)>=this._right?(n.velX=-n.velX*this._bounce,n.x+=2*(this._right-i),t.particleBoundingBoxCollision.getNumListeners()>0&&t.particleBoundingBoxCollision.dispatch(n)):n.velX<0&&(i=n.x-o)<=this._left&&(n.velX=-n.velX*this._bounce,n.x+=2*(this._left-i),t.particleBoundingBoxCollision.getNumListeners()>0&&t.particleBoundingBoxCollision.dispatch(n)),n.velY>0&&(i=n.y+o)>=this._bottom?(n.velY=-n.velY*this._bounce,n.y+=2*(this._bottom-i),t.particleBoundingBoxCollision.getNumListeners()>0&&t.particleBoundingBoxCollision.dispatch(n)):n.velY<0&&(i=n.y-o)<=this._top&&(n.velY=-n.velY*this._bounce,n.y+=2*(this._top-i),t.particleBoundingBoxCollision.getNumListeners()>0&&t.particleBoundingBoxCollision.dispatch(n))},e}(t.ActionBase);t.BoundingBox=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),t.call(this),this._diffRadius=e-i,this._endRadius=i}return __extends(e,t),Object.defineProperty(e.prototype,"startRadius",{get:function(){return this._endRadius+this._diffRadius},set:function(t){this._diffRadius=t-this._endRadius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endRadius",{get:function(){return this._endRadius},set:function(t){this._diffRadius=this._endRadius+this._diffRadius-t,this._endRadius=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){e.collisionRadius=this._endRadius+this._diffRadius*e.energy},e}(t.ActionBase);t.ChangeCollisionRadius=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),t.call(this),this._diffMass=e-i,this._endMass=i}return __extends(e,t),Object.defineProperty(e.prototype,"startMass",{get:function(){return this._endMass+this._diffMass},set:function(t){this._diffMass=t-this._endMass},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endMass",{get:function(){return this._endMass},set:function(t){this._diffMass=this._endMass+this._diffMass-t,this._endMass=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){e.mass=this._endMass+this._diffMass*e.energy},e}(t.ActionBase);t.ChangeMass=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t){"undefined"==typeof t&&(t=1),e.call(this),this._sign=1,this.priority=-20,this.bounce=t,this._maxDistance=0}return __extends(i,e),Object.defineProperty(i.prototype,"bounce",{get:function(){return this._bounce},set:function(t){this._bounce=t},enumerable:!0,configurable:!0}),i.prototype.addedToEmitter=function(e){e.spaceSort=!0,this._updateActivity=new t.UpdateOnFrame(this),e.addActivity(this._updateActivity)},i.prototype.removedFromEmitter=function(t){this._updateActivity&&t.removeActivity(this._updateActivity)
},i.prototype.frameUpdate=function(t){for(var e,i=t.particles,n=0,o=0,r=0;r<i.length;r++)e=i[r],e.collisionRadius>n?(o=n,n=e.collisionRadius):e.collisionRadius>o&&(o=e.collisionRadius);this._maxDistance=n+o,this._sign=-this._sign},i.prototype.update=function(t,e){var i,n,o,r,s,a,h,l,c,u,p,d,f,_,g=e,m=t,y=m.particles,v=y.length;for(n=g.sortID+this._sign;v>n&&n>=0&&(i=y[n],!((a=i.x-g.x)*this._sign>this._maxDistance));n+=this._sign)s=i.collisionRadius+g.collisionRadius,a*this._sign>s||(h=i.y-g.y,h>s||-s>h||(r=h*h+a*a,s*s>=r&&r>0&&(o=1/Math.sqrt(r),a*=o,h*=o,l=a*g.velX+h*g.velY,c=a*i.velX+h*i.velY,u=l-c,u>0&&(p=g.mass,d=i.mass,o=(1+this._bounce)*u/(p+d),f=o*d,_=-o*p,g.velX-=f*a,g.velY-=f*h,i.velX-=_*a,i.velY-=_*h,t.particleCollision.getNumListeners()>0&&t.particleCollision.dispatch(g,i)))))},i}(t.ActionBase);t.Collide=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=1),t.call(this),this.priority=-30,this.bounce=i,this.zone=e}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounce",{get:function(){return this._bounce},set:function(t){this._bounce=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=this._zone.collideParticle(e,this._bounce);i&&t.particleZoneCollision.getNumListeners()>0&&t.particleZoneCollision.dispatch(e,this._zone)},e}(t.ActionBase);t.CollisionZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){"undefined"==typeof t&&(t=4294967295),"undefined"==typeof i&&(i=4294967295),e.call(this),this._startColor=t,this._endColor=i}return __extends(i,e),Object.defineProperty(i.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t},enumerable:!0,configurable:!0}),i.prototype.update=function(e,i){i.color=t.ColorUtil.interpolateARGB(this._startColor,this._endColor,i.energy)},i}(t.ActionBase);t.ColorChange=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=Number.MAX_VALUE),"undefined"==typeof i&&(i=!1),t.call(this),this.limit=e,this.isMinimum=i}return __extends(e,t),Object.defineProperty(e.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=t,this._limitSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMinimum",{get:function(){return this._isMinimum},set:function(t){this._isMinimum=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=e,n=i.velX*i.velX+i.velY*i.velY;(this._isMinimum&&n<this._limitSq||!this._isMinimum&&n>this._limitSq)&&(i.isDead=!0)},e}(t.ActionBase);t.DeathSpeed=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=!1),t.call(this),this.priority=-20,this.zone=e,this.zoneIsSafe=i}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoneIsSafe",{get:function(){return this._invertZone},set:function(t){this._invertZone=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){this.p=e,this.inside=this._zone.contains(this.p.x,this.p.y),this._invertZone?this.inside||(this.p.isDead=!0):this.inside&&(this.p.isDead=!0)},e}(t.ActionBase);t.DeathZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n,o,r,s){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=300),"undefined"==typeof r&&(r=10),"undefined"==typeof s&&(s=1),e.call(this),this._oldRadius=0,this._radius=0,this._radiusChange=0,this._expansionRate=500,this.power=t,this.x=i,this.y=n,this.expansionRate=o,this.depth=r,this.epsilon=s}return __extends(i,e),i.POWER_FACTOR=1e5,Object.defineProperty(i.prototype,"power",{get:function(){return this._power/i.POWER_FACTOR},set:function(t){this._power=t*i.POWER_FACTOR},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"expansionRate",{get:function(){return this._expansionRate},set:function(t){this._expansionRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depth",{get:function(){return 2*this._depth},set:function(t){this._depth=.5*t,this._invDepth=1/this._depth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilonSq)},set:function(t){this._epsilonSq=t*t},enumerable:!0,configurable:!0}),i.prototype.addedToEmitter=function(e){this._updateActivity=new t.UpdateOnFrame(this),e.addActivity(this._updateActivity)},i.prototype.removedFromEmitter=function(t){this._updateActivity&&t.removeActivity(this._updateActivity)},i.prototype.reset=function(){this._radius=0,this._oldRadius=0,this._radiusChange=0},i.prototype.frameUpdate=function(t,e){this._oldRadius=this._radius,this._radiusChange=this._expansionRate*e,this._radius+=this._radiusChange},i.prototype.update=function(t,e,i){var n=e,o=n.x-this._x,r=n.y-this._y,s=o*o+r*r;0==s&&(s=.02,o=.1,r=.1);var a=Math.sqrt(s);if(!(a<this._oldRadius-this._depth||a>this._radius+this._depth)){var h=a<this._radius?this._depth-this._radius+a:this._depth-a+this._radius,l=a<this._oldRadius?this._depth-this._oldRadius+a:this._depth-a+this._oldRadius;h*=this._invDepth,l*=this._invDepth,0>h&&(i=i*(this._radiusChange+h)/this._radiusChange,h=0),0>l&&(i=i*(this._radiusChange+l)/this._radiusChange,l=0);var c;if(a<this._oldRadius||a>this._radius)c=i*this._power*(h+l)/(2*this._radius*a*n.mass);else{var u=(1-l)/this._radiusChange,p=u*i*this._power*(l+1),d=(1-u)*i*this._power*(h+1);c=(p+d)/(2*this._radius*a*n.mass)}n.velX+=o*c,n.velY+=r*c}},i}(t.ActionBase);t.Explosion=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=0),t.call(this),this.priority=-5,this._diffAlpha=e-i,this._endAlpha=i}return __extends(e,t),Object.defineProperty(e.prototype,"startAlpha",{get:function(){return this._endAlpha+this._diffAlpha},set:function(t){this._diffAlpha=t-this._endAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endAlpha",{get:function(){return this._endAlpha},set:function(t){this._diffAlpha=this._endAlpha+this._diffAlpha-t,this._endAlpha=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=this._endAlpha+this._diffAlpha*e.energy;e.color=16777215&e.color|Math.round(255*i)<<24},e}(t.ActionBase);t.Fade=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.friction=e}return __extends(e,t),Object.defineProperty(e.prototype,"friction",{get:function(){return this._friction},set:function(t){this._friction=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e,o=n.velX*n.velX+n.velY*n.velY;if(0!=o){var r=1-this._friction*i/(Math.sqrt(o)*n.mass);0>r?(n.velX=0,n.velY=0):(n.velX*=r,n.velY*=r)}},e}(t.ActionBase);t.Friction=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o=!1),t.call(this),this.x=e,this.y=i,this.zone=n,this.invertZone=o}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invertZone",{get:function(){return this._invert},set:function(t){this._invert=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;this._zone.contains(n.x,n.y)?this._invert||(n.velX+=this._x*i,n.velY+=this._y*i):this._invert&&(n.velX+=this._x*i,n.velY+=this._y*i)},e}(t.ActionBase);t.Jet=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),t.call(this),this._action=e,this._keyCode=i,this._isDown=!1}return __extends(e,t),Object.defineProperty(e.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyCode",{get:function(){return this._keyCode},set:function(t){this._keyCode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._action.priority},set:function(t){this._action.priority=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){this._action.addedToEmitter(t)},e.prototype.removedFromEmitter=function(t){this._action.removedFromEmitter(t)},e.prototype.update=function(t,e,i){this._isDown&&this._action.update(t,e,i)},e}(t.ActionBase);t.KeyDownAction=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.drag=e}return __extends(e,t),Object.defineProperty(e.prototype,"drag",{get:function(){return this._drag},set:function(t){this._drag=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e,o=1-this._drag*i/n.mass;0>o?(n.velX=0,n.velY=0):(n.velX*=o,n.velY*=o)},e}(t.ActionBase);t.LinearDrag=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.priority=10,this.maxDistance=e,this.acceleration=i}return __extends(e,t),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._max},set:function(t){this._max=t,this._maxSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acc},set:function(t){this._acc=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.spaceSort=!0},e.prototype.update=function(t,e,i){var n,o,r,s,a,h,l=e,c=t,u=c.particles,p=u.length,d=0,f=0;for(o=l.sortID-1;o>=0&&(n=u[o],!((s=l.x-n.x)>this._max));--o)a=n.y-l.y,a>this._max||a<-this._max||(r=a*a+s*s,r<=this._maxSq&&(d+=n.angVelocity,++f));for(o=l.sortID+1;p>o&&(n=u[o],!((s=n.x-l.x)>this._max));++o)a=n.y-l.y,a>this._max||a<-this._max||(r=a*a+s*s,r<=this._maxSq&&(d+=n.angVelocity,++f));if(0!=f&&(d=d/f-l.angVelocity,0!=d)){var _=1;0>d&&(_=-1,d=-d),h=i*this._acc,h>d&&(h=d),l.angVelocity+=h*_}},e}(t.ActionBase);t.MatchRotateVelocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.priority=10,this.maxDistance=e,this.acceleration=i}return __extends(e,t),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._max},set:function(t){this._max=t,this._maxSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acc},set:function(t){this._acc=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.spaceSort=!0},e.prototype.update=function(t,e,i){var n,o,r,s,a,h,l=e,c=t,u=c.particles,p=u.length,d=0,f=0,_=0;for(o=l.sortID-1;o>=0&&(n=u[o],!((s=l.x-n.x)>this._max));--o)a=n.y-l.y,a>this._max||a<-this._max||(r=a*a+s*s,r<=this._maxSq&&(d+=n.velX,f+=n.velY,++_));for(o=l.sortID+1;p>o&&(n=u[o],!((s=n.x-l.x)>this._max));++o)a=n.y-l.y,a>this._max||a<-this._max||(r=a*a+s*s,r<=this._maxSq&&(d+=n.velX,f+=n.velY,++_));0!=_&&(d=d/_-l.velX,f=f/_-l.velY,(0!=d||0!=f)&&(h=i*this._acc/Math.sqrt(d*d+f*f),h>1&&(h=1),l.velX+=h*d,l.velY+=h*f))},e}(t.ActionBase);t.MatchVelocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.priority=10,this.minimum=e,this.acceleration=i}return __extends(e,t),Object.defineProperty(e.prototype,"minimum",{get:function(){return this._min},set:function(t){this._min=t,this._minSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acc},set:function(t){this._acc=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.spaceSort=!0},e.prototype.update=function(t,e,i){var n,o,r,s,a,h,l,c=e,u=t,p=u.particles,d=p.length,f=0,_=0;for(o=c.sortID-1;o>=0&&(n=p[o],!((a=c.x-n.x)>this._min));--o)h=c.y-n.y,h>this._min||h<-this._min||(s=h*h+a*a,s<=this._minSq&&s>0&&(r=1/Math.sqrt(s),f+=a*r,_+=h*r));for(o=c.sortID+1;d>o&&(n=p[o],!((a=c.x-n.x)<-this._min));++o)h=c.y-n.y,h>this._min||h<-this._min||(s=h*h+a*a,s<=this._minSq&&s>0&&(r=1/Math.sqrt(s),f+=a*r,_+=h*r));(0!=f||0!=_)&&(l=i*this._acc/Math.sqrt(f*f+_*_),c.velX+=l*f,c.velY+=l*_)},e}(t.ActionBase);t.MinimumDistance=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=100),t.call(this),this._gravityConst=1e4,this.power=e,this.epsilon=n,this._inputManager=i}return __extends(e,t),e.NAME="MouseGravity",Object.defineProperty(e.prototype,"power",{get:function(){return this._power/this._gravityConst},set:function(t){this._power=t*this._gravityConst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilonSq)},set:function(t){this._epsilonSq=t*t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e,o=this._inputManager.inputX-n.x,r=this._inputManager.inputY-n.y,s=o*o+r*r;if(0!=s){var a=Math.sqrt(s);s<this._epsilonSq&&(s=this._epsilonSq);var h=this._power*i/(s*a);n.velX+=o*h,n.velY+=r*h}},e}(t.ActionBase);t.MouseGravity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=1),t.call(this,e,i,n)}return __extends(e,t),e.NAME="MouseAntiGravity",Object.defineProperty(e.prototype,"power",{get:function(){return-t.prototype.power},set:function(e){t.prototype.power=-e},enumerable:!0,configurable:!0}),e}(t.MouseGravity);t.MouseAntiGravity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(){t.call(this),this.priority=-10}return __extends(e,t),e.prototype.update=function(t,e,i){var n=e;n.previousX=n.x,n.previousY=n.y,n.x+=n.velX*i,n.y+=n.velY*i},e}(t.ActionBase);t.Move=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),t.call(this),this._gravityConst=1e3,this.priority=10,this.power=e,this.maxDistance=i,this.epsilon=n}return __extends(e,t),Object.defineProperty(e.prototype,"power",{get:function(){return this._power/this._gravityConst},set:function(t){this._power=t*this._gravityConst},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t,this._maxDistanceSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epsilon",{get:function(){return Math.sqrt(this._epsilonSq)},set:function(t){this._epsilonSq=t*t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.spaceSort=!0},e.prototype.update=function(t,e,i){if(0!=e.mass){var n,o,r,s,a,h,l,c=e,u=t,p=u.particles,d=p.length;for(o=c.sortID+1;d>o;++o)if(n=p[o],0!=n.mass){if((h=n.x-c.x)>this._maxDistance)break;l=n.y-c.y,l>this._maxDistance||l<-this._maxDistance||(a=l*l+h*h,a<=this._maxDistanceSq&&a>0&&(s=Math.sqrt(a),a<this._epsilonSq&&(a=this._epsilonSq),r=this._power*i/(a*s),c.velX+=(h*=r)*n.mass,c.velY+=(l*=r)*n.mass,n.velX-=h*c.mass,n.velY-=l*c.mass))}}},e}(t.ActionBase);t.MutualGravity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.drag=e}return __extends(e,t),Object.defineProperty(e.prototype,"drag",{get:function(){return this._drag},set:function(t){this._drag=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e,o=n.velX*n.velX+n.velY*n.velY;if(0!=o){var r=1-this._drag*i*Math.sqrt(o)/n.mass;0>r?(n.velX=0,n.velY=0):(n.velX*=r,n.velY*=r)}},e}(t.ActionBase);t.QuadraticDrag=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.driftX=e,this.driftY=i}return __extends(e,t),Object.defineProperty(e.prototype,"driftX",{get:function(){return this._sizeX/2},set:function(t){this._sizeX=2*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driftY",{get:function(){return this._sizeY/2},set:function(t){this._sizeY=2*t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;n.velX+=(Math.random()-.5)*this._sizeX*i,n.velY+=(Math.random()-.5)*this._sizeY*i},e}(t.ActionBase);t.RandomDrift=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(){t.call(this),this.priority=-10}return __extends(e,t),e.prototype.update=function(t,e,i){var n=e;n.rotation+=n.angVelocity*i},e}(t.ActionBase);t.Rotate=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.update=function(t,e){var i=e;i.rotation=Math.atan2(i.velY,i.velX)},e}(t.ActionBase);t.RotateToDirection=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.friction=e}return __extends(e,t),Object.defineProperty(e.prototype,"friction",{get:function(){return this._friction},set:function(t){this._friction=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;if(0!=n.angVelocity){var o=1-this._friction*i/(Math.abs(n.angVelocity)*n.inertia);0>o?n.angVelocity=0:n.angVelocity*=o}},e}(t.ActionBase);t.RotationalFriction=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.drag=e}return __extends(e,t),Object.defineProperty(e.prototype,"drag",{get:function(){return this._drag},set:function(t){this._drag=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;if(0!=n.angVelocity){var o=1-this._drag*i/n.inertia;0>o?n.angVelocity=0:n.angVelocity*=o}},e}(t.ActionBase);t.RotationalLinearDrag=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.drag=e}return __extends(e,t),Object.defineProperty(e.prototype,"drag",{get:function(){return this._drag},set:function(t){this._drag=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;if(0!=n.angVelocity){var o=1-this._drag*i*n.angVelocity/n.inertia;0>o?n.angVelocity=0:n.angVelocity*=o}},e}(t.ActionBase);t.RotationalQuadraticDrag=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),t.call(this),this._diffScale=0,this._endScale=1,this.startScale=e,this.endScale=i}return __extends(e,t),Object.defineProperty(e.prototype,"startScale",{get:function(){return this._endScale+this._diffScale},set:function(t){this._diffScale=t-this._endScale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endScale",{get:function(){return this._endScale},set:function(t){this._diffScale=this._endScale+this._diffScale-t,this._endScale=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=this._endScale+this._diffScale*e.energy,n=i/e.scale;e.scale=i,e.mass*=n*n,e.collisionRadius*=n},e}(t.ActionBase);t.ScaleAll=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),t.call(this),this._diffScale=e-i,this._endScale=i}return __extends(e,t),Object.defineProperty(e.prototype,"startScale",{get:function(){return this._endScale+this._diffScale},set:function(t){this._diffScale=t-this._endScale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endScale",{get:function(){return this._endScale},set:function(t){this._diffScale=this._endScale+this._diffScale-t,this._endScale=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){e.scale=this._endScale+this._diffScale*e.energy},e}(t.ActionBase);t.ScaleImage=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=Number.MAX_VALUE),"undefined"==typeof i&&(i=!1),t.call(this),this.priority=-5,this.limit=e,this.isMinimum=i}return __extends(e,t),Object.defineProperty(e.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=t,this._limitSq=t*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMinimum",{get:function(){return this._isMinimum},set:function(t){this._isMinimum=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=e,n=i.velX*i.velX+i.velY*i.velY;if(this._isMinimum&&n<this._limitSq||!this._isMinimum&&n>this._limitSq){var o=this._limit/Math.sqrt(n);i.velX*=o,i.velY*=o}},e}(t.ActionBase);t.SpeedLimit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=16777215),"undefined"==typeof i&&(i=.1),t.call(this),this._red=e>>>16&255,this._green=e>>>8&255,this._blue=255&e,this._alpha=e>>>24&255,this._rate=i}return __extends(e,t),Object.defineProperty(e.prototype,"targetColor",{get:function(){return this._alpha<<24|this._red<<16|this._green<<8|this._blue},set:function(t){this._red=t>>>16&255,this._green=t>>>8&255,this._blue=255&t,this._alpha=t>>>24&255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},set:function(t){this._rate=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,n){e.dictionary.get(this)||e.dictionary.put(this,new i(e.color));var o=e.dictionary.get(this),r=this._rate*n;r>1&&(r=1);var s=1-r;o.red=o.red*s+this._red*r,o.green=o.green*s+this._green*r,o.blue=o.blue*s+this._blue*r,o.alpha=o.alpha*s+this._alpha*r,e.color=o.getColor()},e}(t.ActionBase);t.TargetColor=e;var i=function(){function t(t){this.red=t>>>16&255,this.green=t>>>8&255,this.blue=255&t,this.alpha=t>>>24&255}return t.prototype.getColor=function(){return Math.round(this.alpha)<<24|Math.round(this.red)<<16|Math.round(this.green)<<8|Math.round(this.blue)},t}();t.ColorFloat=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=.1),t.call(this),this.targetVelocity=e,this.rate=i}return __extends(e,t),Object.defineProperty(e.prototype,"targetVelocity",{get:function(){return this._vel},set:function(t){this._vel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},set:function(t){this._rate=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;n.angVelocity+=(this._vel-n.angVelocity)*this._rate*i},e}(t.ActionBase);t.TargetRotateVelocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=.1),t.call(this),this._scale=e,this._rate=i}return __extends(e,t),Object.defineProperty(e.prototype,"targetScale",{get:function(){return this._scale},set:function(t){this._scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},set:function(t){this._rate=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){e.scale+=(this._scale-e.scale)*this._rate*i},e}(t.ActionBase);t.TargetScale=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=.1),t.call(this),this.targetVelocityX=e,this.targetVelocityY=i,this.rate=n}return __extends(e,t),Object.defineProperty(e.prototype,"targetVelocityY",{get:function(){return this._velY},set:function(t){this._velY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetVelocityX",{get:function(){return this._velX},set:function(t){this._velX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},set:function(t){this._rate=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e;n.velX+=(this._velX-n.velX)*this._rate*i,n.velY+=(this._velY-n.velY)*this._rate*i},e}(t.ActionBase);t.TargetVelocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),t.call(this),this.power=n,this.x=e,this.y=i}return __extends(e,t),Object.defineProperty(e.prototype,"power",{get:function(){return this._power},set:function(t){this._power=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i){var n=e,o=Math.sqrt(n.velX*n.velX+n.velY*n.velY),r=n.velX/o,s=n.velY/o,a=this._power*i,h=this._x-n.x,l=this._y-n.y,c=Math.sqrt(h*h+l*l);if(0!=c){h/=c,l/=c;var u=h*r+l*s,p=h-r*u,d=l-s*u,f=a/Math.sqrt(p*p+d*d);n.velX+=p*f,n.velY+=d*f,f=o/Math.sqrt(n.velX*n.velX+n.velY*n.velY),n.velX*=f,n.velY*=f}},e}(t.ActionBase);t.TurnTowardsPoint=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),t.call(this),this._diffX=0,this._endX=0,this._diffY=0,this._endY=0,this.startX=e,this.endX=n,this.startY=i,this.endY=o}return __extends(e,t),Object.defineProperty(e.prototype,"startX",{get:function(){return this._endX+this._diffX},set:function(t){this._diffX=t-this._endX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endX",{get:function(){return this._endX},set:function(t){this._diffX=this._endX+this._diffX-t,this._endX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startY",{get:function(){return this._endY+this._diffY},set:function(t){this._diffY=t-this._endY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endY",{get:function(){return this._endY},set:function(t){this._diffY=this._endY+this._diffY-t,this._endY=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=e;i.x=this._endX+this._diffX*i.energy,i.y=this._endY+this._diffY*i.energy},e}(t.ActionBase);t.TweenPosition=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this._zone=e,this.priority=-10}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.hasInitializer(this)||t.addInitializer(this)},e.prototype.removedFromEmitter=function(t){t.removeInitializer(this)},e.prototype.initialize=function(t,e){var n=e,o=this._zone.getLocation(),r=new i(o.x,o.y,n.x,n.y);n.dictionary.put(this,r)},e.prototype.update=function(t,e){var i=e;i.dictionary.get(this)||this.initialize(t,e);var n=i.dictionary.get(this);i.x=n.endX+n.diffX*i.energy,i.y=n.endY+n.diffY*i.energy},e}(t.ActionBase);t.TweenToCurrentPosition=e;var i=function(){function t(t,e,i,n){this.diffX=t-i,this.diffY=e-n,this.endX=i,this.endY=n}return t}();t.TweenToPositionData=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this._zone=e,this.priority=-10}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){t.hasInitializer(this)||t.addInitializer(this)},e.prototype.removedFromEmitter=function(t){t.removeInitializer(this)},e.prototype.initialize=function(t,e){var n=e,o=this._zone.getLocation(),r=new i(n.x,n.y,o.x,o.y);n.dictionary.put(this,r)},e.prototype.update=function(t,e){var i=e;i.dictionary.get(this)||this.initialize(t,e);var n=i.dictionary.get(this);i.x=n.endX+n.diffX*i.energy,i.y=n.endY+n.diffY*i.energy},e}(t.ActionBase);t.TweenToZone=e;var i=function(){function t(t,e,i,n){this.diffX=t-i,this.diffY=e-n,this.endX=i,this.endY=n}return t}();t.TweenToZoneData=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n,o){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),t.call(this),this.priority=-20,this.left=e,this.top=i,this.right=n,this.bottom=o}return __extends(e,t),Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,this._width=this._right-this._left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(t){this._top=t,this._height=this._bottom-this._top},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,this._width=this._right-this._left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(t){this._bottom=t,this._height=this._bottom-this._top},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=e;i.velX>0&&i.x>=this._right?i.x-=this._width:i.velX<0&&i.x<=this._left&&(i.x+=this._width),i.velY>0&&i.y>=this._bottom?i.y-=this._height:i.velY<0&&i.y<=this._top&&(i.y+=this._height)},e}(t.ActionBase);t.WrapAroundBox=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=!1),t.call(this),this.action=e,this.zone=i,this.invertZone=n}return __extends(e,t),Object.defineProperty(e.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invertZone",{get:function(){return this._invert},set:function(t){this._invert=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._action.priority},set:function(t){this._action.priority=t},enumerable:!0,configurable:!0}),e.prototype.addedToEmitter=function(t){this._action.addedToEmitter(t)},e.prototype.removedFromEmitter=function(t){this._action.removedFromEmitter(t)},e.prototype.update=function(t,e,i){var n=e;this._zone.contains(n.x,n.y)?this._invert||this._action.update(t,e,i):this._invert&&this._action.update(t,e,i)},e}(t.ActionBase);t.ZonedAction=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._priority=0}return Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!0,configurable:!0}),t.prototype.addedToEmitter=function(){},t.prototype.removedFromEmitter=function(){},t.prototype.initialize=function(){},t.prototype.update=function(){},t}();t.ActivityBase=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),t.call(this),this.x=e,this.y=i}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._velX
},set:function(t){this._velX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._velY},set:function(t){this._velY=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=t;i.x+=this._velX*e,i.y+=this._velY*e},e}(t.ActivityBase);t.MoveEmitter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=0),t.call(this),this.angularVelocity=e}return __extends(e,t),Object.defineProperty(e.prototype,"angularVelocity",{get:function(){return this._angularVelocity},set:function(t){this._angularVelocity=t},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){var i=t;i.rotRadians+=this._angularVelocity*e},e}(t.ActivityBase);t.RotateEmitter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this.action=e}return __extends(e,t),e.prototype.update=function(t,e){this.action.frameUpdate(t,e)},e}(t.ActivityBase);t.UpdateOnFrame=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=0),this._startCount=t,this._done=!1}return Object.defineProperty(t.prototype,"startCount",{get:function(){return this._startCount},set:function(t){this._startCount=t},enumerable:!0,configurable:!0}),t.prototype.stop=function(){},t.prototype.resume=function(){},t.prototype.startEmitter=function(t){return this._done=!0,t.dispatchCounterComplete(),this._startCount},t.prototype.updateEmitter=function(){return 0},Object.defineProperty(t.prototype,"complete",{get:function(){return this._done},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.Blast=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=0),this._stop=!1,this._counter=t,this._keyCode=e,this._isDown=!1}return Object.defineProperty(t.prototype,"counter",{get:function(){return this._counter},set:function(t){this._counter=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyCode",{get:function(){return this._keyCode},set:function(t){this._keyCode=t},enumerable:!0,configurable:!0}),t.prototype.startEmitter=function(t){return this._isDown&&!this._stop?this._counter.startEmitter(t):(this._counter.startEmitter(t),0)},t.prototype.updateEmitter=function(t,e){return this._isDown&&!this._stop?this._counter.updateEmitter(t,e):0},t.prototype.stop=function(){this._stop=!0},t.prototype.resume=function(){this._stop=!1},Object.defineProperty(t.prototype,"complete",{get:function(){return this._counter.complete},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._counter.running},enumerable:!0,configurable:!0}),t}();t.KeyDownCounter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e,i){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=30),this._running=!1,this._rateMin=t,this._rate=this._rateMax=e,this._target=i,this._times=[],this._timeToRateCheck=0}return Object.defineProperty(t.prototype,"rateMin",{get:function(){return this._rateMin},set:function(t){this._rateMin=t,this._timeToRateCheck=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rateMax",{get:function(){return this._rateMax},set:function(t){this._rate=this._rateMax=t,this._timeToRateCheck=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetFrameRate",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),t.prototype.stop=function(){this._running=!1},t.prototype.resume=function(){this._running=!0},t.prototype.startEmitter=function(){return this._running=!0,this.newTimeToNext(),0},t.prototype.newTimeToNext=function(){this._timeToNext=1/this._rate},t.prototype.updateEmitter=function(t,e){if(!this._running)return 0;if(this._rate>this._rateMin&&(this._timeToRateCheck-=e)<=0){var i,n=Math.round(1e4/(i-this._times.shift()));n<this._target&&(this._rate=Math.floor(.5*(this._rate+this._rateMin)),this._times.length=0,(this._timeToRateCheck=t.particles[0].lifetime)||(this._timeToRateCheck=2))}var o=e,r=0;for(o-=this._timeToNext;o>=0;)++r,this.newTimeToNext(),o-=this._timeToNext;return this._timeToNext=-o,r},Object.defineProperty(t.prototype,"complete",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t}();t.PerformanceAdjusted=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),this._running=!1,this._quantity=e,this._period=t}return t.prototype.stop=function(){this._running=!1},t.prototype.resume=function(){this._running=!0},Object.defineProperty(t.prototype,"period",{get:function(){return this._period},set:function(t){this._period=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quantity",{get:function(){return this._quantity},set:function(t){this._quantity=t},enumerable:!0,configurable:!0}),t.prototype.startEmitter=function(){return this._running=!0,this._timeToNext=this._period,this._quantity},t.prototype.updateEmitter=function(t,e){if(!this._running)return 0;var i=0;for(this._timeToNext-=e;this._timeToNext<=0;)i+=this._quantity,this._timeToNext+=this._period;return i},Object.defineProperty(t.prototype,"complete",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t}();t.Pulse=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),this._running=!1,this._minRate=t,this._maxRate=e}return t.prototype.stop=function(){this._running=!1},t.prototype.resume=function(){this._running=!0},Object.defineProperty(t.prototype,"minRate",{get:function(){return this._minRate},set:function(t){this._minRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRate",{get:function(){return this._maxRate},set:function(t){this._maxRate=t},enumerable:!0,configurable:!0}),t.prototype.startEmitter=function(){return this._running=!0,this._timeToNext=this.newTimeToNext(),0},t.prototype.newTimeToNext=function(){var t=Math.random()*(this._maxRate-this._minRate)+this._maxRate;return 1/t},t.prototype.updateEmitter=function(t,e){if(!this._running)return 0;var i=0;for(this._timeToNext-=e;this._timeToNext<=0;)++i,this._timeToNext+=this.newTimeToNext();return i},Object.defineProperty(t.prototype,"complete",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t}();t.RandomCounter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t,e,i){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),this._running=!1,this._period=t,this._rateMin=i,this._rateMax=e,this._factor=2*Math.PI/t,this._scale=.5*(this._rateMax-this._rateMin)}return t.prototype.stop=function(){this._running=!1},t.prototype.resume=function(){this._running=!0,this._emitted=0},Object.defineProperty(t.prototype,"rateMin",{get:function(){return this._rateMin},set:function(t){this._rateMin=t,this._scale=.5*(this._rateMax-this._rateMin)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rateMax",{get:function(){return this._rateMax},set:function(t){this._rateMax=t,this._scale=.5*(this._rateMax-this._rateMin)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"period",{get:function(){return this._period},set:function(t){this._period=t,this._factor=2*Math.PI/this._period},enumerable:!0,configurable:!0}),t.prototype.startEmitter=function(){return this._running=!0,this._timePassed=0,this._emitted=0,0},t.prototype.updateEmitter=function(t,e){if(!this._running)return 0;this._timePassed+=e;var i=Math.floor(this._rateMax*this._timePassed+this._scale*(1-Math.cos(this._timePassed*this._factor))/this._factor),n=i-this._emitted;return this._emitted=i,n},Object.defineProperty(t.prototype,"complete",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t}();t.SineCounter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(t){"undefined"==typeof t&&(t=0),this._running=!1,this.rate=t}return t.prototype.stop=function(){this._running=!1},t.prototype.resume=function(){this._running=!0},Object.defineProperty(t.prototype,"rate",{get:function(){return this._rate},set:function(t){if((!t||0>t)&&(t=0),this._rate!=t)if(this._rate&&t){var e=this._rateInv-this._timeToNext;this._rate=t,this._rateInv=t?1/t:Number.MAX_VALUE,this._timeToNext=Math.max(this._rateInv-e,0)}else this._rate=t,this._rateInv=t?1/t:Number.MAX_VALUE,this._timeToNext=this._rateInv},enumerable:!0,configurable:!0}),t.prototype.startEmitter=function(){return this._running=!0,this._timeToNext=this._rateInv,0},t.prototype.updateEmitter=function(t,e){if(!this._running)return 0;var i=0;for(this._timeToNext-=e;this._timeToNext<=0;)++i,this._timeToNext+=this._rateInv;return i},Object.defineProperty(t.prototype,"complete",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t}();t.Steady=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=null),this._running=!1,this._particles=e,this._duration=i,this._easing=null==n?t.Linear.easeNone:n}return Object.defineProperty(e.prototype,"numParticles",{get:function(){return this._particles},set:function(t){this._particles=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"easing",{get:function(){return this._easing},set:function(t){this._easing=t},enumerable:!0,configurable:!0}),e.prototype.startEmitter=function(){return this._running=!0,this._particlesPassed=0,this._timePassed=0,0},e.prototype.updateEmitter=function(t,e){if(!this._running||this._timePassed>=this._duration)return 0;if(this._timePassed+=e,this._timePassed>=this._duration){t.dispatchCounterComplete();var i=this._particles-this._particlesPassed;return this._particlesPassed=this._particles,i}var n=this._particlesPassed;return this._particlesPassed=Math.round(this._easing(this._timePassed,0,this._particles,this._duration)),this._particlesPassed-n},e.prototype.stop=function(){this._running=!1},e.prototype.resume=function(){this._running=!0},Object.defineProperty(e.prototype,"complete",{get:function(){return this._particlesPassed==this._particles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"running",{get:function(){return this._running&&this._timePassed<this._duration},enumerable:!0,configurable:!0}),e}();t.TimePeriod=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.prototype.startEmitter=function(){return 0},t.prototype.updateEmitter=function(){return 0},t.prototype.stop=function(){},t.prototype.resume=function(){},Object.defineProperty(t.prototype,"complete",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.ZeroCounter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.numParticles=0,t}();t.ParticleFactoryStats=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o){"undefined"==typeof o&&(o=i.NAME),e.call(this,o),this._timeManager=n,this.particleDead=new t.Signal,this.particleCreated=new t.Signal,this.particleAdded=new t.Signal,this.particleRemoved=new t.Signal,this.particleCollision=new t.Signal,this.particleZoneCollision=new t.Signal,this.particleBoundingBoxCollision=new t.Signal,this.emitterEmpty=new t.Signal,this.emitterUpdated=new t.Signal,this.counterComplete=new t.Signal,this._particles=[],this._initializers=[],this._actions=[],this._activities=[],this._running=!1,this._started=!1,this._updating=!1,this._maximumFrameTime=.1,this._dispatchCounterComplete=!1,this._processLastFirst=!1,this._counter=new t.ZeroCounter}return __extends(i,e),i.NAME="Emitter",Object.defineProperty(i.prototype,"maximumFrameTime",{get:function(){return this._maximumFrameTime},set:function(t){this._maximumFrameTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"initializers",{get:function(){return this._initializers},set:function(t){for(var e=this._initializers.length-1;e>=0;e--)this._initializers[e].removedFromEmitter(this);this._initializers=t.concat(),this._initializers.sort(this.prioritySort);for(var e=t.length-1;e>=0;e--)t[e].addedToEmitter(this)},enumerable:!0,configurable:!0}),i.prototype.addInitializer=function(t){for(var e=this._initializers.length,i=0;e>i&&!(this._initializers[i].priority<t.priority);++i);this._initializers.splice(i,0,t),t.addedToEmitter(this)},i.prototype.removeInitializer=function(t){var e=this._initializers.indexOf(t);-1!=e&&(this._initializers.splice(e,1),t.removedFromEmitter(this))},i.prototype.hasInitializer=function(t){return-1!=this._initializers.indexOf(t)},i.prototype.hasInitializerOfType=function(t){for(var e=this._initializers.length,i=0;e>i;++i)if(this._initializers[i]instanceof t)return!0;return!1},Object.defineProperty(i.prototype,"actions",{get:function(){return this._actions},set:function(t){for(var e=this._actions.length-1;e>=0;e--)this._actions[e].removedFromEmitter(this);this._actions=t.concat(),this._actions.sort(this.prioritySort);for(var e=t.length-1;e>=0;e--)t[e].addedToEmitter(this)},enumerable:!0,configurable:!0}),i.prototype.addAction=function(t){for(var e=this._actions.length,i=0;e>i&&!(this._actions[i].priority<t.priority);++i);this._actions.splice(i,0,t),t.addedToEmitter(this)},i.prototype.removeAction=function(t){var e=this._actions.indexOf(t);-1!=e&&(this._actions.splice(e,1),t.removedFromEmitter(this))},i.prototype.hasAction=function(t){return-1!=this._actions.indexOf(t)},i.prototype.hasActionOfType=function(t){for(var e=this._actions.length,i=0;e>i;++i)if(this._actions[i]instanceof t)return!0;return!1},Object.defineProperty(i.prototype,"activities",{get:function(){return this._activities},set:function(t){for(var e=this._activities.length-1;e>=0;e--)this._activities[e].removedFromEmitter(this);this._activities=t.concat(),this._activities.sort(this.prioritySort);for(var e=t.length-1;e>=0;e--)t[e].addedToEmitter(this)},enumerable:!0,configurable:!0}),i.prototype.addActivity=function(t){for(var e=this._activities.length,i=0;e>i&&!(this._activities[i].priority<t.priority);++i);this._activities.splice(i,0,t),t.addedToEmitter(this)},i.prototype.removeActivity=function(t){var e=this._activities.indexOf(t);-1!=e&&(this._activities.splice(e,1),t.removedFromEmitter(this))},i.prototype.hasActivity=function(t){return-1!=this._activities.indexOf(t)},i.prototype.hasActivityOfType=function(t){for(var e=this._activities.length,i=0;e>i;++i)if(this._activities[i]instanceof t)return!0;return!1},Object.defineProperty(i.prototype,"counter",{get:function(){return this._counter},set:function(t){this._counter=t,this.running&&this._counter.startEmitter(this)},enumerable:!0,configurable:!0}),i.prototype.dispatchCounterComplete=function(){this._dispatchCounterComplete=!0},Object.defineProperty(i.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"particleFactory",{get:function(){return this._particleFactory},set:function(t){this._particleFactory=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"particles",{get:function(){return this._particles},set:function(t){this.killAllParticles(),this.addParticles(t,!1)},enumerable:!0,configurable:!0}),i.prototype._createParticle=function(){this._p=this._particleFactory.createParticle(),this._len=this._initializers.length,this._initParticle(this._p);for(var t=0;t<this._len;++t)this._initializers[t].initialize(this,this._p);return this._particles.push(this._p),this.particleCreated.getNumListeners()>0&&this.particleCreated.dispatch(this._p),this._p},i.prototype._initParticle=function(){},i.prototype.addParticle=function(t,e){if("undefined"==typeof e&&(e=!1),e)for(var i=this._initializers.length,n=0;i>n;++n)this._initializers[n].initialize(this,t);this._particles.push(t),this.particleAdded.getNumListeners()>0&&this.particleAdded.dispatch(t)},i.prototype.addParticles=function(t,e){"undefined"==typeof e&&(e=!1);var i,n=t.length;if(e)for(var o=this._initializers.length,r=0;o>r;++r)for(i=0;n>i;++i)this._initializers[r].initialize(this,t[i]);if(this.particleAdded.getNumListeners()>0)for(i=0;n>i;++i)this._particles.push(t[i]),this.particleAdded.dispatch(t[i]);else for(i=0;n>i;++i)this._particles.push(t[i])},i.prototype.removeParticle=function(t){var e=this._particles.indexOf(t);return-1!=e?(this._updating?this.emitterUpdated.add(this.onRemoveParticle,this):(this._particles.splice(e,1),this.particleRemoved.dispatch(t)),!0):!1},i.prototype.onRemoveParticle=function(t){this.emitterUpdated.remove(this.onRemoveParticle,this),this.removeParticle(t)},i.prototype.removeParticles=function(t){if(this._updating)this.emitterUpdated.add(this.onRemoveParticles,this);else for(var e=0,i=t.length;i>e;++e){var n=this._particles.indexOf(t[e]);-1!=n&&(this._particles.splice(n,1),this.particleRemoved.dispatch(t[e]))}},i.prototype.onRemoveParticles=function(t){this.emitterUpdated.remove(this.onRemoveParticles,this),this.removeParticles(t)},i.prototype.killAllParticles=function(){var t,e=this._particles.length;if(this.particleDead.getNumListeners()>0)for(t=0;e>t;++t)this.particleDead.dispatch(this._particles[t]),this._particleFactory.disposeParticle(this._particles[t]);else for(t=0;e>t;++t)this._particleFactory.disposeParticle(this._particles[t]);this._particles=[]},i.prototype.start=function(){this._timeManager.addTickedObject(this),this._started=!0,this._running=!0;for(var t=this._activities.length,e=0;t>e;++e)this._activities[e].initialize(this);for(t=this._counter.startEmitter(this),e=0;t>e;++e)this._createParticle()},i.prototype.onTick=function(t){this.update(t)},i.prototype.update=function(t){if(this._running){t>this._maximumFrameTime&&(t=this._maximumFrameTime);var e,i;this._updating=!0;var n=this._counter.updateEmitter(this,t);for(e=0;n>e;++e)this._createParticle();for(this._sortParticles(),n=this._activities.length,e=0;n>e;++e)this._activities[e].update(this,t);if(this._particles.length>0){n=this._actions.length;var o,r,s=this._particles.length;if(this._processLastFirst)for(r=0;n>r;++r)for(o=this._actions[r],e=s-1;e>=0;--e)i=this._particles[e],o.update(this,i,t);else for(r=0;n>r;++r)for(o=this._actions[r],e=0;s>e;++e)i=this._particles[e],o.update(this,i,t);if(this._processLastFirst=!this._processLastFirst,this.particleDead.getNumListeners()>0)for(e=s;e--;)i=this._particles[e],i.isDead&&(this._particles.splice(e,1),this.particleDead.dispatch(i),i.isDead&&this._particleFactory.disposeParticle(i));else for(e=s;e--;)i=this._particles[e],i.isDead&&(this._particles.splice(e,1),this._particleFactory.disposeParticle(i))}else this.emitterEmpty.getNumListeners()>0&&this.emitterEmpty.dispatch(this);this._updating=!1,this.emitterUpdated.getNumListeners()>0&&this.emitterUpdated.dispatch(this),this._dispatchCounterComplete&&(this._dispatchCounterComplete=!1,this.counterComplete.getNumListeners()>0&&this.counterComplete.dispatch())}},i.prototype._sortParticles=function(){},i.prototype.pause=function(){this._running=!1},i.prototype.resume=function(){this._running=!0},i.prototype.stop=function(){this._timeManager.removeTickedObject(this),this._started=!1,this._running=!1,this.killAllParticles()},i.prototype.runAhead=function(t,e){"undefined"==typeof e&&(e=10);var i=this._maximumFrameTime,n=1/e;for(this._maximumFrameTime=n;t>0;)t-=n,this.update(n);this._maximumFrameTime=i},i.prototype.prioritySort=function(t,e){return t.priority-e.priority},i.prototype.destroy=function(){this.particleDead.removeAll(),this.particleCreated.removeAll(),this.particleAdded.removeAll(),this.particleRemoved.removeAll(),this.particleCollision.removeAll(),this.particleZoneCollision.removeAll(),this.particleBoundingBoxCollision.removeAll(),this.emitterEmpty.removeAll(),this.emitterUpdated.removeAll(),this.counterComplete.removeAll(),this.particleDead=null,this.particleCreated=null,this.particleAdded=null,this.particleRemoved=null,this.particleCollision=null,this.particleZoneCollision=null,this.particleBoundingBoxCollision=null,this.emitterEmpty=null,this.emitterUpdated=null,this.counterComplete=null,this._particles=null,this._initializers=null,this._actions=null,this._activities=null,this._counter=null,e.prototype.destroy.call(this)},i}(t.Element);t.Emitter=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o){"undefined"==typeof o&&(o=t.Emitter.NAME),e.call(this,n,o),i._creator||(i._creator=new t.ParticleCreator2D),this._particleFactory=i._creator,this._x=0,this._y=0,this._rotation=0,this.spaceSort=!1}return __extends(i,e),Object.defineProperty(i,"defaultParticleFactory",{get:function(){return i._creator},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return t.GeomUtil.radiansToDegrees(this._rotation)},set:function(e){this._rotation=t.GeomUtil.degreesToRadians(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotRadians",{get:function(){return this._rotation},set:function(t){this._rotation=t},enumerable:!0,configurable:!0}),i.prototype._initParticle=function(t){t.x=this._x,t.y=this._y,t.previousX=this._x,t.previousY=this._y,t.rotation=this._rotation},i.prototype._sortParticles=function(){if(this.spaceSort){this._particles.sort(this.xSort);for(var t=this._particles.length,e=0;t>e;++e)this._particles[e].sortID=e}},i.prototype.xSort=function(t,e){return t.x-e.x},i}(t.Emitter);t.Emitter2D=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._priority=0}return Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!0,configurable:!0}),t.prototype.addedToEmitter=function(){},t.prototype.removedFromEmitter=function(){},t.prototype.initialize=function(){},t}();t.InitializerBase=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=0/0),t.call(this),this.priority=-10,this._min=e,this._max=isNaN(i)?this._min:i}return __extends(e,t),Object.defineProperty(e.prototype,"minAlpha",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAlpha",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i;i=this._max==this._min?this._min:this._min+Math.random()*(this._max-this._min),e.color=16777215&e.color|Math.round(255*i)<<24},e}(t.InitializerBase);t.AlphaInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this),this._initializers=new t.WeightedArray,null!=i&&this.init(i,n)}return __extends(i,e),i.prototype.addedToEmitter=function(){this._mxmlInitializers&&(this.init(this._mxmlInitializers,this._mxmlWeights),this._mxmlInitializers=null,this._mxmlWeights=null)},i.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._initializers.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this._initializers.add(t[i],e[i]);else for(i=0;n>i;++i)this._initializers.add(t[i],1)},i.prototype.addInitializer=function(t,e){"undefined"==typeof e&&(e=1),this._initializers.add(t,e)},i.prototype.removeInitializer=function(t){this._initializers.remove(t)},Object.defineProperty(i.prototype,"initializers",{set:function(t){this._mxmlInitializers=t,this.checkStartValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),i.prototype.checkStartValues=function(){this._mxmlInitializers&&this._mxmlWeights&&(this.init(this._mxmlInitializers,this._mxmlWeights),this._mxmlInitializers=null,this._mxmlWeights=null)},i.prototype.initialize=function(t,e){var i=this._initializers.getRandomValue();i.initialize(t,e)},i}(t.InitializerBase);t.ChooseInitializer=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=1),t.call(this),this._radius=e}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){e.collisionRadius=this._radius},e}(t.InitializerBase);t.CollisionRadiusInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){"undefined"==typeof t&&(t=16777215),"undefined"==typeof i&&(i=16777215),e.call(this),this._min=t,this._max=i}return __extends(i,e),Object.defineProperty(i.prototype,"minColor",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxColor",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._min==this._max?this._min:t.ColorUtil.interpolateARGB(this._max,this._min,.5)},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),i.prototype.initialize=function(e,i){i.color=this._max==this._min?this._min:t.ColorUtil.interpolateARGB(this._min,this._max,Math.random())},i}(t.InitializerBase);t.ColorInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this),this._colors=new t.WeightedArray,null!=i&&this.init(i,n)}return __extends(i,e),i.prototype.addedToEmitter=function(){this._mxmlColors&&(this.init(this._mxmlColors,this._mxmlWeights),this._mxmlColors=null,this._mxmlWeights=null)},i.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._colors.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this._colors.add(t[i],e[i]);else for(i=0;n>i;++i)this._colors.add(t[i],1)},i.prototype.addColor=function(t,e){"undefined"==typeof e&&(e=1),this._colors.add(t,e)},i.prototype.removeColor=function(t){this._colors.remove(t)},Object.defineProperty(i.prototype,"colors",{set:function(t){this._mxmlColors=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),i.prototype.checkStartValues=function(){this._mxmlColors&&this._mxmlWeights&&(this.init(this._mxmlColors,this._mxmlWeights),this._mxmlColors=null,this._mxmlWeights=null)},i.prototype.initialize=function(t,e){e.color=this._colors.getRandomValue()},i}(t.InitializerBase);t.ColorsInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this._initValues=e}return __extends(e,t),Object.defineProperty(e.prototype,"initValues",{get:function(){return this._initValues},set:function(t){this._initValues=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){if(this._initValues)for(var i in this._initValues)e.dictionary[i]=this._initValues[i]},e}(t.InitializerBase);t.DictionaryInitializer=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=0),t.call(this),this._usePool=e,this._emitters=[],this._usePool&&(this.clearPool(),i&&this.fillPool(i))}return __extends(e,t),e.prototype.clearPool=function(){this._pool=[]},e.prototype.addedToEmitter=function(t){this._emitters.push(t),this._usePool&&t.particleDead.add(this.particleDying,this,-1e3)},e.prototype.particleDying=function(t){t.isDead&&t.dictionary.get(this)&&(this._pool.push(t.image),delete t.dictionary.get(this))},e.prototype.removedFromEmitter=function(t){t.particleDead.remove(this.particleDying,this);var e=this._emitters.indexOf(t);-1!=e&&this._emitters.splice(e,1)},e.prototype.fillPool=function(t){if(this._usePool){this._pool.length>0&&(this._pool=[]);for(var e=0;t>e;++e)this._pool[e]=this.createImage()}},Object.defineProperty(e.prototype,"usePool",{get:function(){return this._usePool},set:function(t){if(this._usePool!=t)if(this._usePool=t,this._usePool)for(var e=0;e<this._emitters.length;e++)this._emitters[e].particleDead.add(this.particleDying,this,-1e3);else for(var e=0;e<this._emitters.length;e++)this._emitters[e].particleDead.remove(this.particleDying,this)},enumerable:!0,configurable:!0}),e.prototype.createImage=function(){throw new Error("Image initializer must override the createImage method.")},e.prototype.initialize=function(t,e){this._usePool?(e.image=this._pool.length>0?this._pool.shift():this.createImage(),e.dictionary.put(this,!0)):e.image=this.createImage()},e}(t.InitializerBase);t.ImageInitializerBase=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i,n,o){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=!1),"undefined"==typeof o&&(o=0),e.call(this,n),this._imageClass=t,this._parameters=i?i:[],o>0&&this.fillPool(o)}return __extends(i,e),Object.defineProperty(i.prototype,"imageClass",{get:function(){return this._imageClass},set:function(t){this._imageClass=t,this._usePool&&this.clearPool()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parameters",{get:function(){return this._parameters},set:function(t){this._parameters=t,this._usePool&&this.clearPool()},enumerable:!0,configurable:!0}),i.prototype.createImage=function(){return t.ObjectUtil.create(this._imageClass,this._parameters)},i}(t.ImageInitializerBase);t.ImageClass=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i,n,o,r){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o=!1),"undefined"==typeof r&&(r=0),e.call(this,o),this._images=new t.WeightedArray,null!=i&&(this.init(i,n),r>0&&this.fillPool(r))}return __extends(n,e),n.prototype.addedToEmitter=function(t){e.prototype.addedToEmitter.call(this,t),this._mxmlImages&&(this.init(this._mxmlImages,this._mxmlWeights),this._mxmlImages=null,this._mxmlWeights=null)},n.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._images.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this.addImage(t[i],e[i]);else for(i=0;n>i;++i)this.addImage(t[i],1)},n.prototype.addImage=function(e,n){if("undefined"==typeof n&&(n=1),t.ObjectUtil.isArray(e)){var o=e.concat(),r=o.shift();this._images.add(new i(r,o),n)}else this._images.add(new i(e,[]),n);this._usePool&&this.clearPool()},n.prototype.removeImage=function(t){this._images.remove(t),this._usePool&&this.clearPool()},Object.defineProperty(n.prototype,"images",{set:function(t){this._mxmlImages=t,this.checkStartValues(),this._usePool&&this.clearPool()
},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues(),this._usePool&&this.clearPool()},enumerable:!0,configurable:!0}),n.prototype.checkStartValues=function(){this._mxmlImages&&this._mxmlWeights&&(this.init(this._mxmlImages,this._mxmlWeights),this._mxmlImages=null,this._mxmlWeights=null)},n.prototype.createImage=function(){var e=this._images.getRandomValue();return t.ObjectUtil.create(e.image,e.parameters)},n}(t.ImageInitializerBase);t.ImageClasses=e;var i=function(){function t(t,e){this.image=t,this.parameters=e}return t}();t.ImagePair=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(){for(var e=[],i=0;i<arguments.length-0;i++)e[i]=arguments[i+0];t.call(this),this._initializers=[];for(var n=0;n<e.length;n++)this.addInitializer(e[n])}return __extends(e,t),Object.defineProperty(e.prototype,"initializers",{get:function(){return this._initializers},set:function(t){if(this._emitter)for(var e=0;e<this._initializers.length;e++)this._initializers[e].removedFromEmitter(this._emitter);if(this._initializers=t.concat(),this._initializers.sort(this.prioritySort),this._emitter)for(var e=0;e<this._initializers.length;e++)this._initializers[e].addedToEmitter(this._emitter)},enumerable:!0,configurable:!0}),e.prototype.addInitializer=function(t){for(var e=this._initializers.length,i=0;e>i&&!(this._initializers[i].priority<t.priority);++i);this._initializers.splice(i,0,t),this._emitter&&t.addedToEmitter(this._emitter)},e.prototype.removeInitializer=function(t){var e=this._initializers.indexOf(t);-1!=e&&(this._initializers.splice(e,1),this._emitter&&t.removedFromEmitter(this._emitter))},e.prototype.addedToEmitter=function(t){this._emitter=t;for(var e=this._initializers.length,i=0;e>i;++i)this._initializers[i].addedToEmitter(t)},e.prototype.removedFromEmitter=function(t){for(var e=this._initializers.length,i=0;e>i;++i)this._initializers[i].removedFromEmitter(t);this._emitter=null},e.prototype.initialize=function(t,e){for(var i=this._initializers.length,n=0;i>n;++n)this._initializers[n].initialize(t,e)},e.prototype.prioritySort=function(t,e){return t.priority-e.priority},e}(t.InitializerBase);t.InitializerGroup=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=Number.MAX_VALUE),"undefined"==typeof i&&(i=0/0),t.call(this),this._max=i,this._min=e}return __extends(e,t),Object.defineProperty(e.prototype,"minLifetime",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLifetime",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifetime",{get:function(){return this._min==this._max?this._min:.5*(this._max+this._min)},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){e.lifetime=isNaN(this._max)?this._min:this._min+Math.random()*(this._max-this._min)},e}(t.InitializerBase);t.Lifetime=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=1),t.call(this),this._mass=e}return __extends(e,t),Object.defineProperty(e.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){e.mass=this._mass},e}(t.InitializerBase);t.MassInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=null),t.call(this),this.zone=e}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e,n=this._zone.getLocation();if(0==i.rotation)i.x+=n.x,i.y+=n.y;else{var o=Math.sin(i.rotation),r=Math.cos(i.rotation);i.x+=r*n.x-o*n.y,i.y+=r*n.y+o*n.x}i.previousX=i.x,i.previousY=i.y},e}(t.InitializerBase);t.Position=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=null),t.call(this),this.zone=e}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e,n=this._zone.getLocation();i.x=n.x,i.y=n.y,i.previousX=i.x,i.previousY=i.y},e}(t.InitializerBase);t.PositionAbsolute=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0/0),t.call(this),this.minAngVelocity=e,this.maxAngVelocity=i}return __extends(e,t),Object.defineProperty(e.prototype,"minAngVelocity",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAngVelocity",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angVelocity",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e;i.angVelocity=isNaN(this._max)?this._min:this._min+Math.random()*(this._max-this._min)},e}(t.InitializerBase);t.RotateVelocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0/0),t.call(this),this.minAngle=e,this.maxAngle=i}return __extends(e,t),Object.defineProperty(e.prototype,"minAngle",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e;i.rotation+=isNaN(this._max)?this._min:this._min+Math.random()*(this._max-this._min)},e}(t.InitializerBase);t.Rotation=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0/0),t.call(this),this.minAngle=e,this.maxAngle=i}return __extends(e,t),Object.defineProperty(e.prototype,"minAngle",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e;i.rotation=isNaN(this._max)?this._min:this._min+Math.random()*(this._max-this._min)},e}(t.InitializerBase);t.RotationAbsolute=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=0/0),t.call(this),this.priority=-10,this.minScale=e,this.maxScale=isNaN(i)?e:i}return __extends(e,t),Object.defineProperty(e.prototype,"minScale",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScale",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i;i=this._max==this._min?this._min:this._min+Math.random()*(this._max-this._min),e.scale=i,e.mass*=i*i,e.collisionRadius*=i},e}(t.InitializerBase);t.ScaleAllInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this),this.priority=-10,this._scales=new t.WeightedArray,null!=i&&this.init(i,n)}return __extends(i,e),i.prototype.addedToEmitter=function(){this._mxmlScales&&(this.init(this._mxmlScales,this._mxmlWeights),this._mxmlScales=null,this._mxmlWeights=null)},i.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._scales.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this._scales.add(t[i],e[i]);else for(i=0;n>i;++i)this._scales.add(t[i],1)},i.prototype.addScale=function(t,e){"undefined"==typeof e&&(e=1),this._scales.add(t,e)},i.prototype.removeScale=function(t){this._scales.remove(t)},Object.defineProperty(i.prototype,"scales",{set:function(t){this._mxmlScales=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),i.prototype.checkStartValues=function(){this._mxmlScales&&this._mxmlWeights&&(this.init(this._mxmlScales,this._mxmlWeights),this._mxmlScales=null,this._mxmlWeights=null)},i.prototype.initialize=function(t,e){var i=this._scales.getRandomValue();e.scale=i,e.mass*=i*i,e.collisionRadius*=i},i}(t.InitializerBase);t.ScaleAllsInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=0/0),t.call(this),this._min=e,this._max=isNaN(i)?this._min:i}return __extends(e,t),Object.defineProperty(e.prototype,"minScale",{get:function(){return this._min},set:function(t){this._min=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScale",{get:function(){return this._max},set:function(t){this._max=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._min==this._max?this._min:(this._max+this._min)/2},set:function(t){this._max=this._min=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){e.scale=this._max==this._min?this._min:this._min+Math.random()*(this._max-this._min)},e}(t.InitializerBase);t.ScaleImageInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this),this._scales=new t.WeightedArray,null!=i&&this.init(i,n)}return __extends(i,e),i.prototype.addedToEmitter=function(){this._mxmlScales&&(this.init(this._mxmlScales,this._mxmlWeights),this._mxmlScales=null,this._mxmlWeights=null)},i.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._scales.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this._scales.add(t[i],e[i]);else for(i=0;n>i;++i)this._scales.add(t[i],1)},i.prototype.addScale=function(t,e){"undefined"==typeof e&&(e=1),this._scales.add(t,e)},i.prototype.removeScale=function(t){this._scales.remove(t)},Object.defineProperty(i.prototype,"scales",{set:function(t){this._mxmlScales=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),i.prototype.checkStartValues=function(){this._mxmlScales&&this._mxmlWeights&&(this.init(this._mxmlScales,this._mxmlWeights),this._mxmlScales=null,this._mxmlWeights=null)},i.prototype.initialize=function(t,e){e.scale=this._scales.getRandomValue()},i}(t.InitializerBase);t.ScaleImagesInit=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){t.call(this),this.priority=-10,this._properties=e}return __extends(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return this._properties},set:function(t){this._properties=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){if(!e.image)throw new Error("Attempting to set image properties when no image is set");var i=e.image;for(var n in this._properties)i.hasOwnProperty(n)&&(i[n]=this._properties[n])},e}(t.InitializerBase);t.SetImageProperties=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=null),t.call(this),this._image=e}return __extends(e,t),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},set:function(t){this._image=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){e.image=this._image},e}(t.InitializerBase);t.SharedImage=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(i,n){"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),e.call(this),this._images=new t.WeightedArray,null!=i&&this.init(i,n)}return __extends(i,e),i.prototype.addedToEmitter=function(){this._mxmlImages&&(this.init(this._mxmlImages,this._mxmlWeights),this._mxmlImages=null,this._mxmlWeights=null)},i.prototype.init=function(t,e){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=null),this._images.clear();var i,n=t.length;if(null!=e&&e.length==n)for(i=0;n>i;++i)this._images.add(t[i],e[i]);else for(i=0;n>i;++i)this._images.add(t[i],1)},i.prototype.addImage=function(t,e){"undefined"==typeof e&&(e=1),this._images.add(t,e)},i.prototype.removeImage=function(t){this._images.remove(t)},Object.defineProperty(i.prototype,"images",{set:function(t){this._mxmlImages=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weights",{set:function(t){this._mxmlWeights=1==t.length?t[0].split(","):t,this.checkStartValues()},enumerable:!0,configurable:!0}),i.prototype.checkStartValues=function(){this._mxmlImages&&this._mxmlWeights&&(this.init(this._mxmlImages,this._mxmlWeights),this._mxmlImages=null,this._mxmlWeights=null)},i.prototype.initialize=function(t,e){e.image=this._images.getRandomValue()},i}(t.InitializerBase);t.SharedImages=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e){"undefined"==typeof e&&(e=null),t.call(this),this.zone=e}return __extends(e,t),Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},set:function(t){this._zone=t},enumerable:!0,configurable:!0}),e.prototype.initialize=function(t,e){var i=e,n=this._zone.getLocation();if(0==i.rotation)i.velX=n.x,i.velY=n.y;else{var o=Math.sin(i.rotation),r=Math.cos(i.rotation);i.velX=r*n.x-o*n.y,i.velY=r*n.y+o*n.x}},e}(t.InitializerBase);t.Velocity=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){this.initialize()}return Object.defineProperty(e.prototype,"dictionary",{get:function(){return null==this._dictionary&&(this._dictionary=new t.Dictionary),this._dictionary},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){this.color=4294967295,this.scale=1,this.mass=1,this.collisionRadius=1,this.lifetime=0,this.age=0,this.energy=1,this.isDead=!1,this.image=null,this._dictionary=null},Object.defineProperty(e.prototype,"alpha",{get:function(){return((4278190080&this.color)>>>24)/255},enumerable:!0,configurable:!0}),e.prototype._cloneInto=function(e){if(e.color=this.color,e.scale=this.scale,e.mass=this.mass,e.collisionRadius=this.collisionRadius,e.lifetime=this.lifetime,e.age=this.age,e.energy=this.energy,e.isDead=this.isDead,e.image=this.image,this._dictionary){e._dictionary=new t.Dictionary;for(var i in this._dictionary._hash)e._dictionary.put(i,this._dictionary.get(i))}return e},e.prototype.clone=function(t){"undefined"==typeof t&&(t=null);var i;return i=t?t.createParticle():new e,this._cloneInto(i)},e.prototype.revive=function(){this.lifetime=0,this.age=0,this.energy=1,this.isDead=!1},e}();t.Particle=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(){e.call(this),this.sortID=-1,this.x=0,this.y=0,this.previousX=0,this.previousY=0,this.velX=0,this.velY=0,this.rotation=0,this.angVelocity=0,this._matrix=new t.Matrix}return __extends(i,e),Object.defineProperty(i.prototype,"inertia",{get:function(){return(this.mass!=this._previousMass||this.collisionRadius!=this._previousRadius)&&(this._inertia=this.mass*this.collisionRadius*this.collisionRadius*.5,this._previousMass=this.mass,this._previousRadius=this.collisionRadius),this._inertia},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){e.prototype.initialize.call(this),this.x=0,this.y=0,this.previousX=0,this.previousY=0,this.velX=0,this.velY=0,this.rotation=0,this.angVelocity=0,this.sortID=-1,this._regX=0,this._regY=0},Object.defineProperty(i.prototype,"matrixTransform",{get:function(){return this.image&&(this._regX=.5*this.image.width,this._regY=.5*this.image.height),this._matrix.identity(),this._matrix.translate(this.x+this._regX,this.y+this._regY),this._matrix.scale(this.scale,this.scale),this._matrix.rotate(this.rotation*(Math.PI/180)),this._matrix.translate(-this._regX,-this._regY),this._matrix},enumerable:!0,configurable:!0}),i.prototype.clone=function(t){"undefined"==typeof t&&(t=null);var e;return e=t?t.createParticle():new i,this._cloneInto(e),e.x=this.x,e.y=this.y,e.velX=this.velX,e.velY=this.velY,e.rotation=this.rotation,e.angVelocity=this.angVelocity,e},i}(t.Particle);t.Particle2D=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){this._particles=[]}return e.prototype.createParticle=function(){return t.ParticleFactoryStats.numParticles++,this._particles.length?this._particles.pop():new t.Particle2D},e.prototype.disposeParticle=function(e){t.ParticleFactoryStats.numParticles--,e instanceof t.Particle2D&&(e.initialize(),this._particles.push(e))},e.prototype.clearAllParticles=function(){this._particles=[]},e}();t.ParticleCreator2D=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._values=[],this._totalRatios=0}return t.prototype.add=function(t,e){return this._totalRatios+=e,this._values.push(new i(this._totalRatios,t)),this._values.length},t.prototype.clear=function(){this._values=[],this._totalRatios=0},Object.defineProperty(t.prototype,"length",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalRatios",{get:function(){return this._totalRatios},enumerable:!0,configurable:!0}),t.prototype.getRandomValue=function(){for(var t,e=Math.random()*this._totalRatios,i=0,n=this._values.length;n>i;)t=Math.floor(.5*(i+n)),this._values[t].topWeight<e?i=t+1:n=t;return this._values[i].value},t}();t.FastWeightedArray=e;var i=function(){function t(t,e){this.topWeight=t,this.value=e}return t}();t.FastPair=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._values=[],this._totalWeights=0}return t.prototype.add=function(t,e){return this._totalWeights+=e,this._values.push(new i(e,t)),this._values.length},t.prototype.remove=function(t){for(var e=this._values.length;e--;)if(this._values[e].value==t)return this._totalWeights-=this._values[e].weight,this._values.splice(e,1),!0;return!1},t.prototype.contains=function(t){for(var e=this._values.length;e--;)if(this._values[e].value==t)return!0;return!1},t.prototype.removeAt=function(t){var e=this._values[t].value;return this._totalWeights-=this._values[t].weight,this._values.splice(t,1),e},t.prototype.clear=function(){this._values=[],this._totalWeights=0},Object.defineProperty(t.prototype,"length",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalWeights",{get:function(){return this._totalWeights},enumerable:!0,configurable:!0}),t.prototype.getRandomValue=function(){for(var t=Math.random()*this._totalWeights,e=0,i=this._values.length,n=0;i>n;++n)if(e+=this._values[n].weight,e>=t)return this._values[n].value;return this._values[i-1].value},t}();t.WeightedArray=e;var i=function(){function t(t,e){this.weight=t,this.value=e}return t}();t.WeightedPair=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(i,n,o,r,s){if("undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=0),"undefined"==typeof r&&(r=0),"undefined"==typeof s&&(s=0),o>n)throw new Error("The outerRadius ("+n+") can't be smaller than the innerRadius ("+o+") in your DiscSectorZone. N.B. the outerRadius is the second argument in the constructor and the innerRadius is the third argument.");if(this._center=i?i.clone():new t.Point(0,0),this._innerRadius=o,this._outerRadius=n,this._innerSq=this._innerRadius*this._innerRadius,this._outerSq=this._outerRadius*this._outerRadius,this._minAngle=r,this._maxAngle=s,!isNaN(this._maxAngle)){for(;this._maxAngle>e.TWOPI;)this._maxAngle-=e.TWOPI;for(;this._maxAngle<0;)this._maxAngle+=e.TWOPI;this._minAllowed=this._maxAngle-e.TWOPI,isNaN(this._minAngle)||(this._minAngle=r==s?this._maxAngle:this.clamp(this._minAngle)),this.calculateNormals()}}return e.TWOPI=2*Math.PI,e.prototype.clamp=function(t){if(!isNaN(this._maxAngle)){for(;t>this._maxAngle;)t-=e.TWOPI;for(;t<this._minAllowed;)t+=e.TWOPI}return t},e.prototype.calculateNormals=function(){isNaN(this._minAngle)||(this._minNormal=new t.Point(Math.sin(this._minAngle),-Math.cos(this._minAngle)),this._minNormal.normalize(1)),isNaN(this._maxAngle)||(this._maxNormal=new t.Point(-Math.sin(this._maxAngle),Math.cos(this._maxAngle)),this._maxNormal.normalize(1))},Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(t){this._center=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._center.x},set:function(t){this._center.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._center.y},set:function(t){this._center.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this._innerRadius},set:function(t){this._innerRadius=t,this._innerSq=this._innerRadius*this._innerRadius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this._outerRadius},set:function(t){this._outerRadius=t,this._outerSq=this._outerRadius*this._outerRadius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minAngle",{get:function(){return this._minAngle},set:function(t){this._minAngle=this.clamp(t),this.calculateNormals()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){for(this._maxAngle=t;this._maxAngle>e.TWOPI;)this._maxAngle-=e.TWOPI;for(;this._maxAngle<0;)this._maxAngle+=e.TWOPI;this._minAllowed=this._maxAngle-e.TWOPI,this._minAngle=this.clamp(this._minAngle),this.calculateNormals()},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){t-=this._center.x,e-=this._center.y;var i=t*t+e*e;if(i>this._outerSq||i<this._innerSq)return!1;var n=Math.atan2(e,t);return n=this.clamp(n),n>=this._minAngle},e.prototype.getLocation=function(){var e=Math.random(),i=t.Point.polar(this._innerRadius+(1-e*e)*(this._outerRadius-this._innerRadius),this._minAngle+Math.random()*(this._maxAngle-this._minAngle));return i.x+=this._center.x,i.y+=this._center.y,i},e.prototype.getArea=function(){return(this._outerSq-this._innerSq)*(this._maxAngle-this._minAngle)*.5},e.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);var i=t.x-this._center.x,n=t.y-this._center.y,o=t.previousX-this._center.x,r=t.previousY-this._center.y,s=!0,a=!0,h=o*o+r*r,l=i*i+n*n;if((h>this._outerSq||h<this._innerSq)&&(a=!1),(l>this._outerSq||l<this._innerSq)&&(s=!1),!s&&!a)return!1;var c=this.clamp(Math.atan2(r,o)),u=this.clamp(Math.atan2(n,i));if(a=a&&c>=this._minAngle,s=s&&u>=this._minAngle,s==a)return!1;var p,d,f,_=t.velX*i+t.velY*n;return s?(h>this._outerSq?(p=(1+e)*_/l,t.velX-=p*i,t.velY-=p*n):h<this._innerSq&&(p=(1+e)*_/l,t.velX-=p*i,t.velY-=p*n),c<this._minAngle&&(c<(this._minAllowed+this._minAngle)/2?(f=this._maxNormal.x*t.velX+this._maxNormal.y*t.velY,d=(1+e)*f,t.velX-=d*this._maxNormal.x,t.velY-=d*this._maxNormal.y):(f=this._minNormal.x*t.velX+this._minNormal.y*t.velY,d=(1+e)*f,t.velX-=d*this._minNormal.x,t.velY-=d*this._minNormal.y))):(l>this._outerSq?(p=(1+e)*_/l,t.velX-=p*i,t.velY-=p*n):l<this._innerSq&&(p=(1+e)*_/l,t.velX-=p*i,t.velY-=p*n),u<this._minAngle&&(u<(this._minAllowed+this._minAngle)/2?(f=this._maxNormal.x*t.velX+this._maxNormal.y*t.velY,d=(1+e)*f,t.velX-=d*this._maxNormal.x,t.velY-=d*this._maxNormal.y):(f=this._minNormal.x*t.velX+this._minNormal.y*t.velY,d=(1+e)*f,t.velX-=d*this._minNormal.x,t.velY-=d*this._minNormal.y))),t.x=t.previousX,t.y=t.previousY,!0},e}();t.DiscSectorZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(e,i,n){if("undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),n>i)throw new Error("The outerRadius ("+i+") can't be smaller than the innerRadius ("+n+") in your DiscZone. N.B. the outerRadius is the second argument in the constructor and the innerRadius is the third argument.");this._center=null==e?new t.Point(0,0):e,this._innerRadius=n,this._outerRadius=i,this._innerSq=this._innerRadius*this._innerRadius,this._outerSq=this._outerRadius*this._outerRadius}return e.TWOPI=2*Math.PI,Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(t){this._center=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._center.x},set:function(t){this._center.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._center.y},set:function(t){this._center.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this._innerRadius},set:function(t){this._innerRadius=t,this._innerSq=this._innerRadius*this._innerRadius},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this._outerRadius},set:function(t){this._outerRadius=t,this._outerSq=this._outerRadius*this._outerRadius},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){t-=this._center.x,e-=this._center.y;var i=t*t+e*e;return i<=this._outerSq&&i>=this._innerSq},e.prototype.getLocation=function(){var i=Math.random(),n=t.Point.polar(this._innerRadius+(1-i*i)*(this._outerRadius-this._innerRadius),Math.random()*e.TWOPI);return n.x+=this._center.x,n.y+=this._center.y,n},e.prototype.getArea=function(){return Math.PI*(this._outerSq-this._innerSq)},e.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);var i,n,o,r,s,a,h,l,c,u,p,d=.001,f=t.x-this._center.x,_=t.y-this._center.y,g=t.velX*f+t.velY*_;if(0>g){if(i=this._outerRadius+t.collisionRadius,Math.abs(f)>i)return!1;if(Math.abs(_)>i)return!1;if(s=f*f+_*_,o=i*i,s>o)return!1;if(h=t.previousX-this._center.x,l=t.previousY-this._center.y,c=h*h+l*l,c>o)return u=(1+e)*g/s,t.velX-=u*f,t.velY-=u*_,a=Math.sqrt(s),p=(2*i-a)/a+d,t.x=this._center.x+f*p,t.y=this._center.y+_*p,!0;if(0!=this._innerRadius&&this._innerRadius!=this._outerRadius){if(n=this._innerRadius+t.collisionRadius,Math.abs(f)>n)return!1;if(Math.abs(_)>n)return!1;if(r=n*n,s>r)return!1;if(c>r)return u=(1+e)*g/s,t.velX-=u*f,t.velY-=u*_,a=Math.sqrt(s),p=(2*n-a)/a+d,t.x=this._center.x+f*p,t.y=this._center.y+_*p,!0}return!1}return i=this._outerRadius-t.collisionRadius,h=t.previousX-this._center.x,l=t.previousY-this._center.y,Math.abs(h)>i?!1:Math.abs(l)>i?!1:(c=h*h+l*l,o=i*i,c>o?!1:(s=f*f+_*_,0!=this._innerRadius&&this._innerRadius!=this._outerRadius&&(n=this._innerRadius-t.collisionRadius,r=n*n,r>c&&s>=r)?(u=(1+e)*g/s,t.velX-=u*f,t.velY-=u*_,a=Math.sqrt(s),p=(2*n-a)/a-d,t.x=this._center.x+f*p,t.y=this._center.y+_*p,!0):s>=o?(u=(1+e)*g/s,t.velX-=u*f,t.velY-=u*_,a=Math.sqrt(s),p=(2*i-a)/a-d,t.x=this._center.x+f*p,t.y=this._center.y+_*p,!0):!1))},e}();t.DiscZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e,i,n,o){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=1),this._image=t,this._offsetX=e,this._offsetY=i,this._scaleX=n,this._scaleY=o,this.invalidate()}return Object.defineProperty(e.prototype,"image",{get:function(){return this._image},set:function(t){this._image=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){if(this._image){this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._canvas.width=this._image.width,this._canvas.height=this._image.height,this._canvas.getContext("2d").drawImage(this._image,0,0,this._image.width,this._image.height),this._validPoints=new t.FastWeightedArray;for(var e=0;e<this._canvas.width;++e)for(var i=0;i<this._canvas.height;++i){var n=this._context.getImageData(e,i,1,1).data,o=t.ColorUtil.ARGBToHex(n[3],n[0],n[1],n[2]),r=.11*(255&o)+.59*(o>>>8&255)+.3*(o>>>16&255);0!=r&&this._validPoints.add(new t.Point(e,i),r/255)}}},e.prototype.contains=function(e,i){if(e>=this._offsetX&&e<=this._offsetX+this._canvas.width*this._scaleX&&i>=this._offsetY&&i<=this._offsetY+this._canvas.height*this._scaleY){var n=this._context.getImageData(Math.round((e-this._offsetX)/this._scaleX),Math.round((i-this._offsetY)/this._scaleY),1,1).data,o=t.ColorUtil.ARGBToHex(n[3],n[0],n[1],n[2]);return 0!=(16777215&o)}return!1},e.prototype.getLocation=function(){var t=this._validPoints.getRandomValue().clone();return t.x=t.x*this._scaleX+this._offsetX,t.y=t.y*this._scaleY+this._offsetY,t},e.prototype.getArea=function(){return this._validPoints.totalRatios*this._scaleX*this._scaleY},e.prototype.collideParticle=function(t,e){return"undefined"==typeof e&&(e=1),this.contains(t.x,t.y)!=this.contains(t.previousX,t.previousY)?(t.x=t.previousX,t.y=t.previousY,t.velX=-e*t.velX,t.velY=-e*t.velY,!0):!1},e}();t.GreyscaleZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(e,i,n,o,r){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=1),"undefined"==typeof r&&(r=1),this._image=e,this._offsetX=i,this._offsetY=n,this._scaleX=o,this._scaleY=r,this._renderRect=new t.Rectangle,this._renderOffset=new t.Point,this._image&&(this._renderRect.width=this._image.width,this._renderRect.height=this._image.height),this.invalidate()}return Object.defineProperty(e.prototype,"image",{get:function(){return this._image},set:function(t){this._image=t,this._image&&(this._renderRect.width=this._image.width,this._renderRect.height=this._image.height),this.invalidate()},enumerable:!0,configurable:!0}),e.prototype.setRenderInfo=function(t,e,i){this._image=t,this._renderRect=e,this._renderOffset=i,this.invalidate()},Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){if(this._image){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=this._renderRect.width,this._canvas.height=this._renderRect.height,this._context.drawImage(this._image,this._renderRect.x,this._renderRect.y,this._renderRect.width,this._renderRect.height,this._renderOffset.x,this._renderOffset.y,this._renderRect.width,this._renderRect.height),this._validPoints=new t.FastWeightedArray;
for(var e,i,n=this._context.getImageData(0,0,this._canvas.width,this._canvas.height).data,o=0,r=n.length;r>o;o+=4)e=n[o+3]/255,0!=e&&(i=o/4,this._validPoints.add(new t.Point(i%this._canvas.width,Math.floor(i/this._canvas.width)),e))}},e.prototype.contains=function(t,e){if(t>=this._offsetX&&t<=this._offsetX+this._canvas.width*this._scaleX&&e>=this._offsetY&&e<=this._offsetY+this._canvas.height*this._scaleY){var i=this._context.getImageData(Math.round((t-this._offsetX)/this._scaleX),Math.round((e-this._offsetY)/this._scaleY),1,1).data;return 0!=i[3]}return!1},e.prototype.getLocation=function(){var t=this._validPoints.getRandomValue().clone();return t.x=t.x*this._scaleX+this._offsetX,t.y=t.y*this._scaleY+this._offsetY,t},e.prototype.getArea=function(){return this._validPoints.totalRatios*this._scaleX*this._scaleY},e.prototype.collideParticle=function(t,e){return"undefined"==typeof e&&(e=1),this.contains(t.x,t.y)!=this.contains(t.previousX,t.previousY)?(t.x=t.previousX,t.y=t.previousY,t.velX=-e*t.velX,t.velY=-e*t.velY,!0):!1},e}();t.ImageZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(e,i){"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),this._start=null==e?new t.Point(0,0):e,this._end=null==i?new t.Point(0,0):i,this.setLengthAndNormal()}return e.prototype.setLengthAndNormal=function(){this._length=this._end.subtract(this._start),this._parallel=this._length.clone(),this._parallel.normalize(1),this._normal=new t.Point(this._parallel.y,-this._parallel.x)},Object.defineProperty(e.prototype,"start",{get:function(){return this._start},set:function(t){this._start=t,this.setLengthAndNormal()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},set:function(t){this._end=t,this.setLengthAndNormal()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startX",{get:function(){return this._start.x},set:function(t){this._start.x=t,this._length=this._end.subtract(this._start)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startY",{get:function(){return this._start.y},set:function(t){this._start.y=t,this._length=this._end.subtract(this._start)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endX",{get:function(){return this._end.x},set:function(t){this._end.x=t,this._length=this._end.subtract(this._start)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endY",{get:function(){return this._end.y},set:function(t){this._end.y=t,this._length=this._end.subtract(this._start)},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return(t-this._start.x)*this._length.y-(e-this._start.y)*this._length.x!=0?!1:(t-this._start.x)*(t-this._end.x)+(e-this._start.y)*(e-this._end.y)<=0},e.prototype.getLocation=function(){var t=this._start.clone(),e=Math.random();return t.x+=this._length.x*e,t.y+=this._length.y*e,t},e.prototype.getArea=function(){return this._length.length},e.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);var i=(t.previousX-this._start.x)*this._normal.x+(t.previousY-this._start.y)*this._normal.y,n=t.velX*this._normal.x+t.velY*this._normal.y;if(i*n>=0)return!1;var o=(t.x-this._start.x)*this._normal.x+(t.y-this._start.y)*this._normal.y;if(o*i>0&&(o>t.collisionRadius||o<-t.collisionRadius))return!1;var r,s;0>i?(r=this._normal.x*t.collisionRadius,s=this._normal.y*t.collisionRadius):(r=-this._normal.x*t.collisionRadius,s=-this._normal.y*t.collisionRadius);var a=t.previousX+r,h=t.previousY+s,l=t.x+r,c=t.y+s,u=this._start.x-this._parallel.x*t.collisionRadius,p=this._start.y-this._parallel.y*t.collisionRadius,d=this._end.x+this._parallel.x*t.collisionRadius,f=this._end.y+this._parallel.y*t.collisionRadius,_=1/((c-h)*(d-u)-(l-a)*(f-p)),g=_*((l-a)*(p-h)-(c-h)*(u-a));if(0>g||g>1)return!1;var m=-_*((d-u)*(h-p)-(f-p)*(a-u));if(0>m||m>1)return!1;t.x=t.previousX+m*(t.x-t.previousX),t.y=t.previousY+m*(t.y-t.previousY);var y=this._normal.x*t.velX+this._normal.y*t.velY,v=(1+e)*y;return t.velX-=v*this._normal.x,t.velY-=v*this._normal.y,!0},e}();t.LineZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._zones=[],this._areas=[],this._totalArea=0}return t.prototype.addZone=function(t){this._zones.push(t);var e=t.getArea();this._areas.push(e),this._totalArea+=e},t.prototype.removeZone=function(t){for(var e=this._zones.length,i=0;e>i;++i)if(this._zones[i]==t)return this._totalArea-=this._areas[i],this._areas.splice(i,1),void this._zones.splice(i,1)},t.prototype.contains=function(t,e){for(var i=this._zones.length,n=0;i>n;++n)if(this._zones[n].contains(t,e))return!0;return!1},t.prototype.getLocation=function(){for(var t=Math.random()*this._totalArea,e=this._zones.length,i=0;e>i;++i)if((t-=this._areas[i])<=0)return this._zones[i].getLocation();if(0==this._zones.length)throw new Error("Attempt to use a MultiZone object that contains no Zones");return this._zones[0].getLocation()},t.prototype.getArea=function(){return this._totalArea},t.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);for(var i=!1,n=0;n<this._zones.length;n++)i=this._zones[n].collideParticle(t,e)||i;return i},t}();t.MultiZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(e){"undefined"==typeof e&&(e=null),this._point=null==e?new t.Point(0,0):e}return Object.defineProperty(e.prototype,"point",{get:function(){return this._point},set:function(t){this._point=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._point.x},set:function(t){this._point.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._point.y},set:function(t){this._point.y=t},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return this._point.x==t&&this._point.y==e},e.prototype.getLocation=function(){return this._point.clone()},e.prototype.getArea=function(){return 1},e.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);var i=t.previousX-this._point.x,n=t.previousY-this._point.y,o=i*t.velX+n*t.velY;if(o>=0)return!1;var r=t.x-this._point.x,s=t.y-this._point.y,a=t.collisionRadius;if(o=r*t.velX+s*t.velY,0>=o){if(r>a||-a>r)return!1;if(s>a||-a>s)return!1;if(r*r+s*s>a*a)return!1}var h=r-i,l=s-n,c=h*h+l*l,u=2*(i*h+n*l),p=i*i+n*n-a*a,d=u*u-4*c*p;if(0>d)return!1;var f=Math.sqrt(d),_=(-u+f)/(2*c),g=(-u-f)/(2*c),m=[];_>0&&1>=_&&m.push(_),g>0&&1>=g&&m.push(g);var y;if(0==m.length)return!1;y=1==m.length?m[0]:Math.min(_,g);var v=i+y*h+this._point.x,b=n+y*l+this._point.y,C=v-this._point.x,S=b-this._point.y,E=Math.sqrt(C*C+S*S);C/=E,S/=E;var A=h*C+l*S;h-=2*C*A,l-=2*S*A,t.x=v+(1-y)*h,t.y=b+(1-y)*l;var x=t.velX*C+t.velY*S;return t.velX-=(1+e)*C*x,t.velY-=(1+e)*S*x,!0},e}();t.PointZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e,i,n){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this._left=t,this._top=e,this._right=i,this._bottom=n,this._width=i-t,this._height=n-e}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,isNaN(this._right)||isNaN(this._left)||(this._width=this.right-this.left)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,isNaN(this._right)||isNaN(this._left)||(this._width=this.right-this.left)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(t){this._top=t,isNaN(this._top)||isNaN(this._bottom)||(this._height=this.bottom-this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(t){this._bottom=t,isNaN(this._top)||isNaN(this._bottom)||(this._height=this.bottom-this.top)},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return t>=this._left&&t<=this._right&&e>=this._top&&e<=this._bottom},e.prototype.getLocation=function(){return new t.Point(this._left+Math.random()*this._width,this._top+Math.random()*this._height)},e.prototype.getArea=function(){return this._width*this._height},e.prototype.collideParticle=function(t,e){"undefined"==typeof e&&(e=1);var i,n,o,r=!1;return t.velX>0?(i=t.x+t.collisionRadius,n=t.previousX+t.collisionRadius,n<this._left&&i>=this._left?(o=t.previousY+(t.y-t.previousY)*(this._left-n)/(i-n),o>=this._top-t.collisionRadius&&o<=this._bottom+t.collisionRadius&&(t.velX=-t.velX*e,t.x+=2*(this._left-i),r=!0)):n<=this._right&&i>this._right&&(o=t.previousY+(t.y-t.previousY)*(this._right-n)/(i-n),o>=this._top-t.collisionRadius&&o<=this._bottom+t.collisionRadius&&(t.velX=-t.velX*e,t.x+=2*(this._right-i),r=!0))):t.velX<0&&(i=t.x-t.collisionRadius,n=t.previousX-t.collisionRadius,n>this._right&&i<=this._right?(o=t.previousY+(t.y-t.previousY)*(this._right-n)/(i-n),o>=this._top-t.collisionRadius&&o<=this._bottom+t.collisionRadius&&(t.velX=-t.velX*e,t.x+=2*(this._right-i),r=!0)):n>=this._left&&i<this._left&&(o=t.previousY+(t.y-t.previousY)*(this._left-n)/(i-n),o>=this._top-t.collisionRadius&&o<=this._bottom+t.collisionRadius&&(t.velX=-t.velX*e,t.x+=2*(this._left-i),r=!0))),t.velY>0?(i=t.y+t.collisionRadius,n=t.previousY+t.collisionRadius,n<this._top&&i>=this._top?(o=t.previousX+(t.x-t.previousX)*(this._top-n)/(i-n),o>=this._left-t.collisionRadius&&o<=this._right+t.collisionRadius&&(t.velY=-t.velY*e,t.y+=2*(this._top-i),r=!0)):n<=this._bottom&&i>this._bottom&&(o=t.previousX+(t.x-t.previousX)*(this._bottom-n)/(i-n),o>=this._left-t.collisionRadius&&o<=this._right+t.collisionRadius&&(t.velY=-t.velY*e,t.y+=2*(this._bottom-i),r=!0))):t.velY<0&&(i=t.y-t.collisionRadius,n=t.previousY-t.collisionRadius,n>this._bottom&&i<=this._bottom?(o=t.previousX+(t.x-t.previousX)*(this._bottom-n)/(i-n),o>=this._left-t.collisionRadius&&o<=this._right+t.collisionRadius&&(t.velY=-t.velY*e,t.y+=2*(this._bottom-i),r=!0)):n>=this._top&&i<this._top&&(o=t.previousX+(t.x-t.previousX)*(this._top-n)/(i-n),o>=this._left-t.collisionRadius&&o<=this._right+t.collisionRadius&&(t.velY=-t.velY*e,t.y+=2*(this._top-i),r=!0))),r},e}();t.RectangleZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(t,e,i,n,o){"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=1),"undefined"==typeof o&&(o=1),this._textGraphic=t,this._offsetX=e,this._offsetY=i,this._scaleX=n,this._scaleY=o,this.invalidate()}return e.NAME="TextZone",Object.defineProperty(e.prototype,"textGraphic",{get:function(){return this._textGraphic},set:function(t){this._textGraphic=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},set:function(t){this._offsetY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){if(this._textGraphic){this._validPoints=new t.FastWeightedArray;for(var e,i=this._textGraphic._renderContext.getImageData(0,0,this._textGraphic.width,this._textGraphic.height).data,n=0;n<this._textGraphic.width;++n)for(var o=0;o<this._textGraphic.height;++o)e=i[4*(~~n+~~o*this._textGraphic.width)]/255,0!=e&&this._validPoints.add(new t.Point(n,o),e)}},e.prototype.contains=function(t,e){return t>=this._offsetX&&t<=this._offsetX+this._textGraphic.width*this._scaleX&&e>=this._offsetY&&e<=this._offsetY+this._textGraphic.height*this._scaleY?0!=this._textGraphic._renderContext.getImageData(Math.round((t-this._offsetX)/this._scaleX),Math.round((e-this._offsetY)/this._scaleY),1,1).data[3]:!1},e.prototype.getLocation=function(){var t=this._validPoints.getRandomValue().clone();return t.x=t.x*this._scaleX+this._offsetX,t.y=t.y*this._scaleY+this._offsetY,t},e.prototype.getArea=function(){return this._validPoints.totalRatios*this._scaleX*this._scaleY},e.prototype.collideParticle=function(t,e){return"undefined"==typeof e&&(e=1),this.contains(t.x,t.y)!=this.contains(t.previousX,t.previousY)?(t.x=t.previousX,t.y=t.previousY,t.velX=-e*t.velX,t.velY=-e*t.velY,!0):!1},e}();t.TextZone=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(i,o,r){"undefined"==typeof o&&(o=n.NAME),"undefined"==typeof r&&(r=null),e.call(this,o),this._resourceManager=i,this._options=r,this.loadCompleteSignal=new t.Signal,this.loadErrorSignal=new t.Signal,this._onLoadListener=this._onLoadComplete.bind(this),this._onErrorListener=this._onLoadError.bind(this)}return __extends(n,e),n.NAME="ResourceElement",Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),n.prototype.load=function(t){LOGGING&&this._log.log("Loading: "+t),this.path=t,this._status=i.LOADING},n.prototype.setContent=function(){return!1},n.prototype._onLoadComplete=function(){LOGGING&&this._log.log("Load Complete: "+this.path),this._status=i.LOADED,this._removeListeners(),this.loadCompleteSignal.dispatch(this)},n.prototype._onLoadError=function(){LOGGING&&this._log.error("Error | Unable to Load: "+this.path),this._status=i.FAILED,this._removeListeners(),this.loadErrorSignal.dispatch(this)},n.prototype._removeListeners=function(){},n.prototype.destroy=function(){this._removeListeners(),this.loadCompleteSignal.removeAll(),this.loadErrorSignal.removeAll(),this.data=null,this.loadCompleteSignal=null,this.loadErrorSignal=null,this._resourceManager=null,this._onLoadListener=null,this._onErrorListener=null,e.prototype.destroy.call(this)},n}(t.Element);t.ResourceElement=e;var i=function(){function t(){}return t.LOADING="loading",t.LOADED="loaded",t.FAILED="failed",t}();t.ResourceStatus=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this.css=document.createElement("link"),this.css.type="text/css",this.css.rel="stylesheet",this.css.addEventListener("load",this._onLoadListener,!1),this.css.addEventListener("error",this._onErrorListener,!1),this.css.href=this.path,document.getElementsByTagName("head")[0].appendChild(this.css)},i.prototype._onLoadComplete=function(i){this.setContent(this.css)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(){return this.data=this.css,null!=this.css},i.prototype._removeListeners=function(){this.css.removeEventListener("load",this._onLoadListener),this.css.removeEventListener("error",this._onErrorListener)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.css=null},i}(t.ResourceElement);t.CSSResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this._xhr||(this._xhr=new XMLHttpRequest),this._xhr.open("GET",this.path,!0),this._xhr.responseType="text",this._xhr.addEventListener("load",this._onLoadListener,!1),this._xhr.addEventListener("error",this._onErrorListener,!1),this._xhr.send()},i.prototype._onLoadComplete=function(i){this.setContent(this._xhr.responseText)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(t){return this.font=t,this.data=this.font,null!=this.font},i.prototype._removeListeners=function(){this._xhr.removeEventListener("load",this._onLoadListener),this._xhr.removeEventListener("error",this._onErrorListener)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.font=null,this._xhr=null},i}(t.ResourceElement);t.FontResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this.source||(this.source=new Image),this.source.addEventListener("load",this._onLoadListener,!1),this.source.addEventListener("error",this._onErrorListener,!1),this.source.src=this.path},i.prototype._onLoadComplete=function(i){this.setContent(this.source)?(this.image=document.createElement("canvas"),this.image.width=this.source.width,this.image.height=this.source.height,this.image.getContext("2d").drawImage(this.source,0,0,this.source.width,this.source.height),e.prototype._onLoadComplete.call(this,i),this.source=null):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(){return this.data=this.source,null!=this.source},i.prototype._removeListeners=function(){this.source&&(this.source.removeEventListener("load",this._onLoadListener),this.source.removeEventListener("error",this._onErrorListener))},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.source=null,this.image=null},i}(t.ResourceElement);t.ImageResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this._xhr||(this._xhr=new XMLHttpRequest),this._xhr.open("GET",this.path,!0),this._xhr.responseType="text",this._xhr.addEventListener("load",this._onLoadListener,!1),this._xhr.addEventListener("error",this._onErrorListener,!1),this._xhr.send()},i.prototype._onLoadComplete=function(i){this.setContent(this._xhr.responseText)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(t){return this.json=JSON.parse(t),this.data=this.json,null!=this.json},i.prototype._removeListeners=function(){this._xhr.removeEventListener("load",this._onLoadListener),this._xhr.removeEventListener("error",this._onErrorListener)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.json=null,this._xhr=null},i}(t.ResourceElement);t.JSONResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this.js=document.createElement("script"),this.js.type="text/javascript",this.js.addEventListener("load",this._onLoadListener),this.js.addEventListener("error",this._onErrorListener),this.js.src=this.path;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(this.js,i)},i.prototype._onLoadComplete=function(i){this.setContent(this.js)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(){return this.data=this.js,null!=this.js},i.prototype._removeListeners=function(){this.js.removeEventListener("load",this._onLoadListener),this.js.removeEventListener("error",this._onErrorListener)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.js=null},i}(t.ResourceElement);t.JSResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(i){return e.prototype.load.call(this,i),t.EnvUtil.hasWebAudio?(this._xhr||(this._xhr=new XMLHttpRequest),this._xhr.open("GET",this.path,!0),this._xhr.responseType="arraybuffer",this._onXHRLoadListener=this._onXHRLoadComplete.bind(this),this._xhr.addEventListener("load",this._onXHRLoadListener,!1),this._xhr.addEventListener("error",this._onErrorListener,!1),void this._xhr.send()):t.EnvUtil.hasAudioTag&&!t.EnvUtil.hasWebAudio?(this.soundData||(this.soundData=new Audio),this.soundData.addEventListener("canplaythrough",this._onLoadListener,!1),this.soundData.addEventListener("error",this._onErrorListener,!1),this.soundData.id=this.name,this.soundData.preload="none",this.soundData.src=this.path,void this.soundData.load()):void(t.EnvUtil.hasAudioTag||t.EnvUtil.hasWebAudio||(LOGGING&&this._log.warn("Audio not supported, bypassing load of: "+this.path),this._status=t.ResourceStatus.FAILED,this._removeListeners(),this.loadErrorSignal.dispatch(this)))},i.prototype._onLoadComplete=function(i){this.setContent(this.soundData)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED,e.prototype._onLoadError.call(this,i))},i.prototype._onXHRLoadComplete=function(i){4==this._xhr.readyState&&200==this._xhr.status?this.setContent(this._xhr.response)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED,e.prototype._onLoadError.call(this,i)):e.prototype._onLoadError.call(this,i)},i.prototype.setContent=function(){return t.EnvUtil.hasWebAudio?(this.soundData=this._xhr.response,this.data=this.soundData,null!=this.soundData):t.EnvUtil.hasAudioTag&&!t.EnvUtil.hasWebAudio?(this.data=this.soundData,null!=this.soundData):void 0},i.prototype._removeListeners=function(){t.EnvUtil.hasWebAudio&&(this._xhr.removeEventListener("load",this._onXHRLoadListener),this._xhr.removeEventListener("error",this._onErrorListener)),t.EnvUtil.hasAudioTag&&!t.EnvUtil.hasWebAudio&&(this.soundData.removeEventListener("canplaythrough",this._onLoadListener,!1),this.soundData.removeEventListener("error",this._onErrorListener,!1))},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.soundData=null,this._xhr=null,this._onXHRLoadListener=null},i}(t.ResourceElement);t.SoundResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(t){function e(e,i,n){t.call(this,e,i,n)}return __extends(e,t),e.prototype.load=function(e){if(t.prototype.load.call(this,e),this._html='<object id="'+this._options.id+'" type="application/x-shockwave-flash" data="'+this.path+'" width="'+this._options.width+'" height="'+this._options.height+'"><param name="movie" value="'+this.path+'" />',this._options.hasOwnProperty("flashVars")){this._html+='<param name="FlashVars" value="';for(var i in this._options.flashVars)this._html+=i+"="+this._options.flashVars[i]+"&amp;";this._html+='" />'}this._html+='<param name="allowScriptAccess" value="always" /></object>',this._options.hasOwnProperty("autoplay")&&1==this._options.autoplay&&this.init(),this._options.hasOwnProperty("parent")?this.parent=document.getElementById(this._options.parent):(this.parent=document.createElement("div"),this._options.hasOwnProperty("parentID")&&this.parent.setAttribute("id",this._options.parentID),document.body.appendChild(this.parent)),this.parent.style.position="absolute",this.parent.style.width=this._options.width+"px",this.parent.style.height=this._options.height+"px",t.prototype._onLoadComplete.call(this,null)},e.prototype.init=function(){document.body.appendChild(this.parent),this.parent.innerHTML=this._html,this.swf=document.getElementById(this._options.id),this.data=this.swf},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.swf=null,this._options=null},e}(t.ResourceElement);t.SWFResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(t,i){e.call(this,t,i)}return __extends(i,e),i.prototype.load=function(t){e.prototype.load.call(this,t),this._xhr||(this._xhr=new XMLHttpRequest),this._xhr.open("GET",this.path,!0),this._xhr.responseType="text",this._xhr.addEventListener("load",this._onLoadListener,!1),this._xhr.addEventListener("error",this._onErrorListener,!1),this._xhr.send()},i.prototype._onLoadComplete=function(i){this.setContent(this._xhr.response)?e.prototype._onLoadComplete.call(this,i):(LOGGING&&this._log.error("Resource Data unavailable for: "+this.path),this._status=t.ResourceStatus.FAILED)},i.prototype.setContent=function(t){try{if(window.DOMParser){var e=new DOMParser;this.xml=e.parseFromString(t,"text/xml")}else this.xml=new ActiveXObject("Microsoft.XMLDOM"),this.xml.async="false",this.xml.loadXML(t)}catch(i){this.xml=null}return this.data=this.xml,null!=this.xml},i.prototype._removeListeners=function(){this._xhr.removeEventListener("load",this._onLoadListener),this._xhr.removeEventListener("error",this._onErrorListener)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.xml=null,this._xhr=null},i}(t.ResourceElement);t.XMLResource=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n){"undefined"==typeof n&&(n=i.NAME),e.call(this,n),this.changedSignal=new t.Signal,this.channels=i.MAX_CHANNELS,this._playingSounds=[],this._mute=!1,this._volume=1,this._pan=0,this.override=!1}return __extends(i,e),i.NAME="SoundCategory",i.MAX_CHANNELS=Number.MAX_VALUE,i.MUSIC="music",i.SFX="sfx",i.VO="vo",Object.defineProperty(i.prototype,"mute",{get:function(){return this._mute},set:function(t){this._mute=t,this.changedSignal.dispatch()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return 100*this._volume},set:function(t){t>100&&(t=100),0>t&&(t=0),this._volume=t/100,this.changedSignal.dispatch()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this.changedSignal.dispatch()},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){this.changedSignal.removeAll(),e.prototype.destroy.call(this),this.changedSignal=null,this._playingSounds=null},i}(t.Element);t.SoundCategory=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a,h){"undefined"==typeof a&&(a=!1),"undefined"==typeof h&&(h=100);var l=this;switch(e.call(this,n),this._soundManager=o,this._soundData=r,this._category=s,this._repeat=a,this._volume=h/100,this._defaultVolume=this._volume,this._position=0,this._isPlaying=!1,this._isPaused=!1,this._isStopping=!1,this._isPending=!1,this._playbackRate=1,this.startSignal=new t.Signal,this.stopSignal=new t.Signal,this.completeSignal=new t.Signal,this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._filterNodes=[],this._volumeNode="undefined"==typeof this._soundManager._audioContext.createGain?this._soundManager._audioContext.createGainNode():this._soundManager._audioContext.createGain(),this._volumeNode.gain.value=this._volume,this._volumeNode.connect(this._soundManager._volumeNode),this._status=i.DECODING,this._soundManager._audioContext.decodeAudioData(this._soundData,function(t){return l.onAudioDataDecoded(t)});break;case t.SoundSupport.AUDIOTAG:this._sound=this._soundData,this._sound.volume=this._volume,this._duration=1e3*this._sound.duration,this._defaultDuration=this._duration,this._onSoundCompleteListener=this.onSoundComplete.bind(this)}this._soundManager._timeManager.tick.add(this.onTick,this),this._category&&this._category.changedSignal.add(this.onCategoryChange,this)}return __extends(i,e),i.FILTER_CONVOLVER=0,i.FILTER_HIGHPASS=1,i.FILTER_LOWPASS=2,i.DECODING=0,i.DECODED=1,Object.defineProperty(i.prototype,"isMuted",{get:function(){return this._mute},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return 1e3*this._position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPaused",{get:function(){return this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"repeat",{get:function(){return this._repeat},set:function(t){this._repeat=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"category",{get:function(){return this._category},set:function(t){this._category&&this._category.changedSignal.remove(this.onCategoryChange),this._category=t,this._category&&this._category.changedSignal.add(this.onCategoryChange)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return 100*this._volume},set:function(e){switch(e>100&&(e=100),0>e&&(e=0),this._volume=e/100,this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._volumeNode.gain.value=this._volume;break;case t.SoundSupport.AUDIOTAG:this._sound.volume=this._volume}this.applyCategoryTransform()},enumerable:!0,configurable:!0}),i.prototype.onTick=function(){if(this._sound&&this.isPlaying){var e;switch(this._soundManager._support){case t.SoundSupport.WEBAUDIO:if(e=1e3*(this._soundManager._audioContext.currentTime-this._playStartTime),!this._repeat&&e>=this._duration-this._position)return void this.stop();if(this.currentCuePoint&&this.currentCuePoint.start+e>=this.currentCuePoint.start+this.currentCuePoint.duration)return void this.stop();break;case t.SoundSupport.AUDIOTAG:if(e=1e3*this._sound.currentTime,this.currentCuePoint&&e>=this.currentCuePoint.start+this.currentCuePoint.duration)return void this.stop()}}},i.prototype.onAudioDataDecoded=function(t){this._soundBuffer=t,this._duration=1e3*this._soundBuffer.duration,this._defaultDuration=this._duration,this._status=i.DECODED,this._isPending&&(this._isPending=!1,this.playSound())},i.prototype.addCuePoint=function(t,e,i,n,o,r){"undefined"==typeof i&&(i=-1),"undefined"==typeof n&&(n=!1),"undefined"==typeof o&&(o=-1),"undefined"==typeof r&&(r=null),this._cuePoints||(this._cuePoints={}),this._cuePoints[t]={name:t,start:e,duration:i,loop:n,volume:o,category:r}},i.prototype.hasCuePoint=function(t){return this._cuePoints?null!=this._cuePoints[t]:!1},i.prototype.getCuePoint=function(t){return this._cuePoints?this._cuePoints[t]:null},i.prototype.play=function(e,i,n,o){if("undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=-1),"undefined"==typeof o&&(o=-1),t.ObjectUtil.isString(e)){var r=e;if(this.currentCuePoint=this._cuePoints[r],!this.currentCuePoint)return void(LOGGING&&this._log.warn("CuePoint: "+r+" not found."));this._position=this.currentCuePoint.start/1e3,this._duration=-1!=this.currentCuePoint.duration?this.currentCuePoint.duration:this._defaultDuration-this._position,-1!=this.currentCuePoint.volume&&(this.volume=this.currentCuePoint.volume),this.currentCuePoint.category&&(!this.category||this.category&&this.category.name!==this.currentCuePoint.category)&&(this._soundManager._categories[this.currentCuePoint.category]||(this._soundManager._categories[this.currentCuePoint.category]=this._soundManager.create(t.SoundCategory,this.currentCuePoint.category)),this.category=this._soundManager._categories[this.currentCuePoint.category]),this.currentCuePoint.loop&&(this._repeat=!0),this.applyCategoryTransform(),this.playSound(),this.startSignal.dispatch(this),this._isPlaying=!0}else{var s=e;-1!=n&&(this._position=n),-1!=o&&(this.volume=o),this.applyCategoryTransform(),this.playSound(),this.startSignal.dispatch(this),this._isPlaying=!0,s&&TweenMax.from(this,i/1e3,{volume:0})}},i.prototype.pause=function(){if(this._isPaused=!this._isPaused,this._isPaused){if(!this._isPlaying)return;switch(this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._position=this._soundManager._audioContext.currentTime-this._playStartTime,"undefined"==typeof this._sound.stop?this._sound.noteOff(0):this._sound.stop(0);break;case t.SoundSupport.AUDIOTAG:this._position=this._sound.currentTime,this._sound.removeEventListener("ended",this._onSoundCompleteListener,!1),this._sound.pause()
}}else this._isPlaying&&this.playSound()},i.prototype.resume=function(){this._isPaused&&(this.playSound(),this._isPaused=!1)},i.prototype.stop=function(e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=1e3);var n=this;if((this._isPlaying||this._isPaused)&&this._sound)if(TweenMax.killTweensOf(this,!0),e)TweenMax.to(this,i/1e3,{volume:0,onComplete:function(){return n.stop()}}),this._isStopping=!0;else{switch(this._soundManager._support){case t.SoundSupport.WEBAUDIO:"undefined"==typeof this._sound.stop?this._sound.noteOff(0):this._sound.stop(0);break;case t.SoundSupport.AUDIOTAG:this._sound.removeEventListener("ended",this._onSoundCompleteListener,!1),this._sound.pause()}this._position=0,this._isPlaying=!1,this._isStopping=!1,this.volume=100*this._defaultVolume,this._duration=this._defaultDuration,this.currentCuePoint=null,this.repeat||(this.stopSignal.dispatch(this),this.completeSignal.dispatch(this))}},i.prototype.mute=function(e){switch("undefined"==typeof e&&(e=!this._mute),this._mute=e,this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._volumeNode.gain.value=this._mute?0:this._volume;break;case t.SoundSupport.AUDIOTAG:this._sound.volume=this._mute?0:this._volume}},i.prototype.addFilter=function(t,e,n){"undefined"==typeof n&&(n=this._filterNodes.length);var o,r={};switch(t){case i.FILTER_CONVOLVER:if(!e&&!e.hasOwnProperty("impulseResponse"))return;o=this._soundManager._audioContext.createConvolver(),o.buffer=this._soundManager.getSound(e.impulseResponse)._soundBuffer,r.id=e.impulseResponse;break;case i.FILTER_LOWPASS:o=this._soundManager._audioContext.createBiquadFilter(),o.type="lowpass",o.frequency.value=e&&e.hasOwnProperty("frequency")?e.frequency:440;break;case i.FILTER_HIGHPASS:o=this._soundManager._audioContext.createBiquadFilter(),o.type="highpass",o.frequency.value=e&&e.hasOwnProperty("frequency")?e.frequency:440}r.type=t,r.node=o,this._filterNodes[n]=r,this._updateNodes()},i.prototype.removeFilter=function(t,e){for(var i=this._filterNodes.length-1;i>=0;i--)if(this._filterNodes[i].node.disconnect(0),this._filterNodes[i].type===t)if(e){if(this._filterNodes[i].id!==e)continue;this._filterNodes.splice(i,1)}else this._filterNodes.splice(i,1);this._updateNodes()},i.prototype.playSound=function(e){if("undefined"==typeof e&&(e=!0),!this.destroyed)switch(this._soundManager._support){case t.SoundSupport.WEBAUDIO:if(this._status==i.DECODING)return void(this._isPending=!0);this._sound=this._soundManager._audioContext.createBufferSource(),this._sound.buffer=this._soundBuffer,this._updateNodes(),this._sound.loop=this._repeat,this._sound.playbackRate.value=this._playbackRate,"undefined"==typeof this._sound.start?this._sound.noteOn(0,this._position):this._sound.start(0,this._position),this._playStartTime=this._soundManager._audioContext.currentTime;break;case t.SoundSupport.AUDIOTAG:this._sound.currentTime=this._position-.25,this.applyCategoryTransform(),this._sound.volume=this._mute?0:this._volume,this._sound.play(),this.currentCuePoint||this._sound.addEventListener("ended",this._onSoundCompleteListener,!1)}},i.prototype._updateNodes=function(){if(this._sound.disconnect(0),this._filterNodes.length>0){for(var t=0,e=this._filterNodes.length;e>t;t++)this._filterNodes[t].node.disconnect(0);this._sound.connect(this._filterNodes[0].node);for(var t=0,e=this._filterNodes.length-2;e>=t;t++)this._filterNodes[t].node.connect(this._filterNodes[t+1].node);this._filterNodes[this._filterNodes.length-1].node.connect(this._volumeNode)}else this._sound.connect(this._volumeNode)},i.prototype.onSoundComplete=function(){this.stop(),this._repeat&&!this._isStopping&&this.play()},i.prototype.onCategoryChange=function(){this.applyCategoryTransform()},i.prototype.applyCategoryTransform=function(){if(this._category)switch(this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._volumeNode.gain.value=this._category.mute?0:this._volume*(this._category.volume/100);break;case t.SoundSupport.AUDIOTAG:this._sound.volume=this._category.mute?0:this._volume*(this._category.volume/100)}},i.prototype.destroy=function(){var i=this;switch(this._soundManager._timeManager.tick.remove(this.onTick,this),(this._isPlaying||this._isPaused)&&this.stop(),this._category&&(-1!=this._category._playingSounds.indexOf(this._sound)&&this._category._playingSounds.splice(this._category._playingSounds.indexOf(this._sound),1),this._category.changedSignal.remove(function(){return i.onCategoryChange()})),this._soundManager._support){case t.SoundSupport.WEBAUDIO:this._volumeNode.disconnect(0),this._sound&&this._sound.disconnect(0);break;case t.SoundSupport.AUDIOTAG:}this.startSignal.removeAll(),this.stopSignal.removeAll(),this.completeSignal.removeAll(),e.prototype.destroy.call(this),this.startSignal=null,this.stopSignal=null,this.completeSignal=null,this._category=null,this._sound=null,this._soundBuffer=null,this._soundData=null,this._cuePoints=null,this._volumeNode=null,this._filterNodes=null,this._soundManager=null,this._onSoundCompleteListener=null},i}(t.Element);t.SoundElement=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function n(o,r,s){switch("undefined"==typeof r&&(r="auto"),"undefined"==typeof s&&(s=n.NAME),e.call(this,s),this._timeManager=o,this._volume=1,this._mute=!1,this._sounds={},this._categories={},this._cuePointSources={},this._playingSounds=[],this._count=0,this.muteSignal=new t.Signal,this.volumeSignal=new t.Signal,this.playSignal=new t.Signal,this.stopSignal=new t.Signal,this.errorSignal=new t.Signal,r){case i.WEBAUDIO:LOGGING&&this._log.warn("Audio Format Override: WebAudio"),window.AudioContext?(this._audioContext=new window.AudioContext,this._support=i.WEBAUDIO,t.EnvUtil.hasWebAudio=!0,t.EnvUtil.hasAudioTag=!1):window.webkitAudioContext?(this._audioContext=new window.webkitAudioContext,this._support=i.WEBAUDIO,t.EnvUtil.hasWebAudio=!0,t.EnvUtil.hasAudioTag=!1):(this._support=i.NONE,t.EnvUtil.hasWebAudio=!1,t.EnvUtil.hasAudioTag=!1);break;case i.AUDIOTAG:LOGGING&&this._log.warn("Audio Format Override: AudioTag"),window.Audio?(this._support=i.AUDIOTAG,t.EnvUtil.hasWebAudio=!1,t.EnvUtil.hasAudioTag=!0):(this._support=i.NONE,t.EnvUtil.hasWebAudio=!1,t.EnvUtil.hasAudioTag=!1);break;case i.NONE:LOGGING&&this._log.warn("Audio Format Override: None"),this._support=i.NONE,t.EnvUtil.hasWebAudio=!1,t.EnvUtil.hasAudioTag=!1;break;default:window.AudioContext?(this._audioContext=new window.AudioContext,this._support=i.WEBAUDIO):window.webkitAudioContext?(this._audioContext=new window.webkitAudioContext,this._support=i.WEBAUDIO):this._support=window.Audio?i.AUDIOTAG:i.NONE}this._support==i.WEBAUDIO&&(this._compressorNode=this._audioContext.createDynamicsCompressor(),this._compressorNode.threshold.value=-50,this._compressorNode.knee.value=40,this._compressorNode.ratio.value=12,"object"==typeof this._compressorNode.reduction&&(this._compressorNode.reduction.value=-20),this._compressorNode.attack.value=0,this._compressorNode.release.value=.25,this._volumeNode="undefined"==typeof this._audioContext.createGain?this._audioContext.createGainNode():this._audioContext.createGain(),this._volumeNode.gain.value=this._volume,this._volumeNode.connect(this._compressorNode),this._compressorNode.connect(this._audioContext.destination))}return __extends(n,e),n.NAME="SoundManager",Object.defineProperty(n.prototype,"playingSounds",{get:function(){return this._playingSounds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return 100*this._volume},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMuted",{get:function(){return this._mute},enumerable:!0,configurable:!0}),n.prototype.createEmptyBuffer=function(){this._emptyBuffer=this._audioContext.createBufferSource(),this._emptyBuffer.buffer=this._audioContext.createBuffer(1,1,22050),this._emptyBuffer.connect(this._audioContext.destination),this._emptyBuffer.noteOn(0)},n.prototype.mute=function(t){switch("undefined"==typeof t&&(t=!this._mute),this._mute=t,this._support){case i.WEBAUDIO:this._volumeNode.gain.value=this._mute?0:this._volume;break;case i.AUDIOTAG:for(var e in this._sounds)this._sounds[e].mute(this._mute)}this.muteSignal.dispatch(this._mute),LOGGING&&(this._log.info("Mute "+(this._mute?"On":"Off")),this._log.mark("Mute "+(this._mute?"On":"Off")))},n.prototype.setGlobalVolume=function(t){switch(t>100&&(t=100),0>t&&(t=0),this._volume=t/100,this._support){case i.WEBAUDIO:this._volumeNode.gain=this._volume;break;case i.AUDIOTAG:for(var e in this._sounds)this._sounds[e].volume=this._sounds[e].volume*this._volume}this.volumeSignal.dispatch(t),LOGGING&&this._log.info("Volume: "+t)},n.prototype.addSound=function(e,i,n,o,r){"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o=!1),"undefined"==typeof r&&(r=100),n&&!this._categories[n]&&(this._categories[n]=this.create(t.SoundCategory,n));var s=this.create(t.SoundElement,e,this,i,this._categories[n],o,r);this._sounds[e]&&(LOGGING&&this._log.warn("Sound: "+e+" already exists - replacing existing sound"),this.removeSound(e)),this._sounds[e]=s,this._count++,LOGGING&&this._log.debug("Added Sound: "+e)},n.prototype.hasSound=function(t){var e=this._sounds[t];return!e&&this._cuePointSources[t]&&(e=this._cuePointSources[t].sound),null!=e},n.prototype.getSound=function(t){var e=this._sounds[t];return!e&&this._cuePointSources[t]&&(e=this._cuePointSources[t].sound),e},n.prototype.removeSound=function(t,e){"undefined"==typeof e&&(e=!0);var i=this._sounds[t];i&&e&&i.destroy(),this._sounds[t]=null,delete this._sounds[t],this._count--,LOGGING&&this._log.debug("Removed Sound: "+t)},n.prototype.playSound=function(t,e,i,n,o,r){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=1e3),"undefined"==typeof n&&(n=null),"undefined"==typeof o&&(o=-1),"undefined"==typeof r&&(r=-1);var s=this._sounds[t];if(!s&&this._cuePointSources[t]&&(s=this._cuePointSources[t].sound),!s)return LOGGING&&this._log.warn("Unable to play sound: "+t),void this.errorSignal.dispatch(t);if(s.category&&s.category._playingSounds.length>=s.category.channels){if(!s.category.override)return LOGGING&&this._log.warn("Unable to play: "+s.name+", exceeds "+s.category.name+" channels"),void this.errorSignal.dispatch(t);this.stopCategorySounds(s.category.name)}return this._cuePointSources[t]?s.play(t):s.play(e,i,o,r),s.stopSignal.addOnce(this.onSoundComplete,this),null!=n&&(s.completeSignal.removeAll(),s.completeSignal.add(n)),s.category&&s.category._playingSounds.push(s),this._playingSounds.push(s),this.playSignal.dispatch(t),s},n.prototype.stopSound=function(t,e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=1e3);var n=this._sounds[t];!n&&this._cuePointSources[t]&&(n=this._cuePointSources[t].sound),n?(n.stop(e,i),this.stopSignal.dispatch(n)):this.errorSignal.dispatch(t)},n.prototype.pauseSound=function(t){var e=this._sounds[t];!e&&this._cuePointSources[t]&&(e=this._cuePointSources[t].sound),e&&e.pause()},n.prototype.stopCategorySounds=function(t,e,i){"undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=1e3);var n;for(var o in this._sounds)n=this._sounds[o],n.category.name==t&&n.stop(e,i)},n.prototype.stopAllSounds=function(t,e){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=1e3);var i;for(var n in this._sounds)i=this._sounds[n],i.stop(t,e)},n.prototype.pauseAllSounds=function(){var t;for(var e in this._sounds)t=this._sounds[e],t.pause()},n.prototype.resumeAllSounds=function(){var t;for(var e in this._sounds)t=this._sounds[e],t.resume()},n.prototype.isSoundPlaying=function(e){var i;if(this.hasSound(e)){if(i=this._sounds[e],i&&i.isPlaying)return!0;var n;if(!i&&this._cuePointSources[e])return i=this._cuePointSources[e].sound,n=i.getCuePoint(e),t.MathUtil.isInRange(i.position,n.start,n.start+n.duration)}return!1},n.prototype.addSoundCuePoint=function(t,e,i,n,o,r,s){if("undefined"==typeof n&&(n=-1),"undefined"==typeof o&&(o=!1),"undefined"==typeof r&&(r=-1),"undefined"==typeof s&&(s=null),this.hasSound(t)){var a=this.getSound(t);a.addCuePoint(e,i,n,o,r,s),this._cuePointSources[e]={sound:a}}},n.prototype.addSoundFilter=function(t,e,i,n){this.hasSound(t)&&this.getSound(t).addFilter(e,i,n)},n.prototype.removeSoundFilter=function(t,e,i){this.hasSound(t)&&this.getSound(t).removeFilter(e,i)},n.prototype.getSoundDuration=function(t){var e=this.getSound(t);return e?e.hasCuePoint(t)?e.getCuePoint(t).duration:e.duration:0},n.prototype.setSoundVolume=function(t,e,i,n){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=1e3),this.hasSound(t)&&(i?TweenMax.to(this.getSound(t),n/1e3,{volume:e}):this.getSound(t).volume=e)},n.prototype.setSoundRepeat=function(t,e){this.hasSound(t)&&(this.getSound(t).repeat=e)},n.prototype.setCategoryVolume=function(t,e){var i=this._categories[t];i.volume=e,LOGGING&&this._log.info("Category "+t+" Volume: "+e)},n.prototype.muteCategory=function(t){var e=this._categories[t];e.mute=!e.mute,LOGGING&&this._log.info("Category "+t+" Mute "+(e.mute?"On":"Off"))},n.prototype.onSoundComplete=function(t){var e=this._playingSounds.indexOf(t);-1!=e&&(this._playingSounds.splice(e,1),t.category&&(e=t.category._playingSounds.indexOf(t),-1!=e&&t.category._playingSounds.splice(e,1)))},n.prototype.destroy=function(){this.muteSignal.removeAll(),this.volumeSignal.removeAll(),this.playSignal.removeAll(),this.stopSignal.removeAll(),this.errorSignal.removeAll(),e.prototype.destroy.call(this);for(var t in this._sounds)this._sounds[t]=null,delete this._sounds[t];for(var t in this._categories)this._categories[t]=null,delete this._categories[t];this.muteSignal=null,this.volumeSignal=null,this.playSignal=null,this.stopSignal=null,this.errorSignal=null,this._sounds=null,this._categories=null,this._playingSounds=null,this._cuePointSources=null,this._volumeNode=null,this._compressorNode=null,this._audioContext=null,this._timeManager=null},n}(t.Group);t.SoundManager=e;var i=function(){function t(){}return t.NONE=0,t.WEBAUDIO=1,t.AUDIOTAG=2,t}();t.SoundSupport=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(e){function i(n,o,r,s,a,h){"undefined"==typeof o&&(o=1e3),"undefined"==typeof r&&(r=-1),"undefined"==typeof h&&(h=!1),e.call(this,i.NAME),this._ms=0,this._count=0,this._timeManager=n,this.delay=o,this.repeatCount=r,this.timerSignal=new t.Signal,this.completeSignal=new t.Signal,null!=s&&this.timerSignal.add(s),null!=a&&this.completeSignal.add(a),this._running=!1}return __extends(i,e),i.schedule=function(t,e,n,o){"undefined"==typeof o&&(o=!0);var r=new i(t,e,0,null,n,o);return r.start(),r},i.NAME="Timer",Object.defineProperty(i.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentCount",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeRemaining",{get:function(){return this.delay-this._ms},enumerable:!0,configurable:!0}),i.prototype.start=function(){this._running||(this._timeManager.addTickedObject(this,0),this._running=!0)},i.prototype.stop=function(){this._running&&(this._timeManager.removeTickedObject(this),this._running=!1)},i.prototype.reset=function(){this.stop(),this._ms=0,this._count=0},i.prototype.onTick=function(t){this._running&&(this._ms+=1e3*t,this._ms>=this.delay&&(this._count++<this.repeatCount||-1==this.repeatCount?(this._ms=this.delay-this._ms,this.timerSignal&&this.timerSignal.dispatch()):(this.reset(),this.timerSignal&&!this.completeSignal&&this.timerSignal.dispatch(),this.completeSignal&&this.completeSignal.dispatch(),this._destroyOnComplete&&this.destroy())))},i.prototype.destroy=function(){this._running&&this.reset(),this.timerSignal&&this.timerSignal.removeAll(),this.completeSignal&&this.completeSignal.removeAll(),this.timerSignal=null,this.completeSignal=null,this._timeManager=null,e.prototype.destroy.call(this)},i}(t.Element);t.Timer=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.randomize=function(e){for(var i,n=[],o=e.concat(),r=0;r<o.length;r++)i=t.Random.integer(0,o.length-1),n.push(o[i]),o.splice(i,1),r--;return n},e.compare=function(t,i){if(t.length!=i.length)return!1;for(var n=0,o=t.length;o>n;n++)if(t[n]instanceof Array&&i[n]instanceof Array){if(!e.compare(t[n],i[n]))return!1}else if(t[n]!=i[n])return!1;return!0},e.createNumericalArray=function(t,e){var i=0,n=0,o=[];if(e>=t)for(i=t;e>=i;i++)o[n++]=i;else for(i=t;i>=e;i--)o[n++]=i;return o},e.removeDuplicates=function(t){for(var e=t.length;e>0;e--)t.indexOf(t[e-1])!=e-1&&t.splice(e-1,1)},e.toArray=function(t){var e=[];for(var i in t)e.push(i);return e},e}();t.ArrayUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.RGBToHex=function(t,e,i){return t<<16|e<<8|i},t.ARGBToHex=function(t,e,i,n){return t<<24|e<<16|i<<8|n},t.RGBAToHex=function(t,e,i,n){return n<<24|t<<16|e<<8|i},t.hexToRGB=function(t){return[t>>>16&255,t>>>8&255,255&t]},t.hexToARGB=function(t){return[t>>>24&255,t>>>16&255,t>>>8&255,255&t]},t.hexToRGBA=function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},t.CSSToHex=function(t){return t=t.slice(1),parseInt(t,16)},t.interpolateRGB=function(e,i,n){var o=1-n,r=t.hexToRGB(e),s=t.hexToRGB(i);return t.RGBToHex(r[0]*n,r[1]*n,r[2]*n)+t.RGBToHex(s[0]*o,s[1]*o,s[2]*o)},t.interpolateARGB=function(e,i,n){var o=1-n,r=t.hexToARGB(e),s=t.hexToARGB(i);return t.ARGBToHex(r[0]*n,r[1]*n,r[2]*n,r[3]*n)+t.ARGBToHex(s[0]*o,s[1]*o,s[2]*o,s[3]*o)},t.interpolateRGBA=function(e,i,n){var o=1-n,r=t.hexToRGBA(e),s=t.hexToRGBA(i);return t.RGBAToHex(r[0]*n,r[1]*n,r[2]*n,r[3]*n)+t.RGBAToHex(s[0]*o,s[1]*o,s[2]*o,s[3]*o)},t.getAlpha=function(t){return t>>>24&255},t.getRed=function(t){return t>>>16&255},t.getGreen=function(t){return t>>>8&255},t.getBlue=function(t){return 255&t},t.getAverageColor=function(t){for(var e,i=0,n=0,o=0,r=0,s=t.getContext("2d"),a=0;a<t.width;a++)for(var h=0;h<t.height;h++)e=s.getImageData(a,h,1,1).data,i+=e[0]>>>16&255,n+=e[1]>>>8&255,o+=255&e[2],r++;return i/=r,n/=r,o/=r,i<<16|n<<8|o},t.darken=function(e,i){var n=t.hexToRGB(e);return t.RGBToHex(n[0]*i,n[1]*i,n[2]*i)},t}();t.ColorUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.convertFromImage=function(t,e,i){"undefined"==typeof e&&(e=1);var n=null!=i?i:document.createElement("canvas");return n.width=t.width*e,n.height=t.height*e,n.getContext("2d").drawImage(t,0,0,t.width*e,t.height*e),n},e.tint=function(e,i,n){var o=t.ColorUtil.hexToARGB(i),r=null!=n?n:document.createElement("canvas"),s=r.getContext("2d");return r.width=e.width,r.height=e.height,s.clearRect(0,0,r.width,r.height),s.fillStyle="rgba("+o[1]+", "+o[2]+", "+o[3]+", "+o[0]/255+")",s.fillRect(0,0,e.width,e.height),s.globalCompositeOperation="multiply",s.drawImage(e,0,0,e.width,e.height),s.globalCompositeOperation="destination-atop",s.drawImage(e,0,0,e.width,e.height),s.globalCompositeOperation="source-over",r},e}();t.CanvasUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.ALICE_BLUE=15792383,t.ANTIQUE_WHITE=16444375,t.AQUA=65535,t.AQUAMARINE=8388564,t.AZURE=15794175,t.BEIGE=16119260,t.BISQUE=16770244,t.BLACK=0,t.BLANCHED_ALMOND=16772045,t.BLUE=255,t.BLUE_VIOLET=9055202,t.BROWN=10824234,t.BURLY_WOOD=14596231,t.CADET_BLUE=6266528,t.CHARTREUSE=8388352,t.CHOCOLATE=13789470,t.CORAL=16744272,t.CORNFLOWER_BLUE=6591981,t.CORNSILK=16775388,t.CRIMSON=14423100,t.CYAN=65535,t.DARK_BLUE=139,t.DARK_CYAN=35723,t.DARK_GOLDEN_ROD=12092939,t.DARK_GRAY=11119017,t.DARK_GREY=11119017,t.DARK_GREEN=25600,t.DARK_KHAKI=12433259,t.DARK_MAGENTA=9109643,t.DARK_OLIVE_GREEN=5597999,t.DARK_ORANGE=16747520,t.DARK_ORCHID=10040012,t.DARK_RED=9109504,t.DARK_SALMON=15308410,t.DARK_SEA_GREEN=9419919,t.DARK_SLATE_BLUE=4734347,t.DARK_SLATE_GRAY=3100495,t.DARK_SLATE_GREY=3100495,t.DARK_TURQUOISE=52945,t.DARK_VIOLET=9699539,t.DEEP_PINK=16716947,t.DEEP_SKY_BLUE=49151,t.DIM_GRAY=6908265,t.DIM_GREY=6908265,t.DODGER_BLUE=2003199,t.FIRE_BRICK=11674146,t.FLORAL_WHITE=16775920,t.FOREST_GREEN=2263842,t.FUCHSIA=16711935,t.GAINSBORO=14474460,t.GHOST_WHITE=16316671,t.GOLD=16766720,t.GOLDEN_ROD=14329120,t.GRAY=8421504,t.GREY=8421504,t.GREEN=32768,t.GREEN_YELLOW=11403055,t.HONEY_DEW=15794160,t.HOT_PINK=16738740,t.INDIAN_RED=13458524,t.INDIGO=4915330,t.IVORY=16777200,t.KHAKI=15787660,t.LAVENDER=15132410,t.LAVENDER_BLUSH=16773365,t.LAWN_GREEN=8190976,t.LEMON_CHIFFON=16775885,t.LIGHT_BLUE=11393254,t.LIGHT_CORAL=15761536,t.LIGHT_CYAN=14745599,t.LIGHT_GOLDEN_ROD_YELLOW=16448210,t.LIGHT_GRAY=13882323,t.LIGHT_GREY=13882323,t.LIGHT_GREEN=9498256,t.LIGHT_PINK=16758465,t.LIGHT_SALMON=16752762,t.LIGHT_SEA_GREEN=2142890,t.LIGHT_SKY_BLUE=8900346,t.LIGHT_SLATE_GRAY=7833753,t.LIGHT_SLATE_GREY=7833753,t.LIGHT_STEEL_BLUE=11584734,t.LIGHT_YELLOW=16777184,t.LIME=65280,t.LIME_GREEN=3329330,t.LINEN=16445670,t.MAGENTA=16711935,t.MAROON=8388608,t.MEDIUM_AQUA_MARINE=6737322,t.MEDIUM_BLUE=205,t.MEDIUM_ORCHID=12211667,t.MEDIUM_PURPLE=9662680,t.MEDIUM_SEA_GREEN=3978097,t.MEDIUM_SLATE_BLUE=8087790,t.MEDIUM_SPRING_GREEN=64154,t.MEDIUM_TURQUOISE=4772300,t.MEDIUM_VIOLET_RED=13047173,t.MIDNIGHT_BLUE=1644912,t.MINT_CREAM=16121850,t.MISTY_ROSE=16770273,t.MOCCASIN=16770229,t.NAVAJO_WHITE=16768685,t.NAVY=128,t.OLD_LACE=16643558,t.OLIVE=8421376,t.OLIVE_DRAB=7048739,t.ORANGE=16753920,t.ORANGE_RED=16729344,t.ORCHID=14315734,t.PALE_GOLDEN_ROD=15657130,t.PALE_GREEN=10025880,t.PALE_TURQUOISE=11529966,t.PALE_VIOLET_RED=14184595,t.PAPAYA_WHIP=16773077,t.PEACH_PUFF=16767673,t.PERU=13468991,t.PINK=16761035,t.PLUM=14524637,t.POWDER_BLUE=11591910,t.PURPLE=8388736,t.RED=16711680,t.ROSY_BROWN=12357519,t.ROYAL_BLUE=4286945,t.SADDLE_BROWN=9127187,t.SALMON=16416882,t.SANDY_BROWN=16032864,t.SEA_GREEN=3050327,t.SEA_SHELL=16774638,t.SIENNA=10506797,t.SILVER=12632256,t.SKY_BLUE=8900331,t.SLATE_BLUE=6970061,t.SLATE_GRAY=7372944,t.SLATE_GREY=7372944,t.SNOW=16775930,t.SPRING_GREEN=65407,t.STEEL_BLUE=4620980,t.TAN=13808780,t.TEAL=32896,t.THISTLE=14204888,t.TOMATO=16737095,t.TURQUOISE=4251856,t.VIOLET=15631086,t.WHEAT=16113331,t.WHITE=16777215,t.WHITE_SMOKE=16119285,t.YELLOW=16776960,t.YELLOW_GREEN=10145074,t}();t.Color=e;var i=function(){function t(){}return t.ALICE_BLUE="#F0F8FF",t.ANTIQUE_WHITE="#FAEBD7",t.AQUA="#00FFFF",t.AQUAMARINE="#7FFFD4",t.AZURE="#F0FFFF",t.BEIGE="#F5F5DC",t.BISQUE="#FFE4C4",t.BLACK="#000000",t.BLANCHED_ALMOND="#FFEBCD",t.BLUE="#0000FF",t.BLUE_VIOLET="#8A2BE2",t.BROWN="#A52A2A",t.BURLY_WOOD="#DEB887",t.CADET_BLUE="#5F9EA0",t.CHARTREUSE="#7FFF00",t.CHOCOLATE="#D2691E",t.CORAL="#FF7F50",t.CORNFLOWER_BLUE="#6495ED",t.CORNSILK="#FFF8DC",t.CRIMSON="#DC143C",t.CYAN="#00FFFF",t.DARK_BLUE="#00008B",t.DARK_CYAN="#008B8B",t.DARK_GOLDEN_ROD="#B8860B",t.DARK_GRAY="#A9A9A9",t.DARK_GREY="#A9A9A9",t.DARK_GREEN="#006400",t.DARK_KHAKI="#BDB76B",t.DARK_MAGENTA="#8B008B",t.DARK_OLIVE_GREEN="#556B2F",t.DARK_ORANGE="#FF8C00",t.DARK_ORCHID="#9932CC",t.DARK_RED="#8B0000",t.DARK_SALMON="#E9967A",t.DARK_SEA_GREEN="#8FBC8F",t.DARK_SLATE_BLUE="#483D8B",t.DARK_SLATE_GRAY="#2F4F4F",t.DARK_SLATE_GREY="#2F4F4F",t.DARK_TURQUOISE="#00CED1",t.DARK_VIOLET="#9400D3",t.DEEP_PINK="#FF1493",t.DEEP_SKY_BLUE="#00BFFF",t.DIM_GRAY="#696969",t.DIM_GREY="#696969",t.DODGER_BLUE="#1E90FF",t.FIRE_BRICK="#B22222",t.FLORAL_WHITE="#FFFAF0",t.FOREST_GREEN="#228B22",t.FUCHSIA="#FF00FF",t.GAINSBORO="#DCDCDC",t.GHOST_WHITE="#F8F8FF",t.GOLD="#FFD700",t.GOLDEN_ROD="#DAA520",t.GRAY="#808080",t.GREY="#808080",t.GREEN="#008000",t.GREEN_YELLOW="#ADFF2F",t.HONEY_DEW="#F0FFF0",t.HOT_PINK="#FF69B4",t.INDIAN_RED="#CD5C5C",t.INDIGO="#4B0082",t.IVORY="#FFFFF0",t.KHAKI="#F0E68C",t.LAVENDER="#E6E6FA",t.LAVENDER_BLUSH="#FFF0F5",t.LAWN_GREEN="#7CFC00",t.LEMON_CHIFFON="#FFFACD",t.LIGHT_BLUE="#ADD8E6",t.LIGHT_CORAL="#F08080",t.LIGHT_CYAN="#E0FFFF",t.LIGHT_GOLDEN_ROD_YELLOW="#FAFAD2",t.LIGHT_GRAY="#D3D3D3",t.LIGHT_GREY="#D3D3D3",t.LIGHT_GREEN="#90EE90",t.LIGHT_PINK="#FFB6C1",t.LIGHT_SALMON="#FFA07A",t.LIGHT_SEA_GREEN="#20B2AA",t.LIGHT_SKY_BLUE="#87CEFA",t.LIGHT_SLATE_GRAY="#778899",t.LIGHT_SLATE_GREY="#778899",t.LIGHT_STEEL_BLUE="#B0C4DE",t.LIGHT_YELLOW="#FFFFE0",t.LIME="#00FF00",t.LIME_GREEN="#32CD32",t.LINEN="#FAF0E6",t.MAGENTA="#FF00FF",t.MAROON="#800000",t.MEDIUM_AQUA_MARINE="#66CDAA",t.MEDIUM_BLUE="#0000CD",t.MEDIUM_ORCHID="#BA55D3",t.MEDIUM_PURPLE="#9370D8",t.MEDIUM_SEA_GREEN="#3CB371",t.MEDIUM_SLATE_BLUE="#7B68EE",t.MEDIUM_SPRING_GREEN="#00FA9A",t.MEDIUM_TURQUOISE="#48D1CC",t.MEDIUM_VIOLET_RED="#C71585",t.MIDNIGHT_BLUE="#191970",t.MINT_CREAM="#F5FFFA",t.MISTY_ROSE="#FFE4E1",t.MOCCASIN="#FFE4B5",t.NAVAJO_WHITE="#FFDEAD",t.NAVY="#000080",t.OLD_LACE="#FDF5E6",t.OLIVE="#808000",t.OLIVE_DRAB="#6B8E23",t.ORANGE="#FFA500",t.ORANGE_RED="#FF4500",t.ORCHID="#DA70D6",t.PALE_GOLDEN_ROD="#EEE8AA",t.PALE_GREEN="#98FB98",t.PALE_TURQUOISE="#AFEEEE",t.PALE_VIOLET_RED="#D87093",t.PAPAYA_WHIP="#FFEFD5",t.PEACH_PUFF="#FFDAB9",t.PERU="#CD853F",t.PINK="#FFC0CB",t.PLUM="#DDA0DD",t.POWDER_BLUE="#B0E0E6",t.PURPLE="#800080",t.RED="#FF0000",t.ROSY_BROWN="#BC8F8F",t.ROYAL_BLUE="#4169E1",t.SADDLE_BROWN="#8B4513",t.SALMON="#FA8072",t.SANDY_BROWN="#F4A460",t.SEA_GREEN="#2E8B57",t.SEA_SHELL="#FFF5EE",t.SIENNA="#A0522D",t.SILVER="#C0C0C0",t.SKY_BLUE="#87CEEB",t.SLATE_BLUE="#6A5ACD",t.SLATE_GRAY="#708090",t.SLATE_GREY="#708090",t.SNOW="#FFFAFA",t.SPRING_GREEN="#00FF7F",t.STEEL_BLUE="#4682B4",t.TAN="#D2B48C",t.TEAL="#008080",t.THISTLE="#D8BFD8",t.TOMATO="#FF6347",t.TURQUOISE="#40E0D0",t.VIOLET="#EE82EE",t.WHEAT="#F5DEB3",t.WHITE="#FFFFFF",t.WHITE_SMOKE="#F5F5F5",t.YELLOW="#FFFF00",t.YELLOW_GREEN="#9ACD32",t}();t.CSSColor=i}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.write=function(t,e,i){"undefined"==typeof i&&(i=-1);var n="";if(-1!=i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),n="; expires="+o.toUTCString()}document.cookie=t+"="+e+n+"; path=/"},t.read=function(t){t+="=";for(var e,i=document.cookie.split(";"),n=0;n<i.length;n++){for(e=i[n];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(t))return e.substring(t.length,e.length)}return null},t.remove=function(e){t.write(e,"",-1)},t}();t.CookieUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){this._hash=[]}return t.prototype.put=function(t,e){this._hash.push({key:t,value:e})},t.prototype.get=function(t){for(var e=0;e<this._hash.length;e++)if(this._hash[e].key===t)return this._hash[e].value},t.prototype.remove=function(t){for(var e=this._hash.length-1;e>=0;e--)this._hash[e].key===t&&(delete this._hash[e].key,delete this._hash[e].value,this._hash.splice(e,1))},t.prototype.clear=function(){for(var t=0;t<this._hash.length;t++)delete this._hash[t].key,delete this._hash[t].value,this._hash[t]=null;this._hash=[]},t}();t.Dictionary=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.getOffset=function(e){var i=e.getBoundingClientRect(),n=e.clientTop||document.body.clientTop||0,o=e.clientLeft||document.body.clientLeft||0,r=window.pageYOffset||e.scrollTop,s=window.pageXOffset||e.scrollLeft;return new t.Point(i.left+s-o,i.top+r-n)},e.getStyle=function(t){for(var e,i=0;i<document.styleSheets.length;i++){e=document.styleSheets[i].cssRules||document.styleSheets[i].rules;for(var n=0;n<e.length;n++)if(e[n].selectorText===t)return e[n].style}return null},e}();t.DOMUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.DEGTORAD=Math.PI/180,e.RADTODEG=180/Math.PI,e.degreesToRadians=function(t){return t*e.DEGTORAD},e.radiansToDegrees=function(t){return t*e.RADTODEG},e.getDistance=function(t,e,i,n){var o=i-t,r=n-e;return Math.sqrt(o*o+r*r)},e.getDistanceSquared=function(t,e,i,n){var o=i-t,r=n-e;return o*o+r*r},e.getAngle=function(t,i,n,o){var r=Math.atan2(o-i,n-t)*e.RADTODEG;return 0>r?r+360:r},e.rotatePoint=function(i,n,o){var r=new t.Point,s=o*e.DEGTORAD,a=i.x-n.x,h=i.y-n.y,l=Math.cos(s),c=Math.sin(s);return r.x=n.x+a*l-h*c|0,r.y=n.y+h*l+a*c|0,r},e.plotLine=function(e,i){var n,o=!1,r=i.y-e.y,s=i.x-e.x,a=[];(r^r>>31)-(r>>31)>(s^s>>31)-(s>>31)&&(r^=s,s^=r,r^=s,o=!0);var h=0>s?-1:1,l=0==s?r:r/s;if(o)for(n=0;n!=s;n+=h)a.push(new t.Point(e.x+n*l,e.y+n));else for(n=0;n!=s;n+=h)a.push(new t.Point(e.x+n,e.y+n*l));return a},e}();t.GeomUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.sign=function(t){return t>0?1:0>t?-1:0},t.clamp=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),e>t?e:t>i?i:t},t.roundToNearest=function(t,e){return Math.round(e/t)*t},t.isInRange=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),t>=e&&i>=t},t.normalize=function(t,e,i){return"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=1),(t-e)/(i-e)},t.interpolate=function(t,e,i){return e+(i-e)*t},t.map=function(e,i,n,o,r){return t.interpolate(t.normalize(e,i,n),o,r)},t.getNextPowerOfTwo=function(t){for(var e=1;t>e;)e*=2;return e},t}();t.MathUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function t(){}return t.addCommas=function(t){for(var e="",i=""+t,n=i.length,o=0;n>o;o++)(n-o)%3==0&&0!=o&&(e+=","),e+=i.charAt(o);return e},t.addLeadingZeros=function(e,i,n){"undefined"==typeof n&&(n=!1);for(var o=e.toString();o.length<i;)o="0"+o;return n?t.addCommas(o):o},t.getOrdinalSuffix=function(t){if(t>=10&&20>=t)return"th";switch(t%10){case 0:case 4:case 5:case 6:case 7:case 8:case 9:return"th";case 3:return"rd";case 2:return"nd";case 1:return"st";default:return""}},t}();t.NumberUtil=e}(Avota||(Avota={}));var Avota;!function(t){var e=function(){function e(){}return e.write=function(i,n,o,r){"undefined"==typeof o&&(o=!1),"undefined"==typeof r&&(r=t.Context.getAllContexts()[0].name),e.readRaw(r)||e.writeRaw(r,JSON.stringify({}),o);var s=JSON.parse(e.readRaw(r));s[i]=n,e.writeRaw(r,JSON.stringify(s),o)},e.read=function(i,n){return"undefined"==typeof n&&(n=t.Context.getAllContexts()[0].name),e.readRaw(n)?JSON.parse(e.readRaw(n))[i]:null},e.remove=function(i,n,o){if("undefined"==typeof n&&(n=!1),"undefined"==typeof o&&(o=t.Context.getAllContexts()[0].name),e.readRaw(o)){var r=JSON.parse(e.readRaw(o));delete r[i],e.writeRaw(o,JSON.stringify(r),n)}},e.removeAll=function(i,n){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=t.Context.getAllContexts()[0].name),e.readRaw(n)&&e.removeRaw(n,i)},e.writeRaw=function(t,e,i){"undefined"==typeof i&&(i=!1),sessionStorage.setItem(t,e),i||localStorage.setItem(t,e)},e.readRaw=function(t){return sessionStorage.getItem(t)||localStorage.getItem(t)},e.removeRaw=function(t,e){"undefined"==typeof e&&(e=!1),sessionStorage.removeItem(t),e||localStorage.removeItem(t)},e}();t.StorageUtil=e}(Avota||(Avota={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,i.NAME,t),this.bootSignal.addOnce(this.onBoot,this),this.startupSignal.addOnce(this.onStart,this)}return __extends(i,e),i.NAME="SuperChargersGame",i.prototype.onBoot=function(){var t=(this.config,this.config.resources);if(Avota.EnvUtil.isMobile)for(var e=0;e<t.length;e++){var i=t[e];i.path.match("high_res")&&(i.path=i.path.replace("high_res","low_res"))}},i.prototype.startGame=function(){if(t.GameData.DEVICE_FRAME_RATE=this.settings.tickRate,t.GameData.setup(this),t.SpriteConfig.setup(t.GameData.getSpriteConfig()),t.PlayerData.setup(),t.PlayerData.logTracks(t.GameData.getTrackList()),!t.PlayerData.validateSaveData()){t.PlayerData.selectVehicle(t.GameData.getSelectableVehicleList()[0]),t.PlayerData.selectCharacter(t.GameData.getSelectableCharacterList()[0]),t.PlayerData.selectTrack(t.GameData.getTrackList()[0]);for(var e in t.GameData.getUpgradeData())t.GameData.getUpgradeData()[e].forceUnlock&&t.PlayerData.unlockUpgrade(e)}this.setScene(t.GameMenu)},i.prototype.onStart=function(){this.startGame()},i}(Avota.Game);t.SuperChargersGame=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(){e.call(this,Avota.Context.getContext(t.SuperChargersGame.NAME),i.NAME),this.frameSkip=0,this.enteredSignal.addOnce(this._onEnter,this)}return __extends(i,e),i.NAME="SuperChargersLevel",i.MAX_FRAME_ADVANCE=5,i.prototype._onEnter=function(){var e=t.GameData.getTrackData(t.PlayerData.getSelectedTrack());this.menuOverlay=this.create(t.GameMenuOverlay,this),this.world=new t.RacerWorld,this.gameboard=new t.Gameboard,this.inventory=new t.InventoryData,this.screenFX=this.create(t.ScreenFX,this,this.timeManager,this.renderManager,this.globalStrings,this.screenWidth,this.screenHeight),this.screenFX.zIndex=400,this.boardSoundstage=new t.BoardSoundStage(this.soundManager,this.gameboard,this.inventory),this.racerSoundstage=new t.RacerSoundStage(this.world,this.soundManager,this._game,this.globalConfig.assets),t.ScreenUtil.makeImage(this,"LevelBG","LevelBG",{x:0,y:0}),this.entityController=new t.TrackEntityController(this.world,this.gameboard,this.inventory,this.inputManager),this.eventController=new t.TrackEventController(this.world),this.physics=new t.RacerPhysics(this.world),this.boardDisplay=this.create(t.BoardDisplay,this.gameboard,this,this.screenFX,this.timeManager,"display1"),this.boardDisplay.setup({displayX:255,displayY:130,pieceData:t.GameData.getData("gamePieces")}),this.raceDisplay=this.create(t.RaceDisplay,this.world,this,t.GameData.getSpriteConfig(),this.timeManager),this.raceDisplay.setupBG(e.bgSettings),this.world.addBuilder(new t.SCTrackBuilder),this.world.newTrack(e),this.gameboard.init({rows:9,columns:8,pieceData:t.GameData.getData("gamePieces")}),this.gui=this.create(t.LevelGUI,this,this.world,this.inventory,this.boardDisplay,this.touchInput),this.gui.menuOverlay=this.menuOverlay,this.eventController.addTrackEvents(e.events),this.eventController.startQueue(),this.eventController.addModule("screenFX",this.screenFX),this.eventController.addModule("sound",this.soundManager),this.eventController.addModule("menuOverlay",this.menuOverlay),this.eventController.addModule("strings",this.globalStrings)
},i.prototype.pause=function(t){e.prototype.pause.call(this,t)},i.prototype.onTick=function(t){this.updateGame(t),this.boardDisplay.update(),this.raceDisplay.update()},i.prototype.updateGame=function(){this.world.update(),this.eventController.update(),this.entityController.update(),this.physics.update(),this.racerSoundstage.update()},i.prototype.destroy=function(){TweenMax.killAll(),this.menuOverlay.destroy(),e.prototype.destroy.call(this)},i}(Avota.Level);t.SuperChargersLevel=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(t){this._events={},this._eventHandlers={},this._activeEvents={},this._eventQueue=[],this._modules={},this._racerWorld=t,this._racerWorld.eventSignal.add(this.eventSignalHandler,this),this.addEventHandler(i.RACE_BEGIN,this.raceBegin),this.addEventHandler(i.COUNTDOWN,this.countDown),this.addEventHandler(i.START,this.startRace),this.addEventHandler(i.LAP_COMPLETED,this.lapCompleted),this.addEventHandler(i.RACE_END,this.raceEnd)}return e.NAME="TrackEventController",e.prototype.addModule=function(t,e){this._modules[t]=e},e.prototype.getModule=function(t){return this._modules[t]},e.prototype.addEventHandler=function(t,e){this._eventHandlers[t]=e},e.prototype.eventSignalHandler=function(e){switch(e){case t.EventSignals.LAP_COMPLETED:this._events.lapCompleted||this.addEvent("lapCompleted",i.LAP_COMPLETED),this.startEvent("lapCompleted");break;case t.EventSignals.RACE_END:this._events.raceEnd||this.addEvent("raceEnd",i.RACE_END),this.startEvent("raceEnd")}},e.prototype.update=function(){for(var t in this._activeEvents){var e=this._events[t];this._eventHandlers[e.eventID]&&this._eventHandlers[e.eventID].call(this,e)}},e.prototype.addTrackEvents=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.addEvent(i.id,i.event,i.target),this.queueEvent(i.id)}},e.prototype.addEvent=function(t,e,i){var n={};n.uid=t,n.eventID=e,n.target=i,this._events[t]=n},e.prototype.queueEvent=function(t){this._eventQueue.push(t)},e.prototype.startEvent=function(t){this._activeEvents[t]=!0},e.prototype.endEvent=function(t){this._activeEvents[t]=null,delete this._activeEvents[t],this._queueActive&&this.startNextEvent()},e.prototype.startQueue=function(){this._queueActive=!0,this.startNextEvent()},e.prototype.pauseQueue=function(){this._queueActive=!1},e.prototype.startNextEvent=function(){if(0!=this._eventQueue.length){var t=this._events[this._eventQueue.shift()];this.startEvent(t.uid)}},e.prototype.raceBegin=function(e){var i=this,n=this.getModule("sound"),o=this.getModule("screenFX"),r=t.GameData.getTrackData(t.PlayerData.getSelectedTrack());e.started||(n&&n.playSound("BGMLevel"),o&&o.showPreraceMessage(.3,r.preRaceMessage),TweenMax.delayedCall(5,function(){return i.endEvent(e.uid)}),e.started=!0)},e.prototype.countDown=function(t){if(!t.started){var e=this.getModule("screenFX"),i=this.getModule("sound"),n=this;TweenMax.delayedCall(.1,function(){return o()}),t.count=3,t.started=!0;var o=function(){t.count>0?(e&&e.showCountdownNumber(t.count),i&&i.playSound("VOCount"+t.count),t.count--,TweenMax.delayedCall(1,function(){return o()})):n.endEvent(t.uid)}}},e.prototype.startRace=function(e){var i=this.getModule("screenFX"),n=this.getModule("sound");i&&i.showGoMessage(),n&&n.playSound("VOGo");this._racerWorld.getEntity("player");this._racerWorld.raceStarted=!0,this._racerWorld.raceStartFrame=this._racerWorld.frameCount,this._racerWorld.eventSignal.dispatch(t.EventSignals.RACE_BEGIN),this.endEvent(e.uid)},e.prototype.lapCompleted=function(e){var i=this.getModule("screenFX"),n=(this.getModule("menuOverlay"),this.getModule("sound"),this.getModule("hud"),this.getModule("strings")),o=this._racerWorld.getEntity("player");o.lapsCompleted<this._racerWorld.track.laps?(i&&i.showMessage(n.game.lap.toUpperCase()+" "+(o.lapsCompleted+1)),this.endEvent(e.uid)):(this._racerWorld.eventSignal.dispatch(t.EventSignals.RACE_END),this.endEvent(e.uid))},e.prototype.raceEnd=function(e){var i=this.getModule("screenFX"),n=this.getModule("menuOverlay"),o=this.getModule("sound"),r=(this.getModule("hud"),this.getModule("strings"),this),s=this._racerWorld.getEntity("player");if(!e.complete){i&&i.showBeneficialPlacement(s.place);var a=t.GameData.getTrackData(t.PlayerData.getSelectedTrack());s.place<2&&(o&&1==s.place&&o.playSound("VOYouWin"),a.unlocks&&t.PlayerData.unlockTrack(a.unlocks));var h=[t.ScoreMultiplier.FIRST_PLACE,t.ScoreMultiplier.SECOND_PLACE,t.ScoreMultiplier.THIRD_PLACE,t.ScoreMultiplier.FORTH_PLACE];s.place-1<h.length&&this._racerWorld.scoreData.logMultipier(h[s.place-1]),this._racerWorld.raceEndFrame=this._racerWorld.frameCount,e.complete=!0,t.PlayerData.recordTrackStats(t.PlayerData.getSelectedTrack(),this._racerWorld.scoreData.getTotalScore(),this._racerWorld.raceEndFrame-this._racerWorld.raceStartFrame),t.PlayerData.save(),this._racerWorld.end(),TweenMax.delayedCall(5,function(){t.PlayerData.recordRaceResults(r._racerWorld),n&&n.showResultsScreen(),r.endEvent(e.uid)})}},e}();t.TrackEventController=e;var i=function(){function t(){}return t.RACE_BEGIN="raceBegin",t.COUNTDOWN="countdown",t.START="start",t.LAP_COMPLETED="lapCompleted",t.RACE_END="raceEnd",t}();t.TrackEvent=i}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function t(){this._pieces={},this._pieceList=[],this._pieceData={},this._rows=[],this._columns=[],this._pieceCategories={},this._pieceAddCount=0,this._selectedPieces=[],this._encounterRates=["sword",15,"explosion",15,"engine",37,"gearbit",18,"treasure",12,"wild",3],this._bank=[],this._matchCount=3,this._matches={},this._matchData=new o,this._bonuses=[],this._numMoves=0,this._moves=[],this._numTypes=0,this.initialized=!1,this.empty=!1,this.eventSignal=new Avota.Signal,this.patternTypes=[[1,3],[3,1],[1,4],[4,1],[3,2],[2,3],[4,2],[2,4],[1,1],[2,2],[3,3],[4,4]]}return t.NAME="Gameboard",t.loopSum=function(t,e,i,n){"undefined"==typeof n&&(n=0);for(var o=t+e;o>i;)o=n+(o-i);for(;n>=o;)o=i+(o-n);return o},t.findClosestDivisable=function(t,e){return e>=t?e:t%e>e/2?t+(e-t%e):t-t%e},t.findNextDivisable=function(t,e){return e>=t?e:t+(e-t%e)},Object.defineProperty(t.prototype,"maxBonuses",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._rows.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._columns.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSelected",{get:function(){return this._matchData.numSelected},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numMoves",{get:function(){return this._numMoves},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moves",{get:function(){return this._moves},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this._rows.length=t.rows,this._columns.length=t.columns,this._pieceCategories.type={};for(var e=0;e<this._rows.length;e++){var i=[];i.length=this.numColumns,this._rows[e]=i}for(var e=0;e<this._columns.length;e++){var n=[];n.length=this.numRows,this._columns[e]=n}this._pieceData=t.pieceData,this._encounterRates=t.encounterRates||this._encounterRates,this.createPieceBank(),this.fill(!0),this.initialized=!0},t.prototype.createPieceBank=function(){var t=this.numRows*this.numColumns*2;this._numTypes=0;for(var e in this._pieceData){for(var i=this._pieceData[e],n=Math.floor(i.rate/100*t),o=0;n>o;o++)this._bank.push(e);this._numTypes++}this.shuffleBank()},t.prototype.shuffleBank=function(){this._bank=Avota.ArrayUtil.randomize(this._bank)},t.prototype.fill=function(t){"undefined"==typeof t&&(t=!1);for(var e=0;e<this.numColumns;e++)for(var i=this._columns[e],n=i.length-1;n>=0&&i.length>0;n--)if(!i[n]||""==i[n]){var o;if(t)for(var r=0;r<this._bank.length;r++){if(o=this._bank[r],!this.checkMatch(o,n+1,e+1)){this._bank.splice(r,1);break}if(r==this._bank.length-1){this._bank.splice(r,1);break}}else o=this._bank.shift();this.addPiece(o,n+1,e+1)}this.empty=!1},t.prototype.shiftRow=function(e,i){for(var n=this.getRow(e),o=0;o<n.length;o++){var r=n[o],s=this.getPiece(r);s.column=t.loopSum(s.column,i,this.numColumns);var a=this._columns[s.column-1];a[e-1]=s.id}for(var o=0;o<Math.abs(i);o++)i>0?n.unshift(n.pop()):n.push(n.shift())},t.prototype.shiftColumn=function(e,i){for(var n=this.getColumn(e),o=0;o<n.length;o++){var r=n[o],s=this.getPiece(r);s.row=t.loopSum(s.row,i,this.numRows)}for(var o=0;o<Math.abs(i);o++)i>0?n.unshift(n.pop()):n.push(n.shift())},t.prototype.changeRandomPiecesTo=function(t,e){"undefined"==typeof e&&(e=.2);for(var i,n=Math.floor(this.numRows*this.numColumns*e),o=[],r=Avota.ArrayUtil.randomize(this._pieceList.concat());o.length<n&&(i=this._bank.indexOf(t),-1!=i);)o.push(this._bank.splice(i,1)[0]);for(var s=o.length-1;s>=0&&o.length>0;s--){for(var a=o[s],h=null;!h&&0!=r.length;)h=this.getPiece(r.shift());if(!h)break;this.changePieceType(h.id,a)}},t.prototype.changePieceType=function(t,e){var n=this.getPiece(t);if(n){var o=n.type;n.type=e,-1!=this._bank.indexOf(e)&&this._bank.splice(this._bank.indexOf(e),1),this._bank.push(o),this.eventSignal.dispatch(i.PIECE_CHANGED,{id:t,oldType:o,newType:e})}},t.prototype.selectPiece=function(t,e,o){"undefined"==typeof o&&(o=!0),e||(e=this._matchData);var r=this.getPiece(t);if(r){var s=!1;if(0==e.numSelected)s=!0;else{var a=this.getPiece(e.selectedPieces[e.numSelected-1]);(e.selectionType==r.type||r.type==n.WILD||e.selectionType==n.WILD)&&(a.column==r.column||a.row==r.row)&&Math.abs(a.column-r.column)<=1&&Math.abs(a.row-r.row)<=1&&(s=!0,e.selectionType==n.WILD&&r.type!=n.WILD&&(e.selectionType=r.type))}!r.selected&&s&&(e.addSelectedPiece(r.id,r.type),o&&(r.selected=!0,this.eventSignal.dispatch(i.PIECE_SELECTED,r.id)))}},t.prototype.checkMoves=function(){this._numMoves=0,this._moves=[],this.traversePieces(this.findMoves,this)},t.prototype.findMoves=function(t){for(var e=0,i=new o,n=0;n<this.patternTypes.length;n++){var r=this.patternTypes[n],s=t.row,a=t.column;i=new o,this.selectPiece(this.getPieceAt(s,a).id,i,!1);for(var h=0;h<r.length;h++){var l=r[h];switch(l){case 1:s-=1;break;case 2:s+=1;break;case 3:a-=1;break;case 4:a+=1}s>0&&s<=this.numRows&&a>0&&a<=this.numColumns&&this.selectPiece(this.getPieceAt(s,a).id,i,!1)}i.numSelected>2&&(e++,this._moves.push(i))}this._numMoves+=e},t.prototype.deselectPiece=function(t){var e=this.getPiece(t);e&&e.selected&&(e.selected=!1,this._matchData.removeSelectedPiece(e.id),this.eventSignal.dispatch(i.PIECE_DESELECTED,e.id))},t.prototype.deselectAllAfter=function(t){for(var e=this._matchData.selectedPieces.slice(this._matchData.selectedPieces.indexOf(t)+1),i=0;i<e.length;i++){var n=e[i];this.deselectPiece(n)}},t.prototype.removeBoard=function(){for(var t in this._pieces)this._bank.push(this._pieces[t].type),this.deselectPiece(t);this.eventSignal.dispatch(i.BOARD_REMOVED),this.removeAllPieces()},t.prototype.executeSelection=function(){if(this._matchData.selectedPieces.length>2){this.eventSignal.dispatch(i.SELECTION_EXECUTED,this._matchData);for(var t=this._matchData.selectedPieces.length-1;t>=0&&this._matchData.selectedPieces.length>0;t--){var e=this.getPiece(this._matchData.selectedPieces[t]);e&&this.clearPiece(e.id)}this._matchData.clear(),this.shuffleBank(),this.fill()}else for(var t=this._matchData.selectedPieces.length-1;t>=0&&this._matchData.selectedPieces.length>0;t--){var e=this.getPiece(this._matchData.selectedPieces[t]);e&&this.deselectPiece(e.id)}},t.prototype.getAllMatches=function(){for(var t in this._matches)delete this._matches[t];for(var t in this._pieces){var e=this._pieces[t];this.checkMatch(e.type,e.row,e.column,this._matches)}var i=0;for(var t in this._matches)this._matches[t]&&i++;return this._matches.numPieces=i,this._matches},t.prototype.getMatchesFromMove=function(t,e,i){var n;return"column"==t?(this.shiftColumn(e,i),n=this.getAllMatches(),this.shiftColumn(e,-i)):(this.shiftRow(e,i),n=this.getAllMatches(),this.shiftRow(e,-i)),n},t.prototype.executeMatches=function(){var t=this.getAllMatches();if(0!=t.numPieces){for(var e in t){var n=this.getPiece(e);n&&(n.matched=!0)}this.eventSignal.dispatch(i.MATCH,t);for(var e in t){var n=this.getPiece(e);n&&this.clearPiece(n.id)}this.shuffleBank(),this.fill()}},t.prototype.checkMatch=function(t,e,i,n){var o=!1;return this.checkDir(t,e,i,"up",n)&&(o=!0),this.checkDir(t,e,i,"down",n)&&(o=!0),this.checkDir(t,e,i,"left",n)&&(o=!0),this.checkDir(t,e,i,"right",n)&&(o=!0),o},t.prototype.checkDir=function(t,e,i,o,r){var s,a,h,l,c,u,p=this.getColumn(i),d=this.getRow(e);switch(o){case"up":case"down":h=e-1,l=p;break;case"left":case"right":h=i-1,l=d}c="up"==o||"left"==o?-1:1,s=0;for(var f=1;f<l.length;f++){var _=h+c*f;if(0>_||_>=l.length)break;if(a=this.getPiece(l[_]),a&&t==n.WILD&&(t=a.type),!a||a.type!=t&&a.type!=n.WILD)break;s++}if(u=s>=this._matchCount-1,r&&u)for(var f=0;s+1>f;f++){var _=h+c*f;a=this.getPiece(l[_]),r[a.id]=!0}return u},t.prototype.addPiece=function(t,e,o){var r=new n;r.id=t+this._pieceAddCount,r.type=t,r.row=e>this.numRows?this.numRows:1>e?1:e,r.column=o>this.numColumns?this.numColumns:1>o?1:o;var s=this._columns[r.column-1];s[r.row-1]=r.id,this._pieceCategories.type[r.type]||(this._pieceCategories.type[r.type]=[]),this._pieceList.push(r.id),this._pieceCategories.type[r.type].push(r.id),this._pieces[r.id]=r,this._pieceAddCount++,this.eventSignal.dispatch(i.PIECE_ADDED,r.id)},t.prototype.clearPiece=function(t){var e=this.getPiece(t);if(e){var n=this.getColumn(e.column);n.splice(e.row-1,1);for(var o=0;o<n.length;o++){var r=this.getPiece(n[o]);r&&(r.row=o+1)}n.length=this.numRows,this._bank.push(e.type),this.removePiece(e.id),this.eventSignal.dispatch(i.PIECE_CLEARED,e.id)}},t.prototype.removePiece=function(t){this._pieces[t]=null,delete this._pieces[t]},t.prototype.removeAllPieces=function(){this._pieces={};for(var t=0;t<this.numColumns;t++){var e=this.getColumn(t+1);e.splice(0,e.length),e.length=this.numRows}this.empty=!0},t.prototype.getPiece=function(t){return this._pieces[t]},t.prototype.getPieceAt=function(t,e){return this.getPiece(this._columns[e-1][t-1])},t.prototype.traversePieces=function(t,e,i){for(var n=i?this._pieceCategories[i]:this._pieceList,o=n.length;o>=0&&n.length>0;o--){var r=this.getPiece(n[o]);r?t.call(e,r):n.splice(o,1)}},t.prototype.getRow=function(t){for(var e=this._rows[t-1],i=0;i<this.numColumns;i++){var n=this.getColumn(i+1);e[i]=n[t-1]}return e},t.prototype.getColumn=function(t){return this._columns[t-1]},t}();t.Gameboard=e;var i=function(){function t(){}return t.PIECE_ADDED=0,t.MATCH=1,t.PIECE_CLEARED=2,t.PIECE_SELECTED=3,t.PIECE_DESELECTED=4,t.SELECTION_EXECUTED=5,t.BOARD_REMOVED=6,t.PIECE_CHANGED=7,t}();t.GameboardEvents=i;var n=function(){function t(){}return t.HEAL="heal",t.SWORD="sword",t.EXPLOSION="explosion",t.ENGINE="engine",t.BOOTS="boots",t.KEY="key",t.GEARBIT="gearbit",t.TREASURE="treasure",t.WILD="wild",t}();t.GamePiece=n;var o=function(){function t(){this.selectedPieces=[],this.selectedTypes=[]}return Object.defineProperty(t.prototype,"numSelected",{get:function(){return this.selectedPieces.length},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.selectedPieces.length=0,this.selectedTypes.length=0,this.selectionType=""},t.prototype.addSelectedPiece=function(t,e){this.selectedPieces.push(t),this.selectedTypes.push(e),1==this.selectedPieces.length&&(this.selectionType=e)},t.prototype.removeSelectedPiece=function(t){this.selectedTypes.splice(this.selectedPieces.indexOf(t),1),this.selectedPieces.splice(this.selectedPieces.indexOf(t),1),0==this.selectedPieces.length&&(this.selectionType="")},t.prototype.hasType=function(t){return-1!=this.selectedTypes.indexOf(t)},t.prototype.numType=function(t){for(var e=this.selectedTypes.indexOf(t),i=0;-1!=e;)i++,e=this.selectedTypes.indexOf(t,e+1);return i},t.prototype.getPiecesOfType=function(t){for(var e=this.selectedTypes.indexOf(t),i=[];-1!=e;)i.push(this.selectedPieces[e]),e=this.selectedTypes.indexOf(t,e+1);return i},t}();t.MatchData=o}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t,n,o,r,s){"undefined"==typeof s&&(s=i.NAME);var a=this;e.call(this,r,s),this._displayX=0,this._displayY=0,this._inputData={},this._cellWidth=-1,this._cellHeight=-1,this._moveThreshold=10,this._animations={},this._animCount=0,this._inputEnabled=!1,this._checkMatch=!1,this._locked=!0,this._gameboard=t,this._scene=n,this._screenFX=o,this._timeline=new TimelineMax({onComplete:function(){return a.onAnimComplete()},paused:!0})}return __extends(i,e),i.NAME="BoardDisplay",i.prototype.setup=function(e){this._displayX=e.displayX||0,this._displayY=e.displayY||0,this._pieceData=e.pieceData,this._gameboard.eventSignal.add(this.boardHandler,this),t.ScreenUtil.makeImage(this._scene,"TileBG","TileBG",{x:this._displayX-10,y:this._displayY-5,zIndex:2})},i.prototype.lock=function(){this.disableHint(),this._locked=!0},i.prototype.unlock=function(){this.enableHint(),this._locked=!1},i.prototype.enableInput=function(){this._locked||(this._inputEnabled=!0)},i.prototype.disableInput=function(){this._inputData.isDown&&this.onUp(this._inputRect,this._inputData.current.x,this._inputData.current.y),this._inputEnabled=!1},i.prototype.update=function(){this.updateInputs(),this.updateSelection()},i.prototype.getPieceLocation=function(t){var e=this._gameboard.getPiece(t);if(!e)return null;var i=this.getCellX(e.column),n=this.getCellY(e.row);return new Avota.Point(i,n)},i.prototype.boardHandler=function(e,i){switch(e){case t.GameboardEvents.PIECE_ADDED:this.showPiece(i);break;case t.GameboardEvents.MATCH:this.showMatches(i);break;case t.GameboardEvents.PIECE_CLEARED:this.movePieces();break;case t.GameboardEvents.PIECE_SELECTED:this.showSelected(i);break;case t.GameboardEvents.PIECE_DESELECTED:this.showDeselected(i);break;case t.GameboardEvents.SELECTION_EXECUTED:this.clearSelection(i);break;case t.GameboardEvents.BOARD_REMOVED:this.removeBoard();break;case t.GameboardEvents.PIECE_CHANGED:this.changePiece(i.id,i.oldType,i.newType)}},i.prototype.showPiece=function(e){var i=this._gameboard.getPiece(e);if(i){var n=this._pieceData[i.type];if(!n)throw"Data not found for "+i.type;var o=t.ScreenUtil.makeImage(this._scene,"piece"+i.id,n.display,{zIndex:10});(this._cellWidth<0||this._cellHeight<0)&&(this._cellWidth=o.width,this._cellHeight=o.height,this.setInputRect()),o.x=this.getCellX(i.column),o.y=this.getCellY(i.row),o.registrationX=o.width/2,o.registrationY=o.height/2;var r=t.ScreenUtil.makeImage(this._scene,"piece"+i.id+"glow","PieceGlow",{zIndex:11,x:-this._cellWidth,y:-this._cellHeight,visible:!1});r.registrationX=r.width/2,r.registrationY=r.height/2;var s=t.ScreenUtil.makeImage(this._scene,"piece"+i.id+"hint","PieceHint",{zIndex:11,x:-this._cellWidth,y:-this._cellHeight,visible:!1});s.registrationX=s.width/2,s.registrationY=s.height/2,this._timeline.insert(TweenMax.from(o,.65,{scale:0,ease:Elastic.easeOut,delay:!this._gameboard.initialized||this._gameboard.empty?Avota.Random["float"](0,.75):.5})),this.playAnim(!0,!0)}},i.prototype.changePiece=function(e){var i=this._gameboard.getPiece(e);if(i){var n=this._scene.get("piece"+e),i=this._gameboard.getPiece(e),o=t.GameData.getData("gamePieces")[i.type],r=t.SpriteConfig.getDisplayDefinition(o.matchFX),s=t.SpriteConfig.getAnimationData(r.data),a=t.SpriteConfig.makeSpriteSheet(this._scene,s.spritesheet),h=this._scene.get("piece"+e+"glow");TweenMax.killTweensOf(h),h.destroy();var l=t.ScreenUtil.makeSprite(this._scene,"pieceMatch"+e,a,[s],{zIndex:n.zIndex+1});l.centerX=n.centerX,l.centerY=n.centerY,l.play(s.name,0,1,function(){var t=this;TweenMax.delayedCall(.1,function(){return t.destroy()})}.bind(l)),TweenMax.killTweensOf(n),n.destroy(),n=t.ScreenUtil.makeImage(this._scene,"piece"+i.id,o.display,{zIndex:10}),n.x=this.getCellX(i.column),n.y=this.getCellY(i.row),n.registrationX=n.width/2,n.registrationY=n.height/2;var c=t.ScreenUtil.makeImage(this._scene,"piece"+i.id+"glow","PieceGlow",{zIndex:11,x:-this._cellWidth,y:-this._cellHeight,visible:!1});c.registrationX=c.width/2,c.registrationY=c.height/2;var u=t.ScreenUtil.makeImage(this._scene,"piece"+i.id+"hint","PieceHint",{zIndex:11,x:-this._cellWidth,y:-this._cellHeight,visible:!1});u.registrationX=u.width/2,u.registrationY=u.height/2,this._timeline.insert(TweenMax.from(n,.65,{scale:0,ease:Elastic.easeOut,delay:!this._gameboard.initialized||this._gameboard.empty?Avota.Random["float"](0,.75):.5})),this.playAnim(!0,!0)}},i.prototype.destroyPieceImageFX=function(t){var e=this._scene.get("piece"+t+"glow");TweenMax.killTweensOf(e),e.destroy();var i=this._scene.get("piece"+t+"hint");TweenMax.killTweensOf(i),i.destroy()},i.prototype.showMatches=function(t){for(var e in t){var i=this._scene.get("piece"+e);i&&(this.destroyPieceImageFX(e),this._timeline.insert(TweenMax.to(i,.65,{scale:1.5,alpha:0})))}this.playAnim()},i.prototype.clearSelection=function(e){for(var i=0;i<e.selectedPieces.length;i++){var n=e.selectedPieces[i],o=this._scene.get("piece"+e.selectedPieces[i]),r=this._gameboard.getPiece(n),s=t.GameData.getData("gamePieces")[r.type],a=t.SpriteConfig.getDisplayDefinition(s.matchFX),h=t.SpriteConfig.getAnimationData(a.data),l=t.SpriteConfig.makeSpriteSheet(this._scene,h.spritesheet);if(o){this.destroyPieceImageFX(e.selectedPieces[i]);var c=t.ScreenUtil.makeSprite(this._scene,"pieceMatch"+e.selectedPieces[i],l,[h],{zIndex:o.zIndex+1});c.centerX=o.centerX,c.centerY=o.centerY,c.play(h.name,0,1,function(){var t=this;TweenMax.delayedCall(.1,function(){return t.destroy()})}.bind(c)),this._timeline.insert(TweenMax.to(o,.65,{scale:1.5,alpha:0,onComplete:o.destroy,onCompleteScope:o}))}}this.playAnim()},i.prototype.removeBoard=function(){this._gameboard.traversePieces(function(t){var e=this._scene.get("piece"+t.id);if(e){this.destroyPieceImageFX(t.id);var i=Avota.Random["float"](0,.45);this._timeline.insert(TweenMax.to(e,.15,{y:"-=25",ease:Power2.easeOut,delay:i})),this._timeline.insert(TweenMax.to(e,.45,{y:"+=600",ease:Power2.easeIn,onComplete:e.destroy,onCompleteScope:e,delay:i+.16}))}},this),this.playAnim()},i.prototype.showSelected=function(t){var e=this._gameboard.getPiece(t);if(e){var i=this._scene.get("piece"+e.id),n=this._scene.get("piece"+e.id+"glow");n.visible=!0,n.active=!1,n.centerX=i.centerX,n.centerY=i.centerY,e.selected&&(this._timeline.insert(TweenMax.to(i,.35,{scale:1.2})),this._timeline.insert(TweenMax.to(n,.35,{scale:1.2})),this.playAnim(!1))}},i.prototype.showDeselected=function(t){var e=this._gameboard.getPiece(t);if(e){var i=this._scene.get("piece"+e.id),n=this._scene.get("piece"+e.id+"glow");n&&(n.visible=!1,n.active=!1,n.x=-n.width,n.y=-n.height,e.selected||(this._timeline.insert(TweenMax.to(i,.35,{scale:1})),this.playAnim(!1)))}},i.prototype.showHint=function(){for(var t=this._gameboard.moves,e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.numSelected;n++){var o=i.selectedPieces[n],r=this._gameboard.getPiece(o);if(!r)return;var s=this._scene.get("piece"+r.id),a=this._scene.get("piece"+r.id+"hint");a.visible=!0,a.active=!1,a.alpha=1,a.scale=1,a.centerX=s.centerX,a.centerY=s.centerY,TweenMax.isTweening(a)||(TweenMax.from(a,.35,{alpha:0,scale:1.5}),TweenMax.to(a,.35,{scale:1.05,delay:.5,yoyo:!0,repeat:-1}))}this._scene.soundManager.playSound("SUIHint")},i.prototype.disableHint=function(){this._gameboard.traversePieces(function(t){var e=this._scene.get("piece"+t.id+"hint");TweenMax.killTweensOf(e),e.visible=!1,e.active=!1},this),this._hintTween&&TweenMax.killTweensOf(this._hintTween.target)},i.prototype.enableHint=function(){var t=this;this._hintTween&&TweenMax.killTweensOf(this._hintTween.target),this._hintTween=TweenMax.delayedCall(7,function(){return t.showHint()})},i.prototype.movePieces=function(){this._gameboard.traversePieces(this.movePiece,this)},i.prototype.movePiece=function(t){var e=this._scene.get("piece"+t.id);if(e&&!t.matched&&!t.selected){var i=this.getCellX(t.column),n=this.getCellY(t.row);this._timeline.kill(null,e),this._timeline.insert(TweenMax.to(e,.2*(Math.abs(n-e.y)/this._cellHeight),{x:i,y:n,ease:Power3.easeIn})),this.playAnim()}},i.prototype.playAnim=function(t,e){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!1),t&&this.disableInput(),this._timeline.isActive()||this._timeline.play(0),e&&(this._checkMatch=e)},i.prototype.animate=function(t,e,i,n){function o(t,e){this._animations[t.data]=null,delete this._animations[t.data];var i=0;for(var n in this._animations)this._animations[n].data&&i++;e&&e(),0==i&&this.enableInput()}var r=n.onComplete;n.onComplete=o,n.onCompleteParams=["{self}",r],n.onCompleteScope=this;var s=TweenMax[e](t,i,n);s.data="anim"+this._animCount,this._animations[s.data]=s,this._animCount++},i.prototype.onAnimComplete=function(){var t=this;this._timeline.clear(),this._gameboard.checkMoves(),this._checkMatch?(0==this._gameboard.numMoves?(this._gameboard.removeBoard(),this._screenFX.showMessage(this._scene.globalStrings.game.messages.outOfMoves),TweenMax.delayedCall(.5,function(){return t._gameboard.fill()})):(this.enableInput(),this.enableHint()),this._checkMatch=!1):(this.enableInput(),this.enableHint())},i.prototype.removeImage=function(t){var e=this._scene.get(t);e&&e.destroy()},i.prototype.getRowAt=function(t){return Math.min(this._gameboard.numRows,this._gameboard.numRows-Math.ceil((t-this._displayY)/this._cellHeight)+1)},i.prototype.getColumnAt=function(t){return Math.min(this._gameboard.numColumns,Math.ceil((t-this._displayX)/this._cellWidth))},i.prototype.getCellX=function(t){return this._displayX+(t-1)*this._cellWidth},i.prototype.getCellY=function(t){return this._displayY+(this._gameboard.numRows-t)*this._cellHeight},i.prototype.updateSelection=function(){if(this._inputEnabled&&this._inputData.isDown){var t=this._inputData.current,e=(this._inputData.start,Math.max(this.getRowAt(t.y),1)),i=Math.max(this.getColumnAt(t.x),1),n=this._gameboard.getPieceAt(e,i);n&&(n.selected?this._gameboard.deselectAllAfter(n.id):this._gameboard.selectPiece(n.id))}},i.prototype.updateGraphics=function(){if(this._inputEnabled&&this._inputData.isDown){var t=this._inputData.current,e=this._inputData.start,i=this.getRowAt(e.y),n=this.getColumnAt(e.x);"hor"==this._inputData.moveDir?this.shiftRow(i,t.x-e.x):"vert"==this._inputData.moveDir&&this.shiftColumn(n,t.y-e.y)}},i.prototype.shiftRow=function(e,i,n){"undefined"==typeof n&&(n=!1);for(var o=this._gameboard.getRow(e),r=0;r<o.length;r++){var s=o[r],a=this._gameboard.getPiece(s),h=this._scene.get("piece"+s),l=this._scene.get("piece"+s+"copy");if(h){var c=this._displayX,u=this._displayX+this._gameboard.numColumns*this._cellWidth,p=this._displayX+(a.column-1)*this._cellWidth,d=t.Gameboard.loopSum(p,i,u-1,c-1),f=d+this._cellWidth>c&&c>d,_=d+this._cellWidth>u&&u>d;if(h.scale=1,h.alpha=1,h.zIndex=10,l.scale=1,l.alpha=1,l.x=-this._cellWidth,l.y=-this._cellHeight,l.visible=!1,f||_){var g=f?c:u,m=g==c?u:c,y=d+this._cellWidth-g;d=g-(f?0:this._cellWidth),h.scale=f?y/this._cellWidth:1-y/this._cellWidth,h.alpha=f?y/this._cellWidth:1-y/this._cellWidth,h.zIndex=9,h.scale<0&&(h.scale=0),h.alpha<0&&(h.alpha=0),l.scale=1-h.scale,l.alpha=1-h.alpha,l.visible=!0,l.x=m,l.y=h.y}h.x=d}}},i.prototype.shiftColumn=function(e,i,n){"undefined"==typeof n&&(n=!1);for(var o=this._gameboard.getColumn(e),r=0;r<o.length;r++){var s=o[r],a=this._gameboard.getPiece(s),h=this._scene.get("piece"+s),l=this._scene.get("piece"+s+"copy");if(h){var c=this._displayY,u=this._displayY+this._gameboard.numRows*this._cellHeight,p=this._displayY+(this._gameboard.numRows-a.row)*this._cellHeight,d=t.Gameboard.loopSum(p,i,u-1,c-1),f=d+this._cellWidth>c&&c>d,_=d+this._cellWidth>u&&u>d;if(h.scale=1,h.alpha=1,h.zIndex=10,l.scale=1,l.alpha=1,l.x=-this._cellWidth,l.y=-this._cellHeight,l.visible=!1,f||_){var g=f?c:u,m=g==c?u:c,y=d+this._cellHeight-g;d=g-(f?0:this._cellHeight),h.zIndex=9,h.scale=f?y/this._cellHeight:1-y/this._cellHeight,h.alpha=f?y/this._cellHeight:1-y/this._cellHeight,h.scale<0&&(h.scale=0),h.alpha<0&&(h.alpha=0),l.scale=1-h.scale,l.alpha=1-h.alpha,l.visible=!0,l.x=h.x,l.y=m}h.y=d}}},i.prototype.setInputRect=function(){this._inputRect||(this._inputRect=t.ScreenUtil.makeRect(this._scene,"inputRect"+this.name,"#FF0000",this._cellWidth*this._gameboard.numColumns,this._cellHeight*this._gameboard.numRows,{alpha:0,zIndex:100,x:this._displayX,y:this._displayY}),this._inputComponent=this._inputRect.create(Avota.InputComponent,this._scene.inputManager),this._inputComponent.inputDown.add(this.onDown,this),this._inputComponent.inputUp.add(this.onUp,this),this._inputComponent.inputOut.add(this.onOut,this),this._inputRect.addComponent(this._inputComponent,Avota.EngineConstants.INPUT))},i.prototype.updateInputs=function(){if(this._inputEnabled){var t=this._scene.inputManager;if(this._inputData.isDown){var e=this._inputData.current,i=this._inputData.start;e.setTo(t.inputX,t.inputY),!this._inputData.moveDir&&e.distanceTo(i)>this._moveThreshold&&(this._inputData.thresholdCrossed=!0,this._inputData.moveDir=Math.abs(e.x-i.x)>Math.abs(e.y-i.y)?"hor":"vert"),!t.isInputDown}}},i.prototype.onDown=function(t,e,i){this._inputEnabled&&(this._inputData.isDown||(this.disableHint(),this._inputData.isDown=!0,this._inputData.start=new Avota.Point(e,i),this._inputData.current=new Avota.Point(e,i),this._inputData.moveDir=null,this._inputData.thresholdCrossed=!1))},i.prototype.onOut=function(t,e,i,n){this._inputEnabled&&this._inputData.isDown&&this.onUp(t,e,i,n)},i.prototype.onUp=function(t,e,i){if(this._inputEnabled){this._inputData.isDown=!1;var n=(this._inputData.start,this._inputData.current);n.setTo(e,i),this._inputData.thresholdCrossed,this.enableHint(),this.confirmSelection()}},i.prototype.confirmSelection=function(){this._gameboard.executeSelection()},i.prototype.confirmShift=function(){var e=this._inputData.start,i=this._inputData.current,n=this.getRowAt(e.y),o=this.getColumnAt(e.x),r=this._displayY,s=this._displayY+this._gameboard.numRows*this._cellHeight,a=this._displayX,h=this._displayX+this._gameboard.numColumns*this._cellWidth,l=this.getRowAt(t.Gameboard.loopSum(e.y,i.y-e.y,s,r)),c=this.getColumnAt(t.Gameboard.loopSum(e.x,i.x-e.x,h,a)),u=l-n,p=c-o;"hor"==this._inputData.moveDir?this._gameboard.getMatchesFromMove("row",n,p).numPieces>0?(this.shiftRow(n,p*this._cellWidth),this._gameboard.shiftRow(n,p),this._gameboard.executeMatches()):this.shiftRow(n,0):"vert"==this._inputData.moveDir&&(this._gameboard.getMatchesFromMove("column",o,u).numPieces>0?(this.shiftColumn(o,-u*this._cellHeight),this._gameboard.shiftColumn(o,u),this._gameboard.executeMatches()):this.shiftColumn(o,0))},i}(Avota.GameEntity);t.BoardDisplay=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t,n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,r,s),this._worldX=0,this._focusOffset=20,this._spritesheets={},this._imagebank={},this._bgLayers=[],this._behaviors={},this._racerWorld=t,this._scene=n,this._spriteConfig=o,this._racerWorld.entitySignal.add(this.entityHandler,this),this._racerWorld.addCategory("display",function(t){return null!=t.display&&""!=t.display}),this.addBehavior("bonus",this.bonus),this.addBehavior("js_special",this.js_special),this.addBehavior("pilotedVehicle",this.pilotedVehicle),this.addBehavior("removeOnEnd",this.removeOnEnd)}return __extends(i,e),i.NAME="RaceDisplay",i.prototype.setupBG=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.setBGLayer(i.image,i.amount,i.spacing,i.scrollWidth,i.scrollSpeed,i.startX,i.startY,i.zIndex)}},i.prototype.setBGLayer=function(e,i,n,o,r,s,a,h){if("undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=0),"undefined"==typeof a&&(a=0),"undefined"==typeof h&&(h=10),!(Avota.EnvUtil.isMobile&&this._bgLayers.length>=4)){var l={};l.scrollSpeed=r,l.images=[],l.scrollWidth=o,l.spacing=n;for(var c=0;i>c;c++){var u="BGLayer"+e+c,p=t.ScreenUtil.makeImage(this._scene,u,e,{zIndex:h,x:s+c*(l.spacing||0),y:a});l.images.push(u),l.scrollWidth=l.scrollWidth?l.scrollWidth:p.width,l.spacing=l.spacing?l.spacing:p.width}this._bgLayers.push(l)}},i.prototype.entityHandler=function(e,i){switch(e){case t.EntitySignals.ADDED:var n=this._racerWorld.getEntity(i);
if(n.display&&""!=n.display){var o=this._spriteConfig.displayDefinitions[n.display];if(!o)return void console.error("No definition found for",n.display,"on entity",n.id);this.makeSprite(n.id,o,{x:"player"==n.id?this._focusOffset:n.x,y:n.y,zIndex:20-(n.lane||n.z)})}break;case t.EntitySignals.REMOVED:var r=this._scene.get(i);if(!r)return;r.destroy()}},i.prototype.update=function(){var e=this._racerWorld.getEntity("player"),i=this._racerWorld.track;e&&(this._worldX=t.Gameboard.loopSum(e.x-this._focusOffset,0,i.trackLength)),this._racerWorld.traverseEntities(this.updateGraphic,this,"display"),this.scrollBGLayers()},i.prototype.scrollBGLayers=function(){for(var e=this._bgLayers,i=this._racerWorld.getEntity("player"),n=0;n<e.length;n++)for(var o=e[n],r=0;r<o.images.length;r++){var s=this._scene.get(o.images[r]);s.x=t.Gameboard.loopSum(s.x,Math.round(-i.vx*o.scrollSpeed),this._scene.screenWidth,-o.scrollWidth)}},i.prototype.updateGraphic=function(e){var i=this._scene.get(e.id);if(i){var n=this._spriteConfig.displayDefinitions[e.display];this.isOnScreen(e)?(i.x=this.getScreenPosFor(e),i.y=e.y,i.visible=!0,i.active=!0):(i.visible=!1,i.active=!1),n.options&&(i.x+=n.options.offsetX||0,i.y+=n.options.offsetY||0),(e.state==t.EntityState.UNLOCKED||e.state==t.EntityState.COLLECTED||e.state==t.EntityState.DESTROYED||e.state==t.EntityState.INACTIVE)&&(i.visible=!1),e.hasCommand(t.EntityCommand.CRASH)&&(i.visible=this._racerWorld.frameCount%5==0),n.behavior&&this.executeBehavior(e,n.behavior)}},i.prototype.bonus=function(t){var e=this._scene.get(t.id);if(e){var i=this._spriteConfig.displayDefinitions[t.display],n=e;n.isAnimating||n.play(i.data[1])}},i.prototype.pilotedVehicle=function(e){var i=this._scene.get(e.id);if(i&&!this._scene.get(e.id+"driver")){var n="player"==e.id?t.PlayerData.getSelectedCharacter():"rival"==e.id?t.PlayerData.getRivalCharacter():t.PlayerData.getRivalCharacter(2),o=e.type,r=t.GameData.getData("vehicles")[o],s=t.GameData.getData("characters")[n],a=r.code+"_driver_"+s.code,h=t.SpriteConfig.getDisplayDefinition(a);if(!h)return;var l=this.makeSprite(e.id+"driver",h,{zIndex:i.zIndex-1});i.addChild(l)}},i.prototype.removeOnEnd=function(t){var e=this._scene.get(t.id),i=e;i.isAnimating||this._racerWorld.removeEntity(t.id)},i.prototype.js_special=function(e){var i=this._scene.get(e.id);if(i){var n=this._spriteConfig.displayDefinitions[e.display],o=i;o.isAnimating||o.play(n.data[1]);var r=e.getEndFrame("lifeSpan");o.currentAnimation.name!=n.data[2]&&r-this._racerWorld.frameCount<e.getDuration("lifeSpan")/3&&(o.play(n.data[2]),o.currentAnimation.duration=t.GameData.framesToSeconds(r-this._racerWorld.frameCount))}},i.prototype.addBehavior=function(t,e){this._behaviors[t]=e},i.prototype.executeBehavior=function(t,e){this._behaviors[e]&&this._behaviors[e].call(this,t)},i.prototype.makeSprite=function(e,i,n){var o;switch(i.type){case"image":if(Array.isArray(i.data)){o=t.ScreenUtil.makeGroup(this._scene,e,n);for(var r=0;r<i.data.length;r++){var s=i.data[r],a=t.SpriteConfig.getImageData(e),h=t.ScreenUtil.makeImage(this._scene,o.name+s,a?a.image:s,{zIndex:o.zIndex+r});o.addChild(h)}}else{var l=this.search("name",i.data,this._spriteConfig.images);o=t.ScreenUtil.makeImage(this._scene,e,l?l.image:i.data,n)}break;case"anim":var c=[],u=[];if(Array.isArray(i.data))for(var r=0;r<i.data.length;r++){var p=i.data[r],d=t.SpriteConfig.getAnimationData(p);if(d){var f=t.SpriteConfig.getSpriteSheetData(d.spritesheet);c.push(d);var _=t.SpriteConfig.makeSpriteSheet(this._scene,f.name);u.push(_)}else console.error("Cannot find anim data for ",p)}else{var d=t.SpriteConfig.getAnimationData(i.data);if(d){var f=t.SpriteConfig.getSpriteSheetData(d.spritesheet);c.push(d),u.push(t.SpriteConfig.makeSpriteSheet(this._scene,f.name))}else console.error("Cannot find anim data for ",i.data)}o=t.ScreenUtil.makeSprite(this._scene,e,u,c,n)}return i.options&&(o.x+=i.options.offsetX||0,o.y+=i.options.offsetY||0,o.scale=i.options.scale||1),o},i.prototype.isOnScreen=function(e){var i=this._racerWorld.track,n=this._scene.get(e.id);if(!n)return!1;var o=e.x,r=t.Gameboard.loopSum(o,n.width,i.trackLength),s=t.Gameboard.loopSum(this._worldX,this._scene.screenWidth,i.trackLength),a=i.getDistanceToPoint(this._worldX,i.trackLength),h=i.getDistanceToPoint(o,i.trackLength);return a<this._scene.screenWidth?h<n.width?!0:i.getDistanceToPoint(s,i.trackLength)<h||i.getDistanceToPoint(r,i.trackLength)<a:h<n.width?this._worldX<r||s>o:r>this._worldX&&o<this._worldX+this._scene.screenWidth},i.prototype.getScreenPosFor=function(e){var i=this._racerWorld.track,n=this._scene.get(e.id);if(n){var o=e.x,r=t.Gameboard.loopSum(o,n.width,i.trackLength),s=t.Gameboard.loopSum(this._worldX,this._scene.screenWidth,i.trackLength),a=i.getDistanceToPoint(this._worldX,i.trackLength),h=i.getDistanceToPoint(o,i.trackLength),l=-1e3;return l=a<this._scene.screenWidth?h<n.width?o-this._worldX:i.getDistanceToPoint(s,i.trackLength)<h?a+o:o-this._worldX:h<n.width?s>o?o-this._worldX:r-this._worldX-n.width:o-this._worldX}},i.prototype.search=function(t,e,i){for(var n=0;n<i.length;n++){var o=i[n];if(o[t]&&o[t]===e)return o}return null},i}(Avota.GameEntity);t.RaceDisplay=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){this.entities={},this.entityList=[],this.categoryLists={},this.categoryChecks={},this.entitySignal=new Avota.Signal,this.eventSignal=new Avota.Signal,this.entitySignal.add(this.onEntitySignal,this),this.entityCount=0,this.raceStarted=!1,this.scoreData=new t.ScoreData}return e.NAME="RacerWorld",e.DEFAULT_CAMERA="camera000",e.prototype.onEntitySignal=function(t,e){switch(t){case i.RELIST:this.listEntity(this.getEntity(e))}},e.prototype.addBuilder=function(t){this.builder=t},e.prototype.newTrack=function(e){this.track=new t.Track(e),this.builder&&this.builder.build(this)},e.prototype.addCategory=function(t,e,i){this.categoryLists[t]=[],this.categoryChecks[t]={check:e,context:i},this.traverseEntities(this.listEntity,this)},e.prototype.addEntity=function(t,e,n){n.trackLength=this.track.trackLength;var o=new t(e,n);return o.lane&&!n.x&&(o.x=this.track.getLaneCenterX(o.lane)),this.entities[e]=o,this.entityList.push(o.id),this.listEntity(o),this.updateSegment(o),this.entityCount++,o.entitySignal=this.entitySignal,this.entitySignal.dispatch(i.ADDED,o.id),o},e.prototype.addEffectEntity=function(e,i,n){var o={};o.display=i,o.target=e.id,o.x=e.x,o.y=e.y,o.z=e.z,o.behavior="decay",o.lifeSpan=60;for(var r in n)o[r]=n[r];var s=this.addEntity(t.TrackEntity,i+this.entityCount,o);return e.addChild(s.id),s},e.prototype.listEntity=function(t){for(var e in this.categoryLists){var i=this.categoryChecks[e];if(i.check.call(i.context,t)){for(var n=!0,o=0;o<this.categoryLists[e].length;o++)if(this.categoryLists[e][o]==t.id){n=!1;break}n&&this.categoryLists[e].push(t.id)}}},e.prototype.getEntitiesInCategory=function(t){for(var e=this.categoryLists[t]||[],i=e.length-1;i>=0&&e.length>0;i--){var n=this.getEntity(e[i]);n||e.splice(i,1)}return e},e.prototype.removeEntity=function(t){if(this.entities[t]){var e=this.getEntity(t),n=this.track.getSegment(e.segmentIndex);delete n.entities[e.id],delete this.entities[t],this.entitySignal.dispatch(i.REMOVED,t)}},e.prototype.getEntity=function(t){return this.entities[t]},e.prototype.updateSegment=function(t){null!=t.segmentIndex&&delete this.track.segmentData[t.segmentIndex].entities[t.id];var e=this.track.findSegment(t.z);e.entities[t.id]=!0,t.segmentIndex=e.index},e.prototype.traverseEntities=function(t,e,i){for(var n=this.categoryLists[i]||this.entityList,o=0;o<n.length;o++){var r=this.getEntity(n[o]);r?t.call(e,r):(n.splice(o,1),o--)}},e.prototype.getEntitiesForSegment=function(t){var e=this.track.segmentData[t];return e.entities},e.prototype.update=function(t){"undefined"==typeof t&&(t=0),this.uptime=(this.uptime||0)+t,this.frameCount=(this.frameCount||0)+1},e.prototype.end=function(){this._ended=!0},e.prototype.hasEnded=function(){return this._ended},e.prototype.destroy=function(){this.entities=null,this.categoryChecks=null,this.categoryLists=null,this.eventSignal.removeAll(),this.entitySignal.removeAll,this.entitySignal=null,this.eventSignal=null,this.track.destroy(),this.builder=null},e}();t.RacerWorld=e;var i=function(){function t(){}return t.ADDED="added",t.REMOVED="removed",t.RELIST="relist",t.GET_BONUS="getbonus",t.GET_ITEM="getitem",t.PROGRESS_PLACEMENT="progress_placement",t.DAMAGED="damaged",t.CRASHED="crashed",t.SHIELDED="shielded",t.COLLIDED="collided",t.ATTACK="attack",t.SHOT_FIRED="shotFired",t.SHOT_HIT="shotHit",t.DESTROYED="destroyed",t.BOOST="boost",t.SLOWED="slowed",t}();t.EntitySignals=i;var n=function(){function t(){}return t.RACE_BEGIN="race_begin",t.RACE_END="race_end",t.LAP_COMPLETED="lapCompleted",t.ENEMY_APPROACH="enemyApproach",t}();t.EventSignals=n}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function t(t){this.segmentData=[],this.name=t.name||"NAME NOT SPECIFIED",this.laps=t.laps||2,this.lanes=t.lanes||3,this.roadWidth=t.roadWidth||2e3,this.segmentLength=t.segmentLength||5,this.rumbleLength=t.rumbleLength||3,this.mapImage=t.mapImage||"HUDMap1",this.colors=t.colors||{LIGHT:{road:"#6b6b6b",rumble:"#10AA10",offroad:"#10AA10",lane:"#FFFFFF"},DARK:{road:"#696969",rumble:"#009A00",offroad:"#009A00"}},this.roadSettings=t.roadSettings||{length:{none:0,"short":25,medium:50,"long":100},curve:{none:0,easy:2,medium:4,hard:6},elevation:{none:0,low:20,medium:40,high:60}},this.roadData=t.roadData,this.elementDefinitions=this.parseElementDefinitions(t.elementDefinitions),this.elementPositions=this.parseElementPositioning(t.elementPositioning),this.bgDefinitions=this.parseElementDefinitions(t.bgDefinitions),this.bgPositions=this.parseElementPositioning(t.bgPositioning),this.parseMapData(t.mapNodeList||[]),this.build()}return t.NAME="Track",Object.defineProperty(t.prototype,"trackLength",{get:function(){return this.segmentData.length*this.segmentLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"laneWidth",{get:function(){return this.roadWidth/this.lanes},enumerable:!0,configurable:!0}),t.prototype.easeIn=function(t,e,i){return t+(e-t)*Math.pow(i,2)},t.prototype.easeOut=function(t,e,i){return t+(e-t)*(1-Math.pow(1-i,2))},t.prototype.easeInOut=function(t,e,i){return t+(e-t)*(-Math.cos(i*Math.PI)/2+.5)},t.prototype.toInt=function(t,e){if(null!==t){var i=parseInt(t,10);if(!isNaN(i))return i}return this.toInt(e,0)},Object.defineProperty(t.prototype,"lastY",{get:function(){return 0==this.segmentData.length?0:this.segmentData[this.segmentData.length-1].p2.world.y},enumerable:!0,configurable:!0}),t.prototype.parseMapData=function(t){this.mapData={};for(var e=[],i=0,n=0;n<t.length;n++){var o={},r=t[n];o.point=new Avota.Point(r.x,r.y),0!=n?(o.distToPrev=Avota.Point.distanceBetween(o.point,e[n-1].point),i+=o.distToPrev,o.dist=i):(o.distToPrev=0,o.dist=0),e.push(o)}this.mapData.nodes=e,this.mapData.totalDist=i},t.prototype.parseElementDefinitions=function(t){var e={};if(t){for(var n in t){var o=t[n];e[n]=[];for(var r=0;r<o.length;r++)e[n].push(new i(o[r]))}return e}},t.prototype.parseElementPositioning=function(t){var e=[];if(t){for(var i=0;i<t.length;i++)e.push(new n(t[i]));return e}},t.prototype.getLaneCenterX=function(t){return-this.roadWidth+t*this.laneWidth*2-this.laneWidth},t.prototype.getShortestDistanceBetween=function(t,e){var i=t>e?t:e,n=e>t?t:e,o=i-n,r=this.trackLength-i+n;return r>o?o:r},t.prototype.getLongestDistanceBetween=function(t,e){var i=t>e?t:e,n=e>t?t:e,o=i-n,r=this.trackLength-i+n;return o>r?o:r},t.prototype.getDistanceToPoint=function(t,e){return t>e?e+this.trackLength-t:e-t},t.prototype.getDistanceToEnd=function(t,e,i){var n=this.getTotalDistance(),o=this.getDistanceTraveled(t,e,i);return n-o},t.prototype.getDistanceTraveled=function(t,e,i){var n=e>t?this.trackLength+t:t,o=Math.abs(e-n)+this.trackLength*i;return o},t.prototype.getTotalDistance=function(){return this.trackLength*this.laps},t.prototype.copySegmentData=function(){return this.segmentData.concat()},t.prototype.addSegment=function(t,e){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0);var i=this.segmentData.length;this.segmentData.push({index:i,p1:{world:{y:this.lastY,z:i*this.segmentLength},camera:{},screen:{}},p2:{world:{y:e||0,z:(i+1)*this.segmentLength},camera:{},screen:{}},curve:t||0,color:Math.floor(i/this.rumbleLength)%2?this.colors.DARK:this.colors.LIGHT,entities:{}})},t.prototype.findSegment=function(t){return 0>t&&(t=this.trackLength+t),this.segmentData[Math.floor(t/this.segmentLength)%this.segmentData.length]},t.prototype.getSegment=function(t){return t>=this.segmentData.length&&(t-=this.segmentData.length),0>t&&(t=this.segmentData.length+t),this.segmentData[t]},t.prototype.getSegmentHeight=function(t){return this.getSegment(t).p1.world.y},t.prototype.build=function(){for(var t=0;t<this.roadData.length;t++){var e=this.roadData[t];this.addRoad(this.roadSettings.length[e.length],this.roadSettings.length[e.length],this.roadSettings.length[e.length],this.roadSettings.curve[e.curve]*("left"==e.dirX?-1:1)||0,this.roadSettings.elevation[e.elevation]*("up"==e.dirY?1:-1)||0)}},t.prototype.addRoad=function(t,e,i,n,o){var r,s=this.lastY,a=s+this.toInt(o,0)*this.segmentLength,h=t+e+i;for(r=0;t>r;r++)this.addSegment(this.easeIn(0,n,r/t),this.easeInOut(s,a,r/h));for(r=0;e>r;r++)this.addSegment(n,this.easeInOut(s,a,(t+r)/h));for(r=0;i>r;r++)this.addSegment(this.easeInOut(n,0,r/i),this.easeInOut(s,a,(t+e+r)/h))},t.prototype.destroy=function(){this.segmentData=null,this.name=null,this.laps=null,this.lanes=null,this.roadWidth=null,this.segmentLength=null,this.rumbleLength=null,this.colors=null,this.roadSettings=null,this.roadData=null,this.elementDefinitions=null,this.elementPositions=null,this.bgDefinitions=null,this.bgPositions=null},t}();t.Track=e;var i=function(){function t(t){this.id=t.id,this.type=t.type,this.lane=t.lane,this.amount=t.amount||1,this.display=t.display,this.distance=t.distance||1,this.spacing=t.spacing||0,this["class"]=t["class"],this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.scale=t.scale||1}return t.RACER="racer",t.ALLY="ally",t.STRUCTURE="structure",t.GEARBIT="gearbit",t.POWERPOD="powerpod",t.MYSTERY_BOX="mysterybox",t.BOOST_PAD="boostpad",t.ICE_FLOOR="icefloor",t.ROUGH_FLOOR="roughfloor",t.RACE_MARKER="racemarker",t.ENEMY="enemy",t.PROJECTILE="projectile",t.EXPLOSION="explosion",t.BG_ELEMENT="bgElement",t}();t.TrackElementDefinition=i;var n=function(){function t(t){this.definitionName=t.definition,this.padding=t.padding||0}return t}();t.TrackElementPositioning=n}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(t,i,n){"undefined"==typeof n&&(n=e.NAME),this.overlapX=0,this.overlapY=0,this.overlapZ=0,this.name=n,this.id=t,this.setup(i)}return e.NAME="TrackEntity",e.INPUT_LEFT=0,e.INPUT_RIGHT=1,e.INPUT_UP=2,e.INPUT_DOWN=3,e.INPUT_FIRE=4,e.INPUT_FIRE2=5,Object.defineProperty(e.prototype,"maxHP",{get:function(){return this._maxHP},set:function(t){this._maxHP=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t,this._hp=this.constrain(this._hp,0,this._maxHP)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEnergy",{get:function(){return this._maxEnergy},set:function(t){this._maxEnergy=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return this._energy},set:function(t){this._energy=t,this._energy=this.constrain(this._energy,0,this._maxEnergy)},enumerable:!0,configurable:!0}),e.prototype.setup=function(t){this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.travelDistance=this.z>0?this.z:0,this.behavior=t.behavior,this.physics=t.physics,this.vx=0,this.vy=0,this.vz=0,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.offsetZ=t.offsetZ||0,this.turnSpeed=t.turnSpeed||10,this.maxSpeed=t.maxSpeed||17,this.cruiseSpeed=t.cruiseSpeed||.95*this.maxSpeed,this.boostSpeed=t.boostSpeed||1.5*this.maxSpeed,this.boostAccel=t.boostAccel||this.boostSpeed/50,this.boostDuration=t.boostDuration||60,this.accel=t.accel||this.maxSpeed/100,this.breaking=t.breaking||-(this.maxSpeed/50),this.decel=t.decel||-(this.maxSpeed/200),this.trackLength=t.trackLength,this["class"]=t["class"],this.owner=t.owner,this.target=t.target,this._maxHP=t.maxHP||1e3,this._hp=this._maxHP,this._maxEnergy=t.maxEnergy||1e3,this._energy=this._maxEnergy,this.weight=t.weight||100,this.place=0,this.maxEnginePower=4,this.enginePower=this.maxEnginePower,this.engineDecay=this.maxEnginePower/100,this.engineRecovery=this.engineDecay,this.primaryAttack=t.primaryAttack||"SFShoot",this.secondaryAttack=t.secondaryAttack||"SFCharge",this.display=t.display||"",this.lockToTrack=!0,this.distanceModifier=1,this.slowModifier=1,this.bonusList=[],this.durationList=t.durationList||{boost:t.boostDuration||60,lifeSpan:t.lifeSpan||0,primaryWeaponDelay:t.primaryWeaponDelay||8,crash:t.crashDuration||180,skid:t.skidDuration||100,rough:t.rough||5,invincible:25},this.endFrameList={},this.speedList=t.speedList||{neutral:this.maxSpeed,boost:t.boostSpeed||1.5*this.maxSpeed,skid:t.skidSpeed||350,stun:t.stun||120},this.friction=t.friction||0,this.children=[],this.hitboxHeight=t.hitboxHeight||200,this.hitboxWidth=t.hitboxWidth||200,this.lapsCompleted=-1,this.lane=t.lane||0,this.type=t.type,this.inputMap=[!1,!1,!1,!1,!1],this.commands={},this.state=i.NEUTRAL,this.startParams=t,this.removeAllCommands()},e.prototype.refresh=function(){this.setup(this.startParams)},e.prototype.accelerate=function(){this.vx<this.maxSpeed*this.distanceModifier*this.slowModifier&&(this.vx+=this.accel*this.distanceModifier*this.enginePower*this.slowModifier),this.enginePower-=this.engineDecay,this.enginePower<1&&(this.enginePower=1)},e.prototype.boost=function(t,e){this.vx<e*this.slowModifier&&(this.vx+=t*this.slowModifier)},e.prototype.recoverEngine=function(){this.enginePower+=this.engineRecovery,this.enginePower>this.maxEnginePower&&(this.enginePower=this.maxEnginePower)},e.prototype.cutSpeed=function(t){"undefined"==typeof t&&(t=20),this.vx-=t,this.vx<0&&(this.vx=0)},e.prototype.shove=function(t){"undefined"==typeof t&&(t=100),this.vx=t},e.prototype.ramOffTrack=function(e,n,o){"undefined"==typeof e&&(e=100),"undefined"==typeof n&&(n=300),"undefined"==typeof o&&(o=0),this.state=i.DESTROYED,this.behavior="decay",this.vy=n,this.vz=e,this.vx=o,this.lockToTrack=!1,this.entitySignal.dispatch(t.EntitySignals.RELIST,this.id)},e.prototype.getSpeedCategory=function(t){return this.speedList[t]},e.prototype.setEndFrame=function(e,i,n){this.endFrameList[e]=i+(null!=n?n:this.durationList[e]||0)/t.GameData.FRAME_BUFFER},e.prototype.getEndFrame=function(t){return this.endFrameList[t]},e.prototype.getDuration=function(t){return this.durationList[t]},e.prototype.hasEndFrame=function(t){return 0!=this.endFrameList[t]&&null!=this.endFrameList[t]},e.prototype.clearEndFrame=function(t){this.endFrameList[t]=null,delete this.endFrameList[t]},e.prototype.pastEndFrame=function(t,e){return!this.endFrameList[t]||this.endFrameList[t]<e},e.prototype.travel=function(t,e){this.z=this.loopSum(this.z,t,e),this.travelDistance+=t,this.travelDistance<0&&(this.travelDistance=0)},e.prototype.loopSum=function(t,e,i){for(var n=t+e;n>=i;)n-=i;for(;0>n;)n+=i;return n},e.prototype.constrain=function(t,e,i){var n=t;return e>t&&(n=e),t>i&&(n=i),n},e.prototype.addCommand=function(t){this.hasCommand(t)||(this.commands[t]=new n(t))},e.prototype.removeCommand=function(t){delete this.commands[t]},e.prototype.removeAllCommands=function(){for(var t in this.commands)delete this.commands[t]},e.prototype.hasCommand=function(t){return null!=this.commands[t]},e.prototype.takeDamage=function(e){this.hp-=e,this.entitySignal.dispatch(t.EntitySignals.DAMAGED,this.id,{amount:e})},e.prototype.gainHP=function(t){this.hp+=t},e.prototype.getHPScale=function(){return this.hp/this.maxHP},e.prototype.refillHP=function(){this.hp=this._maxHP},e.prototype.canPerformAttack=function(t){return this._energy>=t},e.prototype.useEnergy=function(t){this.energy-=t},e.prototype.gainEnergy=function(t){this.energy+=t},e.prototype.getEnergyScale=function(){return this._energy/this._maxEnergy},e.prototype.addChild=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i==t)return}this.children.push(t)},e.prototype.removeChild=function(t){for(var e=this.children.length-1;e>=0&&this.children.length>0;e--){var i=this.children[e];if(i==t){this.children.splice(e,1);break}}},e}();t.TrackEntity=e;var i=function(){function t(){}return t.NEUTRAL="neutral",t.CRASH="crash",t.SKID="skid",t.COLLECTED="collected",t.DESTROYED="destroyed",t.UNLOCKED="unlocked",t.UNLOCKABLE="unlockable",t.APPROACHING="approaching",t.INACTIVE="inactive",t.ACTIVE="active",t}();t.EntityState=i;var n=function(){function t(t){this.type=t}return t.ACCELERATE="accelerate",t.DECELERATE="decelerate",t.BREAK="break",t.UNLOCK="unlock",t.LINEAR_ADVANCE="linearAdvance",t.SKID="skid",t.STUN="stun",t.CRASH="crash",t.ROUGH_TERRAIN="rough",t.INVINCIBLE="invincible",t.SLOW="slow",t.MOVE_LEFT="move_left",t.MOVE_RIGHT="move_right",t.FIRE_PRIMARY="fire_primary",t.FIRE_SECONDARY="fire_secondary",t.BONUS_ELIXIR="elixir",t.BONUS_HOURGLASS="hourglass",t.BONUS_JUKEBOX="jukebox",t.BONUS_SHIELD="shield",t.BONUS_SHOE="shoe",t.BONUS_KEY="key",t.PAD_BOOST="padboost",t.BOOST_ATTACK="boostattack",t}();t.EntityCommand=n}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function t(){this.buildHandlers={}}return t.NAME="TrackBuilder",t.prototype.addBuildHandler=function(t,e){this.buildHandlers[t]=e},t.prototype.build=function(t){this.placeElements(t,t.track.elementDefinitions,t.track.elementPositions),this.placeElements(t,t.track.bgDefinitions,t.track.bgPositions)},t.prototype.placeElements=function(t,e,i){for(var n=0,o=(t.track.segmentData.length,t.track),r=0;r<i.length;r++){var s=i[r],a=e[s.definitionName];if(a){var h=0;n+=s.padding||0;for(var l=0;l<a.length;l++){var c=a[l],u=n+c.distance*o.rumbleLength;this.buildHandlers[c.type]&&this.buildHandlers[c.type].call(this,t,c,u);var p=c.distance*o.rumbleLength+c.amount*c.spacing*o.rumbleLength;h=!h||p>h?p:h}if(n+=h,n>=o.segmentData.length)break}else console.error("[TrackBuilder] Cannot find definition for",s.definitionName)}},t}();t.TrackBuilder=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(){e.call(this),this.addBuildHandler(t.TrackElementDefinition.RACER,this.buildRacer),this.addBuildHandler(t.TrackElementDefinition.STRUCTURE,this.buildStructure),this.addBuildHandler(t.TrackElementDefinition.GEARBIT,this.buildGearbit),this.addBuildHandler(t.TrackElementDefinition.POWERPOD,this.buildPowerpod),this.addBuildHandler(t.TrackElementDefinition.BOOST_PAD,this.buildBoostPad),this.addBuildHandler(t.TrackElementDefinition.ICE_FLOOR,this.buildIceFloor),this.addBuildHandler(t.TrackElementDefinition.ROUGH_FLOOR,this.buildRoughFloor),this.addBuildHandler(t.TrackElementDefinition.RACE_MARKER,this.buildRacemarker),this.addBuildHandler(t.TrackElementDefinition.ENEMY,this.buildEnemy),this.addBuildHandler(t.TrackElementDefinition.MYSTERY_BOX,this.buildMysteryBox),this.addBuildHandler(t.TrackElementDefinition.BG_ELEMENT,this.buildBGElement),this.addBuildHandler(t.TrackElementDefinition.ALLY,this.buildAlly)}return __extends(i,e),i.NAME="SCTrackBuilder",i.prototype.buildBGElement=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a={};a.type=i.type,a["class"]=i["class"],a.display=i.display,a.x=s,a.z=i.z,a.y=e.track.getSegmentHeight(r)+i.y;{e.addEntity(t.TrackEntity,i.type+e.entityCount,a)}}},i.prototype.buildMysteryBox=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a={};a.type=i.type,a["class"]=t.TrackElementDefinition.MYSTERY_BOX,a.display="mysterybox",a.x=i.x,a.z=s,a.y=e.track.getSegmentHeight(r),a.behavior="respawnItem",a.lane=i.lane;{e.addEntity(t.TrackEntity,i.type+e.entityCount,a)}}},i.prototype.buildPowerpod=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a={};a.type=i.type,a["class"]=t.TrackElementDefinition.POWERPOD,a.display="powerpod",a.x=i.x,a.z=s,a.y=e.track.getSegmentHeight(r),a.lane=i.lane;{e.addEntity(t.TrackEntity,i.type+e.entityCount,a)}}},i.prototype.buildRacer=function(e,i,n){var o,r,s=n*e.track.segmentLength,a={};switch(i.id){case"player":o=t.PlayerData.getSelectedVehicle(),r=t.GameData.getDisplayIDForVehicleCombo(t.PlayerData.getSelectedVehicle(),t.PlayerData.getActiveUpgrades());break;case"rival":o=t.PlayerData.getRivalVehicle(),r=t.GameData.getDisplayIDForVehicleCombo(o,t.GameData.getOpponentData("rival").upgrades);break;default:o=t.PlayerData.getRivalVehicle(2),r=t.GameData.getDisplayIDForVehicleCombo(o,t.GameData.getOpponentData("rival").upgrades)}var h=t.GameData.getVehicleData(o);r||(r=h.display);for(var l in h)a[l]=h[l];if("player"==i.id||"rival"==i.id){"player"==i.id?t.PlayerData.getActiveUpgrades():t.GameData.getOpponentData("rival").upgrades}a.display=r,a.type=o,a["class"]=t.TrackElementDefinition.RACER,a.behavior="player"==i.id?"control":"cpu",a.lane=i.lane,a.x=s,a.y=2.5*(e.track.lanes-i.lane),a.physics=t.RacerPhysics.GENERIC_OBJECT,a.maxSpeed="player"==i.id?h.maxSpeed:h.maxSpeed/2,a.cruiseSpeed="player"==i.id?.68*a.maxSpeed:.83*h.maxSpeed;var c=e.addEntity(t.TrackEntity,i.id,a);"player"==c.id,t.PlayerData.hasSuperChargedCombo()&&("player"==c.id||"rival"==c.id)},i.prototype.buildStructure=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a={},h=t.GameData.getData("structures")[i["class"]||t.GameData.getDataList("structures")[0]];a.type=i["class"]||t.GameData.getDataList("structures")[0],a["class"]=t.TrackElementDefinition.STRUCTURE,a.display=i.display||h.defaultDisplay,a.z=s,a.y=e.track.getSegmentHeight(r),a.lane=i.lane;{e.addEntity(t.TrackEntity,i.type+e.entityCount,a)}}},i.prototype.buildGearbit=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a=t.GameData.getData("items")[i["class"]||"gearbit"];e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,{display:a.display,lane:i.lane,x:s,"class":"gearbit",type:i["class"]||"gearbit",y:50,z:0,behavior:"gearbit"})}},i.prototype.buildAlly=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a=t.GameData.getData("allies")[i["class"]],h={};h.type=i["class"],h.lane=i.lane,h.display=a.display||i.display||"ally",h.physics=t.RacerPhysics.GENERIC_OBJECT,h.x=s,h.y=0,h["class"]=t.TrackElementDefinition.ALLY,h.behavior="ally",e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,h)}},i.prototype.buildEnemy=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength,a=t.GameData.getData("vehicles"),h=a[i["class"]],l={};for(var c in h)l[c]=h[c];l.type=i["class"],l.lane=i.lane,l.x=s,l.y=0,l["class"]=t.TrackElementDefinition.ENEMY,l.behavior=h.behavior||"hostile",l.physics=t.RacerPhysics.GENERIC_OBJECT,e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,l)}},i.prototype.buildBoostPad=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength;e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,{display:"boostpad",lane:i.lane,z:s,"class":"boostpad",y:e.track.getSegmentHeight(r)})}},i.prototype.buildIceFloor=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength;e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,{display:"icefloor",lane:i.lane,z:s,"class":"icefloor",y:e.track.getSegmentHeight(r)})}},i.prototype.buildRoughFloor=function(e,i,n){for(var o=0;o<i.amount;o++){var r=n+o*i.spacing*e.track.rumbleLength,s=r*e.track.segmentLength;e.addEntity(t.TrackEntity,i.id||i.type+e.entityCount,{display:"roughfloor",lane:i.lane,z:s,"class":"roughfloor",y:e.track.getSegmentHeight(r)})}},i.prototype.buildRacemarker=function(e,i,n){var o=n,r=o*e.track.segmentLength,s={};s.x=r,s["class"]="racemarker",s.display="racemarker",e.addEntity(t.TrackEntity,"racemarker",s)},i}(t.TrackBuilder);t.SCTrackBuilder=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(i,n){this._racerWorld=i,this._collisionList={},this._updateList={},this._collisionHandlers={},this._racerList=[],this._positionTracker={},this._collidableObjects=n,this._collidableObjects||(this._collidableObjects={},this._collidableObjects[e.GENERIC_OBJECT]=!0,this._collidableObjects[e.RIGID_OBJECT]=!0,this._collidableObjects[e.PHASABLE_OBJECT]=!0,this._collidableObjects[e.TEXTURE_OBJECT]=!0,this._collidableObjects[e.DESTRUCTABLE_OBJECT]=!0),this._objectsOfInterest=n,this._objectsOfInterest||(this._objectsOfInterest={},this._objectsOfInterest[e.GENERIC_OBJECT]=!0,this._objectsOfInterest[e.PHASABLE_OBJECT]=!0,this._objectsOfInterest[e.DESTRUCTABLE_OBJECT]=!0),i.addCategory("racemarker",function(t){return t.id.match("racemarker")}),i.addCategory("racers",function(e){return e["class"]==t.TrackElementDefinition.RACER}),i.addCategory("objectsOfInterest",function(t){return 1==this._objectsOfInterest[t.physics]}.bind(this)),this.addCollisionHandler(this.genericVgeneric,e.GENERIC_OBJECT,e.GENERIC_OBJECT)}return e.NAME="RacerPhysics",e.GENERIC_OBJECT="generic",e.RIGID_OBJECT="rigid",e.PHASABLE_OBJECT="phasable",e.COLLECTABLE_OBJECT="collectable",e.TEXTURE_OBJECT="texture",e.DESTRUCTABLE_OBJECT="destructable",e.prototype.addCollisionHandler=function(t,e,i){this._collisionHandlers[e+","+i]=t},e.prototype.shouldUpdate=function(i){return!this._updateList[i.id]&&i.physics!=e.RIGID_OBJECT&&(i.x!=i.x+(i["class"]==t.TrackElementDefinition.RACER&&i.vx>0?i.vx:i.cruiseSpeed)||i.y!=i.y+i.vy||i.z!=i.z+i.vz)},e.prototype.update=function(){this._racerWorld.traverseEntities(this.physics,this,"objectsOfInterest"),this.handleCollisions(),this.applyVectors(),this.updatePlacement()},e.prototype.physics=function(t){this._collidableObjects[t.physics]&&this.detectCollisions(t)},e.prototype.detectCollisions=function(t){this._positionTracker[t.id];this.shouldUpdate(t)&&(this._updateList[t.id]=!0)},e.prototype.handleCollisions=function(){for(var t in this._collisionList){var e=t.split(","),i=this._racerWorld.getEntity(e[0]),n=this._racerWorld.getEntity(e[1]);if(i&&n){for(var o in this._collisionHandlers){var r=o.split(",");if(r[0].match(i.physics)&&r[1].match(n.physics)||r[0].match(n.physics)&&r[1].match(i.physics)){this._collisionHandlers[o].call(this,i,n);break}}this.shouldUpdate(i)&&(this._updateList[i.id]=!0),this.shouldUpdate(n)&&(this._updateList[n.id]=!0)}delete this._collisionList[t]}},e.prototype.refreshTrack=function(){for(var e=(this._racerWorld.getEntitiesInCategory("enemies"),this._racerWorld.getEntitiesInCategory("allies")),i=0;i<e.length;i++){var n=this._racerWorld.getEntity(e[i]);n&&n.state!=t.EntityState.UNLOCKED&&n.refresh()}},e.prototype.applyVectors=function(){var i=this._racerWorld.track,n=this._racerWorld.getEntity(this._racerWorld.getEntitiesInCategory("racemarker")[0]);for(var o in this._updateList){var r=this._racerWorld.getEntity(o);if(r){var s=r.z>0?r.z:i.trackLength-r.z,a=i.findSegment(r.z),h=e.percentRemaining(s,i.segmentLength);this._positionTracker[r.id]||(this._positionTracker[r.id]={x:r.x,y:r.y,z:r.z,vx:r.vx,vy:r.vy,vz:r.vz});var l=this._positionTracker[r.id];l.x=r.x,l.y=r.y,l.z=r.z,l.vx=r.vx,l.vy=r.vy,l.vz=r.vz,0!=r.vx&&(r.vx>0?(r.vx-=r.friction,r.vx<0&&(r.vx=0)):(r.vx+=r.friction,r.vx>0&&(r.vx=0))),r["class"]==t.TrackElementDefinition.RACER&&r.vx<r.cruiseSpeed&&!r.hasCommand(t.EntityCommand.SLOW)&&!r.hasCommand(t.EntityCommand.CRASH)&&this._racerWorld.raceStarted&&(r.vx=r.cruiseSpeed),r.x=r.loopSum(r.x,r.vx*t.GameData.FRAME_BUFFER,i.trackLength),r.x=r.loopSum(r.x,r.overlapX,i.trackLength);var c=e.interpolate(a.p1.world.y,a.p2.world.y,h);r.lockToTrack?(r.y+=r.vy*t.GameData.FRAME_BUFFER,r.y+=r.overlapY):(r.vy-=9.81,r.y+=r.vy*t.GameData.FRAME_BUFFER,r.y+=r.overlapY,r.y<c&&(r.y=c,r.vy*=-.86)),r.overlapX=0,r.overlapY=0,r.overlapZ=0,this._racerWorld.updateSegment(r);
var u=i.getDistanceToPoint(r.x,n.x),p=i.getDistanceToPoint(l.x,n.x),d=i.getDistanceToPoint(n.x,l.vx>0?r.x:l.x),f=i.getShortestDistanceBetween(l.x,r.x);if(f>d&&(u>p?(r.lapsCompleted++,"player"==r.id&&r.lapsCompleted>0&&(this.refreshTrack(),this._racerWorld.eventSignal.dispatch(t.EventSignals.LAP_COMPLETED))):p>u&&(r.lapsCompleted--,"player"==r.id)),r.lapsCompleted>=i.laps&&!r.hasEndFrame("raceEnd")&&r.setEndFrame("raceEnd",this._racerWorld.frameCount,0),r.hasCommand(t.EntityCommand.ACCELERATE)||r.recoverEngine(),this._racerWorld.raceEndFrame&&!r.hasEndFrame("raceEnd")){var _=i.getDistanceToEnd(r.x,n.x,r.lapsCompleted),g=_/(r.vx*t.GameData.FRAME_BUFFER||100);r.setEndFrame("raceEnd",this._racerWorld.frameCount,g)}for(var m=r.children.length-1;m>=0&&r.children.length>0;m--){var y=r.children[m],v=this._racerWorld.getEntity(y);v?(v.x=r.x+v.offsetX,v.y=r.y+v.offsetY,v.z=r.z+v.offsetZ,this._racerWorld.updateSegment(v)):r.children.splice(m,1)}}delete this._updateList[o]}},e.prototype.updatePlacement=function(){if(!this._racerWorld.raceEndFrame){var e=this._racerWorld.getEntitiesInCategory("racers");this._racerList.length=0;for(var i=0;i<e.length;i++){var n=this._racerWorld.getEntity(e[i]);this._racerList.push(n)}this._racerList.sort(this.sortRacersByPlace.bind(this));for(var i=0;i<this._racerList.length;i++){var n=this._racerList[i];i+1<n.place&&n.entitySignal.dispatch(t.EntitySignals.PROGRESS_PLACEMENT,n.id),n.place=i+1}}},e.prototype.sortRacersByPlace=function(t,e){var i=this._racerWorld,n=i.getEntity(i.getEntitiesInCategory("racemarker")[0]),o=i.track.getDistanceToEnd(t.x,n.x,t.lapsCompleted),r=i.track.getDistanceToEnd(e.x,n.x,e.lapsCompleted);return o>r?1:r>o?-1:0},e.prototype.genericVgeneric=function(e,i){if(!e.hasCommand(t.EntityCommand.INVINCIBLE)&&!i.hasCommand(t.EntityCommand.INVINCIBLE)){e.vz>=i.vz?e:i}},e.prototype.genericVdestructable=function(t,i){t.physics==e.DESTRUCTABLE_OBJECT?t:i,t.physics==e.GENERIC_OBJECT?t:i},e.prototype.genericVrigid=function(){},e.prototype.genericVphasable=function(i,n){var o=i.physics==e.PHASABLE_OBJECT?i:n,r=o!=i?i:n;switch(o["class"]){case t.TrackElementDefinition.ENEMY:if(o.state==t.EntityState.DESTROYED||r.hasCommand(t.EntityCommand.CRASH)||r.hasCommand(t.EntityCommand.INVINCIBLE)||r.hasCommand(t.EntityCommand.BONUS_SHIELD))r.hasCommand(t.EntityCommand.BONUS_SHIELD)&&r.entitySignal.dispatch(t.EntitySignals.SHIELDED,r.id);else if(r.hasCommand(t.EntityCommand.BOOST_ATTACK)){var s=t.GameData.getAttackData(r.primaryAttack),a=t.GameData.getAttackData(r.secondaryAttack),h="boost"==s.type?s:a;this._racerWorld.addEffectEntity(o,h.hitDisplay),o.ramOffTrack(100,200,50),o.setEndFrame("lifeSpan",this._racerWorld.frameCount,120)}else{var l=t.GameData.getData("enemies")[o.type];r.cutSpeed(),r.takeDamage(l.damage),"player"==r.id&&this._racerWorld.scoreData.logScore(t.ScoreDefinition.DAMAGE_PENALTY)}break;case t.TrackElementDefinition.PROJECTILE:if(o.owner!=r.id){if(!(r.hasCommand(t.EntityCommand.MOVE_LEFT)||r.hasCommand(t.EntityCommand.MOVE_RIGHT)||r.hasCommand(t.EntityCommand.CRASH)||r.hasCommand(t.EntityCommand.INVINCIBLE))){var c=(this._racerWorld.getEntity(o.owner),t.GameData.getAttackData(o.type));if(r.hasCommand(t.EntityCommand.BONUS_SHIELD)||r.hasCommand(t.EntityCommand.BONUS_JUKEBOX)?r.hasCommand(t.EntityCommand.BONUS_SHIELD)&&r.entitySignal.dispatch(t.EntitySignals.SHIELDED,r.id):(r.vz+=.02*o.vz,r.cutSpeed(),r.takeDamage(c.baseDamage),"player"==o.owner&&this._racerWorld.scoreData.logScore(t.ScoreDefinition.HIT_OPPONENT),"player"==r.id&&this._racerWorld.scoreData.logScore(t.ScoreDefinition.DAMAGE_PENALTY)),this._racerWorld.addEffectEntity(r,t.GameData.getAttackData(o.type).hitDisplay),c.explosive){this._racerWorld.addEntity(t.TrackEntity,c.hitDisplay+this._racerWorld.entityCount,{display:c.hitDisplay,behavior:"decay",lifeSpan:c.explosionLifespan,x:r.x,y:r.y,z:r.z,physics:e.PHASABLE_OBJECT,hitboxHeight:3*this._racerWorld.track.segmentLength,"class":t.TrackElementDefinition.EXPLOSION,owner:o.owner,type:o.type,friction:c.friction||0})}}this._racerWorld.removeEntity(o.id)}break;case t.TrackElementDefinition.EXPLOSION:if(o.owner!=r.id)if(r.hasCommand(t.EntityCommand.MOVE_LEFT)||r.hasCommand(t.EntityCommand.MOVE_RIGHT)||r.hasCommand(t.EntityCommand.CRASH)||r.hasCommand(t.EntityCommand.INVINCIBLE)||r.hasCommand(t.EntityCommand.BONUS_SHIELD)||r.hasCommand(t.EntityCommand.BONUS_JUKEBOX))r.hasCommand(t.EntityCommand.BONUS_SHIELD)&&r.entitySignal.dispatch(t.EntitySignals.SHIELDED,r.id);else{var c=(this._racerWorld.getEntity(o.owner),t.GameData.getAttackData(o.type));r.vz+=.3*o.vz,r.cutSpeed(),r.takeDamage(c.baseDamage),this._racerWorld.addEffectEntity(r,t.GameData.getAttackData(o.type).hitDisplay),"player"==o.owner&&this._racerWorld.scoreData.logScore(t.ScoreDefinition.HIT_OPPONENT),"player"==r.id&&this._racerWorld.scoreData.logScore(t.ScoreDefinition.DAMAGE_PENALTY)}}},e.prototype.genericVcollectable=function(i,n){var o=i.physics==e.COLLECTABLE_OBJECT?i:n,r=o!=i?i:n;switch(o["class"]){case t.TrackElementDefinition.GEARBIT:if("player"==r.id&&o.state!=t.EntityState.COLLECTED){var s=t.GameData.getData("items")[o.type];o.state=t.EntityState.COLLECTED,this._racerWorld.scoreData.logScore(t.ScoreDefinition.GET_GEARBIT1),this._racerWorld.scoreData.logGearbits("gearbit"),t.PlayerData.addCurrency(s.value),r.entitySignal.dispatch(t.EntitySignals.GET_ITEM,r.id,{item:o.type})}break;case t.TrackElementDefinition.MYSTERY_BOX:if(o.state!=t.EntityState.COLLECTED){o.state=t.EntityState.COLLECTED,this._racerWorld.addEffectEntity(r,"prize_get",{offsetY:-200});{Avota.ArrayUtil.randomize(t.GameData.getBonusList().concat())}0==r.bonusList.length&&(r.bonusList=t.GameData.getRandomizedBonusList()),r.addCommand(r.bonusList.pop())}break;case t.TrackElementDefinition.POWERPOD:if(o.state!=t.EntityState.COLLECTED){var s=t.GameData.getData("items").powerpod;o.state=t.EntityState.COLLECTED,this._racerWorld.addEffectEntity(r,"powerpods_get_fx",{offsetY:-200}),r.gainEnergy(s.value),r.entitySignal.dispatch(t.EntitySignals.GET_ITEM,r.id,{item:"powerpod"})}}},e.prototype.genericVtexture=function(i,n){var o=i.physics==e.GENERIC_OBJECT?i:n,r=n!=o?n:i;switch(r["class"]){case t.TrackElementDefinition.BOOST_PAD:o.hasCommand(t.EntityCommand.PAD_BOOST)?o.boostEndFrame=this._racerWorld.frameCount+o.boostDuration:o.addCommand(t.EntityCommand.PAD_BOOST);break;case t.TrackElementDefinition.RACE_MARKER:break;case t.TrackElementDefinition.ICE_FLOOR:o.hasCommand(t.EntityCommand.SKID)?o.setEndFrame("skid",this._racerWorld.frameCount):o.addCommand(t.EntityCommand.SKID);break;case t.TrackElementDefinition.ROUGH_FLOOR:o.hasCommand(t.EntityCommand.ROUGH_TERRAIN)?o.setEndFrame("rough",this._racerWorld.frameCount):o.addCommand(t.EntityCommand.ROUGH_TERRAIN)}},e.prototype.phasableVdestructable=function(i,n){var o=i.physics==e.PHASABLE_OBJECT?i:n,r=n==o?i:n;switch(o["class"]){case t.TrackElementDefinition.PROJECTILE:var s=t.GameData.getData("structures")[r.type];s.canShoot?this.projectileVEnemy(o,r):(this.projectileHit(o),this._racerWorld.removeEntity(o.id))}},e.prototype.phaseableVphaseable=function(e,i){switch(e["class"]){case t.TrackElementDefinition.ENEMY:switch(i["class"]){case t.TrackElementDefinition.PROJECTILE:this.projectileVEnemy(i,e);break;case t.TrackElementDefinition.EXPLOSION:this.explosionVEnemy(i,e)}break;case t.TrackElementDefinition.PROJECTILE:i["class"]==t.TrackElementDefinition.ENEMY&&this.projectileVEnemy(e,i);break;case t.TrackElementDefinition.EXPLOSION:i["class"]==t.TrackElementDefinition.ENEMY&&this.explosionVEnemy(e,i)}},e.prototype.projectileVEnemy=function(t,e){this.projectileHit(t),this.explosionVEnemy(t,e),this._racerWorld.removeEntity(t.id)},e.prototype.projectileHit=function(i){var n=t.GameData.getAttackData(i.type);if(!n)return void console.warn("[RacerPhysics] Attack data not found for:",i.type);if(n.explosive){this._racerWorld.addEntity(t.TrackEntity,n.hitDisplay+this._racerWorld.entityCount,{display:n.hitDisplay,behavior:"decay",lifeSpan:n.explosionLifespan,hitboxHeight:3*this._racerWorld.track.segmentLength,x:i.x,y:i.y,z:i.z,physics:e.PHASABLE_OBJECT,"class":t.TrackElementDefinition.EXPLOSION,owner:i.owner,type:i.type,friction:n.friction||0})}},e.prototype.explosionVEnemy=function(t,e){e.ramOffTrack(t.vz+100,200,0),e.setEndFrame("lifeSpan",this._racerWorld.frameCount,120)},e.getOverlapX=function(t,e){return-(e.x+e.hitboxWidth/2-(t.x-t.hitboxWidth/2))},e.interpolate=function(t,e,i){return t+(e-t)*i},e.percentRemaining=function(t,e){return t%e/e},e}();t.RacerPhysics=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(e,i,n,o){this._soundClasses={},this._soundData={},this._signalHandlers={},this._playingSounds=[],this._soundManager=i,this._game=n,this._racerWorld=e,this._racerWorld.entitySignal.add(this.entityHandler,this),this.addSoundClass("racer",this.racer),this.logSounds(o),this.addSignalHandler(t.EntitySignals.GET_ITEM,this.onGetItem),this.addSignalHandler(t.EntitySignals.GET_BONUS,this.onGetBonus),this.addSignalHandler(t.EntitySignals.PROGRESS_PLACEMENT,this.onProgressPlacement),this.addSignalHandler(t.EntitySignals.DAMAGED,this.onDamaged),this.addSignalHandler(t.EntitySignals.CRASHED,this.onCrashed),this.addSignalHandler(t.EntitySignals.SHIELDED,this.onShielded),this.addSignalHandler(t.EntitySignals.COLLIDED,this.onCollided),this.addSignalHandler(t.EntitySignals.BOOST,this.onBoost),this.addSignalHandler(t.EntitySignals.ATTACK,this.onAttack),this.addSignalHandler(t.EntitySignals.SLOWED,this.onSlow),this.addSignalHandler(t.EntitySignals.SHOT_FIRED,this.onShotFired),this.addSignalHandler(t.EntitySignals.SHOT_HIT,this.onShotHit),this.addSignalHandler(t.EntitySignals.DESTROYED,this.onDestroyed)}return e.NAME="RacerSoundStage",e.prototype.logSounds=function(t){for(var e=0;e<t.length;e++){var i=t[e];if("Audio"==i.type){var n={};n.name=i.name,n.category=i.category,n.volume=i.volume,n.loop=i.loop===!0||"true"==i.loop,this._soundData[i.name]=n}}},e.prototype.entityHandler=function(t,e,i){this._racerWorld.raceEndFrame||this._signalHandlers[t]&&this._signalHandlers[t].call(this,e,i)},e.prototype.onAttack=function(){},e.prototype.onDestroyed=function(e){var i=this._racerWorld.getEntity(e),n=t.GameData.getVehicleData(i.type);n&&n.crashSFX&&this._soundManager.playSound(n.crashSFX)},e.prototype.onShotHit=function(e,i){var n=(this._racerWorld.getEntity(e),t.GameData.getData("attacks")[i.attack]);n.hitSFX&&this._soundManager.playSound(n.hitSFX)},e.prototype.onShotFired=function(e,i){var n=(this._racerWorld.getEntity(e),t.GameData.getData("attacks")[i.attack]);n.shootSFX&&this._soundManager.playSound(n.shootSFX)},e.prototype.onSlow=function(t){this._racerWorld.getEntity(t);this._soundManager.stopSound("SFXSlow"),this._soundManager.playSound("SFXSlow")},e.prototype.onGetBonus=function(e,i){var n=this._racerWorld.getEntity(e),o=t.GameData.getData("bonuses")[i.bonus];o.sfx&&this.makeSound(o.sfx,n)},e.prototype.onGetItem=function(e,i){var n=this._racerWorld.getEntity(e),o=t.GameData.getData("items")[i.item];o.sfx&&(this._soundManager.stopSound(o.sfx),this.makeSound(o.sfx,n))},e.prototype.onProgressPlacement=function(e){var i=this._racerWorld.getEntity(e),n=t.GameData.getVehicleData(t.PlayerData.getVehicleIDForEntity(e));if(n.hornSFX)if("player"==i.id||"rival"==i.id)this.makeSound(n.hornSFX,i);else{var o=parseInt(i.id.match(/\d+/)[0]);this.makeSound(n.hornSFX+o,i)}},e.prototype.onDamaged=function(e){var i=this._racerWorld.getEntity(e);if(i["class"]!=t.TrackElementDefinition.ENEMY){var n=t.GameData.getCharacterData(t.PlayerData.getCharIDForEntity(e));n.hitVO&&this.makeSound(n.hitVO,i)}},e.prototype.onCrashed=function(e){var i=this._racerWorld.getEntity(e),n=t.GameData.getCharacterData(t.PlayerData.getCharIDForEntity(e));n.crashVO&&this.makeSound(n.crashVO,i)},e.prototype.onShielded=function(t){var e=this._racerWorld.getEntity(t);this.makeSound("SFXBonusShieldBlock",e)},e.prototype.onCollided=function(t){var e=this._racerWorld.getEntity(t);this.makeSound("SFXBump",e)},e.prototype.onBoost=function(e){var i=this._racerWorld.getEntity(e),n=t.PlayerData.getVehicleIDForEntity(i.id),o=t.GameData.getVehicleData(n);this.makeSound("SFXBoostPad",i),o.boostRevSFX&&i.vz<i.maxSpeed/2&&(this._soundManager.stopSound(o.revSFX),this.makeSound(o.boostRevSFX,i))},e.prototype.addSoundClass=function(t,e){this._soundClasses[t]=e},e.prototype.addSignalHandler=function(t,e){this._signalHandlers[t]=e},e.prototype.makeSound=function(t,e){if(this._soundManager.hasSound(t)){if(!this._soundManager.isSoundPlaying(t)){var i=this._soundManager.playSound(t);i.completeSignal.addOnce(this.onSoundComplete,this);var n={};n.sound=t,n.entity=e.id,this._playingSounds.push(n)}var o=this._racerWorld.getEntity("player"),r=this._soundData[t].volume,s=this._racerWorld.track.getShortestDistanceBetween(e.x,o.x),a=s,h=1/Math.pow(a/5,2),l=1e5*r*h;l>r&&(l=r),this._soundManager.setSoundVolume(t,l)}},e.prototype.onSoundComplete=function(t){for(var e=this._playingSounds.length-1;e>=0&&this._playingSounds.length>0;e--){var i=this._playingSounds[e];if(i.sound==t.name){this._playingSounds.splice(e,1);break}}},e.prototype.update=function(){this._racerWorld.traverseEntities(this.updateSounds,this,"racers"),this.updatePlayingSounds()},e.prototype.updateSounds=function(t){return this._racerWorld.raceEndFrame?void this.stopAll():void(this._soundClasses[t["class"]]&&this._soundClasses[t["class"]].call(this,t))},e.prototype.updatePlayingSounds=function(){if(this._racerWorld.frameCount%3==0)for(var t=this._playingSounds.length-1;t>=0&&this._playingSounds.length>0;t--){var e=this._playingSounds[t],i=this._racerWorld.getEntity(e.entity);i?this.makeSound(e.sound,i):(this._playingSounds.splice(t,1),this._soundManager.stopSound(e.sound))}},e.prototype.racer=function(e){if(this.isInSoundRange(e)){var i,n,o,r;i=e.type,n=t.PlayerData.getCharIDForEntity(e.id),o=t.GameData.getVehicleData(i),r=t.GameData.getCharacterData(n),this.makeSound(o.engineSFX,e)}},e.prototype.stopAll=function(){for(var t=this._playingSounds.length-1;t>=0&&this._playingSounds.length>0;t--){var e=this._playingSounds[t];this._playingSounds.splice(t,1),this._soundManager.stopSound(e.sound)}},e.prototype.isInSoundRange=function(t){var e=this._racerWorld.getEntity("player"),i=this._racerWorld.track,n=i.getShortestDistanceBetween(t.x,e.x);return 960>n},e}();t.RacerSoundStage=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(e,i,n,o,r){this._attackable={racer:!0,enemy:!0},this._racerWorld=e,this._inputManager=o,this._touchInput=r,this._gameboard=i,this._inventory=n,this._gameboard.eventSignal.add(this.boardHandler,this),this._inventory.eventSignal.add(this.inventoryHandler,this,2),this._racerWorld.addCategory("behavior",function(t){return null!=t.behavior}),this._racerWorld.addCategory("allies",function(e){return e["class"]==t.TrackElementDefinition.ALLY}),this._racerWorld.addCategory("shootable",function(t){return this._attackable[t["class"]]}.bind(this)),this._racerWorld.addCategory("enemies",function(e){return e["class"]==t.TrackElementDefinition.ENEMY}.bind(this))}return e.NAME="TrackEntityController",e.prototype.update=function(){this._racerWorld.traverseEntities(this.behave,this,"behavior")},e.prototype.behave=function(t){this[t.behavior]&&this[t.behavior](t)},e.prototype.inventoryHandler=function(e,i){switch(e){case t.InventoryEvent.BONUS_USE:this.useBonus(i.bonus);break;case t.InventoryEvent.TREASURE_GET:this.useTreasure(i.treasure)}},e.prototype.useBonus=function(e){switch(e){case t.EntityCommand.BONUS_ELIXIR:var i=this._racerWorld.getEntity("player");i.addCommand(t.EntityCommand.BONUS_ELIXIR);break;case t.EntityCommand.BONUS_SHOE:var i=this._racerWorld.getEntity("player");i.addCommand(t.EntityCommand.BONUS_SHOE);break;case t.EntityCommand.BONUS_KEY:this.unlock();break;case t.EntityCommand.BONUS_SHIELD:var i=this._racerWorld.getEntity("player");i.addCommand(t.EntityCommand.BONUS_SHIELD);break;case"attack_extra":this.changePiecesTo(t.GamePiece.SWORD);break;case"engine_extra":this.changePiecesTo(t.GamePiece.ENGINE);break;case"sattack_extra":this.changePiecesTo(t.GamePiece.EXPLOSION);break;case"gearbits03":var n=t.GameData.getData("bonuses")[e];t.PlayerData.addCurrency(n.amount)}},e.prototype.changePiecesTo=function(t){this._gameboard.changeRandomPiecesTo(t,.2)},e.prototype.useTreasure=function(e){var i=t.GameData.getData("treasure")[e];t.PlayerData.addCurrency(i.amount)},e.prototype.boardHandler=function(e,i){switch(e){case t.GameboardEvents.PIECE_ADDED:break;case t.GameboardEvents.MATCH:this.addPieceCommands(i);break;case t.GameboardEvents.PIECE_CLEARED:break;case t.GameboardEvents.PIECE_SELECTED:break;case t.GameboardEvents.PIECE_DESELECTED:break;case t.GameboardEvents.SELECTION_EXECUTED:this.addPieceCommands(i)}},e.prototype.addPieceCommands=function(e){if(e.numSelected){var i=e;if(this.setPieceCommand(i.selectionType,i),i.hasType(t.GamePiece.WILD)){{i.numType(t.GamePiece.WILD)}this.setPieceCommand(t.GamePiece.WILD,i)}}else{var n={};for(var o in e){var r=this._gameboard.getPiece(o);r&&!n[r.type]&&(this.setPieceCommand(r.type),n[r.type]=!0)}}},e.prototype.setPieceCommand=function(e,i){var n=i?i.numSelected:3;switch(e){case t.GamePiece.ENGINE:this.engine(n);break;case t.GamePiece.SWORD:this.attack1(n);break;case t.GamePiece.EXPLOSION:this.attack2(n);break;case t.GamePiece.KEY:this.unlock();break;case t.GamePiece.TREASURE:this.getTreasure(n);break;case t.GamePiece.GEARBIT:this.getGearbits(n);break;case t.GamePiece.WILD:this.getBonus(i)}},e.prototype.engine=function(e){"undefined"==typeof e&&(e=3);var i=this._racerWorld.getEntity("player"),n=t.GameData.getData("gamePieces")[t.GamePiece.ENGINE];i.durationList.accelerateActive=n.baseValue+(e-3)*n.increment,this._racerWorld.addEffectEntity(i,"boost"),i.entitySignal.dispatch(t.EntitySignals.BOOST,i.id),i.hasCommand(t.EntityCommand.ACCELERATE)?i.setEndFrame("accelerateActive",this._racerWorld.frameCount):i.addCommand(t.EntityCommand.ACCELERATE)},e.prototype.attack1=function(e){"undefined"==typeof e&&(e=3);var i=this._racerWorld.getEntity("player"),n=t.GameData.getData("attacks")[i.primaryAttack];i.durationList[i.primaryAttack+"activeTime"]=n.activeTime+n.activeTime/2*(e-3),i.hasCommand(t.EntityCommand.FIRE_PRIMARY)?i.setEndFrame(i.primaryAttack+"activeTime",this._racerWorld.frameCount):i.addCommand(t.EntityCommand.FIRE_PRIMARY)},e.prototype.attack2=function(e){"undefined"==typeof e&&(e=3);var i=this._racerWorld.getEntity("player"),n=t.GameData.getData("attacks")[i.secondaryAttack];i.durationList[i.secondaryAttack+"activeTime"]=n.activeTime+n.activeTime/2*(e-3),i.hasCommand(t.EntityCommand.FIRE_SECONDARY)?i.setEndFrame(i.secondaryAttack+"activeTime",this._racerWorld.frameCount):i.addCommand(t.EntityCommand.FIRE_SECONDARY)},e.prototype.unlock=function(){var e=this._racerWorld.getEntity("player");e.addCommand(t.EntityCommand.BONUS_KEY)},e.prototype.getBonus=function(e){for(var i=e.getPiecesOfType(t.GamePiece.WILD),n=0;n<i.length;n++)this._inventory.getBonus(i[n])},e.prototype.getTreasure=function(t){"undefined"==typeof t&&(t=3);var e=this._racerWorld.scoreData;e.logScore("matchTreasure");for(var i=0;t-3>i;i++)e.logScore("matchTreasureExtra")},e.prototype.getGearbits=function(e){"undefined"==typeof e&&(e=3);var i=this._racerWorld.getEntity("player"),n=t.GameData.getData("gamePieces")[t.GamePiece.GEARBIT],o=n.baseValue+(e-3)*n.increment;t.PlayerData.addCurrency(o),i.entitySignal.dispatch(t.EntitySignals.GET_ITEM,i.id,{item:"gearbit"})},e.prototype.lockToTarget=function(t){var e=this._racerWorld.getEntity(t.target);if(e){{e.x-t.x,e.y-t.y,e.z-t.z}t.x=e.x+t.offsetX,t.y=e.y+t.offsetY,t.z=e.z+t.offsetZ,this._racerWorld.updateSegment(t)}},e.prototype.skimTrack=function(t){t.z=t.loopSum(t.z,175,this._racerWorld.track.trackLength),this._racerWorld.updateSegment(t)},e.prototype.cruise=function(e){this._racerWorld.raceStarted&&(e.hasCommand(t.EntityCommand.ACCELERATE)||e.addCommand(t.EntityCommand.ACCELERATE),this.executeCommands(e))},e.prototype.fly=function(){},e.prototype.gearbit=function(e){var i=this._racerWorld.getEntity("player");if(this._racerWorld.track.getShortestDistanceBetween(i.x,e.x)<i.hitboxWidth/2&&e.state!=t.EntityState.COLLECTED){var n=t.GameData.getData("items")[e.type];e.state=t.EntityState.COLLECTED,this._racerWorld.scoreData.logScore(t.ScoreDefinition.GET_GEARBIT1),this._racerWorld.scoreData.logGearbits("gearbit"),t.PlayerData.addCurrency(n.value),e.entitySignal.dispatch(t.EntitySignals.GET_ITEM,e.id,{item:e.type})}},e.prototype.ally=function(e){var i=this._racerWorld.getEntity("player");e.state!=t.EntityState.UNLOCKED&&(this._racerWorld.track.getDistanceToPoint(i.x,e.x)<2*i.hitboxWidth?(e.vx=.9*i.vx,e.state!=t.EntityState.UNLOCKABLE&&(e.state=t.EntityState.UNLOCKABLE,this._inventory.eventSignal.dispatch(t.InventoryEvent.ALLY_UNLOCKABLE,{ally:e.id}))):(e.state!=t.EntityState.NEUTRAL&&(e.state=t.EntityState.NEUTRAL,this._inventory.eventSignal.dispatch(t.InventoryEvent.ALLY_OFFSCREEN,{ally:e.id})),e.vx=0))},e.prototype.projectile=function(e){var i=this._racerWorld.getEntity(e.target),n=t.GameData.getAttackData(e.type);e.vx+=e.accel,i&&(e.vy=(i.y-e.y)*(1/e.getDuration("lifeSpan")),this._racerWorld.track.getShortestDistanceBetween(e.x,i.x)<i.hitboxWidth/2&&(this._racerWorld.removeEntity(e.id),i.hasCommand(t.EntityCommand.BONUS_SHIELD)?i.entitySignal.dispatch(t.EntitySignals.SHIELDED,i.id):(e.entitySignal.dispatch(t.EntitySignals.SHOT_HIT,e.id,{attack:e.type}),i.takeDamage(n.baseDamage),"player"!=i.id?(i.cutSpeed(2),i.addCommand(t.EntityCommand.SLOW)):i.removeCommand(t.EntityCommand.ACCELERATE)),this._racerWorld.addEffectEntity(i,n.hitDisplay))),this.decay(e)},e.prototype.staticProjectile=function(e){var i=this._racerWorld.getEntitiesInCategory("shootable"),n=t.GameData.getAttackData(e.type);e.vx+=e.accel;for(var o=0;o<i.length;o++){var r=this._racerWorld.getEntity(i[o]);r&&e.owner!=r.id&&this._racerWorld.track.getShortestDistanceBetween(e.x,r.x)<r.hitboxWidth/2&&(e.entitySignal.dispatch(t.EntitySignals.SHOT_HIT,e.id,{attack:e.type}),r.takeDamage(n.baseDamage),r.cutSpeed(2),r.addCommand(t.EntityCommand.SLOW))}this.decay(e)},e.prototype.respawnItem=function(e){e.state==t.EntityState.COLLECTED&&(e.hasEndFrame("respawnDelay")||e.setEndFrame("respawnDelay",this._racerWorld.frameCount,100),e.pastEndFrame("respawnDelay",this._racerWorld.frameCount)&&(e.state="",e.clearEndFrame("respawnDelay")))},e.prototype.explosiveProjectile=function(e){if(e.vz+=e.accel,e.hasEndFrame("lifeSpan")||e.setEndFrame("lifeSpan",this._racerWorld.frameCount),e.pastEndFrame("lifeSpan",this._racerWorld.frameCount)){var i=t.GameData.getAttackData(e.type);if(i){this._racerWorld.addEntity(t.TrackEntity,i.hitDisplay+this._racerWorld.entityCount,{display:i.hitDisplay,behavior:"decay",lifeSpan:i.explosionLifespan,x:e.x,y:e.y,z:e.z,physics:t.RacerPhysics.PHASABLE_OBJECT,"class":t.TrackElementDefinition.EXPLOSION,owner:e.owner,type:e.type,friction:i.friction||0})}this._racerWorld.removeEntity(e.id)}},e.prototype.decay=function(t){t.hasEndFrame("lifeSpan")||t.setEndFrame("lifeSpan",this._racerWorld.frameCount),t.pastEndFrame("lifeSpan",this._racerWorld.frameCount)&&this._racerWorld.removeEntity(t.id)},e.prototype.hostile=function(e){if(this._racerWorld.raceStarted){var i=t.GameData.getVehicleData(e.type);if(this._racerWorld.hasEnded())return void(e.state!=t.EntityState.INACTIVE&&e.state!=t.EntityState.DESTROYED&&(e.state=t.EntityState.DESTROYED,e.vx=0,e.entitySignal.dispatch(t.EntitySignals.DESTROYED,e.id),i.destroyDisplay&&this._racerWorld.addEffectEntity(e,i.destroyDisplay)));if(e.state==t.EntityState.DESTROYED)return e.hasEndFrame("respawn")||e.setEndFrame("respawn",this._racerWorld.frameCount,180),void(e.pastEndFrame("respawn",this._racerWorld.frameCount)&&(e.clearEndFrame("respawn"),e.refresh()));for(var n=this._racerWorld.track,o=this._racerWorld.getEntity("player"),r=this._racerWorld.getEntitiesInCategory("enemies"),s=!1,a=0;a<r.length;a++){var h=this._racerWorld.getEntity(r[a]);if(h&&h!=e&&h.state==t.EntityState.APPROACHING){s=!0;break}}!s&&n.getShortestDistanceBetween(e.x,o.x)<960?(e.addCommand(t.EntityCommand.ACCELERATE),e.state==t.EntityState.INACTIVE&&(e.state=t.EntityState.ACTIVE),n.getShortestDistanceBetween(e.x,o.x)<300&&(e.state!=t.EntityState.APPROACHING&&(e.state=t.EntityState.APPROACHING,this._racerWorld.eventSignal.dispatch(t.EventSignals.ENEMY_APPROACH)),n.getShortestDistanceBetween(e.x,o.x)<o.hitboxWidth&&(e.x=o.x+o.hitboxWidth),o.hasCommand(t.EntityCommand.CRASH)||e.addCommand(t.EntityCommand.FIRE_PRIMARY))):e.state!=t.EntityState.INACTIVE&&(e.state=t.EntityState.INACTIVE),0==e.hp&&e.state!=t.EntityState.DESTROYED&&(e.state=t.EntityState.DESTROYED,e.vx=0,e.entitySignal.dispatch(t.EntitySignals.DESTROYED,e.id),i.destroyDisplay&&this._racerWorld.addEffectEntity(e,i.destroyDisplay)),this.executeCommands(e)}},e.prototype.charge=function(t){this._racerWorld.raceStarted&&this.executeCommands(t)},e.prototype.cpu=function(t){this._racerWorld.raceStarted&&this.executeCommands(t)},e.prototype.control=function(e){this.mapInputs(e),this._racerWorld.raceStarted&&(0==e.hp&&e.addCommand(t.EntityCommand.CRASH),this.executeCommands(e))},e.prototype.mapInputs=function(e){Avota.EnvUtil.isMobile?this._touchInput&&(e.inputMap[t.TrackEntity.INPUT_DOWN]=this._touchInput.hasInput(t.TouchInput.INPUT_BRAKE)?!0:!1,e.inputMap[t.TrackEntity.INPUT_UP]=this._touchInput.hasInput(t.TouchInput.INPUT_ACCEL)?!0:!1,e.inputMap[t.TrackEntity.INPUT_LEFT]=this._touchInput.hasInput(t.TouchInput.INPUT_LEFT)?!0:!1,e.inputMap[t.TrackEntity.INPUT_RIGHT]=this._touchInput.hasInput(t.TouchInput.INPUT_RIGHT)?!0:!1,e.inputMap[t.TrackEntity.INPUT_FIRE]=this._touchInput.hasInput(t.TouchInput.INPUT_FIRE)?!0:!1,e.inputMap[t.TrackEntity.INPUT_FIRE2]=this._touchInput.hasInput(t.TouchInput.INPUT_FIRE2)?!0:!1):(e.inputMap[t.TrackEntity.INPUT_DOWN]=this._inputManager.isKeyDown(40)?!0:!1,e.inputMap[t.TrackEntity.INPUT_UP]=this._inputManager.isKeyDown(38)?!0:!1,e.inputMap[t.TrackEntity.INPUT_LEFT]=this._inputManager.isKeyDown(37)?!0:!1,e.inputMap[t.TrackEntity.INPUT_RIGHT]=this._inputManager.isKeyDown(39)?!0:!1,e.inputMap[t.TrackEntity.INPUT_FIRE]=this._inputManager.isKeyDown(32)?!0:!1,e.inputMap[t.TrackEntity.INPUT_FIRE2]=this._inputManager.isKeyDown(69)?!0:!1)},e.prototype.performAttack=function(e,i){var n=t.GameData.getAttackData(i),o=i==e.primaryAttack?t.EntityCommand.FIRE_PRIMARY:t.EntityCommand.FIRE_SECONDARY,r=t.PlayerData.hasSuperChargedCombo()?t.GameData.getData("superchargedModifier"):1;switch(n.type){case"shot":if(e.pastEndFrame(i+"fireCooldown",this._racerWorld.frameCount)){if(e.hasEndFrame(i+"activeTime")||(e.setEndFrame(i+"activeTime",this._racerWorld.frameCount,(e.durationList[i+"activeTime"]||n.activeTime)*r),e.entitySignal.dispatch(t.EntitySignals.ATTACK,e.id,{attack:i}),e.useEnergy(n.energy/r)),e.pastEndFrame(i+"shotDelay",this._racerWorld.frameCount)){var s,a,h=this._racerWorld.getEntitiesInCategory("shootable"),l=this._racerWorld.track;if(!n.isStatic)for(var c=0;c<h.length;c++){var u=this._racerWorld.getEntity(h[c]);if(u&&u.id!=e.id){var p=e["class"]==t.TrackElementDefinition.ENEMY?l.getDistanceToPoint(u.x,e.x):l.getDistanceToPoint(e.x,u.x);940>p&&(!s||a>p)&&(s=u,a=p)}}n.shootDisplay&&this._racerWorld.addEffectEntity(e,n.shootDisplay,{});var d=this._racerWorld.addEntity(t.TrackEntity,n.display+this._racerWorld.entityCount,{display:n.display,behavior:n.behavior,lifeSpan:n.shotLifespan*r,accel:n.shotAccel*r,x:e.x,y:e.y+50,physics:t.RacerPhysics.PHASABLE_OBJECT,target:s?s.id:null,"class":t.TrackElementDefinition.PROJECTILE,owner:e.id,type:i,friction:n.friction||0});d.vx=e.vx,e.setEndFrame(i+"shotDelay",this._racerWorld.frameCount,n.shotDelay/r),e.entitySignal.dispatch(t.EntitySignals.SHOT_FIRED,e.id,{attack:i})}e.pastEndFrame(i+"activeTime",this._racerWorld.frameCount)&&(e.removeCommand(o),e.clearEndFrame(i+"activeTime"),e.clearEndFrame(i+"shotDelay"),e.clearEndFrame(i+"fireCooldown"),e.setEndFrame(i+"fireCooldown",this._racerWorld.frameCount,n.cooldown/r))}break;case"boost":if(e.pastEndFrame(i+"boostAttackCooldown",this._racerWorld.frameCount)){if(!e.hasEndFrame(i+"boostActiveTime")){e.setEndFrame(i+"boostActiveTime",this._racerWorld.frameCount,n.activeTime);var f=this._racerWorld.addEntity(t.TrackEntity,n.display+this._racerWorld.entityCount,{display:n.display,x:e.x,y:e.y,z:e.z,target:e.id,lifeSpan:n.activeTime,offsetX:n.effectOffsetX,offsetY:n.effectOffsetY,offsetZ:n.effectOffsetZ,behavior:"decay"});e.entitySignal.dispatch(t.EntitySignals.ATTACK,e.id,{attack:i}),e.addCommand(t.EntityCommand.BOOST_ATTACK),e.addChild(f.id),e.useEnergy(n.energy/r)}e.hasEndFrame(i+"boostAccelTime")||e.setEndFrame(i+"boostAccelTime",this._racerWorld.frameCount,n.boostAccelTime*r),e.pastEndFrame(i+"boostAccelTime",this._racerWorld.frameCount)||e.vz<1.25*e.getSpeedCategory("boost")&&(e.vz+=n.accel*r),e.pastEndFrame(i+"boostActiveTime",this._racerWorld.frameCount)&&(e.removeCommand(o),e.removeCommand(t.EntityCommand.BOOST_ATTACK),e.clearEndFrame(i+"boostActiveTime"),e.clearEndFrame(i+"boostAccelTime"),e.clearEndFrame(i+"boostAttackCooldown"),e.setEndFrame(i+"boostAttackCooldown",this._racerWorld.frameCount,n.cooldown/r))}}},e.prototype.executeCommands=function(e){for(var i in e.commands){var n=e.commands[i];switch(n.type){case t.EntityCommand.ACCELERATE:if(e.hasCommand(t.EntityCommand.PAD_BOOST))break;if(e.hasCommand(t.EntityCommand.CRASH))break;if(e.hasCommand(t.EntityCommand.SKID))break;if(e.hasCommand(t.EntityCommand.STUN))break;e.hasEndFrame("accelerateStartup")||e.setEndFrame("accelerateStartup",this._racerWorld.frameCount,1),e.pastEndFrame("accelerateStartup",this._racerWorld.frameCount)&&(e.hasEndFrame("accelerateActive")||e.setEndFrame("accelerateActive",this._racerWorld.frameCount),e.pastEndFrame("accelerateActive",this._racerWorld.frameCount)?(e.clearEndFrame("accelerateStartup"),e.clearEndFrame("accelerateActive"),e.removeCommand(t.EntityCommand.ACCELERATE)):e.accelerate());break;case t.EntityCommand.DECELERATE:if(e.hasCommand(t.EntityCommand.PAD_BOOST))break;if(e.hasCommand(t.EntityCommand.SKID))break;e.vz>0&&(e.vz+=e.decel);break;case t.EntityCommand.BREAK:if(e.hasCommand(t.EntityCommand.SKID))break;if(e.hasCommand(t.EntityCommand.STUN))break;e.vz>-e.maxSpeed/3&&(e.vz+=e.breaking);break;case t.EntityCommand.LINEAR_ADVANCE:if(e.hasCommand(t.EntityCommand.CRASH))break;e.vz=e.maxSpeed;break;case t.EntityCommand.MOVE_LEFT:if(e.hasCommand(t.EntityCommand.SKID)){e.vx=0;break}if(e.lane-1<=0||e.hasCommand(t.EntityCommand.MOVE_RIGHT)){e.removeCommand(t.EntityCommand.MOVE_LEFT);break}e.x>this._racerWorld.track.getLaneCenterX(e.lane-1)?e.vx=-(e.turnSpeed*(Math.abs(e.vz)/Math.abs(e.getSpeedCategory("neutral"))))||-10:(e.x=this._racerWorld.track.getLaneCenterX(e.lane-1),e.vx=0,e.lane=e.lane-1,e.removeCommand(t.EntityCommand.MOVE_LEFT));break;case t.EntityCommand.MOVE_RIGHT:if(e.hasCommand(t.EntityCommand.SKID)){e.vx=0;break}if(e.lane+1>this._racerWorld.track.lanes||e.hasCommand(t.EntityCommand.MOVE_LEFT)){e.removeCommand(t.EntityCommand.MOVE_RIGHT);break}e.x<this._racerWorld.track.getLaneCenterX(e.lane+1)?e.vx=e.turnSpeed*(Math.abs(e.vz)/Math.abs(e.getSpeedCategory("neutral")))||10:(e.x=this._racerWorld.track.getLaneCenterX(e.lane+1),e.vx=0,e.lane=e.lane+1,e.removeCommand(t.EntityCommand.MOVE_RIGHT));break;case t.EntityCommand.PAD_BOOST:if(e.hasCommand(t.EntityCommand.CRASH))break;if(e.hasEndFrame("boost")||(e.vz=e.boostSpeed,this._racerWorld.addEffectEntity(e,"speedboost_get",{offsetY:-250}),e.entitySignal.dispatch(t.EntitySignals.BOOST,e.id),e.setEndFrame("boost",this._racerWorld.frameCount)),e.vz<e.boostSpeed){var o=t.GameData.getData("boostAccelModifier")*e.accel,r=t.GameData.getData("boostSpeedModifier")*e.maxSpeed;e.boost(o,r)}e.pastEndFrame("boost",this._racerWorld.frameCount)&&(e.clearEndFrame("boost"),e.removeCommand(t.EntityCommand.PAD_BOOST));break;case t.EntityCommand.FIRE_PRIMARY:if(e.hasCommand(t.EntityCommand.CRASH))break;if(e.hasCommand(t.EntityCommand.STUN))break;
this.performAttack(e,e.primaryAttack);break;case t.EntityCommand.FIRE_SECONDARY:if(e.hasCommand(t.EntityCommand.CRASH))break;if(e.hasCommand(t.EntityCommand.STUN))break;this.performAttack(e,e.secondaryAttack);break;case t.EntityCommand.CRASH:e.hasEndFrame("crash")||(e.setEndFrame("crash",this._racerWorld.frameCount),e.entitySignal.dispatch(t.EntitySignals.CRASHED,e.id)),e.removeCommand(t.EntityCommand.PAD_BOOST),e.hasCommand(t.EntityCommand.INVINCIBLE)||(e.addCommand(t.EntityCommand.INVINCIBLE),e.setEndFrame("invincible",this._racerWorld.frameCount,e.getDuration("crash")+60)),e.vz<0?e.vz-=1.25*e.decel:e.vz+=1.25*e.decel,e.pastEndFrame("crash",this._racerWorld.frameCount)&&(e.clearEndFrame("crash"),e.refillHP(),e.removeCommand(t.EntityCommand.CRASH));break;case t.EntityCommand.INVINCIBLE:e.hasEndFrame("invincible")||e.setEndFrame("invincible",this._racerWorld.frameCount),e.pastEndFrame("invincible",this._racerWorld.frameCount)&&e.removeCommand(t.EntityCommand.INVINCIBLE);break;case t.EntityCommand.SKID:e.hasEndFrame("skid")||e.setEndFrame("skid",this._racerWorld.frameCount),e.vz=Avota.MathUtil.clamp(e.vz,e.getSpeedCategory("skid")/5,e.getSpeedCategory("skid")),e.pastEndFrame("skid",this._racerWorld.frameCount)&&(e.clearEndFrame("skid"),e.removeCommand(t.EntityCommand.SKID));break;case t.EntityCommand.STUN:e.hasEndFrame("stun")||e.setEndFrame("stun",this._racerWorld.frameCount),e.pastEndFrame("stun",this._racerWorld.frameCount)&&(e.clearEndFrame("stun"),e.removeCommand(t.EntityCommand.STUN));break;case t.EntityCommand.ROUGH_TERRAIN:e.hasEndFrame("rough")||e.setEndFrame("rough",this._racerWorld.frameCount),e.vz*=.975,e.pastEndFrame("rough",this._racerWorld.frameCount)&&(e.clearEndFrame("rough"),e.removeCommand(t.EntityCommand.ROUGH_TERRAIN));break;case t.EntityCommand.BONUS_ELIXIR:var s=t.GameData.getData("bonuses").elixir;e.hasEndFrame("elixirStartup")||(e.setEndFrame("elixirStartup",this._racerWorld.frameCount,s.startup),e.entitySignal.dispatch(t.EntitySignals.GET_BONUS,e.id,{bonus:"elixir"})),e.pastEndFrame("elixirStartup",this._racerWorld.frameCount)&&(e.hasEndFrame("elixirActive")||(e.setEndFrame("elixirActive",this._racerWorld.frameCount,s.activeFrames),this._racerWorld.addEffectEntity(e,s.fx,{lifeSpan:s.activeFrames}),e.refillHP()),e.pastEndFrame("elixirActive",this._racerWorld.frameCount)&&(e.clearEndFrame("elixirStartup"),e.clearEndFrame("elixirActive"),e.removeCommand(t.EntityCommand.BONUS_ELIXIR)));break;case t.EntityCommand.BONUS_HOURGLASS:var s=t.GameData.getData("bonuses").hourglass;if(e.hasEndFrame("hourglassStartup")||(e.setEndFrame("hourglassStartup",this._racerWorld.frameCount,s.startup),e.entitySignal.dispatch(t.EntitySignals.GET_BONUS,e.id,{bonus:"hourglass"})),e.pastEndFrame("hourglassStartup",this._racerWorld.frameCount)){if(!e.hasEndFrame("hourglassActive")){e.setEndFrame("hourglassActive",this._racerWorld.frameCount,s.activeFrames),this._racerWorld.addEffectEntity(e,s.fx,{lifeSpan:s.activeFrames});for(var a=this._racerWorld.getEntitiesInCategory("racers"),h=0;h<a.length;h++)if(a[h]!=e.id){var l=this._racerWorld.getEntity(a[h]);l.addCommand(t.EntityCommand.SLOW)}}e.pastEndFrame("hourglassActive",this._racerWorld.frameCount)&&(e.clearEndFrame("hourglassStartup"),e.clearEndFrame("hourglassActive"),e.removeCommand(t.EntityCommand.BONUS_HOURGLASS))}break;case t.EntityCommand.BONUS_JUKEBOX:var s=t.GameData.getData("bonuses").jukebox;e.hasEndFrame("jukeboxStartup")||(e.entitySignal.dispatch(t.EntitySignals.GET_BONUS,e.id,{bonus:"jukebox"}),e.setEndFrame("jukeboxStartup",this._racerWorld.frameCount,s.startup)),e.pastEndFrame("jukeboxStartup",this._racerWorld.frameCount)&&(e.hasEndFrame("jukeboxActive")||(e.setEndFrame("jukeboxActive",this._racerWorld.frameCount,s.activeFrames),this._racerWorld.addEffectEntity(e,s.fx,{lifeSpan:s.activeFrames})),e.pastEndFrame("jukeboxActive",this._racerWorld.frameCount)&&(e.clearEndFrame("jukeboxStartup"),e.clearEndFrame("jukeboxActive"),e.removeCommand(t.EntityCommand.BONUS_JUKEBOX)));break;case t.EntityCommand.BONUS_SHIELD:var s=t.GameData.getData("bonuses").shield;e.hasEndFrame("shieldStartup")||(e.entitySignal.dispatch(t.EntitySignals.GET_BONUS,e.id,{bonus:"shield"}),e.setEndFrame("shieldStartup",this._racerWorld.frameCount,s.startup)),e.pastEndFrame("shieldStartup",this._racerWorld.frameCount)&&(e.hasEndFrame("shieldActive")||(e.setEndFrame("shieldActive",this._racerWorld.frameCount,s.activeFrames),this._racerWorld.addEffectEntity(e,s.fx,{lifeSpan:s.activeFrames})),e.pastEndFrame("shieldActive",this._racerWorld.frameCount)&&(e.clearEndFrame("shieldStartup"),e.clearEndFrame("shieldActive"),e.removeCommand(t.EntityCommand.BONUS_SHIELD)));break;case t.EntityCommand.BONUS_SHOE:var s=t.GameData.getData("bonuses").shoe;e.hasEndFrame("shoeStartup")||(e.setEndFrame("shoeStartup",this._racerWorld.frameCount,s.startup),e.entitySignal.dispatch(t.EntitySignals.GET_BONUS,e.id,{bonus:"shoe"})),e.pastEndFrame("shoeStartup",this._racerWorld.frameCount)&&(e.hasEndFrame("shoeActive")||(e.setEndFrame("shoeActive",this._racerWorld.frameCount,s.activeFrames),this._racerWorld.addEffectEntity(e,s.fx,{lifeSpan:s.activeFrames})),e.pastEndFrame("shoeActive",this._racerWorld.frameCount)?(e.clearEndFrame("shoeStartup"),e.clearEndFrame("shoeActive"),e.removeCommand(t.EntityCommand.BONUS_SHOE)):e.boost(e.accel*s.accelModifier,e.maxSpeed*s.speedModifier));break;case t.EntityCommand.SLOW:var s=t.GameData.getData("bonuses").hourglass;e.hasEndFrame("slowActive")||(e.setEndFrame("slowActive",this._racerWorld.frameCount,60),e.entitySignal.dispatch(t.EntitySignals.SLOWED,e.id,{})),e.pastEndFrame("slowActive",this._racerWorld.frameCount)&&(e.clearEndFrame("slowActive"),e.slowModifier=1,e.removeCommand(t.EntityCommand.SLOW));break;case t.EntityCommand.UNLOCK:case t.EntityCommand.BONUS_KEY:if(e.hasEndFrame("unlockActive")||e.setEndFrame("unlockActive",this._racerWorld.frameCount,60),e.pastEndFrame("unlockActive",this._racerWorld.frameCount))e.clearEndFrame("unlockActive"),e.slowModifier=1,e.removeCommand(t.EntityCommand.UNLOCK),e.removeCommand(t.EntityCommand.BONUS_KEY);else for(var c=this._racerWorld.getEntitiesInCategory("allies"),h=0;h<c.length;h++){var u=this._racerWorld.getEntity(c[h]);u&&u.state==t.EntityState.UNLOCKABLE&&(u.state=t.EntityState.UNLOCKED,this._inventory.unlockAlly(u.type),this._racerWorld.addEffectEntity(u,"ally_unlock",{}),this._racerWorld.scoreData.logScore("rescuedFriend"),3==this._inventory.numAlliesUnlocked&&this._racerWorld.scoreData.logScore("rescuedAllFriends"))}}}},e}();t.TrackEntityController=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(t,e,i){this._gameboard=e,this._sound=t,this._inventory=i,this._gameboard.eventSignal.add(this.boardHandler,this),this._inventory.eventSignal.add(this.inventoryHandler,this)}return e.NAME="BoardSoundStage",e.prototype.boardHandler=function(e,i){switch(e){case t.GameboardEvents.PIECE_ADDED:break;case t.GameboardEvents.MATCH:break;case t.GameboardEvents.PIECE_CLEARED:break;case t.GameboardEvents.PIECE_SELECTED:this.onPieceSelected();break;case t.GameboardEvents.PIECE_DESELECTED:break;case t.GameboardEvents.SELECTION_EXECUTED:this.onSelectionExecuted(i);break;case t.GameboardEvents.BOARD_REMOVED:break;case t.GameboardEvents.PIECE_CHANGED:}},e.prototype.inventoryHandler=function(e,i){switch(e){case t.InventoryEvent.BONUS_GET:this._sound.playSound("SUIBonusGet");break;case t.InventoryEvent.BONUS_USE:switch(i.bonus){case t.EntityCommand.BONUS_SHIELD:break;case t.EntityCommand.BONUS_ELIXIR:break;case t.EntityCommand.BONUS_SHOE:break;case"attack_extra":case"sattack_extra":case"engine_extra":this._sound.playSound("SUIShuffle")}break;case t.InventoryEvent.SLOT_FILLED:break;case t.InventoryEvent.SLOT_EMPTIED:break;case t.InventoryEvent.ALLY_UNLOCKED:this._sound.playSound("SFXUnlock");break;case t.InventoryEvent.ALLY_UNLOCKABLE:break;case t.InventoryEvent.ALLY_OFFSCREEN:}},e.prototype.onPieceSelected=function(){this._sound.playSound("SUIPieceSelected")},e.prototype.onSelectionExecuted=function(){this._sound.playSound("SUISelectionCleared")},e}();t.BoardSoundStage=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(n,o,r,s,a,h){e.call(this,o,i.NAME),this.game=Avota.Context.getContext(t.SuperChargersGame.NAME),this.renderManager=r,this.scene=n,this.width=a,this.height=h,this._graphics={},this.globalStrings=s}return __extends(i,e),i.NAME="ScreenFX",i.SCALE_FADE=0,i.FADE_INOUT=1,Object.defineProperty(i.prototype,"timeManager",{get:function(){return this._timeManager},enumerable:!0,configurable:!0}),i.prototype.showBeneficialPlacement=function(e){function i(){s.destroy(),a.destroy(),h.destroy(),l.destroy(),c.destroy()}var n,o=(this.globalStrings.game.messages.RaceGO,this.globalStrings.game.placement);for(var r in o)r.match(e.toString())&&(n=e+o[r]);n||(n=e+o.suffix4);var s=t.ScreenUtil.makeText(this.scene,"Placement"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+10,style:".screenFXWin",text:n,shadow:!0,shadowColor:"#F3CC4E",shadowStrength:2,shadowOffsetX:3,shadowOffsetY:3}),a=t.ScreenUtil.makeText(this.scene,"Placement"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+13,style:".screenFXWin",text:n,alpha:0}),h=t.ScreenUtil.makeText(this.scene,"Placement"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+12,style:".screenFXWin",text:n,alpha:0}),l=t.ScreenUtil.makeText(this.scene,"Placement"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+11,style:".screenFXWin",text:n,alpha:0}),c=t.ScreenUtil.makeImage(this.scene,"PlacementShine"+Math.round(1e5*Math.random()),"SelectGlow",{zIndex:this.zIndex+9,alpha:.75});c.centerX=this.width/2,c.centerY=this.height/2,s.left=this.width/2-s.width/2,s.top=this.height/2-s.height/2,s.registrationY=s.height/2,s.registrationX=s.width/2,a.left=h.left=l.left=s.left,a.top=h.top=l.top=s.top,a.registrationX=h.registrationX=l.registrationX=s.registrationX,a.registrationY=h.registrationY=l.registrationY=s.registrationY;var u=new TimelineMax({onComplete:function(){return i()}});u.insert(TweenMax.from(s,.5,{scaleX:0,scaleY:.75,ease:Elastic.easeOut})),u.insert(TweenMax.to(s,.35,{x:"+=700",ease:Back.easeIn,delay:3.7})),u.insert(TweenMax.to(a,.3,{scale:3,delay:0})),u.insert(TweenMax.to(a,.05,{alpha:.25,delay:0})),u.insert(TweenMax.to(a,.3,{alpha:0,delay:.07})),u.insert(TweenMax.to(h,.3,{scale:3,delay:.1})),u.insert(TweenMax.to(h,.05,{alpha:.25,delay:.1})),u.insert(TweenMax.to(h,.3,{alpha:0,delay:.17})),u.insert(TweenMax.to(l,.3,{scale:3,delay:.2})),u.insert(TweenMax.to(l,.05,{alpha:.25,delay:.2})),u.insert(TweenMax.to(l,.3,{alpha:0,delay:.27})),u.insert(TweenMax.from(c,.6,{scale:0,delay:.05})),u.insert(TweenMax.to(c,1.5,{rotation:90,delay:.05,ease:Linear.easeInOut})),u.insert(TweenMax.to(c,.2,{alpha:0,delay:1.3}))},i.prototype.showGoMessage=function(){function e(){n.destroy(),o.destroy(),r.destroy(),s.destroy(),a.destroy()}var i=this.globalStrings.game.messages.RaceGO,n=t.ScreenUtil.makeText(this.scene,"CountDownGo"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+10,style:i.style,text:i.value,shadow:!0,shadowColor:"#F3CC4E",shadowStrength:2,shadowOffsetX:3,shadowOffsetY:3}),o=t.ScreenUtil.makeText(this.scene,"CountDownGo"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+13,style:i.style,text:i.value,alpha:0}),r=t.ScreenUtil.makeText(this.scene,"CountDownGo"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+12,style:i.style,text:i.value,alpha:0}),s=t.ScreenUtil.makeText(this.scene,"CountDownGo"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+11,style:i.style,text:i.value,alpha:0}),a=t.ScreenUtil.makeImage(this.scene,"CountDownGoShine"+Math.round(1e5*Math.random()),"SelectGlow",{zIndex:this.zIndex+9,alpha:.75});a.centerX=this.width/2,a.centerY=this.height/2,n.left=this.width/2-n.width/2,n.top=this.height/2-n.height/2,n.registrationY=n.height/2,n.registrationX=n.width/2,o.left=r.left=s.left=n.left,o.top=r.top=s.top=n.top,o.registrationX=r.registrationX=s.registrationX=n.registrationX,o.registrationY=r.registrationY=s.registrationY=n.registrationY;var h=new TimelineMax({onComplete:function(){return e()}});h.insert(TweenMax.from(n,.5,{scaleX:0,scaleY:.75,ease:Elastic.easeOut})),h.insert(TweenMax.to(n,.35,{x:"+=700",ease:Back.easeIn,delay:.7})),h.insert(TweenMax.to(o,.3,{scale:3,delay:0})),h.insert(TweenMax.to(o,.05,{alpha:.25,delay:0})),h.insert(TweenMax.to(o,.3,{alpha:0,delay:.07})),h.insert(TweenMax.to(r,.3,{scale:3,delay:.1})),h.insert(TweenMax.to(r,.05,{alpha:.25,delay:.1})),h.insert(TweenMax.to(r,.3,{alpha:0,delay:.17})),h.insert(TweenMax.to(s,.3,{scale:3,delay:.2})),h.insert(TweenMax.to(s,.05,{alpha:.25,delay:.2})),h.insert(TweenMax.to(s,.3,{alpha:0,delay:.27})),h.insert(TweenMax.from(a,.6,{scale:0,delay:.05})),h.insert(TweenMax.to(a,1.5,{rotation:90,delay:.05,ease:Linear.easeInOut})),h.insert(TweenMax.to(a,.2,{alpha:0,delay:1.3}))},i.prototype.showCountdownNumber=function(e){function i(){n.destroy(),o.destroy()}var n=t.ScreenUtil.makeText(this.scene,"CountDownNumber"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+10,style:".screenFXCountdown",text:e.toString(),shadow:!0,shadowColor:"#F3CC4E",shadowStrength:2,shadowOffsetX:3,shadowOffsetY:3});n.left=this.width/2-n.width/2,n.top=this.height/2-n.height/2,n.registrationY=n.height/2,n.registrationX=n.width;var o=t.ScreenUtil.makeImage(this.scene,"CountDownShine"+Math.round(1e5*Math.random()),"TrackSelectGlow",{zIndex:this.zIndex+15,scale:.25});o.centerX=this.width/2-50,o.centerY=this.height/2-50;var r=new TimelineMax({onComplete:function(){return i()}});r.insert(TweenMax.from(n,.5,{scaleX:0,scaleY:.75,ease:Elastic.easeOut})),r.insert(TweenMax.to(n,.35,{x:"+=700",ease:Back.easeIn,delay:.7})),r.insert(TweenMax.from(o,.35,{alpha:0,scale:0,yoyo:!0,repeat:1})),r.insert(TweenMax.to(o,.6,{x:"+=75"}))},i.prototype.showMessage=function(e,i,n,o){function r(){s.destroy(),a.destroy()}var s=t.ScreenUtil.makeText(this.scene,"CountDownNumber"+Math.round(1e5*Math.random()),{zIndex:this.zIndex+34,style:e instanceof Object?e.style:".screenFXCountdown",text:e instanceof Object?e.value:e,shadow:!0,shadowColor:"#444444",shadowStrength:2,shadowOffsetX:3,shadowOffsetY:3});s.left=null!=i?i:this.width/2-s.width/2,s.top=null!=n?n:this.height/2-s.height/2,s.registrationY=s.height/2,s.registrationX=s.width;var a=t.ScreenUtil.makeImage(this.scene,"CountDownShine"+Math.round(1e5*Math.random()),"TrackSelectGlow",{zIndex:this.zIndex+35,scale:.25});a.centerX=null!=i?i:this.width/2-50,a.centerY=null!=n?n:this.height/2-50;var h=new TimelineMax({onComplete:function(){return r()}});h.insert(TweenMax.from(s,.5,{scaleX:0,scaleY:.75,ease:Elastic.easeOut})),h.insert(TweenMax.to(s,.35,{x:"+=700",ease:Back.easeIn,delay:.7+(o||0)})),h.insert(TweenMax.from(a,.35,{alpha:0,scale:0,yoyo:!0,repeat:1})),h.insert(TweenMax.to(a,.6,{x:"+=75"}))},i.prototype.showPreraceMessage=function(e,i){function n(){a.destroy(),s.destroy(),r.destroy()}"undefined"==typeof e&&(e=0);var o=this.globalStrings.game.messages[i],r=t.ScreenUtil.makeGroup(this.scene,"ScreenMessageBoxGroup",{zIndex:this.zIndex+10}),s=t.ScreenUtil.makeImage(this.scene,"ScreenBox","QueenBox",{zIndex:this.zIndex+10}),a=t.ScreenUtil.makeText(this.scene,"ScreenBoxText",{left:0,top:0,zIndex:this.zIndex+11,style:o.style,text:o.value,lineWidth:190});r.addChild(s),r.addChild(a),a.onTick(0),a.left=s.width/2-a.width/2-10,a.top=s.height/2-a.height/2+70,r.x=this.width/2-s.width/2,r.y=this.height/2-s.height/2,r.registrationX=s.width/2,r.registrationY=s.height/2,r.scale=1;var h=new TimelineMax({onComplete:function(){return n()}});h.insert(TweenMax.from(r,1,{scale:0,ease:Elastic.easeOut,delay:e})),h.insert(TweenMax.to(r,1,{y:"+=10",repeat:5,yoyo:!0,delay:1+e})),h.insert(TweenMax.to(r,1,{scale:.1,alpha:0,ease:Elastic.easeIn,delay:4+e}))},i.prototype.getAsset=function(t,e){return this.game.getAsset(t,e)},i.prototype.showText=function(e,n,o,r,s){function a(){l.removeChild(h),h.destroy()}"undefined"==typeof r&&(r=1),"undefined"==typeof s&&(s=i.SCALE_FADE);var h=t.ScreenUtil.makeText(this,"txt"+Math.round(1e3*Math.random()),{text:e,zIndex:this.zIndex+50});h.setStyle(".screenFX");var l=this;switch(s){case i.SCALE_FADE:TweenMax.to(h,r,{scale:2,alpha:0,onComplete:function(){return a()}});break;case i.FADE_INOUT:TweenMax.from(h,r/4,{alpha:0}),TweenMax.delayedCall(r/4*2,function(){TweenMax.to(h,r/4,{alpha:0,onComplete:function(){return a()}})})}h.x=n,h.y=o},i}(Avota.GameEntity);t.ScreenFX=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){this._gearbitCount=0,this.setDefinitions(t.GameData.getScoreData()),this._scoreList=[],this._activeMultipliers={}}return e.NAME="ScoreData",e.prototype.setDefinitions=function(t){this._scoreDefinitions=t.scoreDefinitions,this._scoreMultipliers=t.scoreMultipliers},e.prototype.logScore=function(t){this._scoreDefinitions[t]&&this._scoreList.push(t)},e.prototype.logGearbits=function(e){var i=t.GameData.getData("items")[e];i&&(this._gearbitCount+=i.value)},e.prototype.getGearbitCount=function(){return this._gearbitCount},e.prototype.logMultipier=function(t){this._scoreMultipliers[t]&&(this._activeMultipliers[t]=!0)},e.prototype.getBaseScore=function(){for(var t=0,e=0;e<this._scoreList.length;e++){var i=this._scoreList[e];t+=this._scoreDefinitions[i]}return 0>t&&(t=0),t},e.prototype.getTotalScore=function(){var t=this.getBaseScore();for(var e in this._activeMultipliers)this._activeMultipliers&&(t*=this._scoreMultipliers[e]);return t},e}();t.ScoreData=e;var i=function(){function t(){}return t.GET_POWERUP="getPowerUp",t.GET_GEARBIT1="getGearbit1",t.GET_GEARBIT2="getGearbit2",t.HIT_ENEMY="hitEnemy",t.HIT_OPPONENT="hitOpponent",t.DAMAGE_PENALTY="damagePenalty",t.HAZARD_PENALTY="hazardPenalty",t}();t.ScoreDefinition=i;var n=function(){function t(){}return t.FIRST_PLACE="firstPlace",t.SECOND_PLACE="secondPlace",t.THIRD_PLACE="thirdPlace",t.FORTH_PLACE="fourthPlace",t}();t.ScoreMultiplier=n}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){this._allies=[],this.eventSignal=new Avota.Signal,this._bonusSlots=[],this._bonusSlots.length=this.maxBonuses,this.setBonuses(),this.setTreasure()}return e.NAME="InventoryData",Object.defineProperty(e.prototype,"maxBonuses",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numAlliesUnlocked",{get:function(){var t=0;for(var e in this._allies)this._allies[e]&&t++;return t},enumerable:!0,configurable:!0}),e.prototype.unlockAlly=function(e){if(!this._allies[e]&&(this._allies[e]=!0,this.eventSignal.dispatch(i.ALLY_UNLOCKED,{ally:e}),3==this.numAlliesUnlocked))for(var n=this._bonusList.indexOf(t.GamePiece.KEY);-1!=n;)this._bonusList.splice(n,1),n=this._bonusList.indexOf(t.GamePiece.KEY)},e.prototype.isAllyUnlocked=function(t){return this._allies[t]===!0},e.prototype.setBonuses=function(){this._bonusList=t.GameData.getRandomizedBonusList({key:3==this.numAlliesUnlocked})},e.prototype.setTreasure=function(){this._treasureList=t.GameData.getRandomizedTreasureList()},e.prototype.hasBonusInSlot=function(t){return t<this._bonusSlots.length&&null!=this._bonusSlots[t]},e.prototype.hasBonus=function(t){return-1!=this._bonusSlots.indexOf(t)},e.prototype.getBonusInSlot=function(t){return this._bonusSlots[t]},e.prototype.getBonus=function(e){var n=this._bonusList.shift(),o=t.GameData.getData("bonuses")[n];this.eventSignal.dispatch(i.BONUS_GET,{bonus:n}),o.canStore?this.storeBonus(n,e):this.useBonus(n),0==this._bonusList.length&&this.setBonuses()},e.prototype.getTreasure=function(){var t=this._treasureList.shift();this.eventSignal.dispatch(i.TREASURE_GET,{treasure:t}),0==this._treasureList.length&&this.setTreasure()},e.prototype.storeBonus=function(t,e){for(var n=0;n<this.maxBonuses;n++)if(!this._bonusSlots[n]){this._bonusSlots[n]=t,this.eventSignal.dispatch(i.SLOT_FILLED,{bonus:t,slotIndex:n,sourceID:e});break}},e.prototype.useBonus=function(t){this.eventSignal.dispatch(i.BONUS_USE,{bonus:t})},e.prototype.useBonusInSlot=function(t){if(!(t>=this._bonusSlots.length)){var e=this._bonusSlots[t];this._bonusSlots[t]=null,this.useBonus(e),this.eventSignal.dispatch(i.SLOT_EMPTIED,{bonus:e,slotIndex:t})}},e}();t.InventoryData=e;var i=function(){function t(){}return t.BONUS_GET=0,t.BONUS_USE=1,t.SLOT_FILLED=2,t.SLOT_EMPTIED=3,t.ALLY_UNLOCKED=4,t.ALLY_UNLOCKABLE=5,t.ALLY_OFFSCREEN=6,t.TREASURE_GET=7,t}();t.InventoryEvent=i}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){}return e.NAME="GameData",e.BASE_FRAME_RATE=60,e.DEVICE_FRAME_RATE=60,Object.defineProperty(e,"FRAME_BUFFER",{get:function(){return e.BASE_FRAME_RATE/e.DEVICE_FRAME_RATE},enumerable:!0,configurable:!0}),e.setup=function(t){for(var i=t.getAsset("GameConfig"),n=t.getAsset("SpriteConfig"),o=t.config,r={},s=i.tracks,a=0;a<s.length;a++){var h=t.getAsset(s[a]);h&&(r[s[a]]=h)}e._tracks=r,e._gameData=i,e._spriteData=n,e._vehicleList=[],e._characterList=[],e._trackList=[],e._upgradeList=[],e._bonusList=[],e._dataLists={},e._version=o.version;for(var l in e._gameData.vehicles)e._vehicleList.push(l);for(var l in e._gameData.characters)e._characterList.push(l);for(var l in e._gameData.upgrades)e._upgradeList.push(l);for(var l in e._gameData.bonuses)e._bonusList.push(l);for(var l in r)e._trackList.push(l)},e.getVersionNumber=function(){return e._version},e.getData=function(t){return e._gameData[t]},e.getDataList=function(t){if(!e._dataLists[t]){var i=[];for(var n in e._gameData[t])i.push(n);e._dataLists[t]=i}return e._dataLists[t]},e.getVehicleData=function(t){return e._gameData.vehicles[t]},e.getVehicleList=function(){return e._vehicleList},e.getSelectableVehicleList=function(){for(var t=[],i=e.getVehicleList(),n=0;n<i.length;n++){var o=e.getVehicleData(i[n]);o.selectable&&t.push(i[n])}return t},e.getCharacterData=function(t){return e._gameData.characters[t]},e.getCharacterList=function(){return e._characterList},e.getStarsForScore=function(t,i){for(var n=e.getTrackData(i),o=0,r=0;3>r&&t>=n.scoring[r];r++)o++;return o},e.getSelectableCharacterList=function(){for(var t=[],i=e.getCharacterList(),n=0;n<i.length;n++){var o=e.getCharacterData(i[n]);o.selectable&&t.push(i[n])}return t},e.getTrackData=function(t){return e._tracks[t]},e.getTrackList=function(){return e._trackList},e.getScoreData=function(){return e._gameData.scoring},e.getUpgradeData=function(){return e._gameData.upgrades},e.getSortedUpgradeList=function(t,i){var n=[];for(var o in e._gameData.upgrades){var r=e._gameData.upgrades[o];r[t]==i&&n.push(o)}return n},e.getUpgradeList=function(){return e._upgradeList},e.getBonusList=function(){return e._bonusList},e.getSpriteConfig=function(){return e._spriteData},e.getOpponentData=function(t){return e._gameData.opponents[t]},e.getAttackData=function(t){return e._gameData.attacks[t]},e.framesToSeconds=function(t){return t*(1e3/60)*e.FRAME_BUFFER},e.formatTimeFromFrames=function(t,i){"undefined"==typeof i&&(i=!1);var n=e.framesToSeconds(t),o=Math.floor(n%1e3/10),r=Math.floor(n/1e3)%60,s=Math.floor(n/1e3/60),a="";return a+=10>s?"0"+s:""+s,a+=":",a+=10>r?"0"+r:""+r,i&&(a+=".",a+=10>o?"0"+o:""+o),a},e.getRandomizedBonusList=function(t){for(var i=[],n=e.getBonusList(),o=0;o<n.length;o++)if(!t||!t[n[o]])for(var r=e.getData("bonuses")[n[o]],s=0;s<r.encounter;s++)i.push(n[o]);return i=Avota.ArrayUtil.randomize(i)},e.getRandomizedTreasureList=function(){for(var t=[],i=e.getDataList("treasure"),n=0;n<i.length;n++)for(var o=e.getData("treasure")[i[n]],r=0;r<o.encounter;r++)t.push(i[n]);return t=Avota.ArrayUtil.randomize(t)},e.getVehicleStatScale=function(t,i,n){var o=e.getVehicleStat(t,i,n),r=e.getData("maxStats")[t]||1;return o/r},e.getVehicleStat=function(t,i,n){var o=e.getVehicleData(i),r=o[t]||0;if(n)for(var s=0;s<n.length;s++){var a=n[s],h=e.getUpgradeData()[a];h&&h.vehicle==i&&h.stats&&h.stats[t]&&(r+=h.stats[t])}return r},e.getDisplayIDForVehicleCombo=function(t,i){var n=e.getVehicleData(t),o="";o+=n.code,o+="_";for(var r="",s="",a=0;a<i.length;a++){var h=i[a],l=e.getUpgradeData()[h];l.vehicle==t&&("special"==l.type&&(r=l.code),"performance"==l.type&&(s=l.code))}return o+=r,o+="_",o+=s},e.getAssetListForVehicleCombo=function(t,i,n){for(var o=[],r=e.getSpriteConfig(),s=e.getDisplayIDForVehicleCombo(i,n),a=r.displayDefinitions[s],h={},l=0;l<a.data.length;l++){for(var c,u=a.data[l],p=0;p<r.animations.length;p++)if(r.animations[p].name==u){c=r.animations[p];break}if(c)for(var p=0;p<r.spritesheets.length;p++)if(r.spritesheets[p].name==c.spritesheet&&!h[r.spritesheets[p].name]){h[r.spritesheets[p].name]=!0,o.push(r.spritesheets[p].image),o.push(r.spritesheets[p].json);break}}return o},e.reloadTrack=function(i){function n(){e.setup(o);var i=o.sceneManager._state;i&&i.setScene(t.SuperChargersLevel)}for(var o=Avota.Context.getContext(t.SuperChargersGame.NAME),r=o.config.resources,s=0;s<r.length;s++){var a=r[s];if(a.name==i)try{o.resourceManager.unload(o.resourceManager.getResource(a.path)),o.resourceManager.load(a.path),o.resourceManager.completeSignal.addOnce(n,this)}catch(h){console.error(h)}}},e.reloadSpriteData=function(){function i(){e.setup(n);var i=n.sceneManager._state;i&&i.setScene(t.SuperChargersLevel)}for(var n=Avota.Context.getContext(t.SuperChargersGame.NAME),o=n.config.resources,r=0;r<o.length;r++){var s=o[r];if("SpriteConfig"==s.name)try{n.resourceManager.unload(n.resourceManager.getResource(s.path)),n.resourceManager.load(s.path),n.resourceManager.completeSignal.addOnce(i,this)}catch(a){console.error(a)}}},e.endRace=function(){var e=Avota.Context.getContext(t.SuperChargersGame.NAME),i=e.get("SuperChargersLevel");i.world.eventSignal.dispatch(t.EventSignals.RACE_END)},e.reloadGameData=function(){function i(){e.setup(n);var i=n.sceneManager._state;i&&i.setScene(t.SuperChargersLevel)}for(var n=Avota.Context.getContext(t.SuperChargersGame.NAME),o=n.config.resources,r=0;r<o.length;r++){var s=o[r];if("GameConfig"==s.name)try{n.resourceManager.unload(n.resourceManager.getResource(s.path)),n.resourceManager.load(s.path),n.resourceManager.completeSignal.addOnce(i,this)}catch(a){console.error(a)}}},e}();t.GameData=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function t(){}return t.NAME="SpriteConfig",t.setup=function(e){t.spriteData=e},t.getDisplayDefinition=function(e){return t.spriteData.displayDefinitions[e]},t.makeSpriteSheet=function(e,i){var n=t.getSpriteSheetData(i);return e.get(i)||e.create(Avota.SpriteSheet,e.getAsset(n.sheet),e.getAsset(n.json),i)},t.getAnimationData=function(e){return t._search("name",e,t.spriteData.animations)},t.getImageData=function(e){return t._search("name",e,t.spriteData.images)},t.getSpriteSheetData=function(e){return t._search("name",e,t.spriteData.spritesheets)},t._search=function(t,e,i){for(var n=0;n<i.length;n++){var o=i[n];if(o[t]&&o[t]===e)return o}},t}();t.SpriteConfig=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){}return e.NAME="PlayerData",e._activeUpgrades=[],e._raceResults={},e.instructionsFlag=!0,e.setup=function(){e._upgradeInventory={},e._trackStats=[],e._currency=0,e.reload()},e.hasSavedData=function(){var t=Avota.CookieUtil.read("playerdatascgame2");return t&&""!=t},e.save=function(){Avota.CookieUtil.write("playerdatascgame2",e.encode())},e.reload=function(){var t=Avota.CookieUtil.read("playerdatascgame2");t&&""!=t&&e.decode(t)},e.deleteAll=function(){Avota.CookieUtil.remove("playerdatascgame2")},e.validateSaveData=function(){var i=Avota.CookieUtil.read("playerdatascgame2");if(!i||""==i)return!1;var n=e.decodeURLSafeBase64(i),o=n.split("|"),r=o[0];return r!=t.GameData.getVersionNumber()?(e.deleteAll(),!1):!0},e.encode=function(){var i="";i+=t.GameData.getVersionNumber()+"|",i+=e._selectedCharacter+"|",i+=e._selectedVehicle+"|",i+=e._selectedTrack+"|",i+=e._currency.toString()+"|";for(var n in e._upgradeInventory){var o=e._upgradeInventory[n];i+=n+":"+o.active.toString()+";"}i+="|";for(var n in e._trackStats){var r=e._trackStats[n];i+=n+":"+r.unlocked+","+r.highScore+","+r.bestTime+","+r.frameCount+";"}return e.encodeURLSafeBase64(i)},e.encodeURLSafeBase64=function(t){var e=window.LZString.compressToBase64(t);return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},e.decodeURLSafeBase64=function(t){t=(t+"===").slice(0,t.length+t.length%4);var e=t.replace(/-/g,"+").replace(/_/g,"/");return window.LZString.decompressFromBase64(e)},e.decode=function(i){var n=e.decodeURLSafeBase64(i),o=n.split("|"),r=o[0];if(r==t.GameData.getVersionNumber()){e._selectedCharacter=o[1],e._selectedVehicle=o[2],e._selectedTrack=o[3],e._currency=parseInt(o[4]),e._upgradeInventory={};for(var s=o[5].split(";"),a=0;a<s.length;a++){var h=s[a].split(":");if(h&&1!=h.length){var l=h[0],c="true"==h[1],u={};u.active=c,e._upgradeInventory[l]=u}}e._activeUpgrades=[];for(var p in e._upgradeInventory)e._upgradeInventory[p].active&&e._activeUpgrades.push(p);e._trackStats={};for(var d=o[6].split(";"),a=0;a<d.length;a++){var h=d[a].split(":");if(h&&1!=h.length){var l=h[0],f=h[1].split(","),_="true"==f[0],g=parseInt(f[1]),m=parseInt(f[2]),y=parseInt(f[3]),v={};v.unlocked=_,v.highScore=g,v.bestTime=m,v.frameCount=y,e._trackStats[l]=v}}}},e.purchase=function(i){var n=t.GameData.getUpgradeData()[i];n&&e.canAfford(i)&&(e.deductCurrency(n.cost),e.unlockUpgrade(i))},e.logTracks=function(t){for(var i=0;i<t.length;i++){var n=t[i];if(!e._trackStats[n]){var o={};o.unlocked=0==i,o.highScore=0,o.bestTime=0,o.frameCount=0,e._trackStats[n]=o}}},e.selectTrack=function(i){var n=t.GameData.getTrackData(i);n&&(e._selectedTrack=i)},e.getSelectedTrack=function(){return e._selectedTrack},e.getDataForTrack=function(t){return e._trackStats[t]},e.clearTrackData=function(t){var i={};i.unlocked=e._trackStats[t].unlocked,i.highScore=0,i.bestTime=0,i.frameCount=0,e._trackStats[t]=i},e.isTrackUnlocked=function(t){return e._trackStats[t].unlocked},e.unlockTrack=function(t,i){"undefined"==typeof i&&(i=!0);var n=e._trackStats[t];n&&(n.unlocked=!0)},e.unlockNextTrack=function(){for(var i=t.GameData.getTrackList(),n=0;n<i.length;n++){var o=i[n];if(!e.isTrackUnlocked(o))return void e.unlockTrack(o)}},e.recordTrackStats=function(t,i,n){var o=e._trackStats[t];o&&(i>o.highScore&&(o.highScore=i),(0==o.bestTime||n<o.bestTime)&&(o.bestTime=n))},e.recordRaceResults=function(t){var i=e._raceResults;i.time=t.raceEndFrame-t.raceStartFrame,i.score=t.scoreData.getTotalScore(),i.gearbits=t.scoreData.getGearbitCount(),i.trackID=e.getSelectedTrack();for(var n=t.getEntitiesInCategory("racers"),o=[],r=0;r<n.length;r++){var s,a=t.getEntity(n[r]),h={};switch(a.id){case"player":s=e.getSelectedCharacter(),1==a.place&&(i.placed=!0);break;case"rival":s=e.getRivalCharacter(1);break;default:s=e.getRivalCharacter(2)}h.id=a.id,h.characterID=s,h.time=a.getEndFrame("raceEnd")-t.raceStartFrame,o.push(h)}o.sort(function(t,e){return t.time<e.time?-1:t.time>e.time?1:0}),i.charData=o},e.getRaceResults=function(){return e._raceResults},e.unlockUpgrade=function(i,n){"undefined"==typeof n&&(n=!0);var o=e._upgradeInventory,r=t.GameData.getUpgradeData();r[i]&&(o[i]={active:!1},n&&e.toggleUpgrade(i,!0))},e.toggleUpgrade=function(i,n){var o=e._upgradeInventory,r=t.GameData.getUpgradeData(),s=r[i];if(o[i]){if(n)for(var a in o){var h=r[a];a==i?o[a].active=!0:h.type==s.type&&h.vehicle==s.vehicle&&(o[a].active=!1)}else o[i].active=!1;e._activeUpgrades=[];for(var a in o)o[a].active&&e._activeUpgrades.push(a)}},e.getActiveUpgradeForVehicle=function(i,n){for(var o,r=0;r<e.getActiveUpgrades().length;r++)if(o=e.getActiveUpgrades()[r],t.GameData.getUpgradeData()[o].type==n&&t.GameData.getUpgradeData()[o].vehicle==i)return o;return null},e.getActiveUpgrades=function(){return e._activeUpgrades},e.isUpgradeUnlocked=function(t){var i=e._upgradeInventory;return null!=i[t]},e.isUpgradeActive=function(t){var i=e._upgradeInventory;return i[t]&&i[t].active},e.selectVehicle=function(i){var n=t.GameData.getVehicleData(i);n&&n.selectable&&(e._selectedVehicle=i)},e.getSelectedVehicle=function(){return e._selectedVehicle},e.selectCharacter=function(i){var n=t.GameData.getCharacterData(i);
n&&n.selectable&&(e._selectedCharacter=i)},e.getSelectedCharacter=function(){return e._selectedCharacter},e.hasSuperChargedCombo=function(){var i=t.GameData.getCharacterData(e.getSelectedCharacter());return i.comboVehicle==e.getSelectedVehicle()},e.getRivalCharacter=function(i){"undefined"==typeof i&&(i=1);for(var n=t.GameData.getSelectableCharacterList(),o="char_chompy",r=1,s=0;s<n.length;s++)if(n[s]!=e._selectedCharacter){if(0==i||r==i){o=n[s];break}r++}return o},e.getRivalVehicle=function(i){"undefined"==typeof i&&(i=1);for(var n,o=t.GameData.getSelectableVehicleList(),r=1,s=0;s<o.length;s++)if(o[s]!=e._selectedVehicle){if(0==i||r==i){n=o[s];break}r++}return n},e.getCharIDForEntity=function(t){var i="";switch(t){case"player":i=e.getSelectedCharacter();break;case"rival":i=e.getRivalCharacter();break;default:i=e.getRivalCharacter(2)}return i},e.getVehicleIDForEntity=function(t){var i="";switch(t){case"player":i=e.getSelectedVehicle();break;case"rival":i=e.getRivalVehicle();break;default:i=e.getRivalVehicle(2)}return i},e.executeCommand=function(i,n){switch(i){case"unlock":var o=(e._upgradeInventory,t.GameData.getUpgradeData());if("string"==typeof n){if("all"==n)for(var r in o)e.unlockUpgrade(r)}else for(var s=0;s<n.length;s++)e.unlockUpgrade(n[s])}},e.addCurrency=function(t){e._currency+=t},e.deductCurrency=function(t){e._currency-=t,e._currency<0&&(e._currency=0)},e.getCurrency=function(){return e._currency},e.canAfford=function(i){var n=t.GameData.getUpgradeData()[i];return n.cost<=e._currency},e}();t.PlayerData=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){this.inputs={},this.minSwipeDistance=100,this.swipeWindow=Math.round(40/t.GameData.FRAME_BUFFER),this.elapsed=0,this.currentDistance=0,this.currTouchPoint=new Avota.Point,this.setupTouchQueue()}return e.NAME="TouchInput",e.INPUT_FIRE="fire",e.INPUT_FIRE2="fire2",e.INPUT_RIGHT="right",e.INPUT_LEFT="left",e.INPUT_BRAKE="brake",e.INPUT_ACCEL="accel",e.prototype.setupTouchQueue=function(){this.touchQueue=[];for(var e=0;e<t.GameData.DEVICE_FRAME_RATE;e++){var i={};i.point=new Avota.Point,i.touchDown=!1,this.touchQueue.push(i)}},e.prototype.onTouchMove=function(t,e,i){var n=this.touchQueue[0];n.point.x=e,n.point.y=i,this.checkGestures()},e.prototype.onTouchDown=function(t,e,i){var n=this.touchQueue[0];n.point.x=e,n.point.y=i,n.touchDown=!0,this.checkGestures()},e.prototype.onTouchUp=function(t,e,i){var n=this.touchQueue[0];n.point.x=e,n.point.y=i,n.touchDown=!1,this.clearSwipe()},e.prototype.detectGestures=function(t){this.elapsed+=1e3*t;var e=this.touchQueue.pop(),i=this.touchQueue[0];e.point.x=i.point.x,e.point.y=i.point.y,e.touchDown=i.touchDown,this.touchQueue.unshift(e),e.touchDown||this.clearSwipe()},e.prototype.checkGestures=function(){for(var t=this.touchQueue[0],e=(this.touchQueue[this.swipeWindow],!0),i=0;i<this.swipeWindow;i++){var n=this.touchQueue[i];if(!n.touchDown){e=!1,this.clearSwipe();break}var o=n.point.x-t.point.x;if(Math.abs(o)>this.minSwipeDistance){this.onSwipe(o>0?1:-1);break}}},e.prototype.onSwipe=function(t){console.log("SWIPE!",t>0?"left":"right"),t>0?this.inputs[e.INPUT_LEFT]=!0:0>t&&(this.inputs[e.INPUT_RIGHT]=!0)},e.prototype.hasInput=function(t){return this.inputs[t]},e.prototype.clearSwipe=function(){this.inputs[e.INPUT_LEFT]=!1,this.inputs[e.INPUT_RIGHT]=!1},e.prototype.onPressFire=function(){this.inputs[e.INPUT_FIRE]=!0},e.prototype.onReleaseFire=function(){this.inputs[e.INPUT_FIRE]=!1},e.prototype.onPressFire2=function(){this.inputs[e.INPUT_FIRE2]=!0},e.prototype.onReleaseFire2=function(){this.inputs[e.INPUT_FIRE2]=!1},e.prototype.onPressAccel=function(){this.inputs[e.INPUT_ACCEL]=!0},e.prototype.onReleaseAccel=function(){this.inputs[e.INPUT_ACCEL]=!1},e.prototype.onPressBrake=function(){this.inputs[e.INPUT_BRAKE]=!0},e.prototype.onReleaseBrake=function(){this.inputs[e.INPUT_BRAKE]=!1},e}();t.TouchInput=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(t){this._tweenTypes={"Power4.easeIn":Power4.easeIn,"Power4.easeInOut":Power4.easeInOut,"Bounce.easeOut":Bounce.easeOut,"Bounce.easeIn":Bounce.easeIn,"Bounce.easeInOut":Bounce.easeInOut,"Back.easeIn":Back.easeIn,"Back.easeOut":Back.easeOut,"Back.easeInOut":Back.easeInOut,"Elastic.easeIn":Elastic.easeIn,"Elastic.easeOut":Elastic.easeOut,"Elastic.easeInOut":Elastic.easeInOut,"Linear.easeIn":Linear.easeIn,"Linear.easeOut":Linear.easeOut,"Linear.easeInOut":Linear.easeInOut},this.prebuild=!1,this.destroyOnExit=!0,this._menu=t}return e.NAME="MenuController",e.prototype.buttonHandler=function(t,e){switch(e){case Avota.Button.OVER:this._menu.buttonSFX.over&&this._menu.soundManager.playSound(this._menu.buttonSFX.over);break;case Avota.Button.DOWN:this._menu.buttonSFX.down&&this._menu.soundManager.playSound(this._menu.buttonSFX.down);break;case Avota.Button.UP:this._menu.buttonSFX.up&&this._menu.soundManager.playSound(this._menu.buttonSFX.up),this.executeCommandsFor(t.name);break;case Avota.Button.OUT:}},e.prototype.executeCommandsFor=function(t){var e=this._menu.getAsset("ScreenConfig"),i=e.commands[this._menu.activeScreen];if(i)for(var n=0;n<i.length;n++){var o=i[n];o.name==t&&this.executeCommand(o)}},e.prototype.executeCommand=function(t){var e=this._menu.getCommands(this._menu.activeScreen),i=this._menu.getCommands("default");if(e)for(var n=0;n<e.length;n++){var o=e[n],r=o.execute(t);if(r)return void(t.sfx&&this._menu.soundManager.playSound(t.sfx))}for(var n=0;n<i.length;n++){var o=i[n],r=o.execute(t);if(r)return void(t.sfx&&this._menu.soundManager.playSound(t.sfx))}console.warn("Failed to execute command:",t.command,"for screen",this._menu.activeScreen)},e.prototype.addElements=function(t){var e=this._menu.globalStrings;for(var i in t){{var n=t[i];e.screens[i]}this._menu.menuData[i]={},this._menu.elements[i]=n,this.prebuild&&this.buildElements(i)}},e.prototype.buildElements=function(e){var i=this._menu.globalStrings,n=this._menu.elements[e],o=i.screens[e],r=this._menu.getMenuDataForScreen(e);if(!r._built){t.ScreenUtil.buildElements(this._menu,n,o);for(var s=0;s<n.length;s++){var a=n[s],h=this._menu.get(a.name);h&&(h.visible=!1,h.zIndex+=this._menu.baseZIndex)}this._menu.localizeButtons(i.buttons),r._built=!0}},e.prototype.removeElements=function(t){for(var e=this._menu.elements[t],i=this._menu.getMenuDataForScreen(t),n=0;n<e.length;n++){var o=e[n],r=this._menu.get(o.name);r&&(TweenMax.killTweensOf(r),r.removeAllChildren(),r.destroy())}i._built=!1},e.prototype.hideAll=function(){for(var t in this._menu.elements){var e=this._menu.elements[t],i=this._menu.getMenuDataForScreen(t);if(i._built)for(var n=0;n<e.length;n++){var o=e[n],r=this._menu.get(o.name);r&&(r.visible=!1)}}},e.prototype.setGlobalZIndex=function(t){this._menu.baseZIndex=t;var e=this._menu.elements[this._menu.activeScreen];if(e)for(var i=0;i<e.length;i++){var n=e[i],o=this._menu.get(n.name);o&&(o.zIndex=(n.params?n.params.zIndex||0:0)+t)}},e.prototype.showScreen=function(t,e){var i=this;if(null!=this._menu.activeScreen&&""!=this._menu.activeScreen)return void this.exitScreen(this._menu.activeScreen,function(){return i.showScreen(t,e)});var n=this._menu.getAsset("ScreenConfig"),o=(this._menu.elements[t],n.transitions.enter[t]),r=n.transitions.idle[t],s=this,a=function(){s._menu.enableButtons(),r&&s.transitionScreen(r),s.executeCommandsFor("start"),e&&e()};this.buildElements(t),this._menu.activeScreen=t,this._menu.disableButtons(),this.resetPositions(!0),this.executeCommandsFor("enter"),o?this.transitionScreen(o,function(){return a()}):a()},e.prototype.exitScreen=function(t,e){var i=this._menu.getAsset("ScreenConfig"),n=(this._menu.elements[this._menu.activeScreen],i.transitions.exit[this._menu.activeScreen]),o=this,r=function(){o.executeCommandsFor("exit"),o.resetPositions(!1),o.destroyOnExit&&o.removeElements(o._menu.activeScreen),o._menu.activeScreen="",e&&e()};this._menu.disableButtons(),this.executeCommandsFor("end"),n?this.transitionScreen(n,function(){return r()}):r()},e.prototype.transitionScreen=function(t,e){for(var i=function(){e&&e()},n=new TimelineMax({onComplete:function(){return i()}}),o=0;o<t.length;o++){var r=t[o],s=this._menu.get(r.name);if(s)for(var a=0;a<r.tweens.length;a++){var h=r.tweens[a],l={};for(var c in h.params)l[c]="ease"==c?this._tweenTypes[h.params[c]]:h.params[c];n.insert(TweenMax[h.type](s,h.time,l))}}},e.prototype.resetPositions=function(t,e,i){"undefined"==typeof i&&(i=!0);this._menu.getAsset("ScreenConfig");e=e||this._menu.elements[this._menu.activeScreen];for(var n=function(e,i){e.shadow=!0,e.visible=i,e.active=t},o=0,r=0;r<e.length;r++){var s=e[r],a=this._menu.get(s.name);if(a&&(a.set(s.params),i&&(a.zIndex+=this._menu.baseZIndex),null!=t))if("TextGraphic"==Avota.ClassUtil.getClassName(a)){var h=a;if(h.shadow&&1==t){h.shadow=!1;var l=[h,t];TweenMax.delayedCall(3*o,n,l,null,!0)}else h.shadow=!1,h.visible=t,h.active=t;o++}else a.visible=t,a.active=t}},e.prototype.resetImage=function(t){for(var e=(this._menu.getAsset("ScreenConfig"),this._menu.elements[this._menu.activeScreen]),i=0;i<e.length;i++){var n=e[i];if(n.name==t){var o=this._menu.get(n.name);if(!o)break;o.set(n.params),o.zIndex+=this._menu.baseZIndex;break}}},e}();t.MenuController=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(t){this.menu=t}return e.NAME="MenuCommands",e.COMMANDS_MODULE="Skylanders",e.COMMAND_AUTOLOAD=!0,e.SCREENS=["default"],e.prototype.execute=function(t){return this[t.command]?(this[t.command](t),!0):!1},e.prototype.showScreen=function(t){this.menu.controller.showScreen(t.args.screen)},e.prototype.setScene=function(e){var i=this;this.menu.disableButtons(),this.menu.endBGM();var n=e.args.args?e.args.args.concat():[];n.unshift(t[e.args.scene]),this.menu.transitionOut(Avota.CSSColor.BLACK,1,Avota.Transition.TYPE_FADE,Avota.Transition.OUT,null,0,function(){return i.menu.setScene.apply(i.menu,n)},null,null)},e}();t.MenuCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(){e.call(this,Avota.Context.getContext(t.SuperChargersGame.NAME),t.SuperChargersGame.NAME,Avota.Context.getContext(t.SuperChargersGame.NAME).config,Avota.Context.getContext(t.SuperChargersGame.NAME).strings.screens.GameMenu),this.activeScreen="",this.buttonSFX={},this.baseZIndex=0,this.menuData={},this.elements={},this.controller=new t.MenuController(this),this.setupCommands(),this._requests={}}return __extends(i,e),i.NAME="Menu",Object.defineProperty(i.prototype,"game",{get:function(){return this._game},enumerable:!0,configurable:!0}),i.prototype.localizeButtons=function(t){for(var e=this.getByType(Avota.Button),i=0,n=e.length;n>i;i++)for(var o=0,r=t.length;r>o;o++)e[i].name.match(t[o].name)&&(e[i].textLabel.text=t[o].value,t[o].style&&e[i].textLabel.setStyle(t[o].style))},i.prototype.enableButton=function(t,i){"undefined"==typeof i&&(i=1);var n=t.alpha;e.prototype.enableButton.call(this,t,i);var o=(this.getAsset("ScreenConfig"),this.elements[this.activeScreen]),r=!1;if(o)for(var s=0;s<o.length;s++){var a=o[s];if(a.name==t.name){r=!0;break}}t.visible=r,t.alpha=n},i.prototype.disableButton=function(t,i){"undefined"==typeof i&&(i=1),e.prototype.disableButton.call(this,t,t.alpha)},i.prototype.setupCommands=function(){var e=window[t.MenuCommands.COMMANDS_MODULE];this._commands={},this._defaultCommands=new t.MenuCommands(this);for(var i in e){var n=e[i];if(n.COMMAND_AUTOLOAD)for(var o=new n(this),r=0;r<n.SCREENS.length;r++){var s=n.SCREENS[r];this.addCommands(o,s)}}},i.prototype.addCommands=function(t,e){this._commands[e]||(this._commands[e]=[]),this._commands[e].push(t)},i.prototype.getCommands=function(t){return this._commands[t]},i.prototype.setDefaultCommand=function(t){this._defaultCommands=t},i.prototype.getActiveMenuData=function(){return this.menuData[this.activeScreen]},i.prototype.getMenuDataForScreen=function(t){return this.menuData[t]},i.prototype.setRequest=function(t,e,i){var n={};n.call=e,n.context=i,this._requests[t]=n},i.prototype.setupBaseElements=function(e){this.menuBaseElements=e,t.ScreenUtil.buildElements(this,this.menuBaseElements)},i.prototype.sendRequest=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];var n=this._requests[t];return n?void n.call.apply(n.context,e):void console.error("Cannot complete request. Request:",t,"doesn't exist")},i.prototype.setButtonSFX=function(t,e,i){this.buttonSFX.up=t||this.buttonSFX.up,this.buttonSFX.down=i||this.buttonSFX.down,this.buttonSFX.over=e||this.buttonSFX.over},i.prototype.startBGM=function(t,e){"undefined"==typeof e&&(e=!1),this.bgm=t||this.bgm,this.soundManager.isSoundPlaying(this.bgm)||this.soundManager.playSound(t,e)},i.prototype.endBGM=function(){this.soundManager.stopSound(this.bgm,!0)},i.prototype.destroy=function(){TweenMax.killAll(),e.prototype.destroy.call(this)},i}(Avota.Screen);t.Menu=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(n,o,r){"undefined"==typeof r&&(r=i.NAME),e.call(this,n,o,r),this.activeScreen="",this.buttonSFX={},this.baseZIndex=0,this.menuData={},this.elements={},this.controller=new t.MenuController(this),this.setupCommands(),this._requests={}}return __extends(i,e),i.NAME="MenuOverlay",Object.defineProperty(i.prototype,"game",{get:function(){return this._scene._game},enumerable:!0,configurable:!0}),i.prototype.localizeButtons=function(t){for(var e=this.getByType(Avota.Button),i=0,n=e.length;n>i;i++)for(var o=0,r=t.length;r>o;o++)e[i].name.match(t[o].name)&&(e[i].textLabel.text=t[o].value,t[o].style&&e[i].textLabel.setStyle(t[o].style))},i.prototype.getAsset=function(t){return this._scene.getAsset(t)},i.prototype.setScene=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];e.unshift(t),this._scene.setScene.apply(this._scene,e)},i.prototype.enableButton=function(t,i){"undefined"==typeof i&&(i=1);var n=t.alpha;e.prototype.enableButton.call(this,t,i);var o=this.elements[this.activeScreen],r=!1;if(o)for(var s=0;s<o.length;s++){var a=o[s];if(a.name==t.name){r=!0;break}}t.visible=r,t.alpha=n},i.prototype.disableButton=function(t,i){"undefined"==typeof i&&(i=1),e.prototype.disableButton.call(this,t,t.alpha)},i.prototype.showOverlay=function(t,i,n){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=.5),e.prototype.showOverlay.call(this,t,!1,n),this.controller.hideAll()},i.prototype.hideOverlay=function(t,i,n){"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=.5),e.prototype.hideOverlay.call(this,t,!1,n)},i.prototype.setupCommands=function(){var e=window[t.MenuCommands.COMMANDS_MODULE];this._commands={},this._defaultCommands=new t.MenuCommands(this);for(var i in e){var n=e[i];if(n.COMMAND_AUTOLOAD)for(var o=new n(this),r=0;r<n.SCREENS.length;r++){var s=n.SCREENS[r];this.addCommands(o,s)}}},i.prototype.addCommands=function(t,e){this._commands[e]||(this._commands[e]=[]),this._commands[e].push(t)},i.prototype.getCommands=function(t){return this._commands[t]},i.prototype.setDefaultCommand=function(t){this._defaultCommands=t},i.prototype.getActiveMenuData=function(){return this.menuData[this.activeScreen]},i.prototype.getMenuDataForScreen=function(t){return this.menuData[t]},i.prototype.setupBaseElements=function(e){this.menuBaseElements=e,t.ScreenUtil.buildElements(this,this.menuBaseElements)},i.prototype.setRequest=function(t,e,i){var n={};n.call=e,n.context=i,this._requests[t]=n},i.prototype.sendRequest=function(t){for(var e=[],i=0;i<arguments.length-1;i++)e[i]=arguments[i+1];var n=this._requests[t];return n?void n.call.apply(n.context,e):void console.error("Cannot complete request. Request:",t,"doesn't exist")},i.prototype.setButtonSFX=function(t,e,i){this.buttonSFX.up=t||this.buttonSFX.up,this.buttonSFX.down=i||this.buttonSFX.down,this.buttonSFX.over=e||this.buttonSFX.over},i.prototype.startBGM=function(t,e){"undefined"==typeof e&&(e=!1),this.bgm=t||this.bgm,this.soundManager.isSoundPlaying(this.bgm)||this.soundManager.playSound(t,e)},i.prototype.endBGM=function(){this.soundManager.stopSound(this.bgm,!0)},i}(Avota.GameUIOverlay);t.MenuOverlay=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(t){function e(i){t.call(this,i,i.strings.screens.PreloadScreen,e.NAME)}return __extends(e,t),e.NAME="SuperChargersLoader",e.prototype._createLoader=function(){this._game.width/2,this._game.height/2;this.screenWidth=this._game.width,this.screenHeight=this._game.height;var t=(this.makeImage("ActivisionLogo","LogoActivision",{zIndex:2,x:84,y:250}),this.makeImage("JetMorganLogo","LogoJetMorgan",{zIndex:2,x:567,y:250}),this.create(Avota.ImageSprite,this._game.timeManager,this._game.renderManager,this._game.spatialManager,null,"LoaderGroup")),e=this.makeImage("LoaderBox","LoaderBox",{zIndex:2,x:0,y:0}),i=this.makeImage("BarBG","LoaderBarBG",{zIndex:3,x:0,y:18}),n=this.makeImage("LoaderBar","LoaderBar",{zIndex:4,x:0,y:20}),o=this.makeText("Loading",{zIndex:5});o.text=this._game.strings.screens.PreloadScreen[0].value,o.setStyle(this._game.strings.screens.PreloadScreen[0].style),o.onTick(0);var r=this.makeText("Copyright",{zIndex:5,lineWidth:400});r.text=this._game.strings.screens.PreloadScreen[1].value,r.setStyle(this._game.strings.screens.PreloadScreen[1].style),r.onTick(0),t.x=this.screenWidth/2-e.width/2,n.x=e.width/2-n.width/2-1,i.x=e.width/2-i.width/2,o.x=e.width/2-o.width/2,r.x=e.width/2-r.width/2,o.y=-45,r.y=150,t.addChild(e),t.addChild(i),t.addChild(n),t.addChild(o),t.addChild(r),t.y=448,n.registrationX=0,n.registrationY=n.height/2,this.loaderBar=n,this.barWidth=n.width;this.makeImage("LoaderBG","LoaderBG",{zIndex:1})},e.prototype._onProgressUpdate=function(t,e){this.loaderBar.scaleX=t/e},e.prototype.makeText=function(t,e){var i=this.create(Avota.TextGraphic,this._game.timeManager,this._game.renderManager,null,t),n={};for(var o in e)n[o]=e[o];return n.active=null==e.active||e.active,n.visible=null==e.visible||e.visible,i.set(n),i},e.prototype.makeSingleFrameSprite=function(t,e,i,n){var o=this.create(Avota.SpriteSheet,this._game.getAsset(e+"Image",this._game.config.loader),this._game.getAsset(e+"Data",this._game.config.loader)),r=this.create(Avota.SingleFrameGraphic,this._game.timeManager,this._game.renderManager,o,i,t),s={};for(var a in n)s[a]=n[a];return s.active=null==n.active||n.active,s.visible=null==n.visible||n.visible,r.set(s),r},e.prototype.makeRect=function(t,e,i,n,o){var r=this.create(Avota.RectSprite,this._game.timeManager,this._game.renderManager,this._game.spatialManager,i,n,e,t),s={};for(var a in o)s[a]=o[a];return s.active=null==o.active||o.active,s.visible=null==o.visible||o.visible,r.set(s),null!=o.x&&(r.x=o.x),null!=o.y&&(r.y=o.y),r},e.prototype.makeImage=function(t,e,i){var n=this.create(Avota.ImageGraphic,this._game.timeManager,this._game.renderManager,this._game.getAsset(e,this._game.config.loader),t),o={};for(var r in i)o[r]=i[r];return o.active=null==i.active||i.active,o.visible=null==i.visible||i.visible,n.set(o),n},e}(Avota.GameLoader);t.SuperChargersLoader=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this),this.nodeList=[],this.enteredSignal.addOnce(this.onEnter,this),this._startScreen=t}return __extends(i,e),i.NAME="GameMenu",i.prototype.onEnter=function(){this.setupBaseElements(this.getAsset("ScreenConfig").menus.GameMenu),this._startScreen||(this._startScreen=this.getAsset("ScreenConfig").startScreen),this.controller.addElements(this.getAsset("ScreenConfig").screens),this.onComplete(),this.setButtonSFX(null,"SUIMouseOver"),this._menuOverlay=this.create(t.GameMenuOverlay,this),this.buttonSignal.add(this.controller.buttonHandler,this.controller),this.setRequest("showPurchaseConfirm",this.showPurchaseConfirm,this);this.create(t.ScreenFX,this,this.timeManager,this.renderManager,this.globalStrings,this.screenWidth,this.screenHeight);"TitleScreen"!=this._startScreen&&this.controller.transitionScreen(this.getAsset("ScreenConfig").transitions.idle.GameMenu),"EndScreen"!=this._startScreen&&this.startBGM("BGMMenu")},i.prototype.onMove=function(){},i.prototype.onDown=function(t,e,i,n){console.log("input down",e,i,n)},i.prototype.onUp=function(e,i,n,o){console.log("input up",i,n,o),this.nodeList.push({x:i,y:n}),t.ScreenUtil.makeRect(this,"node"+this.nodeList.length,"#00FF00",5,5,{zIndex:22,x:i,y:n})},i.prototype.printNodeList=function(){var t="";t+='"mapNodeList" : [';for(var e=0;e<this.nodeList.length;e++){var i=this.nodeList[e];t+="\n",t+="{ ",t+='"x" : ',t+=i.x+", ",t+='"y" : ',t+=i.y,t+="}",e!=this.nodeList.length-1&&(t+=",")}t+="\n",t+="]",console.log(t)},i.prototype.loadAssets=function(){for(var e=t.ScreenUtil.getAssetListForElements(this.elements),i=[],n=this._game.config.resources,o=0;o<n.length;o++){for(var r=n[o],s=0;s<e.length;s++)r.name!=e[s]||this.resourceManager.isLoaded(r.path)||i.push(r.path);r.autoload&&!this.resourceManager.isLoaded(r.path)&&i.push(r.path)}0==i.length?this.onComplete():(this.controller.showScreen(this.getAsset("ScreenConfig").loadingScreen),this.resourceManager.loadItems(i),this.resourceManager.completeSignal.addOnce(this.onComplete,this))},i.prototype.onComplete=function(){this.controller.showScreen(this._startScreen||this.getAsset("ScreenConfig").startScreen)},i.prototype.unloadAssets=function(){for(var e=t.PlayerData.getSelectedCharacter(),i=t.PlayerData.getSelectedVehicle(),n=t.PlayerData.getActiveUpgrades(),o=t.PlayerData.getRivalCharacter(),r=t.PlayerData.getRivalVehicle(),s=t.GameData.getOpponentData("rival").upgrades,a=t.GameData.getAssetListForVehicleCombo(e,i,n),h=t.GameData.getAssetListForVehicleCombo(o,r,s),l=[],c=this._game.config.resources,u=0;u<c.length;u++){for(var p=c[u],d=0;d<a.length;d++)p.name==a[d]&&l.push(p.path);for(var d=0;d<h.length;d++)p.name==h[d]&&l.push(p.path)}for(var u=0;u<l.length;u++){var f=l[u];this.resourceManager.unload(this.resourceManager.getResource(f))}},i.prototype.showPurchaseConfirm=function(t,e,i){this._menuOverlay.showPurchaseConfirm(t,e,i)},i}(t.Menu);t.GameMenu=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t,t.globalStrings.ui.overlays.ResultsOverlay,i.NAME);var n=this.getAsset("ScreenConfig"),o={};o.PauseScreen=n.overlays.PauseScreen,o.HowToPlayScreen=n.screens.HowToPlayScreen,o.HowToPlayScreen2=n.screens.HowToPlayScreen2,o.ResultsOverlay=n.overlays.ResultsOverlay,o.ConfirmOverlay=n.overlays.ConfirmOverlay,o.PurchaseConfirmOverlay=n.overlays.PurchaseConfirmOverlay,this.setButtonSFX(null,"SUIMouseOver"),this.setupBaseElements(n.menus.GameMenuOverlay),this.controller.prebuild=!1,this.controller.destroyOnExit=!0,this.controller.addElements(o),this.setRequest("hideOverlay",this.hideOverlay,this),this.buttonSignal.add(this.controller.buttonHandler,this.controller),this.controller.setGlobalZIndex(2e3),this.bgm="BGMLevel"}return __extends(i,e),i.NAME="ResultsOverlay",i.prototype.showOverlayTransition=function(){var t=this.getAsset("ScreenConfig"),e=t.transitions.idle.GameMenuOverlay;e&&(this.controller.resetPositions(!0,t.menus.GameMenuOverlay,!1),this.controller.transitionScreen(e))},i.prototype.showPurchaseConfirm=function(t,e,i){var n=this.menuData.PurchaseConfirmOverlay;n.upgradeID=t,n.onConfirm=e,n.onDecline=i;this.showOverlay(),this.showOverlayTransition(),this.controller.showScreen("PurchaseConfirmOverlay")},i.prototype.showPauseScreen=function(t){this.showOverlay();var e=this.getMenuDataForScreen("PauseScreen");e.onResume=t,this.showOverlayTransition(),this.controller.showScreen("PauseScreen"),this.soundManager.playSound("SUIPause")},i.prototype.showResultsScreen=function(){var e=t.PlayerData.getRaceResults(),i=this.getMenuDataForScreen("ResultsOverlay");for(var n in e)i[n]=e[n];this.showOverlay(),this.showOverlayTransition(),this.controller.showScreen("ResultsOverlay")},i}(t.MenuOverlay);t.GameMenuOverlay=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="ReadyScreenCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["ReadyScreen"],i.prototype.startReadyScreen=function(){var e=this,i=(this.menu.menuData[this.menu.activeScreen],this.menu.get("PlayButtonRS"),this.menu.getAsset("SpriteConfig"),t.PlayerData.getSelectedCharacter(),t.PlayerData.getSelectedVehicle(),t.PlayerData.getActiveUpgrades(),t.PlayerData.getRivalCharacter(),t.PlayerData.getRivalVehicle(),t.GameData.getOpponentData("rival").upgrades,t.PlayerData.getSelectedTrack()),n=t.PlayerData.getDataForTrack(i),o=t.GameData.getTrackData(i),r=this.menu.get("HighScore");r.text=0==n.highScore?Avota.NumberUtil.addLeadingZeros(n.highScore,6,!0):Avota.NumberUtil.addCommas(n.highScore);for(var s=0;s<o.scoring.length;s++){var a=this.menu.get("GoalScore"+(s+1));a.text=Avota.NumberUtil.addCommas(o.scoring[s])}for(var h=t.GameData.getStarsForScore(n.highScore,i),s=0;3>s;s++){var l=s+1,c=this.menu.get("ReadyScreenStarWhite"+l),u=this.menu.get("ReadyScreenStarBlack"+l);c.alpha=0,u.alpha=0,h>=l?c.alpha=1:u.alpha=1}TweenMax.delayedCall(.2,function(){return e.onLoad()})},i.prototype.onLoad=function(){var t=this,e=this.menu.get("PlayButtonRS"),i=this.menu.get("ReadyScreenLoading");this.menu.controller.resetImage(e.name),TweenMax.killTweensOf(i),i.alpha=0,e.alpha=1,TweenMax.killTweensOf(e),TweenMax.from(e,.3,{x:"+=500",onComplete:function(){return t.menu.enableButtons()}})},i}(t.MenuCommands);t.ReadyScreenCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="UpgradeScreenCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["UpgradeScreen"],i.prototype.startUpgradeScreen=function(){var e=this.menu.menuData[this.menu.activeScreen],i=t.PlayerData.getSelectedVehicle(),n=t.GameData.getVehicleData(i),o=(t.GameData.getSortedUpgradeList("vehicle",i),t.GameData.getUpgradeData(),this.menu.get("UpgradeVehicleGroup")),r=this.menu.get("USTextBehind");Avota.EnvUtil.isMobile&&(r.scale=4,r.x+=r.width/4+50,r.y+=r.height/4+20),e.numItems=8,e.inputComponents={},e.inputEnabled=!1;var s=this.menu.create(t.VehicleSprite,this.menu.timeManager,this.menu.renderManager,this.menu.spatialManager,"UpgradeVehicle");s.setup(),s.showVehicle(i,t.PlayerData.getActiveUpgrades()),s.set({zIndex:5,x:0,y:0,visible:!0}),o.addChild(s);var a=this.menu.get("UpgradeVehicleIcon1")||t.ScreenUtil.makeImage(this.menu,"UpgradeVehicleIcon1",n.icon,{zIndex:8}),h=this.menu.get("UpgradeVehicleIcon2")||t.ScreenUtil.makeImage(this.menu,"UpgradeVehicleIcon2",n.icon,{zIndex:8}),l=this.menu.get("IconGroupUVehicle1"),c=this.menu.get("IconGroupUVehicle2");l.addChild(a),c.addChild(h);var u=this.menu.get("UpgradeVehclName");u.text=String(this.menu.globalStrings.game.vehicles[i]).toUpperCase(),u.onTick(0),u.top=u.lines.length>1?u.top-u.lineHeight/2:u.top;var p=this.menu.get("CurrencyAmount");p.text=Avota.NumberUtil.addCommas(t.PlayerData.getCurrency()),this.updateScreen(),e.performance=t.PlayerData.getActiveUpgradeForVehicle(i,"performance"),e.specialty=t.PlayerData.getActiveUpgradeForVehicle(i,"special"),this.previewStats();for(var d=0;d<e.numItems;d++){var f=this.menu.create(Avota.InputComponent,this.menu.inputManager),_=this.menu.get("ItemHit"+(d+1));e.inputComponents[_.name]=f,f.inputUp.add(this.clickUpgrade,this),f.inputOver.add(this.overUpgrade,this),f.inputOut.add(this.outUpgrade,this),_.addComponent(f,Avota.EngineConstants.INPUT)}TweenMax.delayedCall(1.7,function(){e.inputEnabled=!0})},i.prototype.endUpgradeScreen=function(){var t=this.menu.menuData[this.menu.activeScreen];for(var e in t.inputComponents){var i=this.menu.get(e),n=t.inputComponents[e];i.removeComponent(n),n.destroy()}},i.prototype.exitUpgradeScreen=function(){var e=this.menu.menuData[this.menu.activeScreen],i=this.menu.get("UpgradeVehicleGroup"),n=this.menu.get("UpgradeVehicle");i.removeAllChildren(),n.visible=!1,n.destroy(),t.PlayerData.save(),e.inputComponents=null},i.prototype.overUpgrade=function(e){var i=this.menu.menuData[this.menu.activeScreen],n=t.PlayerData.getSelectedVehicle();if(i.inputEnabled){var o=t.GameData.getSortedUpgradeList("vehicle",n),r=parseInt(e.name.match(/\d+/)[0]),s=o[r-1],a=this.menu.get("ItemGroup"+r),h=t.GameData.getUpgradeData()[s];t.PlayerData.isUpgradeUnlocked(s)&&!t.PlayerData.isUpgradeActive(s)&&(a.scale=1,TweenMax.killTweensOf(a),TweenMax.to(a,.1,{scale:1.05}),this.menu.soundManager.playSound("SUIMouseOver")),t.PlayerData.isUpgradeActive(s)||("special"==h.type?(i.specialty=s,i.performance=t.PlayerData.getActiveUpgradeForVehicle(n,"performance")):(i.performance=s,i.specialty=t.PlayerData.getActiveUpgradeForVehicle(n,"special")),this.previewStats())}},i.prototype.outUpgrade=function(e){var i=this.menu.menuData[this.menu.activeScreen],n=t.PlayerData.getSelectedVehicle();if(i.inputEnabled){var o=t.GameData.getSortedUpgradeList("vehicle",n),r=parseInt(e.name.match(/\d+/)[0]),s=o[r-1],a=this.menu.get("ItemGroup"+r);t.PlayerData.isUpgradeUnlocked(s)&&!t.PlayerData.isUpgradeActive(s)&&(TweenMax.killTweensOf(a),TweenMax.to(a,.1,{scale:1})),i.performance=t.PlayerData.getActiveUpgradeForVehicle(n,"performance"),i.specialty=t.PlayerData.getActiveUpgradeForVehicle(n,"special"),this.previewStats()}},i.prototype.clickUpgrade=function(e){var i=this,n=this.menu.menuData[this.menu.activeScreen],o=t.PlayerData.getSelectedVehicle();if(n.inputEnabled){var r=t.GameData.getSortedUpgradeList("vehicle",o),s=parseInt(e.name.match(/\d+/)[0]),a=r[s-1],h=t.GameData.getUpgradeData()[a],l=!1,c=this.menu.get("ItemGroup"+s);n.selectedUpgradeIndex=s-1,t.PlayerData.isUpgradeUnlocked(a)?t.PlayerData.isUpgradeActive(a)||(this.menu.soundManager.playSound("SUIUpgradeApply"),t.PlayerData.toggleUpgrade(a,!0),t.PlayerData.save(),this.updateScreen(),h.vo&&this.menu.soundManager.playSound(h.vo),l=!0):t.PlayerData.canAfford(a)?(this.menu.soundManager.playSound("SUIMouseOver"),n.inputEnabled=!1,this.menu.disableButtons(),this.menu.sendRequest("showPurchaseConfirm",a,function(){return i.onConfirm()},function(){return i.onDecline()}),l=!0):(this.menu.controller.resetImage(c.name),TweenMax.killTweensOf(c),TweenMax.to(c,.05,{x:"+=3",yoyo:!0,repeat:5,ease:Back.easeInOut}),this.menu.soundManager.playSound("SUIPurchaseFail")),c.scale=1,l&&(TweenMax.killTweensOf(c),TweenMax.to(c,.1,{scale:.95,yoyo:!0,repeat:1}))}},i.prototype.onConfirm=function(){var e=this.menu.menuData[this.menu.activeScreen],i=t.PlayerData.getSelectedVehicle(),n=t.GameData.getSortedUpgradeList("vehicle",i),o=e.selectedUpgradeIndex+1,r=n[o-1],s=t.GameData.getUpgradeData()[r];t.PlayerData.purchase(r),this.menu.enableButtons(),s.vo&&this.menu.soundManager.playSound(s.vo),e.inputEnabled=!0,t.PlayerData.save(),this.updateScreen()},i.prototype.onDecline=function(){var t=this.menu.menuData[this.menu.activeScreen];this.menu.enableButtons(),t.inputEnabled=!0},i.prototype.showStats=function(){var e=(this.menu.menuData[this.menu.activeScreen],t.PlayerData.getSelectedVehicle()),i=this.menu.get("UpgradeScreenStatsAmount1"),n=this.menu.get("UpgradeScreenStatsAmount2"),o=this.menu.get("UpgradeScreenStatsAmount3"),r=this.menu.get("UpgradeScreenStatsAmount4"),s=this.menu.get("UpgradeScreenStatsAmount5"),a=t.GameData.getVehicleStatScale("maxHP",e,t.PlayerData.getActiveUpgrades()),h=t.GameData.getVehicleStatScale("maxSpeed",e,t.PlayerData.getActiveUpgrades()),l=t.GameData.getVehicleStatScale("accel",e,t.PlayerData.getActiveUpgrades()),c=t.GameData.getVehicleStatScale("turnSpeed",e,t.PlayerData.getActiveUpgrades()),u=t.GameData.getVehicleStatScale("weight",e,t.PlayerData.getActiveUpgrades()),p=.5;TweenMax.killTweensOf(i),TweenMax.killTweensOf(n),TweenMax.killTweensOf(o),TweenMax.killTweensOf(r),TweenMax.killTweensOf(s),TweenMax.to(i,p,{scaleX:a}),TweenMax.to(n,p,{scaleX:h}),TweenMax.to(o,p,{scaleX:l}),TweenMax.to(r,p,{scaleX:c}),TweenMax.to(s,p,{scaleX:u})},i.prototype.previewStats=function(){var e=this.menu.menuData[this.menu.activeScreen],i=t.PlayerData.getSelectedVehicle(),n=[e.specialty,e.performance],o=this.menu.get("UpgradeScreenStatsPreview1"),r=this.menu.get("UpgradeScreenStatsPreview2"),s=this.menu.get("UpgradeScreenStatsPreview3"),a=this.menu.get("UpgradeScreenStatsPreview4"),h=this.menu.get("UpgradeScreenStatsPreview5"),l=t.GameData.getVehicleStatScale("maxHP",i,n),c=t.GameData.getVehicleStatScale("maxSpeed",i,n),u=t.GameData.getVehicleStatScale("accel",i,n),p=t.GameData.getVehicleStatScale("turnSpeed",i,n),d=t.GameData.getVehicleStatScale("weight",i,n);
o.scaleX=l,r.scaleX=c,s.scaleX=u,a.scaleX=p,h.scaleX=d},i.prototype.updateScreen=function(){for(var e=this.menu.menuData[this.menu.activeScreen],i=t.PlayerData.getSelectedVehicle(),n=(t.GameData.getVehicleData(i),t.GameData.getSortedUpgradeList("vehicle",i)),o=t.GameData.getUpgradeData(),r=0;r<e.numItems;r++){var s=r+1,a=this.menu.get("UpgradeScreenCheck"+s),h=this.menu.get("UpgradeScreenLock"+s),l=this.menu.get("UpgradeScreenGearbitSmall"+s),c=this.menu.get("UpgradeScreenBarActive"+s),u=this.menu.get("UpgradeScreenBarInactive"+s),p=this.menu.get("IconNodeItem"+s),d=this.menu.get("UNameText"+s),f=this.menu.get("UPriceText"+s),_=n[r],g=o[_];if(a.alpha=t.PlayerData.isUpgradeActive(_)?1:0,c.alpha=t.PlayerData.isUpgradeUnlocked(_)?1:0,h.alpha=t.PlayerData.isUpgradeUnlocked(_)?0:1,u.alpha=t.PlayerData.isUpgradeUnlocked(_)?0:1,f.alpha=t.PlayerData.isUpgradeUnlocked(_)?0:1,l.alpha=t.PlayerData.isUpgradeUnlocked(_)?0:1,d.text=String(this.menu.globalStrings.game.upgrades[_]),f.text=Avota.NumberUtil.addCommas(g.cost),p.removeAllChildren(),this.menu.get("UpgradeIcon"+s)){var m=this.menu.get("UpgradeIcon"+s);m.destroy()}if(g.icon){var y=t.ScreenUtil.makeImage(this.menu,"UpgradeIcon"+s,g.icon,{zIndex:10});p.addChild(y)}}var v=this.menu.get("CurrencyAmount");v.text=Avota.NumberUtil.addCommas(t.PlayerData.getCurrency());var b=this.menu.get("UpgradeVehicle");b.showVehicle(t.PlayerData.getSelectedVehicle(),t.PlayerData.getActiveUpgrades());var C=this.menu.get("UpgradeVehicle");C.alpha=1,C.y=0,TweenMax.killTweensOf(C),TweenMax.from(C,.3,{y:"-=50",alpha:0}),this.showStats()},i}(t.MenuCommands);t.UpgradeScreenCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="LevelSelectCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["TrackSelectScreen"],i.prototype.startLevelSelect=function(){var e=this.menu.menuData[this.menu.activeScreen],i=this.menu.get("TrackSelectHitArea1"),n=this.menu.get("TrackSelectHitArea2"),o=this.menu.get("TrackSelectHitArea3"),r=t.GameData.getTrackList();t.PlayerData.selectTrack(r[0]);for(var s=r.length-1;s>=0;s--){var a=r[s];if(t.PlayerData.isTrackUnlocked(a)){t.PlayerData.selectTrack(a);break}}if(this.updateScreen(),!e.inputComponents){e.inputComponents={};var h=i.create(Avota.InputComponent,this.menu.inputManager),l=n.create(Avota.InputComponent,this.menu.inputManager),c=o.create(Avota.InputComponent,this.menu.inputManager);e.inputComponents.TrackSelectHitArea1=h,e.inputComponents.TrackSelectHitArea2=l,e.inputComponents.TrackSelectHitArea3=c,e.inputEnabled=!1,TweenMax.delayedCall(1,function(){e.inputEnabled=!0});var u=function(){},p=function(i){if(e.inputEnabled){var n,o=1;o=i.name.match("1")?1:i.name.match("2")?2:3;var s=t.PlayerData.getDataForTrack(r[o-1]);if(s.unlocked){t.PlayerData.selectTrack(r[o-1]);for(var a=0;3>a;a++){var h=this.menu.get("TrackSelectCheck"+(a+1));h.alpha=o-1==a?1:0}this.menu.soundManager.playSound("SUIUnlock"),n=this.menu.get("LevelGroup"+o),n.scale=1,TweenMax.killTweensOf(n),TweenMax.to(n,.15,{scale:.95,yoyo:!0,repeat:1})}}};for(var d in e.inputComponents){var f=e.inputComponents[d];f.inputDown.add(u,this),f.inputUp.add(p,this),this.menu.get(d).addComponent(f,Avota.EngineConstants.INPUT)}}},i.prototype.clearProgress=function(e){var i=t.GameData.getTrackList(),n=e.args.index;t.PlayerData.clearTrackData(i[n]),t.PlayerData.save(),this.updateScreen()},i.prototype.updateScreen=function(){for(var e=t.GameData.getTrackList(),i=0;3>i;i++){var n=(this.menu.get("LevelGroup"+(i+1)),this.menu.get("TrackSelectCheck"+(i+1))),o=this.menu.get("TrackSelectLock"+(i+1)),r=this.menu.get("TrackSelectGlow"+(i+1)),s=this.menu.get("TrackScore"+(i+1)),a=this.menu.get("TrackTime"+(i+1)),h=t.PlayerData.getDataForTrack(e[i]);o.alpha=h.unlocked?0:1,r.alpha=h.unlocked?1:0,r.rotation=0,n.alpha=t.PlayerData.getSelectedTrack()==e[i]?1:0,s.text=0==h.highScore?Avota.NumberUtil.addLeadingZeros(0,6,!0):Avota.NumberUtil.addCommas(h.highScore),a.text=t.GameData.formatTimeFromFrames(h.bestTime),TweenMax.killTweensOf(r),TweenMax.to(r,29,{rotation:"+=360",repeat:-1,ease:Power0.easeInOut});for(var l=t.GameData.getStarsForScore(h.highScore,e[i]),c=0;3>c;c++){var u=c+1,p=(this.menu.get("StarGroup"+(i+1)),this.menu.get("StarGroup"+(i+1)+"White"+u)),d=this.menu.get("StarGroup"+(i+1)+"Black"+u);p.alpha=0,d.alpha=0,l>=u?p.alpha=1:d.alpha=1}}},i.prototype.gotoNextScreen=function(e){this.menu.getActiveMenuData();this.menu.controller.showScreen(t.PlayerData.instructionsFlag?"HowToPlayScreen":e.args.screen)},i.prototype.exitLevelSelect=function(){var e=this.menu.menuData[this.menu.activeScreen],i=this.menu.get("TrackSelectHitArea1"),n=this.menu.get("TrackSelectHitArea2"),o=this.menu.get("TrackSelectHitArea3"),r=e.inputComponents.TrackSelectHitArea1,s=e.inputComponents.TrackSelectHitArea2,a=e.inputComponents.TrackSelectHitArea3;i.removeComponent(r),n.removeComponent(s),o.removeComponent(a),r.destroy(),s.destroy(),a.destroy(),e.inputComponents=null,t.PlayerData.save()},i}(t.MenuCommands);t.LevelSelectCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="VehicleSelectCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["VehicleSelectScreen"],i.prototype.startSelectScreen=function(){var e=this,i=this.menu.menuData[this.menu.activeScreen],n=t.GameData.getSelectableCharacterList(),o=t.GameData.getSelectableVehicleList(),i=this.menu.menuData[this.menu.activeScreen],r=this.menu.get("CharName"),s=this.menu.get("VehclName"),a=this.menu.get("CharDesc"),h=this.menu.get("VehicleDesc"),l=this.menu.get("StarBanner"),c=this.menu.get("StarBannerGlow"),u=this.menu.get("SelectGlowChar"),p=this.menu.get("SelectGlowVehcl"),d=this.menu.get("ComboText"),f=this.menu.get("VSpriteGroup"),_=this.menu.get("VSTextBehind1"),g=this.menu.get("VSTextBehind2"),m=this.menu.get("IconGroupChar1"),y=this.menu.get("IconGroupChar2"),v=this.menu.get("IconGroupVehicle1"),b=this.menu.get("IconGroupVehicle2"),C=this.menu.get("SuperChargedAnim1"),S=this.menu.get("SuperChargedAnim2");l.alpha=0,c.alpha=0,d.alpha=0,u.alpha=0,p.alpha=0,u.rotation=0,p.rotation=0,C.alpha=0,S.alpha=0,Avota.EnvUtil.isMobile&&(C.scale=4,S.scale=4,_.scale=4,g.scale=4,C.x+=C.width/4+50,C.y+=C.height/4+20,S.x+=S.width/4+50,S.y+=S.height/4+20,_.x+=_.width/4+50,_.y+=_.height/4+20,g.x+=g.width/4+50,g.y+=g.height/4+20),TweenMax.killTweensOf(u),TweenMax.killTweensOf(p),TweenMax.to(u,29,{rotation:360,repeat:-1,ease:Power0.easeInOut}),TweenMax.to(p,20,{rotation:360,repeat:-1,ease:Power0.easeInOut}),i.characterIndex=0,i.vehicleIndex=0;for(var E=0;E<n.length;E++)i[n[E]]={},i[n[E]].voIndex=0,n[E]==t.PlayerData.getSelectedCharacter()&&(i.characterIndex=E);for(var E=0;E<o.length;E++)o[E]==t.PlayerData.getSelectedVehicle()&&(i.vehicleIndex=E);for(var E=0;E<n.length;E++){var A=t.GameData.getCharacterData(n[E]),x=this.menu.get(A.image),O=this.menu.get(n[E]+A.icon+"1")||t.ScreenUtil.makeImage(this.menu,A.icon+"1",A.icon,{zIndex:10}),M=this.menu.get(n[E]+A.icon+"2")||t.ScreenUtil.makeImage(this.menu,A.icon+"2",A.icon,{zIndex:10});m.addChild(O),y.addChild(M),i.characterIndex!=E&&(x.alpha=0,O.alpha=0,M.alpha=0)}for(var E=0;E<o.length;E++){var T=t.GameData.getVehicleData(o[E]),O=t.ScreenUtil.makeImage(this.menu,o[E]+T.icon+"1",T.icon,{zIndex:10}),M=t.ScreenUtil.makeImage(this.menu,o[E]+T.icon+"2",T.icon,{zIndex:10}),P=this.menu.create(t.VehicleSprite,this.menu.timeManager,this.menu.renderManager,this.menu.spatialManager,T.image);P.zIndex=10,P.setup(),P.showVehicle(o[E],t.PlayerData.getActiveUpgrades()),v.addChild(O),b.addChild(M),f.addChild(P),i[P.name]={x:P.x,y:P.y,scale:P.scale},i.vehicleIndex!=E&&(P.alpha=0,O.alpha=0,M.alpha=0)}r.text=String(this.menu.globalStrings.game.characters[n[i.characterIndex]]).toUpperCase(),s.text=String(this.menu.globalStrings.game.vehicles[o[i.vehicleIndex]]).toUpperCase(),a.text=String(this.menu.globalStrings.game.descriptions[n[i.characterIndex]]),h.text=String(this.menu.globalStrings.game.descriptions[o[i.vehicleIndex]]),r.onTick(0),s.onTick(0),a.onTick(0),h.onTick(0),r.top=r.lines.length>1?r.top-r.lineHeight/2:r.top,s.top=s.lines.length>1?s.top-s.lineHeight/2:s.top;var w=t.GameData.getSelectableVehicleList()[i.vehicleIndex],I=t.GameData.getCharacterData(t.GameData.getSelectableCharacterList()[i.characterIndex]);if(I.comboVehicle==w){this.menu.controller.resetImage(l.name),this.menu.controller.resetImage(c.name),this.menu.controller.resetImage(d.name),l.alpha=1,c.alpha=0,c.scale=1,d.alpha=1,u.alpha=1,p.alpha=1;var D=new TimelineMax({onComplete:function(){return e.menu.enableButtons()}});D.insert(TweenMax.from(u,.4,{alpha:0,scale:.5})),D.insert(TweenMax.from(p,.4,{alpha:0,scale:.5})),D.insert(TweenMax.from(l,.4,{alpha:0,scale:1.5,delay:.2,ease:Power4.easeIn})),D.insert(TweenMax.from(d,.4,{alpha:0,scale:1.5,delay:.2,ease:Power4.easeIn})),D.insert(TweenMax.to(c,.01,{alpha:1,delay:.6})),D.insert(TweenMax.to(c,.4,{alpha:0,scale:1.5,delay:.62}))}},i.prototype.exitVehicleSelect=function(){for(var e=t.GameData.getSelectableVehicleList(),i=0;i<e.length;i++){var n=this.menu.get(t.GameData.getVehicleData(e[i]).image);n.destroy()}t.PlayerData.save()},i.prototype.change=function(e){var i=this,n=this.menu.menuData[this.menu.activeScreen],o=e.args.category,r="vehicle"==o?t.GameData.getSelectableVehicleList():t.GameData.getSelectableCharacterList(),s="vehicle"==o?n.vehicleIndex:n.characterIndex,a=this.menu.get("vehicle"==o?"VehclName":"CharName"),h=this.menu.get("vehicle"==o?"VehicleDesc":"CharDesc"),l=this.menu.get("IconGroup"+("vehicle"==o?"Vehicle":"Char")+"1"),c=this.menu.get("IconGroup"+("vehicle"==o?"Vehicle":"Char")+"2"),u=this.menu.get("StarBanner"),p=this.menu.get("StarBannerGlow"),d=this.menu.get("ComboText"),f=this.menu.get("SelectGlowChar"),_=this.menu.get("SelectGlowVehcl"),g=this.menu.get("SuperChargedAnim1"),m=this.menu.get("SuperChargedAnim2"),y=this.menu.get("VSScreenGroup");u.alpha=0,p.alpha=0,d.alpha=0,f.alpha=0,_.alpha=0,g.alpha=0,m.alpha=0;var v="vehicle"==o?t.GameData.getVehicleData(r[s]):t.GameData.getCharacterData(r[s]);s+=e.args.increment,s>=r.length&&(s=0),0>s&&(s=r.length-1);var b="vehicle"==o?t.GameData.getVehicleData(r[s]):t.GameData.getCharacterData(r[s]);"vehicle"==o?t.PlayerData.selectVehicle(r[s]):t.PlayerData.selectCharacter(r[s]);var C=this.menu.get(v.image),S=this.menu.get(b.image);S.alpha=1,S.scale=1;for(var E=0;E<l._children.length;E++){var A=l._children[E];A.alpha=A.name.match(b.icon)?1:0}for(var E=0;E<c._children.length;E++){var A=c._children[E];A.alpha=A.name.match(b.icon)?1:0}var x=function(){n[C.name]?C.set(n[C.name]):this.menu.controller.resetImage(v.image),this.menu.enableButtons()},O=new TimelineMax({onComplete:x.bind(this)});O.insert(TweenMax.from(S,.4,{x:"-="+100*e.args.increment,scale:.75,alpha:0})),O.insert(TweenMax.from(a,.4,{alpha:0})),O.insert(TweenMax.from(h,.4,{alpha:0})),O.insert(TweenMax.from(l,.4,{x:"-=50",alpha:0})),O.insert(TweenMax.from(c,.4,{x:"+=50",alpha:0})),O.insert(TweenMax.to(C,.4,{x:"+="+100*e.args.increment,scale:.75,alpha:0})),this.menu.disableButtons(),"vehicle"==o?n.vehicleIndex=s:n.characterIndex=s;var M;M=b.selectVO;var T;"character"==o&&(T=b.banterVO),this.menu.soundManager.playSound(M),n.banterCall&&TweenMax.killTweensOf(n.banterCall.target),T&&(n.banterCall=TweenMax.delayedCall(1,function(){return i.menu.soundManager.playSound(T)})),this.menu.controller.resetImage(a.name),a.text=String(this.menu.globalStrings.game[o+"s"][r[s]]).toUpperCase(),a.onTick(0),a.top=a.lines.length>1?a.top-a.lineHeight/2:a.top,this.menu.controller.resetImage(h.name),h.text=String(this.menu.globalStrings.game.descriptions[r[s]]),h.onTick(0);var P=t.GameData.getSelectableVehicleList()[n.vehicleIndex],w=t.GameData.getCharacterData(t.GameData.getSelectableCharacterList()[n.characterIndex]);w.comboVehicle==P&&(this.menu.controller.resetImage(u.name),this.menu.controller.resetImage(p.name),this.menu.controller.resetImage(d.name),u.alpha=1,p.alpha=0,p.scale=1,d.alpha=1,f.alpha=1,_.alpha=1,g.alpha=1,m.alpha=1,TweenMax.killTweensOf(g),TweenMax.killTweensOf(m),O.insert(TweenMax.from(f,.2,{alpha:0,scale:.5,delay:.5,ease:Power4.easeIn})),O.insert(TweenMax.from(_,.2,{alpha:0,scale:.5,delay:.5,ease:Power4.easeIn})),O.insert(TweenMax.from(g,.2,{alpha:0,delay:.5,ease:Power4.easeIn})),O.insert(TweenMax.from(m,.2,{alpha:0,delay:.5,ease:Power4.easeIn})),TweenMax.to(g,1.2,{alpha:0,delay:1.5,ease:Power4.easeIn}),TweenMax.to(m,1.2,{alpha:0,delay:1.5,ease:Power4.easeIn}),O.insert(TweenMax.from(u,.4,{alpha:0,scale:1.5,delay:.2,ease:Power4.easeIn})),O.insert(TweenMax.from(d,.4,{alpha:0,scale:1.5,delay:.2,ease:Power4.easeIn})),O.insert(TweenMax.to(p,.01,{alpha:1,delay:.6})),O.insert(TweenMax.to(p,.4,{alpha:0,scale:1.5,delay:.62})),O.insert(TweenMax.to(y,.025,{y:"+=5",delay:.62,yoyo:!0,repeat:17,ease:Back.easeInOut})),O.insert(TweenMax.delayedCall(.6,function(){return i.menu.soundManager.playSound("VOSuperCharged")})),O.insert(TweenMax.delayedCall(.4,function(){return i.menu.soundManager.playSound("SUISuperCharged")})))},i}(t.MenuCommands);t.VehicleSelectCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="PurchaseConfirmCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["PurchaseConfirmOverlay"],i.prototype.startPurchaseConfirm=function(){var e=this.menu.menuData[this.menu.activeScreen],i=t.GameData.getUpgradeData()[e.upgradeID];if(i){var n=this.menu.get("PConfirmImageGroup"),o=this.menu.get("PConfirmItemCost"),r=this.menu.get("PConfirmItemName"),s=this.menu.globalStrings.game.upgrades;o.text=i.cost.toString(),r.text=s[e.upgradeID].toUpperCase(),n.removeAllChildren();var a=this.menu.get("PConfirmItemImage");a&&a.destroy(),a=t.ScreenUtil.makeImage(this.menu,"PConfirmItemImage",i.storeImage,{zIndex:n.zIndex}),a.x=-a.width/2,a.y=-a.height/2,n.addChild(a)}},i.prototype.confirmPurchase=function(){var t=this.menu.menuData[this.menu.activeScreen],e=t.onConfirm,i=this;this.menu.controller.exitScreen(this.menu.activeScreen,function(){e.apply(),i.menu.sendRequest("hideOverlay")})},i.prototype.declinePurchase=function(){var t=this.menu.menuData[this.menu.activeScreen],e=t.onDecline,i=this;this.menu.controller.exitScreen(this.menu.activeScreen,function(){e.apply(),i.menu.sendRequest("hideOverlay")})},i.prototype.closeScreen=function(){var t=this;this.menu.controller.exitScreen(this.menu.activeScreen,function(){t.menu.sendRequest("hideOverlay")})},i}(t.MenuCommands);t.PurchaseConfirmCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="HowToPlayCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["HowToPlayScreen","HowToPlayScreen2"],i.prototype.endHowToPlay=function(e){var i=this.menu.menuData[this.menu.activeScreen];"HowToPlayScreen2"==this.menu.activeScreen&&(t.PlayerData.instructionsFlag=!1),this.menu.controller.showScreen(i.pause?"PauseScreen":e.args.screen)},i}(t.MenuCommands);t.HowToPlayCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.NAME="PauseScreenCommands",e.COMMAND_AUTOLOAD=!0,e.SCREENS=["PauseScreen"],e.prototype.resume=function(){var t=this.menu.getActiveMenuData(),e=t.onResume,i=this;this.menu.controller.exitScreen(this.menu.activeScreen,function(){e.apply(),i.menu.sendRequest("hideOverlay")})},e.prototype.restart=function(){var t=this,e=this.menu.getMenuDataForScreen("ConfirmOverlay");e.returnScreenOnDecline="PauseScreen",e.onConfirm=function(){return t.onRestart()},this.menu.controller.showScreen("ConfirmOverlay")},e.prototype.howToPlay=function(){var t=this.menu.getMenuDataForScreen("HowToPlayScreen"),e=this.menu.getMenuDataForScreen("HowToPlayScreen2");t.pause=!0,e.pause=!0,this.menu.controller.showScreen("HowToPlayScreen")},e.prototype.levelSelect=function(){var t=this,e=this.menu.getMenuDataForScreen("ConfirmOverlay");e.returnScreenOnDecline="PauseScreen",e.onConfirm=function(){return t.onLevelSelect()},this.menu.controller.showScreen("ConfirmOverlay")},e.prototype.quit=function(){var t=this,e=this.menu.getMenuDataForScreen("ConfirmOverlay");e.returnScreenOnDecline="PauseScreen",e.onConfirm=function(){return t.onQuit()},this.menu.controller.showScreen("ConfirmOverlay")},e.prototype.onRestart=function(){this.setScene({args:{scene:"SuperChargersLevel"}})},e.prototype.onLevelSelect=function(){this.setScene({args:{scene:"GameMenu",args:["TrackSelectScreen"]}})},e.prototype.onQuit=function(){this.setScene({args:{scene:"GameMenu",args:["TitleScreen"]}})},e}(t.MenuCommands);t.PauseScreenCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.NAME="ConfirmOverlayCommands",e.COMMAND_AUTOLOAD=!0,e.SCREENS=["ConfirmOverlay"],e.prototype.confirm=function(){var t=this.menu.getActiveMenuData(),e=t.onConfirm,i=t.returnScreenOnConfirm;e.apply(),i&&this.menu.controller.showScreen(i)},e.prototype.decline=function(){var t=this.menu.getActiveMenuData(),e=t.onDecline,i=t.returnScreenOnDecline;e&&e.apply(),i&&this.menu.controller.showScreen(i)},e}(t.MenuCommands);t.ConfirmOverlayCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="ResultsOverlayCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["ResultsOverlay"],i.prototype.enterResultsScreen=function(){var e=this.menu.getActiveMenuData();e.tweens={},e.tweens.gearbits={},e.tweens.gearbits.value=0,e.tweens.time={},e.tweens.time.value=0,e.tweens.score={},e.tweens.score.value=0,this.menu.disableButtons(),e.placed?(this.menu.soundManager.stopSound("BGMLevel",!0),this.menu.soundManager.playSound("BGMMenu"),this.menu.bgm="BGMMenu"):(this.menu.soundManager.stopSound("BGMLevel",!0),this.menu.soundManager.playSound("BGMStinger"));var i=this.menu.get("NextButtonRSLTS"),n=this.menu.get("PlayAgainButtonRSLTS");i.alpha=0,n.alpha=0;for(var o=t.GameData.getStarsForScore(e.score,e.trackID),r=0;3>r;r++){var s=r+1,a=this.menu.get("ResultsStarGroup"+s),h=this.menu.get("ResultsStarWhite"+s),l=this.menu.get("ResultsStarBlack"+s);a.alpha=0,h.alpha=0,l.alpha=0,o>=s?h.alpha=1:l.alpha=1}for(var c=e.charData,r=0;3>r;r++){var s=r+1,u=this.menu.get("ResultsIconGroup"+s),p=this.menu.get("ResultsCharName"+s),d=this.menu.get("ResultsCharTime"+s),f=this.menu.get("ResultsPlaceText"+s);if(r>=c.length)break;var _=c[r],g=t.GameData.getCharacterData(_.characterID),m=t.ScreenUtil.makeImage(this.menu,"ResultsCharIcon"+s,g.mapIcon,{zIndex:u.zIndex});u.addChild(m);var y=this.menu.globalStrings.game.characters[_.characterID]||"CHOMPY";p.text=y.toUpperCase(),d.text=t.GameData.formatTimeFromFrames(_.time),f.text=s+this.menu.globalStrings.game.placement["suffix"+s]}},i.prototype.exitLevel=function(e){var i=this.menu.getActiveMenuData();this.setScene("Track003"==t.PlayerData.getSelectedTrack()&&i.placed?{args:{scene:"GameMenu",args:["EndScreen"]}}:e)},i.prototype.startResultsScreen=function(){function e(){var t=this.menu.getActiveMenuData(),e=t.tweens,i=this.menu.get("ResultGearBitText");i.text="X"+Math.floor(e.gearbits.value)}function i(){var e=this.menu.getActiveMenuData(),i=e.tweens,n=this.menu.get("ResultTimeText");n.text=t.GameData.formatTimeFromFrames(Math.floor(i.time.value))}function n(){var t=this.menu.getActiveMenuData(),e=t.tweens,i=this.menu.get("ResultScoreText");i.text=Avota.NumberUtil.addCommas(Math.floor(e.score.value))}function o(){var t=this.menu.get("NextButtonRSLTS"),e=this.menu.get("PlayAgainButtonRSLTS");this.menu.controller.resetImage(t.name),e&&this.menu.controller.resetImage(e.name),t.alpha=1,e&&(e.alpha=1),TweenMax.from(t,.3,{x:"+=500"}),e&&TweenMax.from(e,.3,{x:"-=500"}),this.menu.enableButtons()}var r=this,s=this.menu.getActiveMenuData(),a=s.tweens;this.menu.disableButtons(0);var h=new TimelineMax({onComplete:o.bind(this)});h.insert(TweenMax.to(a.gearbits,1,{value:s.gearbits,onUpdate:e.bind(this),ease:Linear.easeInOut})),h.insert(TweenMax.to(a.time,1,{value:s.time,onUpdate:i.bind(this),ease:Linear.easeInOut})),h.insert(TweenMax.to(a.score,3,{value:s.score,onUpdate:n.bind(this),ease:Linear.easeInOut}));for(var l=t.GameData.getStarsForScore(s.score,s.trackID),c=0;3>c;c++){var u=c+1,p=this.menu.get("ResultsStarGroup"+u);p.alpha=1,h.insert(TweenMax.from(p,l>=u?2:.5,{scale:0,ease:l>=u?Elastic.easeOut:Power2.easeOut,delay:3+.1*c}))}l>0?h.insert(TweenMax.delayedCall(3,function(){return r.menu.soundManager.playSound("SUIResultsStar")})):3==l&&h.insert(TweenMax.delayedCall(3,function(){return r.menu.soundManager.playSound("SUIResultsWin")}))},i}(t.MenuCommands);t.ResultsOverlayCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.NAME="TitleScreenCommands",e.COMMAND_AUTOLOAD=!0,e.SCREENS=["TitleScreen"],e.prototype.enterTitleScreen=function(){!Avota.EnvUtil.isMobile,this.menu.controller.transitionScreen(this.menu.getAsset("ScreenConfig").transitions.idle.GameMenuTitle)},e.prototype.endTitleScreen=function(t){this.menu.menuData[this.menu.activeScreen];this.menu.controller.showScreen(t.args.screen),this.menu.controller.transitionScreen(this.menu.getAsset("ScreenConfig").transitions.idle.GameMenuPostTitle)},e}(t.MenuCommands);t.TitleScreenCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.NAME="EndScreenCommands",i.COMMAND_AUTOLOAD=!0,i.SCREENS=["EndScreen"],i.prototype.enterEndScreen=function(){var e=this,i=(this.menu.getActiveMenuData(),t.PlayerData.getRaceResults()),n=this.menu.get("EndCharacterGroup"),o=t.GameData.getCharacterData(t.PlayerData.getSelectedCharacter());if(o.endScreenImage){var r=t.ScreenUtil.makeImage(this.menu,"EndScreenCharacter",o.endScreenImage,{zIndex:5});r.y=(640-r.height)/2,n.addChild(r)}TweenMax.delayedCall(.25,function(){return e.menu.soundManager.playSound("SUIEndScreenWin")});for(var s=0;3>s;s++){var a=i.charData[s],h=s+1,l=this.menu.get("EndScreenVehicleGroup"+h),c=this.menu.get("EndPlaceText"+h),u=this.menu.get("EndPlaceSuffix"+h);switch(c.text=h.toString(),u.text=this.menu.globalStrings.game.placement["suffix"+h],a.id){case"player":var p=this.menu.create(t.VehicleSprite,this.menu.timeManager,this.menu.renderManager,this.menu.spatialManager,"EndScreenVehicle"+h);p.set({zIndex:10,scale:.7}),p.setup(),p.showVehicle(t.PlayerData.getSelectedVehicle(),t.PlayerData.getActiveUpgrades()),l.addChild(p);var d=this.menu.get("EndScreenGlow"+h);d.alpha=1,TweenMax.to(d,20,{rotation:360,ease:Linear.easeInOut,repeat:-1});break;case"rival":var p=this.menu.create(t.VehicleSprite,this.menu.timeManager,this.menu.renderManager,this.menu.spatialManager,"EndScreenVehicle"+h);p.set({zIndex:10,scale:.7}),p.setup(),p.showVehicle(t.PlayerData.getRivalVehicle(),t.GameData.getOpponentData("rival").upgrades),l.addChild(p);break;default:var p=this.menu.create(t.VehicleSprite,this.menu.timeManager,this.menu.renderManager,this.menu.spatialManager,"EndScreenVehicle"+h);p.set({zIndex:10,scale:.7}),p.setup(),p.showVehicle(t.PlayerData.getRivalVehicle(2),t.GameData.getOpponentData("rival").upgrades),l.addChild(p)}}},i.prototype.exitEndScreen=function(){var t=this.menu.get("EndScreenCharacter");t.destroy();for(var e=0;3>e;e++){var i=e+1,n=(this.menu.get("EndScreenVehicleGroup"+i),this.menu.get("EndScreenVehicle"+i));n.destroy()}},i.prototype.startEndScreen=function(){var e=(this.menu.getActiveMenuData(),t.PlayerData.getRaceResults());this.menu.startBGM("BGMMenu",!0);for(var i=0;3>i;i++){var n=e.charData[i],o=i+1,r=this.menu.get("EndPlaceGroup"+o);switch(n.id){case"player":1==o&&this.menu.soundManager.playSound("VOYouWon"),TweenMax.to(r,.75,{scale:.96,yoyo:!0,repeat:-1,ease:Power1.easeInOut})}}},i}(t.MenuCommands);t.EndScreenCommands=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(n,o,r,s){"undefined"==typeof s&&(s=i.NAME),e.call(this,n,o,r,null,s),this._graphics={},this._game=Avota.Context.getContext(t.SuperChargersGame.NAME)}return __extends(i,e),i.NAME="VehicleSprite",i.prototype.setup=function(){var e=t.GameData.getUpgradeData(),i=t.GameData.getSelectableVehicleList();for(var n in e){var o=e[n];if(o.image){var r=(this.getAsset(o.image),t.ScreenUtil.makeImage(this._group,o.image+"_"+this.name,o.image,{zIndex:this.zIndex+5,x:0,y:0}));this._graphics[o.image]=r,this.addChild(r)}}for(var s=0;s<i.length;s++){var a=t.GameData.getVehicleData(i[s]);if(a.base){var r=(this.getAsset(a.base),t.ScreenUtil.makeImage(this._group,a.base+"_"+this.name,a.base,{zIndex:this.zIndex+4,x:0,y:0}));this._graphics[a.base]=r,this.addChild(r)}}},i.prototype.getAsset=function(t,e){return this._game.getAsset(t,e)},i.prototype.showVehicle=function(e,i){this.clear();var n=t.GameData.getUpgradeData(),o=t.GameData.getVehicleData(e),r=t.GameData.getData("shopVehicleLayering")[e],s=this._graphics[o.base];if(s){s.visible=!0,r&&(s.zIndex=this.zIndex+r.base);for(var a=0;a<i.length;a++){var h=n[i[a]];if(h.vehicle==e){var l=this._graphics[h.image];l.visible=!0,r&&(l.zIndex=this.zIndex+("special"==h.type?r.specialty:r.performance))}}}},i.prototype.destroy=function(){for(var t in this._graphics)this._graphics[t].destroy();this._graphics=null,this._game=null,e.prototype.destroy.call(this)},i.prototype.clear=function(){for(var t=0;t<this._children.length;t++){var e=this._children[t];e.visible=!1}},i}(Avota.ImageSprite);t.VehicleSprite=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(e){function i(t,n,o,r,s){e.call(this,t,t.globalStrings.ui.GUI,i.NAME),this._beenAttacked=!1,this._bonusEnabled=!0,this.date=new Date,this._racerWorld=n,this._inventory=o,this._boardDisplay=r,this.touchInput=s}return __extends(i,e),i.NAME="LevelGUI",i.prototype._onCreate=function(){e.prototype._onCreate.call(this),this.setScreenVars(),t.ScreenUtil.buildElements(this,this.getAsset("ScreenConfig").ui.GUI);var i=this.get("HUDPortraitGroup"),n=this.get("HUDCharGroup"),o=(this.get("HUDRescuedCharGroup1"),this.get("HUDRescuedCharGroup2"),this.get("HUDRescuedCharGroup3"),this.get("HUDRescuedCharAnim1")),r=this.get("HUDRescuedCharAnim2"),s=this.get("HUDRescuedCharAnim3");o.stop(),r.stop(),s.stop(),this._screenFX=this.create(t.ScreenFX,this._scene,this._scene.timeManager,this._scene.renderManager,this._scene.globalStrings,this._scene.screenWidth,this._scene.screenHeight),this._screenFX.zIndex=100;var a=this.create(Avota.CanvasGraphic,this._scene.timeManager,this._scene.renderManager,175,175,"BarFill");a.set({x:15,y:15,zIndex:3,rotation:115});var h=this.create(Avota.CanvasGraphic,this._scene.timeManager,this._scene.renderManager,175,175,"BarGlow");if(h.set({x:15,y:15,zIndex:4,rotation:115,alpha:0}),n.addChild(a),n.addChild(h),!Avota.EnvUtil.isMobile)for(var l=0;3>l;l++){var c=l+1,u=this.get("HUDProgressVehicleG"+c),p=this.create(t.VehicleSprite,this.timeManager,this.renderManager,this.spatialManager,"HUDProgressVehicle"+c);p.set({zIndex:u.zIndex}),p.setup(),u.addChild(p)}var d=t.GameData.getCharacterData(t.PlayerData.getSelectedCharacter()),f=t.ScreenUtil.makeImage(this,"HUDPortrait",d.portraitHUD,{zIndex:5});i.addChild(f),this.initTouchArea(),this.setHP(),this.setupRescuePortraits(),this.setupMap(),this.buttonSignal.add(this.buttonHandler,this),this._inventory.eventSignal.add(this.inventoryHandler,this,1),this._racerWorld.eventSignal.add(this.onWorldEvent,this),this._racerWorld.entitySignal.add(this.onEntityEvent,this),this.enableButtons()},i.prototype.setupRescuePortraits=function(){var e=this._racerWorld.getEntitiesInCategory("allies");if(e)for(var i=0;i<e.length;i++){var n=this._racerWorld.getEntity(e[i]),o=t.GameData.getData("allies")[n.type];if(o){var r=this.get("HUDRescuedCharGroup"+(i+1));if(r){var s=t.ScreenUtil.makeImage(this,"ally_img_"+(i+1),o.image,{zIndex:10});r.addChild(s)}}}this.updateRescuePortraits()},i.prototype.updateRescuePortraits=function(){var e=this._racerWorld.getEntitiesInCategory("allies");if(e)for(var i=0;i<e.length;i++){var n=i+1,o=this._racerWorld.getEntity(e[i]),r=t.GameData.getData("allies")[o.type];if(r){var s=(this.get("ally_img_"+n),this.get("HUDRescuedLock"+n)),a=this.get("HUDRescuedPortNeed"+n),h=this.get("HUDRescuedPortFound"+n),l=this.get("HUDRescuedCharAnim"+n);if(s&&a&&h){var c=this._inventory.isAllyUnlocked(o.type);c?(TweenMax.isTweening(s)||1!=s.visible||(l.alpha=1,l.play("unlock",0,0,function(){this.alpha=0}.bind(l)),TweenMax.to(s,.2,{alpha:0,scale:1.2,onComplete:function(){this.visible=!1},onCompleteScope:s,delay:.6*l.duration/1e3})),TweenMax.isTweening(h)||0!=h.visible||(h.visible=!0,TweenMax.from(h,.2,{alpha:0,delay:.6*l.duration/1e3}))):(s.visible=!0,s.alpha=1,s.scale=1,l.alpha=0,a.visible=!0,h.visible=!1)}}}},i.prototype.onWorldEvent=function(e){switch(e){case t.EventSignals.ENEMY_APPROACH:this.soundManager.playSound("SUIAlarm"),this._screenFX.showMessage(this._scene.globalStrings.game.messages.EnemyApproach);break;case t.EventSignals.RACE_BEGIN:this._boardDisplay&&(this._boardDisplay.unlock(),this._boardDisplay.enableInput());break;case t.EventSignals.RACE_END:this._boardDisplay&&(this._boardDisplay.disableInput(),this._boardDisplay.lock()),this._bonusEnabled=!1,this.disableButtons()}},i.prototype.onEntityEvent=function(e,i){switch(e){case t.EntitySignals.DAMAGED:var n=this._racerWorld.getEntity(i);"player"!=n.id||this._beenAttacked||(this._screenFX.showMessage(this._scene.globalStrings.game.messages.EnemyHint,null,null,1),this._beenAttacked=!0)}},i.prototype.initTouchArea=function(){for(var t=0;t<this._inventory.maxBonuses;t++){var e=this.get("BonusHit"+(t+1)),i=this.create(Avota.InputComponent,this.inputManager);i.inputMove.add(this.onMove,this),i.inputDown.add(this.onDown,this),i.inputUp.add(this.onUp,this),e.addComponent(i,Avota.EngineConstants.INPUT)}},i.prototype.onMove=function(){},i.prototype.onDown=function(){},i.prototype.onUp=function(e){if(this._bonusEnabled){var i=parseInt(e.name.match(/\d+/)[0]);this._inventory.getBonusInSlot(i-1)==t.GamePiece.KEY&&this._notification&&TweenMax.killTweensOf(this._notification.target),this._inventory.useBonusInSlot(i-1)}},i.prototype.buttonHandler=function(t,e,i){switch(e){case Avota.Button.OVER:break;case Avota.Button.DOWN:this.onButtonDown(t,i);break;case Avota.Button.UP:this.onButtonPress(t,i);break;case Avota.Button.OUT:}},i.prototype.inventoryHandler=function(e,i){var n=this;if(!this._racerWorld.hasEnded())switch(e){case t.InventoryEvent.BONUS_GET:break;case t.InventoryEvent.BONUS_USE:var o,r,s;switch(i.bonus){case t.EntityCommand.BONUS_SHIELD:o=o=this._scene.globalStrings.game.messages.ShieldUse,r=20,s=20;break;case t.EntityCommand.BONUS_ELIXIR:o=o=this._scene.globalStrings.game.messages.ElixirUse,r=20,s=20;break;case t.EntityCommand.BONUS_SHOE:o=o=this._scene.globalStrings.game.messages.ShoeUse,r=20,s=20;break;case"attack_extra":case"sattack_extra":case"engine_extra":o=o=this._scene.globalStrings.game.messages.Shuffle}o&&this._screenFX.showMessage(o),this.bonusIndicationCheck();break;case t.InventoryEvent.SLOT_FILLED:var a=this.get("HUDBonusGroup"+(i.slotIndex+1)),h=t.GameData.getData("bonuses")[i.bonus];a.removeAllChildren();var l=t.ScreenUtil.makeImage(this,a.name+"Bonus",h.display,{zIndex:20});a.addChild(l);var c=this._boardDisplay.getPieceLocation(i.sourceID);if(TweenMax.from(l,.5,{scale:.5,alpha:0}),c){var u=a.globalToLocal(c);TweenMax.from(l,.6,{x:u.x,y:u.y})}this.bonusIndicationCheck(.8);break;case t.InventoryEvent.SLOT_EMPTIED:var a=this.get("HUDBonusGroup"+(i.slotIndex+1)),l=this.get(a.name+"Bonus");if(!l)return;TweenMax.to(l,.2,{scale:1.2,alpha:0,onComplete:function(){return l.destroy()}});break;case t.InventoryEvent.ALLY_UNLOCKED:this._screenFX.showMessage(this._scene.globalStrings.game.messages.RescueMessage),this.updateRescuePortraits(),this.bonusIndicationCheck();break;case t.InventoryEvent.ALLY_UNLOCKABLE:this._screenFX.showMessage(this._scene.globalStrings.game.messages.RescueAlert),this._inventory.hasBonus(t.GamePiece.KEY)&&(this._notification=TweenMax.delayedCall(3,function(){return n._screenFX.showMessage(n._scene.globalStrings.game.messages.HintMessageKey)
})),this.bonusIndicationCheck();break;case t.InventoryEvent.ALLY_OFFSCREEN:this.bonusIndicationCheck()}},i.prototype.bonusIndicationCheck=function(e){"undefined"==typeof e&&(e=0);for(var i=0;i<this._inventory.maxBonuses;i++){var n=this._inventory.getBonusInSlot(i);if(n){var o=this.get("HUDBonusGroup"+(i+1)),r=this.get(o.name+"Bonus");if(r)if(TweenMax.killTweensOf(o),o.scale=1,n==t.EntityCommand.BONUS_KEY){for(var s=this._racerWorld.getEntitiesInCategory("allies"),a=!1,h=0;h<s.length;h++){var l=this._racerWorld.getEntity(s[h]);if(l.state==t.EntityState.UNLOCKABLE){a=!0;break}}a&&(TweenMax.isTweening(o)||TweenMax.to(o,.6,{scale:1.2,delay:e,yoyo:!0,repeat:-1}))}else TweenMax.to(o,.6,{scale:1.2,delay:e,yoyo:!0,repeat:-1})}}},i.prototype.onButtonDown=function(){},i.prototype.onButtonPress=function(t){var e=this;switch(t.name){case"PauseButton":this.menuOverlay&&(this.pauseGame(),this.menuOverlay.showPauseScreen(function(){return e.unpauseGame()}));break;case"SoundButton":this.toggleMute(null,null);break;case"AccelButton":this.touchInput&&this.touchInput.onReleaseAccel();break;case"BrakeButton":this.touchInput&&this.touchInput.onReleaseBrake();break;case"Fire1Button":this.touchInput&&this.touchInput.onReleaseFire();break;case"Fire2Button":this.touchInput&&this.touchInput.onReleaseFire2()}},i.prototype.hideAll=function(){for(var t=this.getAll(),e=0;e<t.length;e++)t[e].visible=!1},i.prototype.pauseGame=function(){this._scene.pause(),this.disableButtons()},i.prototype.unpauseGame=function(){this._scene.resume(),this.enableButtons()},i.prototype.scaleMeter=function(t,e,i){t.clear(),t.beginPath(),t.arc(t.width/2,t.height/2,t.width/2,0,Avota.GeomUtil.degreesToRadians(e),!1),t.lineTo(t.width/2,t.height/2),t.fillStyle=i||"#367EEA",t.fill()},i.prototype.setPlacement=function(){for(var e=this._scene.globalStrings.game.placement,i=this._scene.globalStrings.game.characters,n=this._racerWorld.getEntitiesInCategory("racers"),o=0;o<n.length;o++){var r=this._racerWorld.getEntity(n[o]),s=""+r.place,a=i[t.PlayerData.getCharIDForEntity(r.id)],h="";for(var l in e)if(String(l).match(String(r.place))){h=e[l];break}if(""==h&&(h=e.suffix4),r.place<=3){var c=this.get("HUDProgressPlace"+r.place),u=this.get("HUDProgressSuffix"+r.place),p=this.get("HUDProgressName"+r.place),d=this.get("HUDProgressVehicle"+s);c.text!=s&&(c.text=s),u.text!=h&&(u.text=h),p.text!=a&&(p.text=a,d&&d.showVehicle(r.type,"player"==r.id?t.PlayerData.getActiveUpgrades():t.GameData.getOpponentData("rival").upgrades))}if("player"==r.id){var f=this.get("HUDPlacementText"),_=this.get("HUDPlacementSuffix");f.text!=s&&(f.text=s),_.text!=h&&(_.text=h)}}},i.prototype.setHP=function(){var t=this.screenVars.HP.barScale,e=Math.round(180*t),i=this.get("BarFill");this.scaleMeter(i,e,this.screenVars.HP.barColor)},i.prototype.setCurrency=function(){var t=this.get("HUDCurrencyText"),e=Math.floor(this.screenVars.CURRENCY.textValue);t.text=Avota.NumberUtil.addLeadingZeros(e,5,!1)},i.prototype.setScore=function(){var t=this.get("HUDScoreText"),e=Math.floor(this.screenVars.SCORE.textValue);t.text=Avota.NumberUtil.addLeadingZeros(e,6,!1)},i.prototype.setEnergy=function(){var t=this.screenVars.ENERGY.barWidth,e=this.screenVars.ENERGY.barWidth*this.screenVars.ENERGY.barScale,i=this.screenVars.ENERGY.barHeight,n=this.screenVars.ENERGY.barOffset,o=this.get("EnergyFill");return 0>e?void o.clear():(o.clear(),o.beginPath(),o.moveTo(t-n,i),o.lineTo(t,0),o.lineTo(t-e,0),o.lineTo(t-e-n,i),o.closePath(),o.fillStyle=this.screenVars.ENERGY.barColor,void o.fill())},i.prototype.setupMap=function(){var e=this._racerWorld.getEntitiesInCategory("racers"),i=this._racerWorld.track.mapData,n=this.get("HUDMapGroup"),o=t.ScreenUtil.makeImage(this,"HUDMap",this._racerWorld.track.mapImage,{zIndex:7}),r=i.nodes[0];n.addChild(o);var s=t.ScreenUtil.makeImage(this,"HUDMapFlag","HUDMapFlag",{zIndex:8});s.x=r.point.x-s.width/2,s.y=r.point.y-s.height/2,n.addChild(s);for(var a=0;a<e.length;a++){{var h,l,c=e[a];this._racerWorld.getEntity(c)}switch(c){case"player":l=t.GameData.getCharacterData(t.PlayerData.getSelectedCharacter()),h=l.mapIcon;break;case"rival":l=t.GameData.getCharacterData(t.PlayerData.getRivalCharacter(1)),h=l.mapIcon;break;default:l=t.GameData.getCharacterData(t.PlayerData.getRivalCharacter(2)),h=l.mapIcon}var u=t.ScreenUtil.makeImage(this,"MapIcon"+c,h,{zIndex:"player"==c?20+a:10+a});n.addChild(u),u.x=r.point.x-u.width/2,u.y=r.point.y-u.height/2}},i.prototype.updateMap=function(){for(var t=this._racerWorld.getEntitiesInCategory("racers"),e=(this._racerWorld.getEntity(this._racerWorld.getEntitiesInCategory("racemarker")[0]),this.get("HUDMapGroup"),this.get("HUDMap"),this._racerWorld.track.mapData),i=0;i<t.length;i++){for(var n,o,r=t[i],s=this._racerWorld.getEntity(r),a=this.get("MapIcon"+r),h=s.x,l=h/this._racerWorld.track.trackLength,c=e.totalDist*l,u=1;u<e.nodes.length;u++){var p=e.nodes[u];if(p.dist>c){n=e.nodes[u],o=e.nodes[u-1];break}}var d=c-o.dist,f=n.distToPrev,_=Avota.Point.interpolate(n.point,o.point,d/f);a.centerX=_.x,a.centerY=_.y}},i.prototype.getAsset=function(t){return this._scene.getAsset(t)},i.prototype.onTick=function(t){this.updateScreenVars(),this.incrementTime(),this.touchInput&&this.touchInput.detectGestures(t)},i.prototype.setScreenVars=function(){this.screenVars={},this.screenVars.HP={},this.screenVars.HP.hpScale=1,this.screenVars.HP.barScale=1,this.screenVars.HP.barColor="#367EEA",this.screenVars.HP.glowColor="#A1E3E3",this.screenVars.SCORE={},this.screenVars.SCORE.value=1,this.screenVars.SCORE.textValue=1,this.screenVars.CURRENCY={},this.screenVars.CURRENCY.value=0,this.screenVars.CURRENCY.textValue=0,this.screenVars.PLACE={},this.screenVars.PLACE.value=0,this.screenVars.PLACE.textValue=0,this.screenVars.MAP={},this.screenVars.MAP.height=180},i.prototype.updateScreenVars=function(){var e=this._racerWorld.getEntity("player");if(this.screenVars.HP.hpScale!=e.getHPScale()){var i=this.get("BarGlow");i.alpha=1,TweenMax.killTweensOf(this.screenVars.HP),TweenMax.killTweensOf(i),this.screenVars.HP.hpScale=e.getHPScale(),this.scaleMeter(i,Math.round(180*this.screenVars.HP.barScale),this.screenVars.HP.glowColor),TweenMax.to(i,.8,{alpha:.01}),TweenMax.to(this.screenVars.HP,.3,{barScale:e.getHPScale(),onUpdate:this.setHP.bind(this)})}this.screenVars.CURRENCY.value!=t.PlayerData.getCurrency()&&(this.screenVars.CURRENCY.value=t.PlayerData.getCurrency(),Avota.EnvUtil.isMobile?this.screenVars.CURRENCY.textValue=t.PlayerData.getCurrency():TweenMax.to(this.screenVars.CURRENCY,.3,{textValue:t.PlayerData.getCurrency(),onUpdate:this.setCurrency.bind(this)})),this.screenVars.SCORE.value!=this._racerWorld.scoreData.getBaseScore()&&(this.screenVars.SCORE.value=this._racerWorld.scoreData.getBaseScore(),Avota.EnvUtil.isMobile?this.screenVars.SCORE.textValue=this._racerWorld.scoreData.getBaseScore():TweenMax.to(this.screenVars.SCORE,.3,{textValue:this._racerWorld.scoreData.getBaseScore(),onUpdate:this.setScore.bind(this)})),this.screenVars.PLACE.value!=e.place&&(this.screenVars.PLACE.value=e.place),this.setPlacement(),this.updateMap()},i.prototype.incrementTime=function(){if(this._racerWorld.frameCount%3==0){var e=this.get("HUDTimeText"),i=(this._racerWorld.raceEndFrame||this._racerWorld.frameCount)-(this._racerWorld.raceStartFrame||this._racerWorld.frameCount);e.text=t.GameData.formatTimeFromFrames(i,Avota.EnvUtil.isDesktop)}},i}(Avota.GameUI);t.LevelGUI=e}(Skylanders||(Skylanders={}));var Skylanders;!function(t){var e=function(){function e(){}return e.NAME="ScreenUtil",e.makeDebugGrid=function(t,e,i){var n=t.create(Avota.CanvasGraphic,t.timeManager||t.globalTimeManager,t.renderManager,e,i);n.set({zIndex:120,x:0,y:0,alpha:.5});for(var o=0;(e>i?e:i)>o;o+=10)n.strokeStyle=o%50==0?"#000088":"#008800",n.strokeStyle=o%100==0?"#FF0000":n.strokeStyle,n.beginPath(),n.moveTo(o,0),n.lineTo(o,i),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(0,o),n.lineTo(e,o),n.closePath(),n.stroke();return n},e.drawBounds=function(t,e){var i=t.create(Avota.CanvasGraphic,t.timeManager||t.globalTimeManager,t.renderManager,e.width,e.height);return i.strokeStyle="#FF0000",i.beginPath(),i.moveTo(1,1),i.lineTo(1,i.height-1),i.lineTo(i.width-1,i.height-1),i.lineTo(i.width-1,1),i.lineTo(1,1),i.closePath(),i.stroke(),i.set({x:e.x,y:e.y,zIndex:e.zIndex+1,scale:e.scale,rotation:e.rotation,registrationX:e.registrationX,registrationY:e.registrationY}),e.text&&i.set({left:e.left,top:e.top}),i},e.getAssetListForElements=function(t,e){function i(t,e){for(var i in t)n(t[i],e)}function n(t,e){for(var i=0;i<t.length;i++){var n=t[i];if("image"==n.type){var r=n.asset;o(r,e)}else if("anim"==n.type){var s=n.spritesheetID+"Image",a=n.spritesheetID+"Data";o(s,e),o(a,e)}}}function o(t,e){for(var i=0;i<e.length;i++)if(t==e[i])return;e.push(t)}var r=e||[];return t.length?n(t,r):i(t,r),r},e.makeGroup=function(t,e,i){new Avota.ImageSprite;var n=t.create(Avota.ImageSprite,t.timeManager||t.globalTimeManager,t.renderManager,t.spatialManager,null,e);return n.set(i),n},e.makeImage=function(t,e,i,n){var o=t.create(Avota.ImageGraphic,t.timeManager||t.globalTimeManager,t.renderManager,t.getAsset(i),e),r={};for(var s in n)r[s]=n[s];return r.active=null==n.active||n.active,r.visible=null==n.visible||n.visible,o.set(r),o},e.makeSprite=function(t,e,i,n,o){var r=t.create(Avota.AnimatedGraphic,t.timeManager||t.globalTimeManager,t.renderManager,null,e);if(i instanceof Array){if(i instanceof Array)for(var s=0;s<i.length;s++)r.addSpriteSheet(i[s])}else r.addSpriteSheet(i);var a={};for(var h in o)a[h]=o[h];a.active=null==o.active||o.active,a.visible=null==o.visible||o.visible,r.set(a);for(var s=0;s<n.length;s++){var l=n[s];r.addAnimation(l.name,l.spritesheet,l.frame,l.duration,l.loop?Avota.SpriteSheetAnimation.LOOP:Avota.SpriteSheetAnimation.PLAY_ONCE)}return r.play(n[0].name),r},e.makeText=function(t,e,i,n){var o=t.create(Avota.TextGraphic,t.timeManager||t.globalTimeManager,t.renderManager,null,e);n||(n=t._strings);var r={};for(var s in i)r[s]=i[s];r.active=null==i.active||i.active,r.visible=null==i.visible||i.visible;var a=i.text||"                                ";if(n)for(var h=0;h<n.length;h++){var l=n[h];if(l.name==e){a=l.value,i.style=l.style;break}}return o.text=a,o.set(r),i.style&&o.setStyle(i.style),o.onTick(0),o},e.makeButton=function(t,e,i,n,o){var r=i,s={};s.label={text:o.text||"",shadow:!1,shadowStrength:12,shadowColor:"#FFFFFF"},r.getFrame(n+"_up.png")?s.up={prefix:n+"_up.png"}:null,r.getFrame(n+"_over.png")?s.over={prefix:n+"_over.png"}:null,r.getFrame(n+"_down.png")?s.down={prefix:n+"_down.png"}:null;var a=t.create(Avota.Button,e,t.timeManager||t.globalTimeManager,t.renderManager,t.inputManager,r,s),h={};for(var l in o)h[l]=o[l];return h.labelOffsetX=o.lableOffsetX||0,h.labelOffsetY=o.lableOffsetY||-3,a.set(h),a.textLabel.onTick(0),a},e.makeRect=function(t,e,i,n,o,r){var s=t.create(Avota.RectSprite,t.timeManager||t.globalTimeManager,t.renderManager,t.spatialManager,n,o,i,e),a={};for(var h in r)a[h]=r[h];return a.active=null==r.active||r.active,a.visible=null==r.visible||r.visible,s.set(a),s},e.makeSingleFrameSprite=function(t,e,i,n,o){var r=t.create(Avota.SpriteSheet,t.getAsset(i+"Image",t.config.loader),t.getAsset(i+"Data",t.config.loader)),s=t.create(Avota.SingleFrameGraphic,t.timeManager||t.globalTimeManager,t.renderManager,r,n,e),a={};for(var h in o)a[h]=o[h];return a.active=null==o.active||o.active,a.visible=null==o.visible||o.visible,s.set(a),s},e.buildElements=function(i,n,o,r){r=r||{};for(var s=0;s<n.length;s++){var a,h=n[s];if(h.env){if("mobile"==h.env&&!Avota.EnvUtil.isMobile)continue;if("desktop"==h.env&&!Avota.EnvUtil.isDesktop)continue}switch(h.type){case"image":a=e.makeImage(i,h.name,h.asset,h.params);break;case"text":a=e.makeText(i,h.name,h.params,o);break;case"grid":var l=Avota.Context.getContext(t.SuperChargersGame.NAME);a=e.makeDebugGrid(i,l.config.config.width,l.config.config.height);break;case"rect":a=e.makeRect(i,h.name,h.color,h.width,h.height,h.params);break;case"button":var c=r[h.spritesheetID]?r[h.spritesheetID]:i.create(Avota.SpriteSheet,i.getAsset(h.spritesheetID+"Image"),i.getAsset(h.spritesheetID+"Data"));r[h.spritesheetID]||(r[h.spritesheetID]=c),a=e.makeButton(i,h.name,c,h.prefix,h.params);break;case"group":a=e.makeGroup(i,h.name,h.params);break;case"anim":var c=r[h.spritesheetID]?r[h.spritesheetID]:i.create(Avota.SpriteSheet,i.getAsset(h.spritesheetID+"Image"),i.getAsset(h.spritesheetID+"Data"),h.spritesheetID);r[h.spritesheetID]||(r[h.spritesheetID]=c),a=e.makeSprite(i,h.name,c,h.animations,h.params)}if(h.group){var u=i.get(h.group);if(!u){console.error("[!ScreenUtil] Parent",h.group,"not defined");continue}u.addChild(a)}}},e}();t.ScreenUtil=e}(Skylanders||(Skylanders={}));